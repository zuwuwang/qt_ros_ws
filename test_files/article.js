if(typeof Sina=="undefined"){Sina={}}Sina.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Sina;for(var i=levels[0]=="Sina"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};function $E(oID){var node=typeof oID=="string"?document.getElementById(oID):oID;if(node!=null){return node}return null}function $C(tagName){return document.createElement(tagName)}function $N(name){return document.getElementsByName(name)}function $T(obj,tagName){return obj.getElementsByTagName(tagName)}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}!function(){var bind=function(fFunction,object){var __method=fFunction;return function(){return __method.apply(object,arguments)}};var debug_namespace="Debug";if(window[debug_namespace]==null||typeof window[debug_namespace].log=="undefined"){window[debug_namespace]={cacheData:[],base_url:"http://sjs.sinajs.cn/bind2/",product:scope.$PRODUCT_NAME,baseColor:{1:{color:"#FFF",bgcolor:"#E00"},2:{color:"#F00"},3:{color:"#FFF000"},4:{color:"#0F0"},5:{color:"#FFF"}},fatal:function(sInfo){this.addData(sInfo,1)},error:function(sInfo){this.addData(sInfo,2)},warning:function(sInfo){this.addData(sInfo,3)},info:function(sInfo){this.addData(sInfo,4)},log:function(sInfo){this.addData(sInfo,5)},dir:function(oInfo){this.addData(oInfo,5)},addData:function(sInfo,nType,sColor,sBgColor){if(sInfo==null){return}if(typeof sInfo!="object"){sInfo=sInfo.toString()}var oOption={type:nType||"5",color:sColor||this.baseColor[nType].color,bgcolor:sBgColor||this.baseColor[nType].bgcolor};this.cacheData.push([sInfo,oOption]);if(this.initFinished==true){this.showCurrentData([sInfo,oOption])}}};window.trace=bind(window[debug_namespace].log,window[debug_namespace]);window.traceError=bind(window[debug_namespace].error,window[debug_namespace])}}();Sina.pkg("Core");if(typeof Core=="undefined"){Core=Sina.Core}Sina.pkg("Core.Array");Core.Array.foreach=function(ar,insp){if(ar==null&&ar.constructor!=Array){return[]}var i=0,len=ar.length,r=[];while(i<len){var x=insp(ar[i],i);if(x!==null){r[r.length]=x}i++}return r};Sina.pkg("Core.Events");!function(_s){var _ua=navigator.userAgent.toLowerCase();var system={$winXP:/windows nt 5.1/.test(_ua),$winVista:/windows nt 6.0/.test(_ua),$win7:/windows nt 6.1/.test(_ua),$macOS:/mac/.test(_ua)};var browser={$OPERA:false,$IE6:false,$IE7:false,$IE8:false,$IE9:false,$SAFARI:false,$FF2:false,$FF3:false,$FF4:false,$FF:false,$CHROME:false,$TT:false,$360:false,$SOGO:false,$Maxthon:false};var engine={$IE:0,$MOZ:false,$WEBKIT:false,$KHTML:false};if(/opera/.test(_ua)||_s.opera){browser.$OPERA=true}else if(/chrome\/(\S+)/.test(_ua)){browser.$CHROME=true}else if(/safari\/(\S+)/.test(_ua)){browser.$SAFARI=true}else if(/msie/.test(_ua)){engine.$IE=true;if(/360se/.test(_ua)){browser.$360=true}else if(/tencenttraveler/.test(_ua)){browser.$TT=true}else if(/se\s\S+\smetasr\s\d+\.\d+/.test(_ua)){browser.$SOGO=true}var uaVersionArray=_ua.match(/msie (\d+)/);var version=parseInt(uaVersionArray[1]);engine.$IE=version;if(version===8){browser.$IE8=true}else if(version===6){browser.$IE6=true}else if(version===9){browser.$IE9=true}else if(version===7){browser.$IE7=true}else if(version===10){browser.$IE10=true}}else if(/firefox/.test(_ua)){var uaVersionArray=_ua.match(/firefox\/(\d+)/);browser.$FF=parseInt(uaVersionArray[1]);if(/firefox\/3/.test(_ua)){browser.$FF3=true}else if(/firefox\/4/.test(_ua)){browser.$FF4=true}else if(/firefox\/2/.test(_ua)){browser.$FF2=true}}else if(/trident\/7.0/.test(_ua)&&/rv:11.0/.test(_ua)){engine.$IE=11;browser.$IE11=true}try{var t=window.external;browser.$Maxthon=t.max_version?true:false}catch(e){}if(/applewebkit\/(\S+)/.test(_ua)){engine.$WEBKIT=true}else if(/khtml\/(\S+)/.test(_ua)){engine.$KHTML=true}else if(/rv:([^\)]+)\) gecko\/\d{8}/.test(_ua)){engine.$MOZ=true}browser.$MOBILE=/mobile/i.test(_ua);if(!browser.$MOBILE){browser.$MOBILE=/HTC/.test(_ua)}function apply(thisObj,cfg){var p;for(p in cfg){thisObj[p]=cfg[p]}}apply(_s,browser);apply(_s,engine);apply(_s,system)}(window);Core.Events.addEvent=function(elm,func,evType,useCapture){var _el=typeof elm=="string"?$E(elm):elm;if(_el==null){trace("addEvent 找不到对象："+elm);return}if(typeof useCapture=="undefined"){useCapture=false}if(typeof evType=="undefined"){evType="click"}if(_el.addEventListener){if(evType=="mousewheel"&&$FF){evType="DOMMouseScroll"}_el.addEventListener(evType,func,useCapture);return true}else if(_el.attachEvent){var r=_el.attachEvent("on"+evType,func);return true}else{_el["on"+evType]=func}};Core.Events.removeEvent=function(oElement,fHandler,sName){var _el=$E(oElement);if(_el==null){trace("removeEvent 找不到对象："+oElement);return}if(typeof fHandler!="function"){return}if(typeof sName=="undefined"){sName="click"}if(_el.addEventListener){_el.removeEventListener(sName,fHandler,false)}else if(_el.attachEvent){_el.detachEvent("on"+sName,fHandler)}fHandler[sName]=null};Sina.pkg("Core.Function");Core.Function.bind3=function(fFunc,object,args){args=args==null?[]:args;var __method=fFunc;return function(){return __method.apply(object,args)}};Core.Array.findit=function(arr,v){var k=-1;Core.Array.foreach(arr,function(value,index){if(v==value){k=index}});return k};window.onerror=function(err,file,line){trace("Error occured:"+err+"<br/>file:"+file+"<br/>line:"+line+"<br/>");return true};function Jobs(oOption){this.option=oOption||{};this._jobTable=[[],[],[],[]]}Jobs.prototype={_registedJobTable:{},errorMsg:[],_registJob:function(jobName,rel){this._registedJobTable[jobName]=rel},error:function(sMsg){Debug.error(sMsg);this.errorMsg.push(sMsg)},add:function(jobName,type){type=type||1;if(Core.Array.findit(this._jobTable[type],jobName)==-1){this._jobTable[type].push(jobName)}else{this.error("Error: Job <b>"+jobName+"</b> is existed now.")}},start:function(){if(this.option.onStart!=null){this.option.onStart()}var regJobs=this._registedJobTable;var jobs=this._jobTable[1].concat(this._jobTable[2]);var _this=this;this.fe=Core.Function.bind3(_this.focus,_this,[]);var addFocus=function(){if(_this._jobTable[3].length==0){if(_this.option.onEnd!=null){_this.option.onEnd()}return}Core.Events.addEvent(document.body,_this.fe,"focus");Core.Events.addEvent(window,_this.fe,"scroll");Core.Events.addEvent(document.body,_this.fe,"mousemove");Core.Events.addEvent(document.body,_this.fe,"mouseover")};this.queue(jobs,addFocus)},focus:function(){var _this=this;if(this.focusdown){Core.Events.removeEvent(document.body,_this.fe,"focus");Core.Events.removeEvent(window,_this.fe,"scroll");Core.Events.removeEvent(document.body,_this.fe,"mousemove");Core.Events.removeEvent(document.body,_this.fe,"mouseover");_this.fe=null;return}this.focusdown=true;var jobs=this._jobTable[3];this.queue(jobs,this.option.onEnd)},queue:function(jobs,callback){var _this=this;var getTime=function(){return(new Date).valueOf()};var regJobs=this._registedJobTable;var joblen=jobs.length;var i=0;var interNum=window.setInterval(function(){if(i>=joblen){clearInterval(interNum);interNum=null;if(callback!=null){callback()}return}var jobName=jobs[i];var job=regJobs[jobName];i++;if(typeof job=="undefined"){_this.error("<b>Job["+jobName+"] is undefiend!!!</b>");return}var _try=true;var _start=getTime();try{job.call()}catch(e){_this.error("<b>Job["+jobName+"] failed!!!</b>"+e.message+"");if(callback!=null){callback()}_try=false;throw e}finally{if(_try){var _end=getTime();Debug.info("<b>Job["+jobName+"] done in "+(_end-_start)+"ms.</b>")}}},10)},call:function(jobName,args){if(typeof this._registedJobTable[jobName]!="undefined"){this._registedJobTable[jobName].apply(this,args)}else{trace("<b>Job["+jobName+"] is undefined!!!</b>",{color:"#900",bgColor:"#FFF;"})}}};$registJob=function(name,rel){Jobs.prototype._registJob(name,rel)};$callJob=function(name){var args=[];if(arguments.length>1){Core.Array.foreach(arguments,function(v,i){args[i]=v});args.shift()}Jobs.prototype.call(name,args)};if(typeof Lib=="undefined"){Lib={}}Lib.pkg=function(ns){if(!ns||!ns.length){return null}var levels=ns.split(".");var nsobj=Lib;for(var i=levels[0]=="Lib"?1:0;i<levels.length;++i){nsobj[levels[i]]=nsobj[levels[i]]||{};nsobj=nsobj[levels[i]]}return nsobj};Lib.register=function(name,fn){var ns=name.split(".");var obj={},tmp,nsobj=Lib;while(tmp=ns.shift()){if(ns.length){if(nsobj[tmp]===undefined){nsobj[tmp]={}}nsobj=nsobj[tmp]}else{if(nsobj[tmp]===undefined){nsobj[tmp]=fn(Lib)}}}};Lib.register("Listener",function(){var _this={};_this.listeners={};return{add:function(name){if(_this.listeners[name]){throw new Error("listener '"+name+"' has registed!")}_this.listeners[name]=[]},remove:function(name){if(_this.listeners[name]){_this.listeners[name]=null;return true}return false},notify:function(name,data){var listeners=_this.listeners[name],handle=null;if(!listeners){return}for(var i=0,len=listeners.length;i<len;i++){handle=listeners[i];handle.callBack.call(handle.scope,data)}},on:function(o){var args=arguments,handle=null;for(var i=0,len=args.length;i<len;i++){handle=args[i];if(!this.isListen(handle)){if(!_this.listeners[handle.name]){_this.listeners[handle.name]=[]}_this.listeners[handle.name].push(handle)}}},off:function(o){var handlers=_this.listeners[o.name];if(!handlers){return true}var handle=null;for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==o.callBack&&handle.scope==o.scope){handlers.splice(i,1)}}},isListen:function(listener){var handlers=_this.listeners[listener.name];var handle=null;if(!handlers){return false}for(var i=0,len=handlers.length;i<len;i++){handle=handlers[i];if(handle.callBack==listener.callBack&&handle.scope==listener.scope){return true}}return false}}});Sina.pkg("Core.Dom");Core.Dom.insertHTML=function(el,html,where){el=$E(el)||document.body;where=where.toLowerCase()||"beforeend";if(el.insertAdjacentHTML){switch(where){case"beforebegin":el.insertAdjacentHTML("BeforeBegin",html);return el.previousSibling;case"afterbegin":el.insertAdjacentHTML("AfterBegin",html);return el.firstChild;case"beforeend":el.insertAdjacentHTML("BeforeEnd",html);return el.lastChild;case"afterend":el.insertAdjacentHTML("AfterEnd",html);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'}var range=el.ownerDocument.createRange();var frag;switch(where){case"beforebegin":range.setStartBefore(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el);return el.previousSibling;case"afterbegin":if(el.firstChild){range.setStartBefore(el.firstChild);frag=range.createContextualFragment(html);el.insertBefore(frag,el.firstChild);return el.firstChild}else{el.innerHTML=html;return el.firstChild}break;case"beforeend":if(el.lastChild){range.setStartAfter(el.lastChild);frag=range.createContextualFragment(html);el.appendChild(frag);return el.lastChild}else{el.innerHTML=html;return el.lastChild}break;case"afterend":range.setStartAfter(el);frag=range.createContextualFragment(html);el.parentNode.insertBefore(frag,el.nextSibling);return el.nextSibling}throw'Illegal insertion point -> "'+where+'"'};Core.Dom.setStyle=function(el,property,val){switch(property){case"opacity":el.style.filter="alpha(opacity="+val*100+")";if(!el.currentStyle||!el.currentStyle.hasLayout){el.style.zoom=1}break;case"float":property="styleFloat";default:el.style[property]=val}};if(!$IE||!($IE<9)){Core.Dom.setStyle=function(el,property,val){if(property=="float"){property="cssFloat"}el.style[property]=val}}Sina.pkg("Core.String");Core.String.formatNumber=function(n){n=n+"";return n.replace(/(\d{1,3})(?=(\d{3})+(?:$|\.))/g,"$1,")};Core.String.encodeHTML=function(str){var div=document.createElement("div");div.appendChild(document.createTextNode(str));return div.innerHTML.replace(/\s/g,"&nbsp;")};Core.String.trimHead=function(str){return str.replace(/^(\u3000|\s|\t)*/gi,"")};Core.String.trimTail=function(str){return str.replace(/(\u3000|\s|\t)*$/gi,"")};Core.String.trim=function(str){return Core.String.trimHead(Core.String.trimTail(str))};Sina.pkg("Utils");if(typeof Utils=="undefined"){Utils=Sina.Utils}Sina.pkg("Utils.Io");Sina.pkg("Core.System");!function(){var parseParam=function(oSource,oParams){var key;try{if(typeof oParams!="undefined"){for(key in oSource){if(oParams[key]!=null){oSource[key]=oParams[key]}}}}finally{key=null;return oSource}};Core.System.parseParam=parseParam}();Utils.Url=function(url){url=url||"";this.url=url;this.query={};this.parse()};Utils.Url.prototype={parse:function(url){if(url){this.url=url}this.parseAnchor();this.parseParam()},parseAnchor:function(){var anchor=this.url.match(/\#(.*)/);anchor=anchor?anchor[1]:null;this._anchor=anchor;if(anchor!=null){this.anchor=this.getNameValuePair(anchor);this.url=this.url.replace(/\#.*/,"")}},parseParam:function(){var query=this.url.match(/\?([^\?]*)/);query=query?query[1]:null;if(query!=null){this.url=this.url.replace(/\?([^\?]*)/,"");this.query=this.getNameValuePair(query)}},getNameValuePair:function(str){var o={};str.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(w,n,v){if(n==""){return}o[n]=v||""});return o},getParam:function(sPara){return this.query[sPara]||""},clearParam:function(){this.query={}},setParam:function(name,value){if(name==null||name==""||typeof name!="string"){throw new Error("no param name set")}this.query=this.query||{};this.query[name]=value},setParams:function(o){this.query=o},serialize:function(o){var ar=[];for(var i in o){if(o[i]==null||o[i]==""){ar.push(i+"=")}else{ar.push(i+"="+o[i])}}return ar.join("&")},toString:function(){var queryStr=this.serialize(this.query);return this.url+(queryStr.length>0?"?"+queryStr:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(forceSharp){return this.anchor?"#"+this.serialize(this.anchor):forceSharp?"#":""}};Core.String.encodeDoubleByte=function(str){if(typeof str!="string"){return str}return encodeURIComponent(str)};Utils.Io.JsLoad={};!function(){function createScripts(oOpts,oCFG){processUrl(oOpts,oCFG);var urls=oOpts.urls;var i,len=urls.length;for(i=0;i<len;i++){var js=$C("script");js.src=urls[i].url;js.charset=urls[i].charset;js.onload=js.onerror=js.onreadystatechange=function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}oCFG.script_loaded_num++;js.onload=js.onreadystatechange=js.onerror=null;if(!1!==oOpts.isRemove){js.src="";js.parentNode.removeChild(js)}js=null};document.getElementsByTagName("head")[0].appendChild(js)}}function processUrl(oOpts,oCFG){var urls=oOpts.urls;var get_hash=oOpts.GET;var i,len=urls.length;var key,url_cls,varname,rnd;for(i=0;i<len;i++){rnd=window.parseInt(Math.random()*1e8);url_cls=new Utils.Url(urls[i].url);for(key in get_hash){if(oOpts.noencode==true){url_cls.setParam(key,get_hash[key])}else{url_cls.setParam(key,Core.String.encodeDoubleByte(get_hash[key]))}}varname=url_cls.getParam("varname")||"requestId_"+rnd;if(oOpts.noreturn!=true){url_cls.setParam("varname",varname)}if(oOpts.returnType=="jsonp"){var name=url_cls.getParam("callback")||"callback_"+rnd;var callback="script_callbackes."+name;url_cls.setParam("callback",callback);if(!window.script_callbackes){window.script_callbackes=[]}window.script_callbackes[name]=function(res){oCFG.is_loadcomplete=true;delete window.script_callbackes[name];if(oCFG.timeout_flag!=null){clearTimeout(oCFG.timeout_flag)}if(oCFG.is_timeout){return}if(oOpts.onComplete!=null){oOpts.onComplete(res)}}}oCFG.script_var_arr.push(varname);urls[i].url=url_cls.toString();urls[i].charset=urls[i].charset||oOpts.charset}}function ancestor(aUrls,oOpts){var _opts={isRemove:!0,urls:[],charset:"utf-8",noreturn:false,noencode:false,returnType:"",timeout:-1,POST:{},GET:{},onComplete:null,onException:null};var _cfg={script_loaded_num:0,is_timeout:false,is_loadcomplete:false,script_var_arr:[],timeout_flag:null};_opts.urls=typeof aUrls=="string"?[{url:aUrls}]:aUrls;Core.System.parseParam(_opts,oOpts);createScripts(_opts,_cfg);if(_opts.returnType!="jsonp"){!function(){if(_opts.noreturn==true&&_opts.onComplete==null){return}var i,data=[];if(_cfg.script_loaded_num==_opts.urls.length){_cfg.is_loadcomplete=true;if(_opts.onComplete!=null){for(i=0;i<_cfg.script_var_arr.length;i++){data.push(window[_cfg.script_var_arr[i]])}if(_cfg.script_var_arr.length<2){_opts.onComplete(data[0])}else{_opts.onComplete(data)}}return}if(_cfg.is_timeout==true){return}setTimeout(arguments.callee,50)}()}if(_opts.timeout>0){_cfg.timeout_flag=setTimeout(function(){if(_cfg.is_loadcomplete!=true){if(_opts.onException!=null){_opts.onException()}_cfg.is_timeout=true}},_opts.timeout)}}Utils.Io.JsLoad.request=function(aUrls,oOpts){new ancestor(aUrls,oOpts)}}();Sina.pkg("Core.Class");Core.Class.AsPrototype={};Core.Class.create=function(){return function(t){if(t!=Core.Class.AsPrototype){this.initialize.apply(this,arguments)}}};Lib.pkg("Lib.Component");Lib.Component=Core.Class.create();Lib.Component.instances=Lib.Component.instances||{};Lib.Component.compSize={};Lib.Component.getInitCompSize=function(){if(scope.component_lists!=null){var compList=scope.component_lists;for(var key in compList){if(compList[key].list.length>0){Core.Array.foreach(compList[key].list,function(oItem){Lib.Component.compSize[oItem]=compList[key].size})}}return true}else{return null}};Lib.Component.refresh=function(sCompId,oOption){oOption=oOption||{};try{if(Lib.Component.instances[sCompId]==null){if(typeof Lib.Component["Comp_"+sCompId]=="undefined"){$registComp(sCompId,{},"static")}Lib.Component.instances[sCompId]=new Lib.Component["Comp_"+sCompId](sCompId)}}catch(e){}Debug.log("刷新组件 "+sCompId+" ，新宽度是 "+oOption.width);Debug.log("组件 "+sCompId+" 增加管理链接："+oOption.addManage);Lib.Component.instances[sCompId].reload(oOption.width,oOption.addManage,oOption.forceRefresh)};Lib.Component.set=function(sCompId){Debug.log("展开组件 "+sCompId+" 的设置功能");if(Lib.Component.instances[sCompId]==null){Lib.Component.instances[sCompId]=new Lib.Component["Comp_"+sCompId](sCompId)}Lib.Component.instances[sCompId].getUserSet()};Core.Class.extend=function(destination,supClass,bForce){for(var property in supClass){if(bForce!=null){if(!destination[property]){destination[property]=supClass[property]}}else{destination[property]=supClass[property]}}return destination};Core.Class.define=function(init,superClz,methods){if(init&&init.__isClass&&init.__isClass()){throw new Error("class cnt be used as another class' constructor : "+init)}superClz=superClz||Object;methods=methods||{};methods.initialize=init||methods.initialize||superClz.prototype.initialize||function(){};if(typeof methods.initialize!="function"){throw new Error("only function can be used as constructor")}methods.__isClass=function(){return true};var clz=Core.Class.create();clz.__isClass=methods.__isClass;var proto=superClz==Object?{}:new superClz(Core.Class.AsPrototype);clz.prototype=Core.Class.extend(proto,methods);return clz};$registComp=Lib.Component.registComp=function(id,override,superClass){superClass=superClass==null?Lib.Component.Comp:Lib.Component["Comp_"+superClass];superClass=superClass||Lib.Component.Comp;override.compId=id;Lib.Component["Comp_"+id]=Core.Class.define(null,superClass,override)};Core.Function.bind2=function(fFunc,object){var __method=fFunc;return function(){return __method.apply(object,arguments)}};Function.prototype.bind2=function(object){var __method=this;return function(){return __method.apply(object,arguments)}};Core.Dom.getElementsByClass=function(el,tg,clz){el=el||document;var rs=[];clz=" "+clz+" ";var cldr=el.getElementsByTagName(tg),len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];if(o.nodeType==1){var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}}return rs};Core.Dom.byClz=Core.Dom.getElementsByClass;Core.Dom.removeNode=function(node){node=$E(node)||node;try{node.parentNode.removeChild(node)}catch(e){}};Lib.Component.Comp=Core.Class.create();Lib.Component.Comp.prototype={initialize:function(sId){if(this.isInit==true||sId==null||Lib.Component.compSize[sId]==null){return}else{this.isInit=true;this.compId=sId;this.size=Lib.Component.compSize[sId];Lib.Component.instances[sId]=this;return this}},compId:null,getContainer:function(){return $E("module_"+this.compId)},getTitle:function(){return Core.Dom.getElementsByClass($E("module_"+this.compId),"span","title")[0]},getManage:function(){var manageNode=Core.Dom.getElementsByClass($E("module_"+this.compId),"span","edit");if(manageNode.length!=0){return manageNode[0]}else{Debug.error("组件添加管理链接失败，检查组件"+this.compId+"标题栏 SPAN[class=edit] 是否存在");return null}},getContent:function(){var contentNode=Core.Dom.getElementsByClass($E("module_"+this.compId),"div","SG_connBody");if(contentNode.length!=0){return contentNode[0]}else{Debug.error("组件内容节点获取失败，检查组件"+this.compId+"内 DIV[class=SG_connBody] 是否存在");return null}},load:function(){trace("load compId="+this.compId);this.setContent("")},reload:function(sSize){this.clearContent();this.load()},setTitle:function(sTitle){var titleNode=this.getTitle();if(titleNode){titleNode.innerHTML=sTitle||""}},setManage:function(){var manageNode=this.getManage();if($isAdmin&&manageNode){manageNode.innerHTML='<span class="move"><a href="#" '+'onclick="funcMoveUpDown.up('+this.compId+');return false;">↑</a><a href="#" '+'onclick="funcMoveUpDown.down('+this.compId+');return false;">↓</a></span>'+'<a href="#" onclick="hiddenComponents(\''+this.compId+'\');return false;" class="CP_a_fuc">[<cite>隐藏</cite>]</a>'}},setContent:function(sContent){sContent=typeof sContent=="string"?sContent:sContent+"";this.getContent().innerHTML=sContent||""},clearContent:function(){this.getContent().innerHTML=""},remove:function(){Core.Dom.removeNode(this.getContainer());this.finalize()},finalize:function(){this.isInit=null;Lib.Component.instances[this.compId]=null}};var $SYSMSG={};$SYSMSG.extend=function(info,override){for(var i in info){$SYSMSG[i]=!!override==false?info[i]:$SYSMSG[i]}};$SYSMSG.extend({A80001:"暂无内容。",A80002:"暂无内容。",A80101:"组件加载失败，请刷新。",A80201:"你要删除留下的访问记录吗？",A80202:'<div class="CP_w_cnt SG_txtb">删除后一小时内不会在此留下访问记录。</div>',A80203:"确实要删除此访问记录吗？",A80204:['<ul class="CP_w_part SG_txtb">'+'<li><input type="checkbox" id="comp_12_deleteToBlack" class="CP_w_fm1" />'+'<label for="comp_12_deleteToBlack" >将此人加入黑名单</label></li>'+'</ul><div class="CP_w_cnt SG_txtb">加入黑名单的用户无法和你沟通。</div>'].join(""),A02003:"已添加过此模块，不能重复添加。",A02004:"抱歉，该模块不能被克隆。",A02005:"抱歉，您的博客尚未升级，请<a href='http://blog.sina.com.cn/u/#UID' target='_blank'>升级</a>后再“添加到您的博客”。",A02006:"模块已成功添加到你的博客。",A02007:"确实要隐藏此模块吗？隐藏后可在“页面设置”中恢复。",A02008:"确实要隐藏此模块吗？此模块活动时间已结束，隐藏后不可恢复。"});$registComp("dynamic",{render_210:function(){},render_510:function(){},render_730:function(){},show:function(str){this.setContent(str)},showEmpty:function(sEmptyTips){this.setContent('<div class="SG_nodata2">'+(sEmptyTips||$SYSMSG.A80001)+"</div>")},showError:function(sStatusCode){this.setContent(sStatusCode)},setManage:function(){if($isAdmin&&this.getManage()){this.getManage().innerHTML='<span class="move"><a href="#" '+'onclick="funcMoveUpDown.up('+this.compId+');return false;">↑</a><a href="#" '+'onclick="funcMoveUpDown.down('+this.compId+');return false;">↓</a></span>'+'<a href="#" onclick="hiddenComponents(\''+this.compId+'\');return false;" class="CP_a_fuc">[<cite>隐藏</cite>]</a>'}},reload:function(sSize,bAddManage,bForceRequest){var sizeCorrect=sSize==null||sSize&&(sSize==210||sSize==510||sSize==730);if(!sizeCorrect){Debug.error("请检查传入的组件尺寸是否正确。"+sSize);return}this.size=sSize||this.size;this.getContent().innerHTML='<div class="wdtLoading"><img src="http://simg.sinajs.cn/blog7style/'+'images/common/loading.gif" />加载中…</div>';this.isSetOn=null;Debug.log("this.isSetOn : "+this.isSetOn);if(bForceRequest==true||this.cacheData==null){Debug.log("强制刷新："+this.compId);this.load()}else{Debug.log("缓存刷新："+this.compId);this["render_"+this.size]()}if(bAddManage){this.setManage()}}});Sina.pkg("Utils.Cookie");Utils.Cookie.getCookie=function(name){name=name.replace(/([\.\[\]\$])/g,"\\$1");var rep=new RegExp(name+"=([^;]*)?;","i");var co=document.cookie+";";var res=co.match(rep);if(res){return res[1]||""}else{return""}};Core.System.keyValue=function(string,key){var arr=string.match(new RegExp("(\\?|&)"+key+"=([^&]*)(&|$)"));if(arr!=null)return arr[2];return null};var __reqCheckLogin__=function(){var isReqEnd=false;var isReq=false;var funQueue=[];return function(func){funQueue.push(func);if(isReq){return}else if(isReqEnd){if(func){func()}}else{var times=(new Date).getTime();isReq=true;window["__check_login_status__"+times]=function(data){isReq=false;var user=data.user;$nick=user.nick||null;$UID=user.uid||null;$isLogin=!!$UID;if(typeof scope.$uid=="undefined"){$isAdmin=false}else{$isAdmin=scope.$uid==$UID}try{delete window["__check_login_status__"+times];document.head.removeChild(document.getElementById("jsonp_script"+times))}catch(e){}isReqEnd=true;for(var i=0;i<funQueue.length;i++){try{funQueue[i].call(null)}catch(e){console.log(e.stack)}}};var script=document.createElement("script");script.id="jsonp_script"+times;script.src="http://control.blog.sina.com.cn/riaapi/check_login.php?callback="+"__check_login_status__"+times;document.getElementsByTagName("head")[0].appendChild(script)}}}();Lib.checkAuthor=function(func,fileName){var AuthorInfo=Utils.Cookie.getCookie("SUBP");var _self=this;if(AuthorInfo&&AuthorInfo!=""){var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(AuthorInfo);if(typeof arrSubp.nick!=="undefined"){$nick=decodeURIComponent(arrSubp.nick.replace(/(^\s*)|(\s*$)/g,""))}else{$nick="null"}if(typeof arrSubp.uid==="undefined"){$isLogin=false;$UID=null}else{$isLogin=true}if(typeof scope.$uid=="undefined"){$isAdmin=false}else{if(typeof arrSubp.uid!=="undefined"){$UID=arrSubp.uid.replace(/(^\s*)|(\s*$)/g,"");$isAdmin=scope.$uid==$UID}else{$isAdmin=false}}if(func&&fileName){func()}}else{__reqCheckLogin__(func)}};Core.Array.uniq=function(ar){var result=[],x;for(var i=0;i<ar.length;i++){x=ar[i];if(Core.Array.findit(result,x)==-1){result.push(x)}}return result};Lib.Uic={_interfaceNick:"http://hs.blog.sina.com.cn/user/nick/",cacheNickName:{},getNickName:function(arrUidLists,fCallBack){var cache=this.cacheNickName;var hitCache={};var notHitCacheList=[];for(var i=0;i<arrUidLists.length;i++){var uid=arrUidLists[i];if(cache[uid]){hitCache[uid]=cache[uid]}else{notHitCacheList.push(uid)}}if(notHitCacheList.length>0){Utils.Io.JsLoad.request(this._interfaceNick+notHitCacheList.join(","),{returnType:"jsonp",onComplete:function(result){if(result.code===0){for(var key in result.data){hitCache[key]=result.data[key];this.cacheNickName[key]=result.data[key]}fCallBack(hitCache)}}.bind2(this)})}else{fCallBack(hitCache)}}};$registComp("901",{load:function(){var _this=this;Lib.checkAuthor(function(){if($isAdmin==false&&$isLogin){_this.loadIsFriend()}else if($isAdmin==false&&!$isLogin){_this.isFriend=false;_this.loadOnline()}else{_this.isOnline=true;_this.showOnlineInfo()}_this.loadNickname();_this.loadOtherInfo()},"901_load"+(new Date).getTime())},loadIsFriend:function(){if($_GLOBAL.mashAddFriend){this.mashAddFriend=true;return}var _isFriend=new Interface("http://control.blog.sina.com.cn/riaapi/profile/IsFriend.php","jsload");_isFriend.request({GET:{friend_uids:scope.$uid,version:7},onSuccess:function(result){this.friendSuccessCallback(result)}.bind2(this),onError:function(result){this.friendErrorCallback()}.bind2(this),onFail:function(){this.friendErrorCallback()}.bind2(this)})},friendSuccessCallback:function(result){for(var i=0,len=result.length;i<len;i++){if(result[i].uid==scope.$uid){this.isFriend=result[i].status==1?true:false}}this.isFriend=this.isFriend!=null?this.isFriend:false;this.loadOnline()},friendErrorCallback:function(){this.isFriend=false;this.loadOnline()},loadOnline:function(){if($isAdmin){this.isOnline=true;this.showOnlineInfo()}else{this.showVisitButton();var _isOnline=Utils.Io.JsLoad.request("http://online.sso.sina.com.cn/status/MutiqueryVProduct.php",{GET:{UIDS:"["+scope.$uid+"]",Check:scope.$key,ProductType:"1000",Verbose:"0",noencode:true},onComplete:Core.Function.bind2(function(result){try{var _status=result.Status;this.isOnline=_status[0]==1?true:false}catch(e){this.isOnline=$isAdmin?true:false}this.showOnlineInfo()},this),onException:Core.Function.bind2(function(){this.isOnline=false;this.showOnlineInfo()},this)})}},loadNickname:function(){Lib.Uic.getNickName([scope.$uid],Core.Function.bind2(function(oResult){this.showNickName(oResult)},this))},showOnlineInfo:function(){},showNickName:function(){},showVisitButton:function(){},loadOtherInfo:function(){},mashAddFriend:false,reload:function(sSize,bAddManage,bForceRequest){var sizeCorrect=sSize==null||sSize&&(sSize==210||sSize==510||sSize==730);if(!sizeCorrect){Debug.error("请检查传入的组件尺寸是否正确。"+sSize);return}this.size=sSize||this.size;if(bForceRequest==true||this.cacheData==null){this.load()}else{this["render_"+this.size]()}if(bAddManage){this.setManage()}}},"dynamic");Core.String.j2o=function(str){if(!str||str==""){return null}try{var o=window.eval("("+str+")");return o}catch(e){trace("j2o : 数据分析出错");traceError(e);return null}};Utils.Io.Ijax={arrTaskLists:[],createLoadingIframe:function(){if(this.loadFrames!=null){return false}var rndId1="loadingIframe_thread"+Math.ceil(Math.random()*1e4);var rndId2="loadingIframe_thread"+Math.ceil((Math.random()+1)*1e4);this.loadFrames=[rndId1,rndId2];var html='<iframe id="'+rndId1+'" name="'+rndId1+'" class="invisible"	              scrolling="no" src=""	              allowTransparency="true" style="display:none;" frameborder="0"	              ></iframe>				  <iframe id="'+rndId2+'" name="'+rndId2+'" class="invisible"	              scrolling="no" src=""	              allowTransparency="true" style="display:none;" frameborder="0"	              ></iframe>';var oIjaxIframeCnt=$C("div");oIjaxIframeCnt.id="ijax_iframes";oIjaxIframeCnt.innerHTML=html;trace("创建 Ijax 需要的 iframe");document.body.appendChild(oIjaxIframeCnt);var loadTimer=setInterval(Core.Function.bind2(function(){if($E(this.loadFrames[0])!=null&&$E(this.loadFrames[1])!=null){clearInterval(loadTimer);loadTimer=null;this.loadingIframe={thread1:{container:$E(this.loadFrames[0]),isBusy:false},thread2:{container:$E(this.loadFrames[1]),isBusy:false}};this.loadByList()}},this),10)},isIjaxReady:function(){if(typeof this.loadingIframe=="undefined"){return false}for(var oLoadCnt in this.loadingIframe){if(this.loadingIframe[oLoadCnt].isBusy==false){this.loadingIframe[oLoadCnt].isBusy=true;return this.loadingIframe[oLoadCnt]}}return false},request:function(url,option){var oTask={};oTask.url=url;oTask.option=option||{};this.arrTaskLists.push(oTask);if(this.loadFrames==null){this.createLoadingIframe()}else{this.loadByList()}},loadByList:function(){if(this.arrTaskLists.length==0){return false}var loadStatus=this.isIjaxReady();if(loadStatus==false){return false}var newData=this.arrTaskLists[0];this.loadData(newData.url,newData.option,loadStatus);this.arrTaskLists.shift()},loadData:function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)
}document.body.appendChild(oIjaxForm);oIjaxForm.submit()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}};Utils.Io.Ajax={createRequest:function(){var request=null;try{request=new XMLHttpRequest}catch(trymicrosoft){try{request=new ActiveXObject("Msxml2.XMLHTTP")}catch(othermicrosoft){try{request=ActiveXObject("Microsoft.XMLHTTP")}catch(failed){}}}if(request==null){}else{return request}},request:function(url,option){option=option||{};option.onComplete=option.onComplete||function(){};option.onException=option.onException||function(){};option.returnType=option.returnType||"txt";option.method=option.method||"get";option.data=option.data||{};if(typeof option.GET!="undefined"&&typeof option.GET.url_random!="undefined"&&option.GET.url_random==0){this.rand=false;option.GET.url_random=null}return this.loadData(url,option)},loadData:function(url,option){var request=this.createRequest(),tmpArr=[];var _url=new Utils.Url(url);if(option.POST){for(var postkey in option.POST){var postvalue=option.POST[postkey];if(postvalue!=null){tmpArr.push(postkey+"="+Core.String.encodeDoubleByte(postvalue))}}}var sParameter=tmpArr.join("&")||"";if(option.GET){for(var key in option.GET){if(key!="url_random"){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}}if(this.rand!=false){}request.onreadystatechange=function(){if(request.readyState==4){var response,type=option.returnType;try{switch(type){case"txt":response=request.responseText;break;case"xml":if($IE){response=request.responseXML}else{var Dparser=new DOMParser;response=Dparser.parseFromString(request.responseText,"text/xml")}break;case"json":response=eval("("+request.responseText+")");break}option.onComplete(response)}catch(e){option.onException(e.message,_url);return false}}};try{if(option.POST){request.open("POST",_url,true);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");request.withCredentials=true;request.send(sParameter)}else{request.open("GET",_url,true);request.send(null)}}catch(e){option.onException(e.message,_url);return false}return request}};if($IE6&&typeof Utils.Io.Ijax!="undefined"){Utils.Io.Ijax.loadData=function(url,option,loader){var _url=new Utils.Url(url);if(option.GET){for(var key in option.GET){_url.setParam(key,Core.String.encodeDoubleByte(option.GET[key]))}}if(!/\bdomain\b/.test(url)){_url.setParam("domain","1")}_url=_url.toString();var ifm=loader.container;ifm.listener=Core.Function.bind2(function(){try{var iframeObject=ifm.contentWindow.document,sResult;var tArea=Core.Dom.byClz(iframeObject,"textarea","")[0];if(typeof tArea!="undefined"){sResult=tArea.value}else{sResult=iframeObject.body.innerHTML}if(option.onComplete){option.onComplete(sResult)}else{option.onException()}}catch(e){traceError(e);if(option.onException){option.onException(e.message,_url.toString())}}loader.isBusy=false;Core.Events.removeEvent(ifm,ifm.listener,"load");this.loadByList()},this);Core.Events.addEvent(ifm,ifm.listener,"load");if(option.POST){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=ifm.id;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);var timenum=100;function innerfun(){if(timenum>0){try{oIjaxForm.submit()}catch(e){setTimeout(innerfun,10)}}timenum--}innerfun()}else{try{window.frames(ifm.id).location.href=_url}catch(e){ifm.src=_url}}}}var Interface=function(url,type){this.url=new Utils.Url(url);this.type=type.toLowerCase()};Interface.prototype={url:null,type:"",request:function(option){var err=option.onError;var suc=option.onSuccess;option.onComplete=option.onSuccess=function(result){try{if(typeof result=="string"){result=result.replace(/;$/,"")}result=typeof result=="string"&&/\s*{/.test(result)?Core.String.j2o(result):result;if(result!=null&&typeof result.code=="undefined"){trace("接口数据异常："+this.url,"#F00");return}if(result!=null){if(result.code=="A00006"){suc(result.data)}else{err(result)}}else{err(result)}}catch(e){traceError(e)}}.bind2(this);option.onException=option.onError=option.onFail||function(){trace("接口失败："+this.url,"#F00");if(arguments.length>0){for(var i=0,len=arguments.length;i<len;i++){if(arguments[i]&&typeof arguments[i]!="undefined"){trace("错误信息："+arguments[i].toString())}}}}.bind2(this);var requestURL=this.url.toString();switch(this.type){case"ijax":Utils.Io.Ijax.request(requestURL,option);break;case"ajax":Utils.Io.Ajax.request(requestURL,option);break;case"script":case"jsload":Utils.Io.JsLoad.request(requestURL,option);break;default:throw new Error("未指定有效的数据传输类型")}}};function v6SendLog(type,label){}function v7sendLog(type,pageid,msg){if(!type){return false}if(type.split("_").length==3){Lib.checkAuthor(function(){if($isLogin){type+="_"+$UID}},"v7SendLog"+(new Date).getTime())}if(typeof scope=="undefined"){window.scope={};scope.$pageid=""}pageid=pageid||scope.$pageid;msg=msg||"";Utils.Io.JsLoad.request("http://hits.sinajs.cn/A2/b.html?type="+type+"&pageid="+pageid+"&msg="+msg,{onComplete:function(){}})}!function(){function object(o){function F(){}F.prototype=o;return new F}Function.prototype.$define=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extends=this.$define=this.$implements=function(){throw new Error("$define语句定义后面不能再作其它定义")};return this};Function.prototype.$extends=function(){var me=this,i=arguments.length,sup,fn;if(i===0){throw new Error("$extends语句错误：未指定父类")}sup=arguments[0];fn=function(){sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;fn.$super=sup.prototype;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0),fn,i=arg.length,k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements语句错误：参数必须为object类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extends=function(){throw new Error("$extends语句错误:$extends语句不能出现在$implements定义之后")};return this}}();Core.Events.getEvent=function(){return window.event};if(!$IE||$IE>8){Core.Events.getEvent=function(){if(!$IE&&window.event){return window.event}var o=arguments.callee.caller;var e;var n=0;while(o!=null&&n<40){e=o.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent)){return e}n++;o=o.caller}return e}}Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true;ev.returnValue=false}};if(!$IE||$IE>8){Core.Events.stopEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.preventDefault();ev.stopPropagation()}}}Sina.pkg("Ui");if(typeof Ui=="undefined"){Ui=Sina.Ui}Ui.Template=function(tmpl){this.tmpl=tmpl;this.pattern=/(#\{(.*?)\})/g};Ui.Template.prototype={evaluate:function(data){return this.tmpl.replace(this.pattern,function(){return data[arguments[2]]||""})},evaluateMulti:function(data,reverse){var _buffer=[];Core.Array.foreach(data,Core.Function.bind2(function(v,i){i=reverse?data.length-i:i;_buffer[i]=this.evaluate(v)},this));return _buffer.join("")}};!function(){Core.Function.defineGetter=function(obj,p,fn){if(p instanceof Array&&fn instanceof Array){var i=Math.min(p.length,fn.length);while(i--){if(typeof p[i]==="string"&&__checkFunction(fn[i])){obj[p[i]]={valueOf:function(j){return function(){return __getValue(obj,fn[j])}}(i),toString:this.valueOf}}}}else if(typeof p==="string"&&__checkFunction(fn)){obj[p]={valueOf:function(){return __getValue(obj,fn)},toString:this.valueOf}}};function __checkFunction(fn){return typeof fn!=="string"&&String.prototype.slice.call(fn,0,8)=="function"}function __getValue(obj,fn){var ret=fn.call(obj);return typeof ret==="string"||typeof ret==="number"?ret:null}}();Ui.IE6FixedController=function(){var me=this;this.node=null;this.iframeNode=null;this.__orgX=0;this.__orgY=0;this.__isBindScroll=false;this.__fixedHandle=function(){if(me.node){me.node.style.left=document.documentElement.scrollLeft+me.__orgX+"px";me.node.style.top=document.documentElement.scrollTop+me.__orgY+"px"}if(me.iframeNode){me.iframeNode.style.left=me.node.style.left;me.iframeNode.style.top=me.node.style.top}}}.$define({setFixed:function(node,state){this.updateOrgPosition();if(state&&!this.__isBindScroll){Core.Events.addEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=true}if(!state&&this.__isBindScroll){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false}},setPosition:function(node,fixedState,p){if(typeof p.x!=="undefined"){if(fixedState){node.style.left=p.x+document.documentElement.scrollLeft+"px";this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft}else{node.style.left=p.x+"px"}}if(typeof p.y!=="undefined"){if(fixedState){node.style.top=p.y+document.documentElement.scrollTop+"px";this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop}else{node.style.top=p.y+"px"}}typeof p.z!=="undefined"&&(node.style.zIndex=p.z)},getX:function(node,fixedState){if(fixedState){return parseInt(node.style.left)-document.documentElement.scrollLeft}else{return parseInt(node.style.left)}},getY:function(node,fixedState){if(fixedState){return parseInt(node.style.top)-document.documentElement.scrollTop}else{return parseInt(node.style.top)}},updateIframe:function(isFixed){this.setFixed(this.iframeNode,isFixed);isFixed&&this.__fixedHandle()},updateOrgPosition:function(){if(!this.node){return}this.__orgX=parseInt(this.node.style.left)-document.documentElement.scrollLeft;this.__orgY=parseInt(this.node.style.top)-document.documentElement.scrollTop},destroy:function(){Core.Events.removeEvent(window,this.__fixedHandle,"scroll");this.__isBindScroll=false;this.node=null;this.iframeNode=null}});Core.Events.EventDispatcher=function(target){this.__target=target;this.__events={}}.$define({addEventListener:function(type,handle){if(!this.__checkFunction(handle)){return}var evts=this.__events;type=type.toLowerCase();!evts[type]&&(evts[type]=[]);evts[type].push(handle)},removeEventListener:function(type,handle){var evts=this.__events[type];type=type.toLowerCase();if(!this.__checkFunction(handle)||!evts||!evts.length){return}for(var i=evts.length-1;i>=0;i--){evts[i]==handle&&evts.splice(i,1)}},dispatchEvent:function(type){type=type.toLowerCase();var evts=this.__events[type];if(!evts||!evts.length){return}var args=Array.prototype.slice.call(arguments,0);args.shift();for(var i=0,l=evts.length;i<l;i++){evts[i].apply(this.__target,args)}},__checkFunction:function(func){return typeof func!=="string"&&String.prototype.slice.call(func,0,8)=="function"}});Ui.IRenderer={setCanShow:function(state){},setCanHidden:function(state){},show:function(node){},hidden:function(node){},addEventListener:function(type,handle){},removeEventListener:function(type,handle){}};Ui.SimpleRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){node.style.display="";this.__eventDispatcher.dispatchEvent("show")}return this},hidden:function(node){this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){node.style.display="none";this.__eventDispatcher.dispatchEvent("hidden")}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this}});Ui.DisplayObject=function(parent,node){Core.Function.defineGetter(this,["x","y","z","width","height"],[this.__getX,this.__getY,this.__getZ,this.__getWidth,this.__getHeight]);this.__renderer=null;this.__entity=node;this.__isInited=false;this.__parent=parent||document.body;this.__eventDispatcher=new Core.Events.EventDispatcher(this);var ed=this.__eventDispatcher;this.__onBeforeShow=function(){ed.dispatchEvent("beforeShow")};this.__onShow=function(){ed.dispatchEvent("show")};this.__onBeforeHidden=function(){ed.dispatchEvent("beforeHidden")};this.__onHidden=function(){ed.dispatchEvent("hidden")};this.__updateRenderer(Ui.SimpleRenderer)}.$define({isShow:!1,isHidden:!0,setPosition:function(p){!this.__isInited&&this.__initEntity();typeof p.x!=="undefined"&&(this.__entity.style.left=p.x+"px");typeof p.y!=="undefined"&&(this.__entity.style.top=p.y+"px");typeof p.z!=="undefined"&&(this.__entity.style.zIndex=p.z);return this},setSize:function(p){!this.__isInited&&this.__initEntity();typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px");return this},setRenderer:function(rendererConstructor){!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);return this},show:function(rendererConstructor){this.isHidden=!1;this.isShow=!0;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.show(this.__entity);return this},hidden:function(rendererConstructor){return this.hide(rendererConstructor)},hide:function(rendererConstructor){this.isHidden=!0;this.isShow=!1;!this.__isInited&&this.__initEntity();this.__updateRenderer(rendererConstructor);this.__renderer.hidden(this.__entity);return this},setCanShow:function(state){this.__renderer.setCanShow(state);return this},setCanHidden:function(state){this.__renderer.setCanHidden(state);return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){if(!this.__entity){return}!this.__isInited&&this.__initEntity();this.__entity.parentNode&&this.__entity.parentNode.removeChild(this.__entity);this.__entity=null},__initEntity:function(){var st;!this.__entity&&(this.__entity=$C("div"));st=this.__entity.style;st.position="absolute";st.left=0;st.top=0;!this.__entity.parentNode&&this.__parent.appendChild(this.__entity);this.__isInited=true},__updateRenderer:function(rendererConstructor){if(!rendererConstructor){return}var addEvent=function(){this.__renderer.addEventListener("beforeShow",this.__onBeforeShow).addEventListener("show",this.__onShow).addEventListener("beforeHidden",this.__onBeforeHidden).addEventListener("hidden",this.__onHidden)};if(!this.__renderer){this.__renderer=new rendererConstructor;addEvent.call(this)}else if(this.__renderer.constructor!==rendererConstructor){this.__renderer.removeEventListener("beforeShow",this.__onBeforeShow).removeEventListener("show",this.__onShow).removeEventListener("beforeHidden",this.__onBeforeHidden).removeEventListener("hidden",this.__onHidden);this.__renderer=new rendererConstructor;addEvent.call(this)}},__getX:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.left)},__getY:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.top)},__getZ:function(){!this.__isInited&&this.__initEntity();return parseInt(this.__entity.style.zIndex)},__getWidth:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetWidth")},__getHeight:function(){!this.__isInited&&this.__initEntity();return this.__getSize(this.__entity,"offsetHeight")},__getSize:function(node,p){var et=node,v,ov=et.style.visibility;if(et.style.display=="none"){et.style.visibility="hidden";et.style.display="";v=et[p];et.style.display="none";et.style.visibility=ov}else{v=et[p]}return v}});Ui.Panel=function(parent,node){this.nodes={};this.uniqueID=this.__getUniqueID();this.entity=null;this.__iframe=null;this.__isSetAdamant=false;this.__templateNodesIDs=[];this.__isFixed=false;$IE6&&(this.__ie6FixedController=new Ui.IE6FixedController)}.$extends(Ui.DisplayObject).$define({setTemplate:function(tpl){var nd=$C("div");nd.innerHTML=new Ui.Template(tpl).evaluate(this.__getNodes(tpl,"i"));nd.style.display="none";this.__parent.appendChild(nd);this.__updateTemplate(nd);this.nodes=this.__getNodes(tpl);this.entity=this.__entity;this.nodes.panel=this.entity;return this},setFixed:function(state){!this.__isInited&&this.__initEntity();var x=parseInt(this.__entity.style.left),y=parseInt(this.__entity.style.top);if($IE6){this.__ie6FixedController.setFixed(this.__entity,state);this.__isSetAdamant&&this.__ie6FixedController.setFixed(this.__iframe,state)}else{if(state&&!this.__isFixed){this.setPosition({x:x-Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y-Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="fixed"}if(!state&&this.__isFixed){this.setPosition({x:x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)});this.__entity.style.position="absolute"}}this.__isFixed=!!state;this.__updateIframe();return this},setAdamant:function(state){this.__isSetAdamant=!!state;this.__isSetAdamant&&!this.__iframe&&this.__createIframe();this.__updateIframe();return this},destroy:function(){if(!this.__entity){return}Ui.Panel.$super.destroy.call(this);this.__ie6FixedController&&this.__ie6FixedController.destroy();this.__iframe&&this.__iframe.parentNode.removeChild(this.__iframe)},setPosition:function(p){!this.__isInited&&this.__initEntity();if($IE6){this.__ie6FixedController.setPosition(this.__entity,this.__isFixed,p)}else{Ui.Panel.$super.setPosition.call(this,p)}this.__updateIframe();return this},setSize:function(p){Ui.Panel.$super.setSize.call(this,p).__updateIframe();return this},show:function(renderer){Ui.Panel.$super.show.call(this,renderer).__updateIframe();return this},hidden:function(renderer){Ui.Panel.$super.hidden.call(this,renderer).__updateIframe();return this},__getX:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getX(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.left)}},__getY:function(){!this.__isInited&&this.__initEntity();if($IE6){return this.__ie6FixedController.getY(this.__entity,this.__isFixed)}else{return parseInt(this.__entity.style.top)}},__createIframe:function(){this.__iframe=$C("iframe");this.__iframe.frameBorder="none";this.__parent.insertBefore(this.__iframe,this.__entity);Core.Dom.setStyle(this.__iframe,"opacity",0);this.__ie6FixedController&&(this.__ie6FixedController.iframeNode=this.__iframe);this.__updateIframe()},__updateIframe:function(){if(this.__iframe){var st=this.__iframe.style;st.backgroundColor="#ffffff";st.left=this.x+"px";st.top=this.y+"px";st.width=this.width+"px";st.height=this.height+"px";st.position=this.__entity.style.position;st.display=this.__entity.style.display;st.zIndex=this.__entity.style.zIndex;$IE6&&this.__ie6FixedController.updateIframe(this.__isFixed)}},__updateIE6FCOrgPosition:function(){this.__ie6FixedController&&this.__ie6FixedController.updateOrgPosition()},__updateTemplate:function(nd){var l,t,z,p,d,et=this.__entity;if(et){et.parentNode&&et.parentNode.removeChild(et);l=et.style.left;t=et.style.top;z=et.style.zIndex;p=et.style.position;d=et.style.display}else{d="none"}et=this.__entity=$E("_"+this.uniqueID+"_panel");if(!et){et=this.__entity=$E("_"+this.uniqueID+"_entity")}if(!et){throw new Error("[Panel Error]there missing identifier #{panel} in panel template")}et.style.left=l||0;et.style.top=t||0;et.style.zIndex=z||0;et.style.position=p||"absolute";et.style.display=d;this.__parent.replaceChild(et,nd);this.__ie6FixedController&&(this.__ie6FixedController.node=this.__entity)},__getNodes:function(template,mode){var m=mode||"o",p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r;this.__templateNodesIDs=template.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},__getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()},setContent:function(str){this.nodes.content&&(this.nodes.content.innerHTML=str)},getNodes:function(){return this.nodes}});Ui.Drag=function(captureNode,attachNodes,isDragCapureNode){var me=this;this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.__captureNode=captureNode;this.__dragNodes=[];this.__deltaX=[];this.__deltaY=[];this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__isDraging=false;this.__canDragX=true;this.__canDragY=true;this.__dragHandle=function(){me.__drag()};this.__mouseDownHandle=function(){me.__isDraging=true;me.__eventDispatcher.dispatchEvent("beforeDrag");me.__setCapture(true)};this.__mouseUpHandle=function(){me.__isDraging&&me.__eventDispatcher.dispatchEvent("afterDrag");me.__isDraging=false;me.__setCapture(false)};this.__initNodes(captureNode,attachNodes,isDragCapureNode);this.__initCaputerNode()}.$define({addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},destroy:function(){Core.Events.removeEvent(this.__captureNode,this.__mouseDownHandle,"mousedown");Core.Events.removeEvent(document,this.__mouseUpHandle,"mouseup");this.__captureNode=null;this.__dragNodes=null},__initNodes:function(captureNode,attachNodes,isDragCapureNode){if(attachNodes){attachNodes instanceof Array?this.__dragNodes=attachNodes:this.__dragNodes.push(attachNodes);(typeof isDragCapureNode==="undefined"||isDragCapureNode)&&this.__dragNodes.push(this.__captureNode)}else{this.__dragNodes.push(this.__captureNode)}var dns=this.__dragNodes,i=dns.length;while(i--){!dns[i].style.position&&(dns[i].style.position="absolute");!dns[i].style.left&&(dns[i].style.left=0);!dns[i].style.top&&(dns[i].style.top=0)}},__initCaputerNode:function(){var cn=this.__captureNode,me=this;Core.Events.addEvent(cn,this.__mouseDownHandle,"mousedown");Core.Events.addEvent(document,this.__mouseUpHandle,"mouseup")},__setCapture:function(isCapture){var cn=this.__captureNode,dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length;while(i--){this.__deltaX[i]=evt.clientX-parseInt(dns[i].style.left);this.__deltaY[i]=evt.clientY-parseInt(dns[i].style.top)}if(isCapture){if($IE){cn.setCapture();Core.Events.addEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.addEvent(document,this.__dragHandle,"mousemove")}}else{if($IE){cn.releaseCapture();Core.Events.removeEvent(cn,this.__dragHandle,"mousemove")}else{Core.Events.removeEvent(document,this.__dragHandle,"mousemove")}}},__drag:function(){if(!this.canDrag){return}var dns=this.__dragNodes,evt=Core.Events.getEvent(),i=dns.length,la=this.lockArea,dX=0,dY=0;this.__eventDispatcher.dispatchEvent("drag");while(i--){dX=evt.clientX-this.__deltaX[i];dY=evt.clientY-this.__deltaY[i];if(this.isLock){dX=Math.min(Math.max(dX,la.left),la.right);dY=Math.min(Math.max(dY,la.top),la.bottom)}dns[i].style.left=dX+"px";dns[i].style.top=dY+"px"}}});Ui.IDragger={addEventListener:function(type,handle){},removeEventListener:function(type,handle){},setDrag:function(node,attachNodes,isDragCapureNode){},setLock:function(state){},setArea:function(area){},destroy:function(){}};Ui.SimpleDragger=function(){this.__drag=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){var me=this;this.__drag=new Ui.Drag(node,attachNode,isDragCapureNode);this.__drag.addEventListener("afterDrag",function(){me.__eventDispatcher.dispatchEvent("afterDrag")});return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()}});Ui.Dialog=function(parent,node){var me=this;this.__dragger=null;this.__isBindUpadateAreaEvent=false;this.__isBindUpdateIE6AreaEvent=false;this.__beforeDragHandle=function(){me.__updateDraggerArea();me.__eventDispatcher.dispatchEvent("beforedrag")};this.__dragHandle=function(){me.__isSetAdamant&&me.__updateIframe();me.__eventDispatcher.dispatchEvent("drag")};this.__afterDragHandle=function(){me.__isFixed&&$IE6&&me.__updateIE6FCOrgPosition();me.__eventDispatcher.dispatchEvent("afterdrag")};this.__updateDraggerAreaHandle=function(){setTimeout(function(){me.__updateDraggerArea()},1)};this.__setMiddleHandle=function(){me.setMiddle()}}.$extends(Ui.Panel).$define({setTemplate:function(tpl){Ui.Dialog.$super.setTemplate.call(this,tpl);this.__initTitleBar();this.setDragger(Ui.SimpleDragger);return this},setContent:function(content){if(!this.nodes.content){return this}this.nodes.content.innerHTML=new Ui.Template(content).evaluate(this.__getNodes(content,"i"));this.__addContentNodes(this.__getNodes(content));return this},setFixed:function(state){Ui.Dialog.$super.setFixed.call(this,state);if(state){Core.Events.addEvent(window,this.__setMiddleHandle,"resize")}else{Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")}this.__updateDraggerArea();return this},setMiddle:function(){var areaHeight=this.__getDocumentSize().height-this.height,goldenSection=(Math.sqrt(5)-1)/2,totalSection=1,goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection),middleX=this.__getDocumentSize().width/2-this.width/2;if(!this.__isFixed){goldenSectionY+=Math.max(document.documentElement.scrollTop,document.body.scrollTop);middleX+=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)}this.setPosition({x:Math.max(middleX,0),y:Math.max(goldenSectionY,0)});return this},setAreaLocked:function(state){if(!this.__dragger){return this}this.__dragger.setLock(state);return this},setSize:function(p){!this.__isInited&&this.__initEntity();if(this.nodes.content){typeof p.width!=="undefined"&&(this.nodes.content.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.nodes.content.style.height=p.height+"px")}else{typeof p.width!=="undefined"&&(this.__entity.style.width=p.width+"px");typeof p.height!=="undefined"&&(this.__entity.style.height=p.height+"px")}return this},setDragger:function(draggerConstructor){if(!this.nodes.titleBar||!draggerConstructor){return this}if(!this.__dragger){this.__dragger=new draggerConstructor}else if(this.__dragger.constructor===draggerConstructor){return this}this.__updateDragger(draggerConstructor);return this},destroy:function(){if(!this.__entity){return}Ui.Dialog.$super.destroy.call(this);Core.Events.removeEvent(window,this.__updateDraggerAreaHandle,"resize");Core.Events.removeEvent(window,this.__setMiddleHandle,"resize")},__addContentNodes:function(nodes){var nds=this.nodes,k;for(k in nodes){nds[k]=nodes[k]}},__updateDragger:function(draggerConstructor){if(this.__dragger.constructor!==draggerConstructor){this.__dragger.removeEventListener("beforedrag",this.__beforeDragHandle).removeEventListener("drag",this.__dragHandle).removeEventListener("afterdrag",this.__afterDragHandle);this.__dragger.destroy();this.__dragger=new draggerConstructor}this.__dragger.setDrag(this.nodes.titleBar,this.__entity,false);this.__dragger.addEventListener("beforedrag",this.__beforeDragHandle).addEventListener("drag",this.__dragHandle).addEventListener("afterdrag",this.__afterDragHandle)},__updateDraggerArea:function(){var l,t,r,b;if(this.__isFixed){l=$IE6?document.documentElement.scrollLeft:0;t=$IE6?document.documentElement.scrollTop:0;r=$IE6?document.documentElement.scrollLeft+this.__getDocumentSize().width-this.width:this.__getDocumentSize().width-this.width;b=$IE6?document.documentElement.scrollTop+this.__getDocumentSize().height-this.height:this.__getDocumentSize().height-this.height}else{l=0;t=0;r=document.documentElement.scrollWidth-this.width;b=document.documentElement.scrollHeight-this.height}this.__dragger.setArea({left:l,top:t,right:r,bottom:b})},__initTitleBar:function(){if(!this.nodes.titleBar){return}var tb=this.nodes.titleBar;tb.style.cursor="move";if($IE){Core.Events.addEvent(tb,function(){return false},"selectstart")}else{tb.style.MozUserSelect="none"}},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.ModuleDialog=function(tplConfig,iconSet,cfg){this.__bgShadow=null;this.__dialog=null;this.__isInitBgShadow=false;this.__tplConfig=tplConfig;this.__iconSet=iconSet;this.__dialogQueue=[];this.__zIndex=cfg&&cfg.zIndex||5e3;this.__cfg=cfg||{};this.__initDialogEvent()}.$define({alert:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.alert,cfg);dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");dlg.show(cfg.renderer||this.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus();return dlg},newAlert:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg){cfg=cfg||{};var dlg=this.__createMessageDialog(cfg.tplConfig||this.__tplConfig.confirm,cfg),me=this;dlg.nodes.text&&(dlg.nodes.text.innerHTML=text||"");if(dlg.nodes.btnCancel){dlg.nodes.btnCancel.innerHTML=cfg.textCancel||"取消";Core.Events.addEvent(dlg.nodes.btnCancel,function(){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer);Core.Events.stopEvent()},"click");dlg.nodes.linkCancel&&Core.Events.addEvent(dlg.nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){cfg.funcCancel&&cfg.funcCancel.call(dlg);dlg.hidden(cfg.renderer||me.__cfg.renderer)}},"keydown")}dlg.show(cfg.renderer||me.__cfg.renderer).addEventListener("hidden",function(){this.destroy()});if(cfg.defaultButton==0){dlg.nodes.linkCancel&&dlg.nodes.linkCancel.style.display!=="none"&&dlg.nodes.linkCancel.focus()}else{dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}return dlg},newConfirm:function(text,cfg,name){cfg.tplConfig=this.__tplConfig.newConfirm;this.confirm(text,cfg,name)},create:function(cfg){var me=this;cfg=cfg||{};var dlg=new Ui.Dialog;dlg.setTemplate(cfg.tpl||this.__tplConfig.customs);cfg.content&&dlg.setContent(cfg.content);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});return this.__initDialog(dlg,cfg)},__initDialogEvent:function(){var queue=this.__dialogQueue;Core.Events.addEvent(document,function(){var e=Core.Events.getEvent();if(queue.length&&e.keyCode=="27"){queue[queue.length-1].hidden()}},"keydown")},__createMessageDialog:function(tpl,cfg){var dlg=new Ui.Dialog,me=this,i;dlg.setTemplate(tpl);cfg.width&&!isNaN(cfg.width)&&dlg.setSize({width:cfg.width});cfg.height&&!isNaN(cfg.height)&&dlg.setSize({height:cfg.height});dlg.nodes.subText&&(dlg.nodes.subText.innerHTML=cfg.subText||"");if(dlg.nodes.icon){dlg.nodes.icon.className=this.__iconSet[cfg.icon||"01"]["class"];dlg.nodes.icon.alt=this.__iconSet[cfg.icon||"01"]["alt"]}if(dlg.nodes.btnOk){dlg.nodes.btnOk.innerHTML=cfg.textOk||"确定";Core.Events.addEvent(dlg.nodes.btnOk,function(){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg);Core.Events.stopEvent()
},"click")}dlg.nodes.linkOk&&Core.Events.addEvent(dlg.nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){dlg.hidden(cfg.renderer||me.__cfg.renderer);cfg.funcOk&&cfg.funcOk.call(dlg)}},"keydown");dlg.setDragger(cfg.dragger||me.__cfg.dragger).setFixed(true).setAreaLocked(true);return this.__initDialog(dlg,cfg)},__initDialog:function(dlg,cfg){var me=this;cfg.zIndex&&(me.__zIndex=cfg.zIndex);dlg.nodes.titleName&&(dlg.nodes.titleName.innerHTML=cfg.title||"提示");if(dlg.nodes.btnClose){Core.Events.addEvent(dlg.nodes.btnClose,function(){var isCanHidden=true;cfg.funcBeforeClose&&(isCanHidden=cfg.funcBeforeClose.call(dlg)!==false);cfg.funcClose&&cfg.funcClose.call(dlg);isCanHidden&&dlg.hidden()},"click");Core.Events.addEvent(dlg.nodes.btnClose,function(){Core.Events.stopEvent()},"mousedown")}dlg.setPosition({z:cfg.zIndex||me.__zIndex});dlg.setRenderer(cfg.renderer||this.__cfg.renderer);dlg.setDragger(cfg.dragger||this.__cfg.dragger);dlg.setMiddle();dlg.addEventListener("beforeHidden",function(){me.__updateDialogQueue(this,"remove")});dlg.addEventListener("beforeShow",function(){this.nodes.panel.parentNode.appendChild(this.nodes.panel);var that=this;if(!me.__isInitBgShadow){me.__initBGShadow(this,cfg.isAdamant||me.__cfg.isAdamant)}me.__setBGShadowOpacity(cfg.bgShadowOpacity!==0?cfg.bgShadowOpacity||.4:cfg.bgShadowOpacity);window.setTimeout(function(){me.__bgShadow.show();me.__updateDialogQueue(that,"add")},1)});dlg.setTitle=function(title){this.nodes.titleName&&(this.nodes.titleName.innerHTML=title)};dlg.setHelp=function(url){this.nodes.btnHelp&&(this.nodes.btnHelp.href=url)};dlg.close=function(){this.hidden()};dlg.getNodes=function(){return this.nodes};dlg.getX=function(){return this.x};dlg.getY=function(){return this.y};dlg.getWidth=function(){return this.width};dlg.getHeight=function(){return this.height};return dlg},__initBGShadow:function(dlg,isAdamant){var w=this.__getDocumentSize().width,h=this.__getDocumentSize().height,me=this;this.__bgShadow=new Ui.Panel;this.__bgShadow.setTemplate('<div id="#{panel}" style="background-color:black"></div>').setSize({width:w,height:h}).setAdamant(isAdamant).setFixed(true).setPosition({x:0,y:0,z:me.__zIndex});Core.Events.addEvent(window,function(){me.__bgShadow.setPosition({x:0,y:0}).setSize({width:me.__getDocumentSize().width,height:me.__getDocumentSize().height})},"resize");this.__isInitBgShadow=true},__updateDialogQueue:function(dialog,op){var i,dlg;if(op==="add"){this.__dialogQueue.push(dialog)}else if(op==="remove"){i=this.__dialogQueue.length;while(i--){this.__dialogQueue[i]===dialog&&this.__dialogQueue.splice(i,1)}}if(this.__dialogQueue.length===0){this.__bgShadow.hidden()}else{dlg=this.__dialogQueue[this.__dialogQueue.length-1];this.__bgShadow.nodes.panel.parentNode.insertBefore(this.__bgShadow.nodes.panel,dlg.nodes.panel);this.__bgShadow.__iframe&&this.__bgShadow.__iframe.parentNode.insertBefore(this.__bgShadow.__iframe,this.__bgShadow.nodes.panel);dlg.nodes.linkOk&&dlg.nodes.linkOk.style.display!=="none"&&dlg.nodes.linkOk.focus()}},__setBGShadowOpacity:function(v){v=isNaN(v)?0:Math.max(Math.min(v,1),0);Core.Dom.setStyle(this.__bgShadow.nodes.panel,"opacity",v)},__getDocumentSize:function(){var w=document.documentElement.clientWidth||document.body.clientWidth,h=document.documentElement.clientHeight||document.body.clientHeight;return{width:w,height:h}}});Ui.Transition={simple:function(t,b,c,d){return c*t/d+b},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d){var s=1.70158;if((t/=d/2)<1){return c/2*t*t*(((s*=1.525)+1)*t-s)+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*7.5625*t*t+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-Transition.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return Transition.bounceEaseIn(t*2,0,c,d)*.5+b}else{return Transition.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}p=d*.3;if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p))+b},elasticEaseOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*2*Math.PI/p)+c+b},elasticEaseInOut:function(t,b,c,d){var a,p;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*.3*1.5}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)*.5+c+b}};Ui.TweenStrategy=function(startValue,endValue,duration,motion){this.startValue=startValue||0;this.endValue=endValue||0;this.duration=duration||0;this.motion=motion||Ui.Transition.simple;this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value,startTime=(new Date).getTime();this._itvID=window.setInterval(function(){t=((new Date).getTime()-startTime)/1e3;t>me.duration&&(t=me.duration);value=me.motion(t,sv,ev-sv,d);me.onTween&&me.onTween(value);me.__eventDispatcher.dispatchEvent("tween",value);t==me.duration&&me.stop()},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;this.onEnd&&this.onEnd();this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});Ui.OpacityRenderer=function(){this.__canShow=true;this.__canHidden=true;this.__node=null;this.__tween=new Ui.TweenStrategy(0,0,.6,Ui.Transition.strongEaseOut);this.__state="";this.__lastState="";this.__value=0;this.__node=null;this.__eventDispatcher=new Core.Events.EventDispatcher(this);this.__initTweenEvent()}.$implements(Ui.IRenderer).$define({setCanShow:function(state){this.__canShow=!!state},setCanHidden:function(state){this.__canHidden=!!state},show:function(node){var tn=this.__tween;tn.stop();Core.Dom.setStyle(node,"opacity",this.__value);node.style.display="";this.__node=node;this.__state="show";this.__eventDispatcher.dispatchEvent("beforeShow");if(this.__canShow){tn.startValue=this.__value;tn.endValue=1;tn.start()}return this},hidden:function(node){var tn=this.__tween;tn.stop();this.__node=node;this.__state="hidden";this.__eventDispatcher.dispatchEvent("beforeHidden");if(this.__canHidden){tn.startValue=this.__value;tn.endValue=0;tn.start()}return this},addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},__initTweenEvent:function(){var me=this;this.__tween.addEventListener("tween",function(v){me.__value=v;Core.Dom.setStyle(me.__node,"opacity",v)});this.__tween.addEventListener("end",function(){me.__node&&me.__node.style.filter&&(me.__node.style.filter="");if(me.__state!==""&&me.__state!==me.__lastState){me.__lastState=me.__state;me.__eventDispatcher.dispatchEvent(me.__state)}me.__state==="hidden"&&(me.__node.style.display="none")})}});Ui.BorderDragger=function(){this.__drag=null;this.__isBindEvent=false;this.__border=null;this.__dragNode=null;this.__isCreated=false;this.__tweenX=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__tweenY=new Ui.TweenStrategy(0,0,.5,Ui.Transition.strongEaseOut);this.__eventDispatcher=new Core.Events.EventDispatcher(this)}.$implements(Ui.IDragger).$define({addEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.addEventListener(type,handle)}else{this.__drag.addEventListener(type,handle)}return this},removeEventListener:function(type,handle){if(type.toLowerCase()==="afterdrag"){this.__eventDispatcher.removeEventListener(type,handle)}else{this.__drag.removeEventListener(type,handle)}return this},setDrag:function(node,attachNode,isDragCapureNode){if(!this.__isCreated){this.__createBorder(attachNode);this.__initTweenEvent(attachNode)}this.__drag=new Ui.Drag(node,this.__border,isDragCapureNode);this.__dragNode=attachNode;this.__initDragEvent();return this},setLock:function(state){this.__drag.isLock=!!state;return this},setArea:function(area){this.__drag.lockArea=area;return this},destroy:function(){this.__drag.destroy()},__createBorder:function(node){this.__border=$C("div");var st=this.__border.style;st.border="2px dashed #BCC4D0";st.position="absolute";st.display="none";st.backgroundColor="transparent";st.MozUserSelect="none";document.body.appendChild(this.__border);this.__isCreated=true},__initDragEvent:function(){if(this.__isBindEvent){return}var me=this,bst=this.__border.style,nst=this.__dragNode.style,twX=this.__tweenX,twY=this.__tweenY;this.__drag.addEventListener("beforeDrag",function(){bst.zIndex=nst.zIndex+1;bst.position=nst.position;bst.width=me.__dragNode.offsetWidth-4+"px";bst.height=me.__dragNode.offsetHeight-4+"px";bst.left=parseInt(nst.left)+"px";bst.top=parseInt(nst.top)+"px";bst.display=""});this.__drag.addEventListener("afterDrag",function(){if($IE6){nst.left=parseInt(bst.left)+"px";nst.top=parseInt(bst.top)+"px";bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")}else{twX.startValue=parseInt(nst.left);twX.endValue=parseInt(bst.left);twY.startValue=parseInt(nst.top);twY.endValue=parseInt(bst.top);twX.start();twY.start()}});this.__isBindEvent=true},__initTweenEvent:function(node){var nst=node.style,bst=this.__border.style,me=this;this.__tweenX.addEventListener("tween",function(v){nst.left=v+"px"});this.__tweenY.addEventListener("tween",function(v){nst.top=v+"px"});this.__tweenX.addEventListener("end",function(){bst.display="none";me.__eventDispatcher.dispatchEvent("afterDrag")})}});var winDialog={};var DialogTemplate={};!function(){var dialogTemplates={alert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns_Mid"><a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newAlert:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),confirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示标题</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt">','<img id="#{icon}" class="SG_icon SG_icon201" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<table class="CP_w_ttl"><tr><td id="#{text}"></td></tr></table>','<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns">','<a  id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"> <span id="#{cancel}"></span> </cite></a></p>',"</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),newConfirm:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">提示</strong><cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 pop_v">','<div class="v_prompt">','<img id="#{icon}" class="SG_icon SG_icon148" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="20" height="20" align="absmiddle" />','<div id="#{text}" class="v_cnt SG_txtb"></div>','<div id="#{subText}"></div>','<p class="v_btns">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#"><cite id="#{btnOk}">确定</cite></a>&nbsp;&nbsp;','<a id="#{linkCancel}" class="SG_aBtn SG_aBtnB SG_aBtn_g" href="#"><cite id="#{btnCancel}">取消</cite></a>',"</p>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),customs:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("")};var iconSet={"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"05":{"class":"SG_icon SG_bigLoading",alt:"正在加载"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}};var dialogs={};var moduleDialog=new Ui.ModuleDialog(dialogTemplates,iconSet,{renderer:Ui.OpacityRenderer,dragger:Ui.BorderDragger,isAdamant:$IE6});winDialog.create=winDialog.createCustomsDialog=function(args,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.create(args);return dialogs[name]}else{return moduleDialog.create(args)}};winDialog.alert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.alert(text,cfg);return dialogs[name]}else{return moduleDialog.alert(text,cfg)}};winDialog.newAlert=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newAlert(text,cfg);return dialogs[name]}else{return moduleDialog.newAlert(text,cfg)}};winDialog.confirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.confirm(text,cfg);return dialogs[name]}else{return moduleDialog.confirm(text,cfg)}};winDialog.newConfirm=function(text,cfg,name){if(name&&typeof name==="string"){dialogs[name]=moduleDialog.newConfirm(text,cfg);return dialogs[name]}else{return moduleDialog.newConfirm(text,cfg)}};winDialog.getDialog=function(name){if(name&&typeof name==="string"){return dialogs[name]}};DialogTemplate=dialogTemplates}();$SYSMSG.extend({A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"很抱歉，您的IP出现异常，请稍后再试",A00003:"无权限进行此操作，请重新登录。",A00004:"无权限进行此操作，请重新登录。",A00005:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00006:"操作成功",A00007:"无权限进行此操作，请重新登录。",A00009:"网络繁忙，请稍后再试",A00010:"无升级权限",A11007:"你还未开通新浪博客，请先<a href='https://login.sina.com.cn/hd/reg_sec.php?entry=blog'> 开通博客</a>",A00800:"对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！",A00039:"对不起，该文章为私密文章，禁止评论！",A00038:"抱歉，您评论的文章不存在！",A00111:"抱歉，该文章禁止评论！",A00110:"用户设置为不允许评论！",P00001:"抱歉，您还没有认证实名，<br>请点击确认认证后，继续转载文章！"});function showError(code,ico){var msg=$SYSMSG[code]||code;winDialog.alert(msg,{icon:ico||"01"})}$SYSMSG.extend({A33001:"对方已经被你加为关注了！<br/>请不要重复添加。",A33002:"对方拒绝了你的关注请求！",A33003:"关注已达上限，不能再添加新的关注了！<br/>可以到<a href='http://control.blog.sina.com.cn/blogprofile/attention.php"+"' target='_blank'>关注的人</a>去取消关注一些人，再回来关注吧。",A33004:"关注成功！",A33005:"你不能添加自己为关注！",A33008:"取消关注失败",A33009:"移除关注成功，加黑名单失败",A33010:"对不起，您短时间添加关注过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！",A20013:"您已经发送多条相似内容了哦，请先休息一下吧~",A20014:"已经有很多博主发过相似评论了，换个内容会更精彩~"});Utils.Cookie.setCookie=function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+"="+escape(value));if(expire){var dd=new Date;var expires=dd.getTime()+expire*36e5;dd.setTime(expires);cstr.push("expires="+dd.toGMTString())}if(path){cstr.push("path="+path)}if(domain){cstr.push("domain="+domain)}if(secure){cstr.push(secure)}document.cookie=cstr.join(";")};String.prototype.format=function(){var r=!arguments[0]||typeof arguments[0]=="undefined"?"":arguments[0].toString();var re=/(.*?)({(\d+)(:([0-9a-z]+))?})/gi;var t=this.match(re);if(t){for(var i=0,l=t.length;i<l;i++){t[i]=t[i].replace(re,function(){return RegExp.$1});t[i]=RegExp.$1;switch(typeof arguments[parseInt(RegExp.$3)]){case"undefined":t[i]+=RegExp.$2;break;case"number":t[i]+=isNaN(RegExp.$5)||RegExp.$5==""?arguments[parseInt(RegExp.$3)]:arguments[parseInt(RegExp.$3)].toString(Math.max(Math.min(Math.round(RegExp.$5),36),2));break;default:t[i]+=arguments[parseInt(RegExp.$3)]}}t.push(this.replace(re,""));return t.join("")}return this};Sina.pkg("Core.Math");Core.Math.getUniqueId=function(_start,_end){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()};Lib.pkg("Login");Lib.Login.info=function(){var info;if(window["sinaSSOController"]&&(info=sinaSSOController.getLoginInfo())){return info}else{return{}}};Lib.Login.LoginPost=Core.Class.create();Lib.Login.LoginPost.prototype={url:"https://i.sso.sina.com.cn/js/ssologin.js",callback:null,state:{isRequesting:false},initialize:function(callback,clearDomain,from){var _self=this;window.sinaSSOConfig=new function(){if(from){this.from=from}this.pageCharset="utf-8";this.noActiveTime=14400;this.setDomain=true;this.entry="boke";this.customInit=function(){};this.customLoginCallBack=function(){callback.apply(null,arguments);_self.state.isRequesting=false};this.customLogoutCallBack=function(result){};this.useIframe=true}},login:function(username,password,time){var _this=this;if(this.state.isRequesting){return}else{this.state.isRequesting=true}if(typeof sinaSSOController=="undefined"||!sinaSSOController){trace("no sso");Utils.Io.JsLoad.request(this.url,{onComplete:function(){__login()},onException:function(){},timeout:3e4,isRemove:false})}else{trace("has sso");sinaSSOController.init();if(typeof sinaSSOController.setLoginType=="function"){sinaSSOController.setLoginType(2)}if(typeof sinaSSOController.getServerTime=="function"){}trace("init ok");__login()}function __login(){if(typeof time=="undefined"){sinaSSOController.login(username,password)}else{sinaSSOController.login(username,password,time)}}},parse:function(loginStatus){this.callback.call(loginStatus)}};Core.System.getScrollPos=function(oDocument){oDocument=oDocument||document;var dd=oDocument.documentElement;var db=oDocument.body;return[Math.max(dd.scrollTop,db.scrollTop),Math.max(dd.scrollLeft,db.scrollLeft),Math.max(dd.scrollWidth,db.scrollWidth),Math.max(dd.scrollHeight,db.scrollHeight)]};Core.Dom.getStyle=function(el,property){switch(property){case"opacity":var val=100;try{val=el.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(e){try{val=el.filters("alpha").opacity}catch(e){}}return val/100;case"float":property="styleFloat";default:var value=el.currentStyle?el.currentStyle[property]:null;return el.style[property]||value}};if(!$IE||$IE>8){Core.Dom.getStyle=function(el,property){if(property=="float"){property="cssFloat"}try{var computed=document.defaultView.getComputedStyle(el,"")}catch(e){traceError(e)}return el.style[property]||computed?computed[property]:null}}Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;box=el.getBoundingClientRect();var scrollPos=Core.System.getScrollPos(el.ownerDocument);return[box.left+scrollPos[1],box.top+scrollPos[0]];parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos};if(!$IE){Core.Dom.getXY=function(el){if((el.parentNode==null||el.offsetParent==null||Core.Dom.getStyle(el,"display")=="none")&&el!=document.body){return false}var parentNode=null;var pos=[];var box;var doc=el.ownerDocument;pos=[el.offsetLeft,el.offsetTop];parentNode=el.offsetParent;var hasAbs=Core.Dom.getStyle(el,"position")=="absolute";if(parentNode!=el){while(parentNode){pos[0]+=parentNode.offsetLeft;pos[1]+=parentNode.offsetTop;if($SAFARI&&!hasAbs&&Core.Dom.getStyle(parentNode,"position")=="absolute"){hasAbs=true}parentNode=parentNode.offsetParent}}if($SAFARI&&hasAbs){pos[0]-=el.ownerDocument.body.offsetLeft;pos[1]-=el.ownerDocument.body.offsetTop}parentNode=el.parentNode;while(parentNode.tagName&&!/^body|html$/i.test(parentNode.tagName)){if(Core.Dom.getStyle(parentNode,"display").search(/^inline|table-row.*$/i)){pos[0]-=parentNode.scrollLeft;pos[1]-=parentNode.scrollTop}parentNode=parentNode.parentNode}return pos}}!function(){var _inputNode;var _rndID=parseInt(Math.random()*100);var _showMenuItems=[];var _selectMenuIndex=-1;var _selectMenuText="";var _css="#userPosition {padding: 0;margin: 0;border: 0;position: absolute;z-index: 999;}				#sinaNote {position: absolute;z-index: 999999;width: auto;overflow: hidden;padding: 0;margin: 0;				border: 1px solid #CCCCCC;background: #ffffff;text-align:left;}				#sinaNote li {font-size: 12px;list-style: none;margin: 0 1px;height: 20px;padding: 0 5px;clear: both;				line-height: 20px;cursor: pointer;color: #999999;}				#sinaNote li.note {text-align: left;color: #999999;}";var _viewWindow=window;var passcardOBJ={overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:"",menuStatus:{"sina.com":true,"sina.cn":true,"vip.sina.com":true,"qq.com":true,"163.com":true,"126.com":true,"hotmail.com":true,"yahoo.com.cn":true,"gmail.com":true}};passcardOBJ.createNode=function(){var d=_viewWindow.document;var div=d.createElement("div");div.innerHTML='<ul id="sinaNote" style="display:none;"></ul>';var obj=d.createElement("style");obj.setAttribute("type","text/css");try{if($IE){obj.styleSheet.cssText=_css}else{obj.innerHTML=_css}}catch(e){trace(e.message)}var total=d.createElement("div");total.appendChild(div);total.appendChild(obj);d.body.appendChild(total)};passcardOBJ.arrowKey=function(keyCodeNum){if(keyCodeNum==38){if(_selectMenuIndex<=0){_selectMenuIndex=_showMenuItems.length}_selectMenuIndex--;passcardOBJ.selectLi(_selectMenuIndex)}if(keyCodeNum==40){if(_selectMenuIndex>=_showMenuItems.length-1){_selectMenuIndex=-1}_selectMenuIndex++;passcardOBJ.selectLi(_selectMenuIndex)}};passcardOBJ.showList=function(e){_selectMenuText="";var keyCodeNum=Core.Events.getEvent().keyCode;if(keyCodeNum==38||keyCodeNum==40){passcardOBJ.arrowKey(keyCodeNum);return false}if(!$E("sinaNote")){passcardOBJ.createNode()}var username=$E(e).value;var menuList={};var atIndex=username.indexOf("@");var InputCase="";var InputStr="";if(atIndex>-1){InputCase=username.substr(atIndex+1);InputStr=username.substr(0,atIndex)}_showMenuItems=[];_selectMenuIndex=0;_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_Title_"+_rndID;for(var key in this.menuStatus){this.menuStatus[key]=true;if(InputCase!=""&&InputCase!=key.substr(0,InputCase.length)){this.menuStatus[key]=false}else{_showMenuItems[_showMenuItems.length]="sinaNote_MenuItem_"+key+"_"+_rndID}}var listcontent='<li class="note">请选择登录类型</li>';listcontent+='<li id="sinaNote_MenuItem_Title_'+_rndID+'">'+username+"</li>";var itemLabel;for(var mykey in this.menuStatus){if(this.menuStatus[mykey]==true){if(InputStr==""){itemLabel=username+"@"+mykey}else{itemLabel=InputStr+"@"+mykey}listcontent+='<li id="sinaNote_MenuItem_'+mykey+"_"+_rndID+'" title="'+itemLabel+'">'+itemLabel+"</li>"}}$E("sinaNote").innerHTML=listcontent;for(var i=0;i<username.length;i++){if(username.charCodeAt(i)<160){$E("sinaNote").style.display="";this.selectList(e)}else{this.hideList()}}var el=$E(e);var note=$E("sinaNote");var frameLeft=0;var frameTop=0;var framePos;if(_viewWindow!=window){framePos=Core.Dom.getXY(window.frameElement);frameLeft=framePos[0];frameTop=framePos[1]}var inputWidth=el.offsetWidth;if(inputWidth<200){inputWidth=200}note.style.width=inputWidth-2+"px";var inputXY=Core.Dom.getXY(el);note.style.left=inputXY[0]-($IE?2:-1)+frameLeft+"px";note.style.top=inputXY[1]+el.offsetHeight-($IE?2:-1)+frameTop+"px"};passcardOBJ.selectList=function(e){var unames=$E("sinaNote").getElementsByTagName("li");for(var i=1;i<unames.length;i++){unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor;unames[i].onmousedown=function(){var temp=this.innerHTML;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");$E(e).value=pos[0]}else{$E(e).value=this.innerHTML}if(Core.Events.getEvent()!=null){Core.Events.stopEvent()}};unames[i].onmouseover=function(){if(i!=1){unames[1].style.backgroundColor=passcardOBJ.outbgcolor;unames[1].style.color=passcardOBJ.overfcolor}this.style.backgroundColor=passcardOBJ.overbgcolor;this.style.color=passcardOBJ.outfcolor};unames[i].onmouseout=function(){this.style.backgroundColor=passcardOBJ.outbgcolor;this.style.color=passcardOBJ.overfcolor;unames[1].style.backgroundColor=passcardOBJ.overbgcolor;unames[1].style.color=passcardOBJ.outfcolor}}};passcardOBJ.selectLi=function(nIndex){var menuNode;$E("sinaNote_MenuItem_Title_"+_rndID).style.backgroundColor=passcardOBJ.outbgcolor;$E("sinaNote_MenuItem_Title_"+_rndID).style.color=passcardOBJ.overfcolor;for(var i=0;i<_showMenuItems.length;i++){menuNode=$E(_showMenuItems[i]);menuNode.style.backgroundColor=passcardOBJ.outbgcolor;menuNode.style.color=passcardOBJ.overfcolor}$E(_showMenuItems[nIndex]).style.backgroundColor=passcardOBJ.overbgcolor;$E(_showMenuItems[nIndex]).style.color=passcardOBJ.outfcolor;_selectMenuText=$E(_showMenuItems[nIndex]).innerHTML};passcardOBJ.hideList=function(){if(!$E("sinaNote")){passcardOBJ.createNode()}$E("sinaNote").style.display="none"};passcardOBJ.init=function(oNode,oColors,oFocusNode,oWindowTarget){oWindowTarget=oWindowTarget||window;if(oWindowTarget.document.body==null){setTimeout(Core.Function.bind3(function(){this.init(oNode,oColors,oFocusNode,oWindowTarget)},this),100)}for(var key in oColors){this[key]=oColors[key]}Core.Events.addEvent(document,passcardOBJ.hideList,"click");Core.Events.addEvent(oNode,passcardOBJ.hideList,"blur");Core.Events.addEvent(oNode,Core.Function.bind3(passcardOBJ.showList,this,[oNode]),"keyup");Core.Events.addEvent(oNode,function(e){var keyCodeNum=Core.Events.getEvent().keyCode;var isSinaMail;if(keyCodeNum==13||keyCodeNum==9){if(_selectMenuText!=""){var temp=_selectMenuText;if(temp.indexOf("非新浪邮箱")>-1){var pos=temp.split("@");oNode.value=pos[0]+"@";isSinaMail=false}else{oNode.value=_selectMenuText;isSinaMail=true}}if(isSinaMail){if(oFocusNode!=null){setTimeout(function(){oFocusNode.focus()},0)}}else{if(oNode){oNode.focus()}}}},"keydown");if(oWindowTarget){_viewWindow=oWindowTarget}};Lib.passcardOBJ=passcardOBJ}();Lib.Login.Ui=Core.Class.create();var msnRefreshTimer=0;function msnrefreshWindow(){var setCookie=Utils.Cookie.setCookie;var getCookie=Utils.Cookie.getCookie;clearTimeout(msnRefreshTimer);var reg_token=getCookie("reg_token");if(reg_token){trace("token find out...");setCookie("reg_token","","","/",".blog.sina.com.cn")}else{trace("no token...");msnRefreshTimer=setTimeout(msnrefreshWindow,1e3);return}var cookieArr;var cid;var code;var c_cid=getCookie("c_uid");var CBcookie=getCookie("msnLinkCB");var altReg=getCookie("AlT");setCookie("msnLoginComeFrom",window.location.href,1,"/",".blog.sina.com.cn");if(CBcookie){cookieArr=CBcookie.split("_");cid=cookieArr[0];code=cookieArr[1]}if(c_cid!=cid)return;switch(code){case"noCid":break;case"loginError":break;case"unlink":deleteCookie("msnLinkCB");funcNoAccount(reg_token);break;case"done":deleteCookie("msnLinkCB");setCookie("loginFromMsn","msn",24,"/",".blog.sina.com.cn");funcSuccess(altReg,reg_token);break;case"pass":break}function funcSuccess(arg,reg_tk){trace("has Account");if(arg){trace("alt:"+arg);var iframe=$C("iframe");iframe.setAttribute("height",0);iframe.setAttribute("width",0);document.body.appendChild(iframe);iframe.src="https://login.sina.com.cn/sso/login.php?entry=blogmsn&service=blogmsn&alt="+encodeURIComponent(arg)+"&savestate=7&returntype=TEXT";!function(){var me=arguments.callee;if(!me.count)me.count=0;if(me.count++>10){trace("放弃获取SUBP");iframe.parentNode.removeChild(iframe);return}trace("尝试获取SUBP, count:"+me.count);if(getCookie("SUBP")){trace("获取到 SUBP"+getCookie("SUBP"));window.location.reload();return}setTimeout(me,1e3)}()}else{window.location.reload()}}function funcNoAccount(){trace("noAccount");window.location.href="http://blog.sina.com.cn/blog_rebuild/msn/interface/connect_user_confirm.php"
}function deleteCookie(name){var Then=new Date;Then.setTime(Then.getTime()-1);document.cookie=name+"=_pass;path=/;domain=.blog.sina.com.cn;expires="+Then.toGMTString()}function jsonDecode(str){if(!str||str==""){return null}try{return window.eval("("+str+")")}catch(e){return null}}}Lib.Login.Ui.prototype={dialog:null,isInit:false,request:null,callback:null,initialize:function(){},login:function(callback,clearDomain,from){this.callback=callback||null;this.clearDomain=clearDomain||false;this.from=from||null;this.initDom();this.initEvent();this.dialog.show();this.dialog.setAreaLocked(true);this.reloadName();this.onShow();this.focus();if(scope.$pageid==="blogMove"){$E("login_move_tip").style.display=""}if($IE6){this.initAD()}Lib.passcardOBJ.init($E("login_name_d"),{overfcolor:"#999",overbgcolor:"#e8f4fc",outfcolor:"#000000",outbgcolor:""},$E("login_pass_d"))},reloadName:function(){var userInfo=Lib.Login.info();var defaultName=userInfo.ln;if(defaultName){$E("login_name_d").value=defaultName}var alf=Utils.Cookie.getCookie("ALF");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}alf=Utils.Cookie.getCookie("LiRe");if(alf!=""&&$E("login_save")){$E("login_save").checked=true;$E("login_save_tips").style.display="none"}},initDom:function(){var me=this;this.dialog=winDialog.createCustomsDialog({tpl:me.tpl});this.dialog.addEventListener("hidden",function(){this.destroy()});this.dialog.setContent(this.struc);this.dialog.setTitle("登录新浪博客");this.dialog.setMiddle()},initEvent:function(){var callback=this.parse.bind2(this);this.request=new Lib.Login.LoginPost(callback,this.clearDomain,this.from);Core.Events.addEvent("login_button",this.doLogin.bind2(this));Core.Events.addEvent("login_name_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");Core.Events.addEvent("login_pass_d",function(e){var code=e.keyCode;if(code==13){this.doLogin()}}.bind2(this),"keydown");var cancelStatus=1;Core.Events.addEvent("login_save",function(){if($E("login_save").checked){$E("login_save_tips").style.display=""}else{$E("login_save_tips").style.display="none"}if(cancelStatus){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00001&rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}});cancelStatus=null}})},doLogin:function(){Core.Events.stopEvent();var username=$E("login_name_d").value;var password=$E("login_pass_d").value;username=Core.String.trim(username);password=password;if(username==""){this.error("请输入登录名");return false}if(password==""){this.error("请输入密码");return false}if(typeof sinaSSOController!="undefined"&&typeof sinaSSOController.loginExtraQuery!="undefined"){if(typeof sinaSSOController.loginExtraQuery.door!="undefined"){var vcode=$E("login_vcode").value;sinaSSOController.loginExtraQuery.door=vcode||1}}if($E("login_save").checked){v7sendLog("48_01_38_1");this.request.login(username,password,60)}else{v7sendLog("48_01_38_0");this.request.login(username,password)}return false},parse:function(loginStatus){if(loginStatus.result){Lib.checkAuthor();if($E("login_save").checked){Utils.Cookie.setCookie("LiRe",true,2400,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("LiRe","",2400,"/",".blog.sina.com.cn")}var date=new Date,y=date.getFullYear(),m=date.getMonth(),d=date.getDate();var time=new Date(y,m,d,24).getTime();Utils.Cookie.setCookie("onceloggedonblog",time,720,"/",".blog.sina.com.cn");var me=this;function cbreload(){if(this.callback){try{$tray.renderLogin()}catch(e){}this.callback.call()}else{window.location=window.location.toString().replace(/#.*/,"")}}var cbed=false;Utils.Io.JsLoad.request("https://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent($E("login_name_d").value)+"&utf82gbk=1&callback=scope.$bindEmailAlert",{noreturn:true,timeout:5e3,onException:function(){if(!cbed){cbreload.call(me)}}});scope.$bindEmailAlert=function(data){cbed=true;if(data.ret!="y"&&data.errcode!="not_verify"||Utils.Cookie.getCookie("sbr_noTBE")==1){cbreload.call(me)}else{var dialog=winDialog.createCustomsDialog({content:['<div id="#{entityID} style="width:358px;height:144px" class="CP_layercon2 unilayer">','<div id="#{contentID}" class="CP_prompt">','<img height="50" align="absmiddle" width="50" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon201">','<table class="CP_w_ttl"><tbody><tr><td>经检测您的帐号存在一定的安全隐患！<br>建议绑定邮箱</td></tr></tbody></table>','<p class="CP_w_btns_Mid"><a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{bindit}" target="_blank"><cite> 绑定 </cite></a>&nbsp;&nbsp;<a href="javascript:;" class="SG_aBtn SG_aBtnB" id="#{nobind}"><cite> 暂不绑定 </cite></a></p>',"</div>",'<div class="unilayerB SG_j_linedot1">','<p class="SG_txtb"><input type="checkbox" id="#{noalertbind}"><label for="#{noalertbind}">一周内不提醒</label></p>',"</div>","</div>"].join(""),shadow:1},"bindEmail");dialog.setMiddle();dialog.show();dialog.nodes["btnClose"].onclick=function(){cbreload.call(me);dialog.hidden()};dialog.nodes["nobind"].onclick=function(){setTimeout(function(){cbreload.call(me);dialog.hidden()},100)};dialog.nodes["bindit"].href="https://login.sina.com.cn/bindmail/bindmail.php?entry=blog";dialog.nodes["bindit"].onclick=function(){cbreload.call(me)};dialog.nodes["noalertbind"].onclick=function(){if(this.checked){Utils.Cookie.setCookie("sbr_noTBE","1",24*7,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("sbr_noTBE","",0,"/",".blog.sina.com.cn")}}}};this.dialog.hidden()}else{if(loginStatus.errno==="4049"){sinaSSOController.loginExtraQuery={door:0};$E("login_ckimg").style.display="";$E("login_vcode").value="";$E("checkImg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";Core.Events.addEvent($E("reloadCode"),function(){$E("checkImg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value="";$E("login_div_error").innerHTML=""});this.error("");return}if(loginStatus.errno==="2070"){Core.Events.fireEvent($E("reloadCode"),"click");this.error(loginStatus.reason);return}if(loginStatus.errno=="4047"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4057"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="4040"){this.error(loginStatus.reason);return}else if(loginStatus.errno=="50113038"){this.error(loginStatus.reason);return}this.error("登录名或密码错误");$E("checkImg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0";$E("login_vcode").value=""}},friendlyTip:function(reason){var ret=reason;var node=$E("login_name_d");var name=node.value;var me=this;if(!/[\u0391-\uFFE5]+/.test(name)&&!/^\d+$/.test(name)&&!/^@/.test(name)){var str="你的登录名可能是 ";var linkTpl='<a href="#" class="underline" onclick="$_RENAME(/@.*/, \'{1}\');return false">{0}{1}</a>';var linkArr=["@sina.com","@sina.cn"];var finalLink="";if(/@sina\.cn$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[0])}else if(/@sina\.com$/.test(name)){finalLink=linkTpl.format("{0}",linkArr[1])}else{finalLink=linkTpl.format("{0}",linkArr[0])+" 或 "+linkTpl.format("{0}",linkArr[1])}ret=(str+finalLink).format(name.replace(/@.*/,""))}return ret},rename:function(){window.$_RENAME=function(reg,suf){var node=$E("login_name_d");node.value=node.value.replace(reg,"")+suf;$E("login_pass_d").focus();$E("login_div_error").innerHTML=""};return window.$_RENAME}(),focus:function(){var nameEl=$E("login_name_d");if(nameEl.value==""){nameEl.focus()}else{$E("login_pass_d").focus()}},initAD:function(){},onShow:function(){},error:function(msg){$E("login_div_error").innerHTML=msg;$E("login_pass_d").value="";this.focus()},tpl:['<table id="#{panel}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),struc:'		<div class="CP_layercon2 passLoginItem">			<div>				<div id="login_move_tip" style="display:none;margin-bottom:12px">可以使用新浪微博、邮箱、通行证的帐号进行登录</div>				<div class="boxA">登录名：					<input tabIndex="201" type="text" class="fm1" style="width:215px;" name="login_name" id="login_name_d" tabIndex=1/>  <a style="font-size: 12px;" href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid='+scope.$uid+'&src=blogicp" target="_blank">立即注册</a>				</div>				<div class="boxA">密　码：					<input tabIndex="202" type="password" class="fm1" style="width:215px;" name="login_pass" maxlength="16" id="login_pass_d" tabIndex=2/>  <a style="font-size: 12px;" href="https://login.sina.com.cn/getpass.html" target="_blank">找回密码</a>				</div>				<div id="login_ckimg" class="boxA" style="display:none"> <p class="p_img">验证码：                  	<input type="text" id="login_vcode" name="login_vcode" class="fm1" size="10" maxlength="5" />                  	<img width="100" align="absmiddle" id="checkImg" src="https://login.sina.com.cn/cgi/pin.php?r='+Core.Math.getUniqueId()+'&s=0" /> <a href="javascript:;" onclick="return false;" style="font-size: 12px;"><span id="reloadCode">换一换</span></a></p> 			    </div>				<div class="ErrTips" id="login_div_error"></div>				<div class="boxB"><p><input tabIndex="203" type="checkbox" value="" id="login_save" checked="checked" /><label for="login_save"> 记住登录状态</label></p><p id="login_save_tips" style="color:#999;display:none;">建议在网吧/公用电脑上取消该选项</p><p style="margin-top: 8px;"><a id="login_button" class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;" tabIndex=204><cite>登录<input type="text"/></cite></a> </p></div>			</div>			<div class="connect_msn" id="connect_msn" style="position:relative;display:none;">				<span>使用 MSN 帐号登录博客</span>				<a href="#" onclick="Lib.checkAuthor();v7sendLog(\'48_01_36\'); window.open(\'https://login.live.com/oauth20_authorize.srf?client_id=0000000040046F08&redirect_uri=http%3A%2F%2Fcontrol.blog.sina.com.cn%2Fblog_rebuild%2Fmsn%2FmsnLoginCallBack.php&response_type=code&scope=wl.basic%20wl.signin%20wl.offline_access%20wl.share%20wl.emails\',\'neww\',\'left='+(screen.width-440)/2+",top="+(screen.height-400)/2+',height=400,width=440\');msnrefreshWindow();" style="background:transparent url(http://simg.sinajs.cn/blog7style/images/msn_login01.gif) no-repeat left top; width:70px; height:22px; line-height:22px; display:inline-block; text-align:left; text-indent:2em; text-decoration:none; color:white; font-weight:bold; font-size:14px;">登录</a>			</div>			<a href="http://blog.sina.com.cn/s/blog_4b0f52990100miil.html" target="_blank"style="left:308px;position:relative;top:-24px;display:none;">如何登录？</a>			<div class="CP_lg_ad SG_j_linedot1">			</div>		</div>'};Core.System.winSize=function(_target){var w,h;if(_target){target=_target.document}else{target=document}if(self.innerHeight){if(_target){target=_target.self}else{target=self}w=target.innerWidth;h=target.innerHeight}else if(target.documentElement&&target.documentElement.clientHeight){w=target.documentElement.clientWidth;h=target.documentElement.clientHeight}else if(target.body){w=target.body.clientWidth;h=target.body.clientHeight}return{width:w,height:h}};Core.System.pageSize=function(_target){if(_target){target=_target.document}else{target=document}var _rootEl=target.compatMode=="CSS1Compat"?target.documentElement:target.body;var xScroll,yScroll;if(window.innerHeight&&window.scrollMaxY){xScroll=_rootEl.scrollWidth;yScroll=window.innerHeight+window.scrollMaxY}else if(_rootEl.scrollHeight>_rootEl.offsetHeight){xScroll=_rootEl.scrollWidth;yScroll=_rootEl.scrollHeight}else{xScroll=_rootEl.offsetWidth;yScroll=_rootEl.offsetHeight}var win_s=Core.System.winSize(_target);if(yScroll<win_s.height){pageHeight=win_s.height}else{pageHeight=yScroll}if(xScroll<win_s.width){pageWidth=win_s.width}else{pageWidth=xScroll}return[pageWidth,pageHeight,win_s.width,win_s.height]};!function(){function LazyLoad(oObjects,oOptions){this.node=oObjects;this.config=oOptions;for(var key in this.defaultConfig){this.config[key]=this.defaultConfig[key]}this.initialize();return this}LazyLoad.prototype={defaultConfig:{preloadPixel:500},initialize:function(){this.viewableHeight=LazyLoadListener.getViewableHeight();LazyLoadListener.enrol(this)},callback:function(nHeight){if(this.node.length==0){return}this.viewableHeight=nHeight||this.viewableHeight;var remanent=[];for(var i=0,len=this.node.length;i<len;i++){if(this.node[i]&&this.node[i].dom==null&&Core.Dom.getXY(this.node[i])[1]<this.viewableHeight+this.config.preloadPixel){this.config.callback(this.node[i]);this.node[i]=null}else if(this.node[i]&&this.node[i].dom&&Core.Dom.getXY(this.node[i].dom)[1]<this.viewableHeight+this.config.preloadPixel){this.node[i].callback(this.node[i].dom);this.node[i]=null}else{remanent.push(this.node[i])}}this.node=remanent}};var LazyLoadListener={_isInit:null,_binder:null,_isWindow:null,_member:[],initialize:function(){var container=window,isWindow=container==window||container==document||!container.tagName||/^(?:body|html)$/i.test(container.tagName);if(isWindow){var doc=container.document;container=doc.compatMode=="CSS1Compat"&&($IE||$FF||$OPERA)?doc.documentElement:doc.body;try{if($CHROME&&navigator.userAgent.match(/chrome\/(\d+)/i)[1]>60){container=doc.documentElement}}catch(e){}}this._container=container;this._binder=isWindow?window:container;this._isWindow=isWindow;this._isInit=true;this.delayResize();this.bindEvent()},getViewableHeight:function(){var eyeableHeight=LazyLoadListener._container.scrollTop+Core.System.winSize().height;this.eyeableHeight=eyeableHeight;return eyeableHeight},bindEvent:function(){if(!this._isInit){this.initialize();return}Core.Events.addEvent(this._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.addEvent(this._binder,LazyLoadListener.delayResize,"resize")}this.binded=true},unbindEvent:function(){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayLoad,"scroll");if(this._isWindow){Core.Events.removeEvent(LazyLoadListener._binder,LazyLoadListener.delayResize,"resize")}this.binded=false},delayLoad:function(){if(LazyLoadListener.scrollWatch){clearTimeout(LazyLoadListener.scrollWatch)}LazyLoadListener.scrollWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.scrollWatch);LazyLoadListener.scrollWatch=null},100)},delayResize:function(){if(LazyLoadListener.resizeWatch){clearTimeout(LazyLoadListener.resizeWatch)}LazyLoadListener.resizeWatch=setTimeout(function(){LazyLoadListener.callback();clearTimeout(LazyLoadListener.resizeWatch);LazyLoadListener.resizeWatch=null},100)},enrol:function(oLazy){LazyLoadListener._member.push(oLazy)},callback:function(){LazyLoadListener.getViewableHeight();if(LazyLoadListener._member.length>0){for(var i=0,len=LazyLoadListener._member.length;i<len;i++){LazyLoadListener._member[i].callback(LazyLoadListener.eyeableHeight)}}if(LazyLoadListener.eyeableHeight==Core.System.pageSize()[1]){LazyLoadListener.unbindEvent()}}};Lib.LazyLoad=function(oObjects,oOptions){if(LazyLoadListener.binded!=true){LazyLoadListener.bindEvent(oObjects,oOptions)}new LazyLoad(oObjects,oOptions)}}();var Layer=function(template){this.entity=null;this.ifm=null;var _this=this;var Property={width:0,height:0,x:0,y:0,isFixed:false,uniqueID:"",entityID:"",contentID:"",template:template,templateString:"",nodes:{}};this.getProperty=function(){return Property};!function initialize(){var p=_this.getProperty();p.uniqueID="_"+_this.getUniqueID();p.entityID=p.uniqueID+"_entity";p.contentID=p.uniqueID+"_content";_this.setTemplate(p.template);p.width=parseInt(_this.entity.style.width);if($IE6){_this.addIframe()}document.body.appendChild(_this.entity);_this.hidden()}();this._ie6Fixed=function(){_this.entity.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px";if(_this.ifm){_this.ifm.style.left=document.documentElement.scrollLeft+_this.getProperty().x+"px";_this.ifm.style.top=document.documentElement.scrollTop+_this.getProperty().y+"px"}}};Layer.prototype={setTemplate:function(template){var p=this.getProperty();if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}if(typeof template=="object"){p.nodes=template;if(this.entity){this.entity.parentNode.removeChild(this.entity);this.entity=null}this.entity=p.nodes.entity;document.body.appendChild(this.entity);if(!p.nodes.entity||!p.nodes.content){throw new Error("[layer.js] missing entity or content in layer nodes")}else{this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px"}return}var pattern=/[^\{\}]+(?=\})/g;p.template=template;p.templateString=p.template.match(pattern);this.entity=$C("div");var tempEntity=$C("div");var tmp=new Ui.Template(p.template);tempEntity.innerHTML=tmp.evaluate(this.getNodes("i"));document.body.appendChild(tempEntity);if(!$E(p.entityID)||!$E(p.contentID)){throw new Error("[layer.js] there missing #{entityID} or #{contentID} in layer template")}else{this.entity=$E(p.entityID);this.entity.style.position="absolute";this.entity.style.zIndex="1024";this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";document.body.replaceChild(this.entity,tempEntity);tempEntity=null}p.nodes=this.getNodes()},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);if(opts.width){p.nodes.content.style.width=p.width+"px"}if(opts.height){p.nodes.content.style.height=p.height+"px"}this.updateIfmSize()},setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.entity.style.left=p.x+"px";this.entity.style.top=p.y+"px";if($IE6&&p.isFixed){this.entity.style.left=p.x+document.documentElement.scrollLeft+"px";this.entity.style.top=p.y+document.documentElement.scrollTop+"px"}if(this.ifm){this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top}},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},updateIfmSize:function(){if(this.ifm){var _this=this;_this.ifm.style.width=_this.entity.offsetWidth+"px";_this.ifm.style.height=_this.entity.offsetHeight+"px"}},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;var _this=this;if($IE6){_this.entity.style.position="absolute";if(p.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}if(p.isFixed&&$FF2){_this.updateFixed();return}this.entity.style.position=p.isFixed?"fixed":"absolute"},updateFixed:function(){var p=this.getProperty();if(p.isFixed&&$FF2){var _this=this;var lastX=p.x,lastY=p.y;_this.entity.style.position="absolute";_this.setPosition({x:p.x+document.documentElement.scrollLeft,y:p.y+document.documentElement.scrollTop});_this.entity.style.position="fixed";_this.setPosition({x:lastX,y:lastY})}},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display="";this.updateIfmSize()}},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}},addIframe:function(){this.ifm=$C("iframe");this.ifm.style.position="absolute";this.ifm.style.zIndex="1024";this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;document.body.appendChild(this.ifm);Core.Dom.setStyle(this.ifm,"opacity",0)},getNodes:function(mode){var p=this.getProperty();var m=mode||"o";var i;var nodes={};var result=p.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(p.uniqueID+"_"+r);break;case"i":nodes[r]=p.uniqueID+"_"+r;break}}}return"entity"in nodes?nodes:p.nodes},getUniqueID:function(){return parseInt(Math.random()*1e4).toString()+(new Date).getTime().toString()},setContent:function(sHTML){var p=this.getProperty();if(sHTML){p.nodes.content.innerHTML=sHTML}}};!function(){var transitions={simple:function(time,startValue,changeValue,duration){return changeValue*time/duration+startValue},backEaseIn:function(t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backEaseOut:function(t,b,c,d,a,p){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backEaseInOut:function(t,b,c,d,a,p){var s=1.70158;if((t/=d/2)<1){return c/2*t*t*(((s*=1.525)+1)*t-s)+b}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},bounceEaseOut:function(t,b,c,d){if((t/=d)<1/2.75){return c*7.5625*t*t+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},bounceEaseIn:function(t,b,c,d){return c-transitions.bounceEaseOut(d-t,0,c,d)+b},bounceEaseInOut:function(t,b,c,d){if(t<d/2){return transitions.bounceEaseIn(t*2,0,c,d)*.5+b}else{return transitions.bounceEaseOut(t*2-d,0,c,d)*.5+c*.5+b}},strongEaseInOut:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},regularEaseIn:function(t,b,c,d){return c*(t/=d)*t+b},regularEaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},regularEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return-c/2*(--t*(t-2)-1)+b},strongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},strongEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},strongEaseInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},elasticEaseIn:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p))+b},elasticEaseOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*.3}if(!a||a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*2*Math.PI/p)+c+b},elasticEaseInOut:function(t,b,c,d,a,p){if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){var p=d*.3*1.5}if(!a||a<Math.abs(c)){var a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return-.5*a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*2*Math.PI/p)*.5+c+b}};var getUniqueID=function(oNode){return oNode.uniqueID};if(!$IE){getUniqueID=function(oNode){try{var rnd_ID;if(oNode.getAttribute("uniqueID")==null){rnd_ID="moz__id"+parseInt(Math.random()*100)+"_"+(new Date).getTime();oNode.setAttribute("uniqueID",rnd_ID);return rnd_ID}return oNode.getAttribute("uniqueID")}finally{rnd_ID=null}}}function getType(oObject){try{var s=oObject.constructor.toString().toLowerCase();return s.slice(s.indexOf("function")+9,s.indexOf("()"))}finally{s=null}}function getStartValue(oNode,aProperty){var i,_len,_arr=[];_len=aProperty.length;for(i=0;i<_len;i++){_arr[_arr.length]=parseFloat(Core.Dom.getStyle(oNode,aProperty[i]))}return _arr}function formatProperty(oProperty){return getType(oProperty)!="array"?[oProperty]:oProperty}function formatValue(oEndingValue,aProperty){try{var _type=getType(oEndingValue);var _valuearray=[],_suffixarray=[],i,_len,_suffix;if(_type!="array"){_suffix=getSuffix(oEndingValue);_suffix[1]=aProperty=="opacity"?"":_suffix[1];_valuearray=[_suffix[0]];_suffixarray=[_suffix[1]]}else{_len=oEndingValue.length;for(i=0;i<_len;i++){_suffix=getSuffix(oEndingValue[i]);_suffix[1]=aProperty[i]=="opacity"?"":_suffix[1];_valuearray[_valuearray.length]=_suffix[0];_suffixarray[_suffixarray.length]=_suffix[1]}}return[_valuearray,_suffixarray]}finally{_type=_valuearray=_suffixarray=i=_len=_suffix=null}}function getSuffix(sValue){try{var charCase=/(-?\d.?\d*)([a-z%]*)/i.exec(sValue);return[charCase[1],charCase[2]?charCase[2]:"px"]}finally{charCase=null}}var runList={};var saveList={};function getInstance(oNode){try{var uID=getUniqueID(oNode);var runFunc;if(runList[uID]!=true){runFunc=new ancestor;saveList[uID]={node:oNode,func:runFunc};runList[uID]=true;return runFunc}else{return saveList[uID].func}}finally{uID=runFunc=null}}function ancestor(){this._timer=null}ancestor.prototype.start=function(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){this.reset();oFunc=oFunc||{};if(oFunc.before){this._func.before=oFunc.before}if(oFunc.end){this._func.end=oFunc.end}if(oFunc.tween){this._func.tween=oFunc.tween}var _propertyArr=formatProperty(oProperty);var _startValueArr=getStartValue(oNode,_propertyArr);var _endValueArr=formatValue(oEndingValue,_propertyArr);this._node=oNode;this._property=_propertyArr;this._endingvalue=_endValueArr[0];this._suffixvalue=_endValueArr[1];this._startvalue=_startValueArr;this._end=false;this._fps=0;if(nSeconds!=null){this._seconds=nSeconds}if(transitions[sAnimation]!=null){this._animation=transitions[sAnimation]}this._starttime=(new Date).getTime();this._func.before();this._timer=setInterval(Core.Function.bind3(this.play,this),10)};ancestor.prototype.play=function(){var nTime=((new Date).getTime()-this._starttime)/1e3;var i,ani,_len=this._property.length;if(nTime>this._seconds){nTime=this._seconds}for(i=0;i<_len;i++){ani=this._animation(nTime,this._startvalue[i],this._endingvalue[i]-this._startvalue[i],this._seconds);Core.Dom.setStyle(this._node,this._property[i],ani+this._suffixvalue[i])}this._fps++;this._func.tween();if(nTime==this._seconds){this.stop()}};ancestor.prototype.stop=function(){clearInterval(this._timer);this._end=true;this._func.end()};ancestor.prototype.reset=function(){clearInterval(this._timer);this._end=false;this._node=null;this._property=[];this._startvalue=[];this._endingvalue=[];this._suffixvalue=[];this._fps=0;this._seconds=.5;this._animation=transitions.simple;this._func={end:function(){},tween:function(){},before:function(){}}};function tween(oNode,oProperty,oEndingValue,nSeconds,sAnimation,oFunc){var instance=getInstance(oNode);instance.start.apply(instance,arguments)}tween.stop=function(oNode){getInstance(oNode).stop()};tween.isTween=function(oNode){return!getInstance(oNode)._end};Ui.tween=tween}();var DialogDisplaySet={alpha1:{show:function(dom,offsetY,callBack){var v=0,deltaY=0,startY=parseInt(dom.style.top)-offsetY;dom.style.top=startY;Core.Dom.setStyle(dom,"opacity",v);dom.style.display="";var itvId=window.setInterval(function(){if(v<=1){Core.Dom.setStyle(dom,"opacity",v)}if(deltaY<=startY+offsetY){dom.style.top=startY+deltaY+"px"}deltaY+=1.5;v+=.05;if(v>.9&&parseInt(dom.style.top)>=startY+offsetY){window.clearInterval(itvId);if(callBack){callBack()}}},10)},hidden:function(dom,offsetY,callBack){var v=1;var startY=parseInt(dom.style.top);var endY=startY-offsetY;var currentY=startY;var itvId=window.setInterval(function(){if(v>=0){Core.Dom.setStyle(dom,"opacity",v)}if(currentY>=endY){dom.style.top=currentY+"px"}currentY-=1.5;v-=.05;if(v<=0&&currentY<endY){window.clearInterval(itvId);if(callBack){callBack()}}},10)}},alpha:{show:function(dom,offsetY,callBack){Core.Dom.setStyle(dom,"opacity",.3);dom.style.display="";dom.style.top=parseInt(dom.style.top)-offsetY+"px";var y1=parseInt(dom.style.top)+offsetY;Ui.tween(dom,["top","opacity"],[y1,.9],.4,"simple",{end:callBack})},hidden:function(dom,offsetY,callBack){var y1=parseInt(dom.style.top)-offsetY;Ui.tween(dom,["top","opacity"],[y1,0],.2,"simple",{end:callBack})}},fallDown:{show:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"bounceEaseOut",{end:callBack})},hidden:function(dom,y0,y1,callBack){dom.style.display="";dom.style.top=y0+"px";Ui.tween(dom,"top",y1,.6,"strongEaseIn",{end:callBack})}}};Core.Events.fixEvent=function(e){if(typeof e=="undefined")e=window.event;if(!e.target){e.target=e.srcElement;e.pageX=e.x;e.pageY=e.y}if(typeof e.layerX=="undefined")e.layerX=e.offsetX;if(typeof e.layerY=="undefined")e.layerY=e.offsetY;return e};var Drag3=function(beDragObj,movedObjs,dragMode){var _this=this;this.beDragObj=beDragObj;this.movedObjs=movedObjs||this.beDragObj;this.dragMode=dragMode||"normal";this.canDrag=true;this.isLock=false;this.lockArea={left:0,right:0,top:0,bottom:0};this.dragSet={normal:function(){_this.normalDrag()},border:function(){_this.borderDrag()},opacity:function(){_this.opacityDrag()}};this.dragObjsFunc=function(){_this.onDrag();_this.dragObjs()};!function initialize(){_this.beDragObj.style.MozUserSelect="none";Core.Events.addEvent(_this.beDragObj,function(){return false},"selectstart");Core.Events.addEvent(_this.beDragObj,function(){return false},"drag");for(var i=0;i<_this.movedObjs.length;i++){if(_this.movedObjs[i]!=_this.beDragObj){_this.movedObjs[i].style.position="absolute";if(!_this.movedObjs[i].style.left){_this.movedObjs[i].style.left=_this.movedObjs[i].offsetLeft+"px"}if(!_this.movedObjs[i].style.top){_this.movedObjs[i].style.top=_this.movedObjs[i].offsetTop+"px"}}}Core.Events.addEvent(_this.beDragObj,_this.dragSet[_this.dragMode],"mousedown");if($IE){Core.Events.addEvent(_this.beDragObj,function(){Core.Events.removeEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove");_this.beDragObj.releaseCapture();_this.onDragEnd()},"mouseup")}else{Core.Events.addEvent(document,function(){Core.Events.removeEvent(document,_this.dragObjsFunc,"mousemove");_this.onDragEnd()},"mouseup")}}()};Drag3.prototype={capture:function(){this.canDrag=true},release:function(){this.canDrag=false},onDragStart:function(){},onDrag:function(){},onDragEnd:function(){},dragObjs:function(){e=Core.Events.getEvent();for(var i=0;i<this.movedObjs.length;i++){if(this.isLock){if(e.clientX-this.movedObjs[i].deltaX<this.lockArea.left){this.movedObjs[i].style.left=this.lockArea.left+"px"}else{if(e.clientX-this.movedObjs[i].deltaX>this.lockArea.right-this.movedObjs[i].offsetWidth){this.movedObjs[i].style.left=this.lockArea.right-this.movedObjs[i].offsetWidth+"px"}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px"}}if(e.clientY-this.movedObjs[i].deltaY<this.lockArea.top){this.movedObjs[i].style.top=this.lockArea.top+"px"}else{if(e.clientY-this.movedObjs[i].deltaY>this.lockArea.bottom-this.movedObjs[i].offsetHeight){this.movedObjs[i].style.top=this.lockArea.bottom-this.movedObjs[i].offsetHeight+"px"}else{this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}}else{this.movedObjs[i].style.left=e.clientX-this.movedObjs[i].deltaX+"px";this.movedObjs[i].style.top=e.clientY-this.movedObjs[i].deltaY+"px"}}},normalDrag:function(){var _this=this;e=Core.Events.getEvent();for(var i=0;i<_this.movedObjs.length;i++){_this.movedObjs[i].deltaX=e.clientX-parseInt(_this.movedObjs[i].style.left);_this.movedObjs[i].deltaY=e.clientY-parseInt(_this.movedObjs[i].style.top)}if(_this.canDrag){if($IE){_this.beDragObj.setCapture();Core.Events.addEvent(_this.beDragObj,_this.dragObjsFunc,"mousemove")}else{Core.Events.addEvent(document,_this.dragObjsFunc,"mousemove")}}_this.onDragStart()},borderDrag:function(obj,borderWidth){},opacityDrag:function(obj,opacityValue){}};Ui.Drag3=Drag3;var Dialog=function(template){var _this=this;_this.entity=null;_this.ifm=null;var Property={id:"",x:0,y:0,width:0,height:0,isFixed:false,layer:new Layer(template),template:template,canDrag:false,dragEntity:null,name:"",uniqueID:"",isShow:false,nodes:{},focusNode:null,displayMode:"normal",_modeDisplayRuning:false,enabled:true};
this.getProperty=function(){return Property};!function initialize(){var p=_this.getProperty();var i;p.uniqueID=p.layer.getProperty().uniqueID;p.id=p.uniqueID+"_dialog";p.nodes=_this.getNodes();_this.entity=p.layer.entity;_this.ifm=p.layer.ifm;p.width=parseInt(_this.entity.style.width);if(p.nodes.titleBar){p.dragEntity=new Ui.Drag3(p.nodes.titleBar,_this.ifm?[_this.ifm,_this.entity]:[_this.entity]);p.nodes.titleBar.style.cursor="move";Core.Events.addEvent(p.nodes.titleBar,function(){return false},"selectstart");p.dragEntity.onDrag=function(){_this.onDrag()}}Core.Events.addEvent(window,function(){if(p.isShow&&p.isFixed){var win=Core.System.winSize();var _x=win.width/2-_this.getWidth()/2;var _y=win.height/2-_this.getHeight()/2;_x=_x<0?0:_x;_y=_y<0?0:_y;_this.setPosition({x:_x,y:_y})}},"resize")}()};Dialog.prototype={setPosition:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);this.getProperty().layer.setPosition(opts)},setSize:function(opts){var p=this.getProperty();Core.System.parseParam(p,opts);p.layer.setSize(opts)},setFixed:function(isFixed){var p=this.getProperty();p.isFixed=isFixed;this.getProperty().layer.setFixed(p.isFixed)},setContent:function(sHTML){var p=this.getProperty();this.getProperty().layer.setContent(sHTML)},setTemplate:function(template){var p=this.getProperty();p.template=template;p.layer.setTemplate(p.template)},setDrag:function(canDrag){var p=this.getProperty();p.canDrag=canDrag;if(p.canDrag){p.dragEntity.capture()}else{p.dragEntity.release()}},getWidth:function(){return this.getProperty().layer.getWidth()},getHeight:function(){return this.getProperty().layer.getHeight()},getX:function(){return this.getProperty().layer.getX()},getY:function(){return this.getProperty().layer.getY()},show:function(mode){var p=this.getProperty();var _this=this;p.isShow=true;if(this.ifm){this.ifm.style.display=""}this.onShow();if(p.displayMode=="normal"||mode=="normal"){this.entity.style.display=""}else{p._modeDisplayRuning=true;p.enabled=false;this._showWithMode(function(){p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplaied){_this.onDisplaied()}})}},close:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.destroy();this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();p._modeDisplayRuning=false;p.enabled=true;_this.destroy();_this.onClose();if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},hidden:function(mode){var _this=this;var p=this.getProperty();if(p.displayMode=="normal"||mode=="normal"){p.isShow=false;p.layer.hidden();this.onHidden();if(_this.onDisplayFinished){_this.onDisplayFinished()}}else if(!p._modeDisplayRuning){p._modeDisplayRuning=true;p.enabled=false;this._hiddenWithMode(function(){p.isShow=false;p.layer.hidden();_this.onHidden();p._modeDisplayRuning=false;p.enabled=true;if(_this.onDisplayFinished){_this.onDisplayFinished()}})}},_showWithMode:function(callBack){var p=this.getProperty();var win=Core.System.winSize();var _this=this;switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].show(this.entity,20,callBack);break}},_hiddenWithMode:function(callBack){var p=this.getProperty();var _this=this;var win=Core.System.winSize();switch(p.displayMode){case"alpha":DialogDisplaySet["alpha"].hidden(this.entity,20,callBack);break}},destroy:function(){try{if(this.getProperty().nodes.iframe){this.getProperty().nodes.iframe.src=""}}catch(ex){}this.entity&&this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},onShow:function(){},onClose:function(){},onHidden:function(){},onDrag:function(){},onDisplaied:function(){},onDisplayFinished:function(){},setAreaLocked:function(state){var p=this.getProperty();p.dragEntity.isLock=state;var _this=this;if(state){_this._updateLockArea();Core.Events.addEvent(window,function(){_this._updateLockArea()},"resize")}},_updateLockArea:function(){var p=this.getProperty();var win=Core.System.winSize();if(p.isFixed){if($IE6){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height};Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"scroll");Core.Events.addEvent(window,function(){p.dragEntity.lockArea={left:document.documentElement.scrollLeft,right:document.documentElement.scrollLeft+win.width,top:document.documentElement.scrollTop,bottom:document.documentElement.scrollTop+win.height}},"resize")}else{p.dragEntity.lockArea={left:0,right:win.width,top:0,bottom:win.height}}}else{p.dragEntity.lockArea={left:0,right:document.documentElement.scrollWidth,top:0,bottom:document.documentElement.scrollHeight}}},updateFixed:function(){this.getProperty().layer.updateFixed()},getNodes:function(mode){return this.getProperty().layer.getNodes(mode)},setFocus:function(){var p=this.getProperty();if(p.focusNode&&p.focusNode.style.display!="none"){try{p.focusNode.focus()}catch(ex){}}else if(this.entity.style.display!="none"){this.entity.focus()}},getUniqueID:function(){return this.getProperty().layer.getUniqueID()}};Core.String.byteLength=function(str){if(typeof str=="undefined"){return 0}var aMatch=str.match(/[^\x00-\x80]/g);return str.length+(!aMatch?0:aMatch.length)};Core.Array.ArrayWithout=function(){if(arguments.length<2){return arguments.length==1?arguments[0]:null}var results=[];var aa=arguments[0];if(aa===null||aa.constructor!=Array){return null}if(arguments[1].constructor==Array){var args=[];args[0]=aa;Core.Array.foreach(arguments[1],function(v,i){args[i+1]=v})}else{args=arguments}for(var i=0;i<aa.length;i++){var isWithout=true;for(var j=1;j<args.length;j++){if(aa[i]==args[j]){isWithout=false;break}}if(isWithout){results.push(aa[i])}}return results};Lib.register("util.LS",function(lib){var ls;var Storage=function(wnd,undefined){var localStorageName="data-sina-blog-storage",localStorageKeys="data-sina-blog-storage-keys",doc=wnd.document,storageContainer=doc.createElement("input"),length,keys,removeArray=Core.Array.ArrayWithout,mark=function(key,isRemove,temp,reg){storageContainer.load(localStorageName);temp=storageContainer.getAttribute(localStorageKeys)||"";reg=RegExp("\\b"+key+"\\b,?","i");var hasKey=reg.test(temp)?1:0;temp=isRemove?temp.replace(reg,""):hasKey?temp:temp===""?key:temp.split(",").concat(key).join(",");storageContainer.setAttribute(localStorageKeys,temp);storageContainer.save(localStorageName)};var box=document.body||document.getElementsByTagName("head")[0]||document.documentElement;storageContainer.id="____storage_container_box";storageContainer.type="hidden";box.appendChild(storageContainer);storageContainer.addBehavior("#default#userData");storageContainer.load(localStorageName);var keyStr=storageContainer.getAttribute(localStorageKeys);keys=keyStr?keyStr.split(","):[];length=keys.length;return{key:function(index){if(isNaN(index)){index=0}return keys[parseInt(index,10)]},getItem:function(key){storageContainer.load(localStorageName);return storageContainer.getAttribute(key)},setItem:function(key,value){storageContainer.setAttribute(key,value);storageContainer.save(localStorageName);this.length++;keys.push(key);mark(key)},removeItem:function(key){storageContainer.removeAttribute(key);storageContainer.save(localStorageName);this.length--;removeArray(keys,key);mark(key,1)},clear:function(){storageContainer.load(localStorageName);var attrs=storageContainer.getAttribute(localStorageKeys).split(","),len=attrs.length;if(attrs[0]==="")return;for(var i=0;i<len;i++){storageContainer.removeAttribute(attrs[i]);storageContainer.save(localStorageName)}storageContainer.setAttribute(localStorageKeys,"");storageContainer.save(localStorageName);this.length=0},length:length}};var getStorage=function(wnd){if(wnd.localStorage){return wnd.localStorage}else if(wnd.sessionStorage){return wnd.sessionStorage}else if(wnd.globalStorage){return wnd.globalStorage}else{return Storage(wnd)}};var getLS=function(){if(!ls){ls=getStorage(window)}return ls};return{key:function(index){return getLS().key(index)},getItem:function(key){return getLS().getItem(key)},setItem:function(key,value){try{getLS().setItem(key,value);return true}catch(e){return false}},removeItem:function(key){return getLS().removeItem(key)},clear:function(){return getLS().clear()}}});$SYSMSG.extend({A00001:"系统繁忙，请稍候再试。",A00007:"未登录。",A00112:"博客名称超长。",A00113:"您已开通博客，请点击<a href='http://control.blog.sina.com.cn/blogprofile/index.php'>个人中心</a>进入。",A00116:"不能包含 sina 等有特殊含义的字符。",A11003:"此账户已完成博客快速设置，点击确定，直接进入博客。",A44001:"博客个性地址不能为空。",A44002:"地址格式不对。",A44003:"抱歉，此地址已被占用。",A44005:"抱歉，请按照正确格式填写博客地址。"});!function(){if(scope.blogOpener){scope.addBlogOpenerEvent=function(){};return}var openURL="http://control.blog.sina.com.cn/riaapi/reg/open_blog.php";var openBlog=function(){this._hasInit=false};openBlog.prototype={getCon:function(){var checkcodeHTML=['<div class="boxA" style="margin: 20px 0; overflow: hidden; zoom: 1;">','<div id="checkCodeBox_open_msg" class="check-code-box clearfix" > </div>',"</div>"].join("");return['<div class="CP_layercon8">'+'<div class="nowOpenBlog">'+"<strong>您的博客尚未开通,仅一步操作就能开通您的个人博客</strong>"+'<div class="boxA">'+"<label>博客名称：</label>"+'<input id="blogNameInput_t" type="text" class="ipt" />'+'<img style="display:none" id="blogNameIcon_t" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" class="SG_icon SG_icon49 tips">'+'<p id="blogNameError_t" class="tip">名称不能为空</p>'+"</div>"+'<div  class="boxA"> '+"<p>隐私设置："+'<input type="radio" name="isPrivate_t" checked id="openAll1_t" class="rd" /><label for="openAll1_t">对所有人开放</label>'+'<input type="radio" name="isPrivate_t" id="openMe1_t" class="rd" /><label for="openMe1_t">仅对自己开放，私密博客</label>'+"</p>"+"</div>"+checkcodeHTML+'<div id="ErrTips_t" class="ErrTips">系统繁忙，请稍后再试</div>'+'<div class="boxB">'+'<p><a id="openBlogOkBtn_t" class="btn" href="javascript:void(0)">完成开通</a><a id="openBlogCancel" href="javascript:void(0)">取消</a></p>'+"</div>"+"</div>"+"</div>"].join("")},_initDialog:function(){var _this=this;Lib.checkAuthor(function(){_this.key=getKeyName();_this._dialog=winDialog.createCustomsDialog({content:_this.getCon()},"openblog");var checkCodeBox_open_msg={id:"#checkCodeBox_open_msg"};checkManager_open_msg=new Lib.checkManager(checkCodeBox_open_msg);_this.bindEvent();blogNameEvent($E("blogNameInput_t"),$E("blogNameError_t"),[],$E("blogNameIcon_t"))},"openblog"+(new Date).getTime())},showDialog:function(callBack,needToOpen,forceOpen){needToOpen=needToOpen||false;if(!this._hasInit){this._initDialog();this._hasInit=true}var me=this;scope.whenOpenBlogCallback=callBack;if(!scope.hasOpenBlog){trace("这是一位后登陆的用户");var t=0;var timmer=setInterval(function(){trace("呀，怎么还没有出结果啊--"+t);if(scope.hasOpenBlog){clearInterval(timmer);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{trace("他们没有开通博客");me._showDialog(needToOpen)}}t++;if(t==10){Lib.checkAuthor(function(){trace("等不及了，自己发吧。。。");clearInterval(timmer);new Interface("http://control.blog.sina.com.cn/riaapi/profile/unread.php","jsload").request({GET:{uid:$UID,product:"blog"},onSuccess:function(data){scope.hasOpenBlog=data.isbloguser==1?"open":"no";trace("~~~~~~~~~~~~~~~~~~~"+scope.hasOpenBlog);if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");me._showDialog(needToOpen)}}})},"openblogshowDialog"+(new Date).getTime())}},10)}else{trace("这是已登陆的用户");if(scope.hasOpenBlog=="open"){trace("并且他开通的博客");if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback()}}else{if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}trace("他们没有开通博客");this._showDialog(needToOpen)}}if(forceOpen){$E("openBlogCancel").style.display="none";this._dialog.getNodes().btnClose.style.display="none"}},_showDialog:function(needToOpen){$E("blogNameInput_t").value=getShotName();hiddenError($E("blogNameError_t"),$E("blogNameIcon_t"));$E("ErrTips_t").style.visibility="hidden";$E("blogNameIcon_t").style.display="none";this._dialog.show();this._dialog.setAreaLocked(true);this._dialog.setMiddle()},bindEvent:function(){var me=this;Core.Events.addEvent($E("openBlogCancel"),function(){me.closeDialog();return false});Core.Events.addEvent($E("openBlogOkBtn_t"),function(){if(!checkManager_open_msg.validate()){if(!$E("comment_check_img")){winDialog.alert("请拖动滑块儿开始验证")}else{winDialog("验证码不能为空")}return}whenOpenBlog({nameErrorEle:$E("blogNameError_t"),nameOkIcon:$E("blogNameIcon_t"),openName:$E("blogNameInput_t").value||getShotName(),isprivate:$E("openAll1_t").checked?0:1,errorEle:$E("ErrTips_t"),from:"floatingLayer",okCallback:function(res,blogInfo){if(scope.whenOpenBlogCallback){scope.whenOpenBlogCallback(res,blogInfo)}if($E("openedBlogTray")&&$E("openedBlogTray").style.display=="none"){$E("outOfOpenBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="none";$E("openedBlogTray").style.display=""}if($E("noOpendBlogSearchTip")&&$E("noOpendBlogSearchTip").style.display=="block"){$E("noOpendBlogSearchTip").style.display="none";$E("opendBlogSearchTip").style.display="block"}scope.hasOpenBlog="open";me.closeDialog();scope.whenOpenBlogCallback=function(){}}});return false})},closeDialog:function(){var me=this;this._dialog.hidden()}};function getShotName(){var val=$nick;var nameLen=Core.String.byteLength(val);while(nameLen>18){val=val.substring(0,val.length-1);nameLen=Core.String.byteLength(val)}return val+"的博客"}scope.openBlogGetShotName=getShotName;function blogNameEvent(inputEle,errEle,optArr,icon){inputEle.onfocus=function(){inputEle.className="ipt focus";styleThey(optArr,"");icon.style.display=""};inputEle.onblur=function(){inputEle.className="ipt";checkBlogName(inputEle,errEle,icon);styleThey(optArr,"none")};inputEle.onkeyup=function(){checkBlogName(inputEle,errEle,icon)}}scope.openBlogNameEvent=blogNameEvent;function whenOpenBlog(opt){if(whenOpenBlog.requestComplete===false){return}if(opt.nameErrorEle.innerHTML){changeTextBgC(opt.nameErrorEle.parentNode);setTimeout(function(){changeTextBgC(opt.nameErrorEle.parentNode)},442);return}var targetButtonId=opt.from==="floatingLayer"?"openBlogOkBtn_t":"openBlogOkBtn";$E(targetButtonId).className="loading";var blogInfo={loginName:getKeyName(),blogName:opt.openName};var my_data={uid:$UID,loginname:blogInfo.loginName,blogname:blogInfo.blogName,version:7,src:"layer",isprivate:opt.isprivate};var data_my=checkManager_open_msg.getPostData(my_data);new Interface(openURL,"jsload").request({GET:data_my,onSuccess:function(res){whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn";opt.okCallback(res,blogInfo);blogInfo=null},onError:function(res){var nameErr=$E("blogNameError"),nameIcon=$E("blogNameIcon"),layerNameErr=$E("blogNameError_t"),layerNameIcon=$E("blogNameIcon_t");switch(res.code){case"A11008":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"A11010":if(nameErr&&nameIcon){showError(nameErr,"输入内容有误，请修改",nameIcon)};if(layerNameErr&&layerNameIcon){showError(layerNameErr,"输入内容有误，请修改",layerNameIcon)};break;case"B36002":winDialog.alert("验证码错误，请修改。");break;default:showError(opt.errorEle,"系统繁忙，请稍后再试。");break}whenOpenBlog.requestComplete=true;$E(targetButtonId).className="btn"}})}scope.openBlogWhenOpenBlog=whenOpenBlog;function changeTextBgC(ele){for(var i=1;i<=55;i++){!function(val){setTimeout(function(){ele.style.backgroundColor="rgb(255, "+ +(200+val)+", "+(200+val)+")"},val*8)}(i)}}function getKeyName(){var SUBPCookie=Utils.Cookie.getCookie("SUBP");var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(SUBPCookie);var key=arrSubp.ln;return key}function styleThey(eleArr,str){for(var i=0;eleArr[i];i++){eleArr[i].style.display=str}}function checkBlogName(inputEle,errEle,icon){var val=inputEle.value;if(/^(?:\s|[　])+|(?:\s|[　])+$/.test(val)){inputEle.value=Core.String.trim(val);val=inputEle.value}if(val){var nameLen=Core.String.byteLength(val);if(nameLen>24){showError(errEle,"博客名称超长",icon)}else{hiddenError(errEle,icon)}}else{showError(errEle,"博客名称不能为空",icon)}}function showError(ele,str,icon){ele.innerHTML=str;ele.style.display="block";if(ele.id.indexOf("ErrTips")>=0){ele.style.visibility="visible"}if(icon){icon.className="SG_icon SG_icon48 tips"}}function hiddenError(ele,icon){ele.innerHTML="";ele.style.display="none";if(icon){icon.className="SG_icon SG_icon49 tips"}}scope.blogOpener=new openBlog;scope.addBlogOpenerEvent=function(el){Core.Events.addEvent(el,function(e){scope.blogOpener.showDialog(function(res,blogInfo){Lib.LocalDB.clearCache(1,"uid_"+$UID+"unread");Lib.util.LS.removeItem("uid"+$UID);if(scope.$pageid=="fakeIndex"){window.location.href="http://i.blog.sina.com.cn/blogprofile/index.php?atten=1";return}if($E("openedBlogTray")){$E("openedBlogTray").style.display="";$E("noOpenedBlogTray").style.display="none";$E("outOfOpenBlogTray").style.display="none";if(blogInfo){$E("loginBarAppMenuLabel").innerHTML=blogInfo.loginNick}}else{var wnd=window;wnd.$tray&&wnd.$tray.renderLogin()}var successOpenFun=function(){if(scope.___importV){scope.___importV();scope.___openBlogFlag=1}};var alertConf={subText:!scope.___importV?['<div class="CP_w_cnt SG_txtb">欢迎您在新浪博客安家！除了写博客，看博客外，您还可以进入个人中心完善您的个人资料，更有很多有趣的应用等着您哦。</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php" onclick="winDialog.getDialog(\'unregister\').hidden();" target="_blank">到博客个人中心&gt;&gt;</a></li>',"</ul>"].join(""):"",icon:"03",funcOk:successOpenFun,funcClose:successOpenFun,width:300};winDialog.alert("开通博客成功",alertConf,"unregister");var commentNickEl=$E("commentNick");if(commentNickEl){var child=commentNickEl.firstChild;while(child){commentNickEl.removeChild(child);child=commentNickEl.firstChild}commentNickEl.innerHTML=blogInfo.loginNick+":"}},true)},"click")}}();!function(){var addAttention=function(nVisitId,nUserId,addedCallBack){var i_attention=new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_add.php","ijax");Lib.checkAuthor(function(){i_attention.request({POST:{uid:nVisitId||$UID,aid:nUserId||scope.$uid},onSuccess:function(){},onError:function(oData){var msg="";switch(oData.code){case"A11007":msg=$SYSMSG["A11007"].replace("#{linkNewBlog}","https://login.sina.com.cn/hd/reg_sec.php?entry=blog");winDialog.alert(msg,{funcOk:function(){window.open("https://login.sina.com.cn/hd/reg_sec.php?entry=blog","_blank","")}});break;case"A33003":msg=$SYSMSG.A33003.replace("#{UID}",$UID);winDialog.alert(msg);break;case"A33004":var alertConf={subText:['<div class="CP_w_cnt SG_txtb">以后对方的动态（发博文，图片，投票等），都可以在<span style="color:red">个人中心</span>查看啦！</div>','<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php?type=3&from=attention" onclick="winDialog.getDialog(\'attention\').hidden();" target="_blank">到个人中心查看关注动态&gt;&gt;</a></li>',"</ul>"].join(""),icon:"03",width:300};try{var attentionButton=$E("module_901_attention");attentionButton.className="SG_aBtn SG_aBtn_dis";attentionButton.innerHTML="<cite onclick=\"Lib.Component.isAttentioned('"+$UID+"', '"+scope.$uid+"');\">已关注</cite>"}catch(e){}msg=$SYSMSG["A33004"];alertConf["subText"]=alertConf["subText"].replace(/#{UID}/g,$UID);winDialog.alert(msg,alertConf,"attention");break;default:showError(oData.code)}addedCallBack(oData.code)},onFail:function(){showError($SYSMSG.A00001)}})},"addAttention"+(new Date).getTime())};Lib.Component.Attention=function(nVisitId,nUserId,addedCallBack){var me=this;nVisitId=nVisitId;nUserId=nUserId;addedCallBack=addedCallBack||function(){};Lib.checkAuthor(function(){if(!$isLogin){var Login=new Lib.Login.Ui;Login.login(function(){scope.blogOpener.showDialog(function(){Core.Function.bind3(addAttention,null,[nVisitId,nUserId,addedCallBack])()})},false,"referer:"+location.hostname+location.pathname+",func:0004")}else{scope.blogOpener.showDialog(function(){addAttention(nVisitId,nUserId,addedCallBack)})}},"attention"+(new Date).getTime())};Lib.Component.deleteAttention=function(sUid,sAid){winDialog.getDialog("attention").close();winDialog.confirm("是否要取消关注？",{funcOk:function(){new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_del.php","jsload").request({GET:{uid:$UID,aid:scope.$uid},onSuccess:function(){var attentionButton=$E("module_901_attention");attentionButton.className="SG_aBtn";attentionButton.innerHTML="<cite onclick=\"Lib.Component.Attention('"+$UID+"', '"+scope.$uid+"');\">加关注</cite>"},onError:function(){winDialog.alert("取消失败！请重试。")},onFail:function(){winDialog.alert("取消失败！请重试。")}})},funcCancel:function(){Lib.Component.isAttentioned()},textOk:"是",textCancel:"否"})};Lib.Component.isAttentioned=function(){winDialog.alert("已关注此人！",{subText:['<ul class="CP_w_part CP_w_aLine">','<li><a href="http://control.blog.sina.com.cn/blogprofile/index.php?type=3&from=attention2" onclick="winDialog.getDialog(\'attention\').close();" target="_blank">到个人中心查看关注动态&gt;&gt;</a></li>',"</ul>"].join(""),icon:"03"},"attention")}}();$SetPV=function(nPv){nPv=window.parseInt(nPv);Lib.checkAuthor(function(){if($E("comp_901_pv")){if($isAdmin){$E("comp_901_pv").innerHTML='<strong><a title="您的访问统计" href="http://i.blog.sina.com.cn/blogprofile/profilevisitanaly.php" target="_blank">'+Core.String.formatNumber(nPv)+"</a></strong>"}else{$E("comp_901_pv").innerHTML="<strong>"+Core.String.formatNumber(nPv)+"</strong>"}}},"SetPV"+(new Date).getTime());var grade=0;var score=[0,50,100,150,200,300,500,800,1500,3e3,5e3,1e4,15e3,25e3,4e4,7e4,1e5,15e4,2e5,5e5,1e6,2e6,5e6,1e7,2e7,5e7,1e8,15e7,2e8,25e7,3e8,35e7,4e8,45e7,5e8,55e7];if(nPv>=5e7){grade=Math.floor(nPv/5e7)+24}else{grade=-1;score=score.join(",").replace(/(\d+)/g,function(a,b){if(window.parseInt(b)<=nPv){grade++}})}if(scope.$pageid==="article"||scope.$pageid==="articleM"||scope.$pageid==="articletj"){scope.$rank=grade}grade=grade.toString().replace(/(\d)/g,function($0,$1){return'<img src="http://simg.sinajs.cn/blog7style/images/common/number/'+$1+'.gif"/>'});if($E("comp_901_grade")){$E("comp_901_grade").innerHTML=grade}};Sina.pkg("Utils.Form");Core.String.leftB=function(str,len){var s=str.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");str=str.slice(0,s.slice(0,len).replace(/\*\*/g," ").replace(/\*/g,"").length);if(Core.String.byteLength(str)>len)str=str.slice(0,str.length-1);return str};Utils.Form.limitMaxLen=function(oTextNode,nMaxLen){var nValue;var keyup=function(){nValue=oTextNode.value;var strLen=Core.String.byteLength(nValue);if(strLen>nMaxLen){oTextNode.value=Core.String.leftB(nValue,nMaxLen)}};Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"keyup");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"blur");Core.Events.addEvent(oTextNode,Core.Function.bind3(keyup,oTextNode),"focus")};Lib.invite_tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">提示标题</strong>','<cite><a id="#{btnClose}" href="javascript:void(0)" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">',"</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");$SYSMSG.extend({A00001:"系统繁忙，请稍候再试。",A00007:"请先登录。",A20101:"内容超长。",A20102:"请输入正确的登录名或密码。",A20103:"请输入正确的验证码。",A20104:"请把对方在黑名单中解除，再加为好友。",A20105:"你的好友数量达到上限，不能添加新好友。",A20106:"博主已设置为拒绝接受好友邀请，请不要打扰哦。",A20107:"不能加自己为好友。",A20108:"你们已经是好友。",A20109:"不能包含sina等特殊含义字符。",A23002:"您已被对方加入黑名单。",A20121:"参数格式不正确。",A20000:"参数格式不正确。",A20001:"内容超长。",A20002:"请输入正确的登录名或密码。",A20003:"请输入正确的验证码。",A20004:"不能包含sina等特殊含义字符。",A20005:"纸条内容不能为空。",A20006:"不能自己给自己发纸条",A20007:"请把对方在黑名单中解除，再发送纸条。",A20020:"给#{nick}的纸条发送失败！",A20008:"对不起，您短时间发表的纸条过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注!",A20999:"对不起，您短时间发送的好友请求过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注!",A20009:"博主已设置为拒绝接收所有纸条，请不要打扰哦。",A20013:"您已经发送多条相似内容了哦，请先休息一下吧~",A20014:"已经有很多博主发过相似评论了，换个内容会更精彩~",A20015:"发生错误，请稍作休息~",A30006:"该博主只接收来自好友的纸条，您还不是Ta的好友哦。",A10006:"对不起，您已被博主列入黑名单，无法发送小纸条。"});Lib.register("blogv.getVHTML",function(){return function(wtype,isLinked){var title,className;if(isNaN(wtype)){wtype=-1}else{wtype=parseInt(wtype,10)}if(0==wtype){title="新浪个人认证";className=" SG_icon146"}else if(0<wtype&&8>wtype){title="新浪机构认证";className=" SG_icon147"}var str;if(!1!==isLinked){isLinked=!0}if(title){str='<img class="SG_icon '+className+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="'+title+'" alt="'+title+'" align="absmiddle" />'}else{str=""}if(str&&isLinked){str='<a target="_blank" href="http://blog.sina.com.cn/v/verify">'+str+"</a>"}return str}});var Lib=Lib||{};!function(proxy){var Builder=function(domJson,box){this.box=null;this.domList={};this.actList={};if(box){this.box=box}else{this.box=document.createElement("DIV")}if(domJson){this.makeTree(this.box,domJson)}};!function(_p){_p.init=function(){};_p.disp=function(){};_p.NODEMAP={AREA:"MAP",CAPTION:"TABLE",COL:"TABLE|COLGROUP",COLGROUP:"TABLE",LEGEND:"FIELDSET",OPTGROUP:"SELECT",OPTION:"SELECT",PARAM:"OBJECT",TBODY:"TABLE",TD:"TR",TFOOT:"TABLE",TH:"TABLE|TR",THEAD:"TABLE",TR:"TBODY|THEAD|TH|TFOOT"};_p.create=function(tagName,attributes){var dom=null;if(tagName=="TEXT"){dom=document.createTextNode(attributes)}else{dom=document.createElement(tagName)}if(typeof attributes=="object"){for(var k in attributes){switch(k){case"class":dom.className=attributes[k];break;case"id":this.domList[attributes[k]]=dom;break;case"action":if(this.actList[attributes[k]]){this.actList[attributes[k]]=[dom].concat(this.actList[attributes[k]])}else{this.actList[attributes[k]]=dom}break;case"style":dom.style.cssText=attributes[k];break;case"innerHTML":dom.innerHTML=attributes[k];break;case"nodeValue":dom.nodeValue=attributes[k];break;default:dom.setAttribute(k,attributes[k])}}}return dom};_p.check=function(parent,childObj){var tnames=this.NODEMAP[childObj.tagName];if(this.NODEMAP[childObj.tagName]){var pList=tnames.split("|");for(var i=0,len=pList.length;i<len;i++){if(parent.tagName==pList[i]){return true}}return false}return true};_p.append=function(parent,childObj){childObj.tagName=childObj.tagName.toLocaleUpperCase();if(!this.check(parent,childObj)){return false}var returnDom=this.create(childObj.tagName,childObj.attributes);parent.appendChild(returnDom);return returnDom};_p.makeTree=function(parent,objList){for(var i=0,len=objList.length;i<len;i++){var Leaves=this.append(parent,objList[i]);if(!Leaves){alert("tree wrong!!!");return false}if(objList[i].childList&&objList[i].childList.length){this.makeTree(Leaves,objList[i].childList)}}}}(Builder.prototype);proxy.Builder=Builder;proxy.domBuilder=new Builder}(Lib);var CommentV2={};CommentV2.Geetest=Core.Class.create();CommentV2.Geetest.prototype={geetestObj:null,node:"",options:{type:"float"},initialize:function(node,options){if(options){this.options=options}this.node=node||"";this.load()},reqGeetestAuth:function(){var _this=this;var url="http://control.blog.sina.com.cn/riaapi/StartCaptchaServlet.php";Utils.Io.JsLoad.request(url,{GET:{rand:Math.round(Math.random()*100)},returnType:"json",onComplete:function(res){if(res.code==="A00006"&&(res.data.success===1||res.data.success===0)){_this.loadGeetest(res.data)}else if(res.data.success===2){if(!window.scope){window.scope={}}window.scope.check_code_type="old"}}})},loadGeetest:function(config){var _this=this;_this.geetestObj=new window.Geetest({product:_this.options.type||"float",gt:config.gt,challenge:config.challenge,offline:!config.success,sandbox:true});_this.geetestObj.appendTo(_this.node)},load:function(){var _this=this;if(!window.Geetest){s=document.createElement("script");s.src="http://api.geetest.com/get.php?callback=gtcallback";document.body.appendChild(s);window.gtcallback=function(){_this.reqGeetestAuth()}}else{_this.reqGeetestAuth()}}};Core.Events.fireEvent=function(oElement,sEvent){var evt;oElement=$E(oElement);if(oElement.fireEvent){oElement.fireEvent("on"+sEvent)}else{if($MOBILE){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent(sEvent,true,true);oElement.dispatchEvent(evt)}};!function(window){if(window.Evter){return}function toJson(str){try{return new Function("return "+str)()}catch(e){return null}}var _handlers={},_needlock={},_busy={},_eid=1;window.Evter={add:function(ename,handler){if(typeof ename==="string"&&typeof handler==="function"){if(ename.charAt(0)==="-"){ename=ename.substr(1);_needlock[ename]=true}if(_handlers[ename]){traceError('Evter handler "'+ename+'" has been defined!');return}_handlers[ename]=handler}},click:function(elem,ename,handler){var curname=elem.getAttribute("e-name"),cdr=elem.getElementsByTagName("*"),i=cdr.length;while(i--){cdr[i].getAttribute("e-name")||cdr[i].setAttribute("e-name","b")}if(curname){if((" "+curname+" ").indexOf(" "+ename+" ")===-1){elem.setAttribute("e-name",curname+" "+ename)}}else{elem.setAttribute("e-name",ename)}if(handler){this.add(ename,handler)}},remove:function(ename){delete _handlers[ename];delete _needlock[ename]},fire:function(ename,eTarget,event,eSource){if(_needlock[ename]&&eTarget){eTarget.$EID||(eTarget.$EID=" "+_eid++);if(_busy[ename+eTarget.$EID]){return}_busy[ename+eTarget.$EID]=true}var handler=_handlers[ename];handler&&handler(eTarget,event,eSource)},data:function(elem,data){var edata=elem.getAttribute("e-data"),type=typeof data;if(type==="undefined"||data===null){return edata?toJson(edata):null}else if(type==="object"){var k,v;if(edata){edata=toJson(edata);if(typeof edata==="object"){for(k in data){edata[k]=data[k]}}else{edata=data}}else{edata=data}data=[];for(k in edata){v=edata[k];data.push(k+":"+(typeof v==="string"?"'"+v.replace(/'/g,"\\'")+"'":v))}data="{"+data.join(",")+"}"}else if(type==="string"){data="'"+data.replace(/'/g,"\\'")+"'"}elem.setAttribute("e-data",data)},free:function(eTarget,ename){eTarget&&delete _busy[ename+eTarget.$EID]}};Core.Events.addEvent(document.body,function(event){event=event||window.event;var eSource=event.target||event.srcElement,eTarget=eSource,ename=eTarget.getAttribute("e-name");if(ename==="b"){do{eTarget=eTarget.parentNode;ename=eTarget.getAttribute("e-name")}while(ename==="b")}if(ename){if(_needlock[ename]){eTarget.$EID||(eTarget.$EID=" "+_eid++);if(_busy[ename+eTarget.$EID]){return}_busy[ename+eTarget.$EID]=true}var handler=_handlers[ename];if(handler){handler(eTarget,event,eSource)}else{var enames=ename.split(" "),i=0,len=enames.length;for(;i<len;i++){ename=enames[i];if(_needlock[ename]){eTarget.$EID||(eTarget.$EID=" "+_eid++);if(_busy[ename+eTarget.$EID]){continue}_busy[ename+eTarget.$EID]=true}handler=_handlers[ename];handler&&handler(eTarget,event,eSource)}}}},"click")}(window);Lib.imgCheck=function(){this.imgSrc="http://interface.blog.sina.com.cn/riaapi/checkwd_image.php?";this.fresh_chk=false;this.events=["img_check_post"];this.init()};Lib.imgCheck.prototype={init:function(){this.render();this.bindEvent()},render:function(){var html=["<span>验证码：</span>",'<input type="text" style="width: 46px;" id="login_check" tabindex="4" onclick="return false;" />&nbsp;&nbsp;','<a class="SG_linka" id="check_show">请点击后输入验证码</a>','<img id="comment_check_img" align="absmiddle" style="display:none;" />&nbsp;&nbsp;','<a id="comment_get_vcode" href="#" onclick="return false;">收听验证码</a>'].join("");
$E("checkCodeBox").innerHTML=html},bindEvent:function(){var self=this;Core.Events.addEvent("check_show",function(){self.refresh()},"click");Core.Events.addEvent("comment_check_img",function(){self.fresh_chk=false;self.refresh()},"mousedown");Core.Events.addEvent("login_check",function(){self.refresh()},"focus");Core.Events.addEvent("commentArea",function(){self.refresh()},"focus");Core.Events.addEvent($E("login_check"),function(){Evter.fire("img_check_post")},"keydown")},refresh:function(){if(this.fresh_chk){return}$E("comment_check_img").src=this.imgSrc+(new Date).valueOf();$E("comment_check_img").style.display="inline";$E("check_show").style.display="none";this.fresh_chk=true},getValidate:function(){return Core.String.trim($E("login_check").value)}};Lib.AudioCheck={};var random="";if(window.$Maxthon||window.$360||window.$TT){random="?t="+(new Date).getTime()}Lib.AudioCheck.swfUrl=$_GLOBAL.flashBasicURL+"mp3.swf"+random;Lib.AudioCheck.soundUrl="http://interface.blog.sina.com.cn/riaapi/cksound/cksound.php";Lib.AudioCheck.render=function(target,soundUrl){$E(target).innerHTML='		<a style="margin-left:3px;" id="comment_get_vcode" href="javascript:;" onclick="Lib.AudioCheck.callAudioCheck();return false;">收听验证码</a>		<img id="play_img" name="play_img" src="http://image2.sina.com.cn/blog/tmpl/v3/images/blank.gif" align="absmiddle" style="margin-right:2px;" height="15">		<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0" width="0" height="0" id="mp3_player" align="middle">		<param name="allowScriptAccess" value="always" />		<param name="movie" value="'+this.swfUrl+'" />		<param name="quality" value="high" />		<param name="bgcolor" value="#ffffff" />		<param name="FlashVars" value="mp3URL='+soundUrl+'" />		<embed src="'+this.swfUrl+'" FlashVars="mp3URL='+soundUrl+'" quality="high" bgcolor="#ffffff" width="0" height="0" name="mp3_player" swLiveConnect="true" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer"/>		</object>	'};Lib.AudioCheck.callAudioCheck=function(){setTimeout(function(){$E("play_img").src="http://blogimg.sinajs.cn/v5images/play_img.gif";window.document.mp3_player.SetVariable("isPlay","1");$E("login_check").value="";$E("login_check").focus()},500);var url="http://comet.blog.sina.com.cn/api?maintype=hits&act=3&uid=00000203";Utils.Io.JsLoad.request(url,{onComplete:function(){}})};$SYSMSG.extend({B36001:"操作失败，此博文不存在或被删除。",B36002:"验证码错误，请重新输入。",B36003:"请输入昵称。",B36004:"登录名或密码错误。",B36005:"呢称不能使用此类特殊词汇，请重新输入。",B36006:"昵称必须是8个中文或16个字符以内，且不能为纯数字，请重新输入。",B36007:"呢称不能使用此类特殊词汇，请重新输入。",B36008:"不能3秒内连续发评论，请梢后再试。",B36009:"不能发内容重复的评论。",B36020:"暂无评论。",B36021:"暂无评论。",B36022:"评论内容必须是1000中文或2000字符以内，请重新输入。",B36023:"对不起，黑名单已达到上限",B36024:"对方拒绝了你的评论。",B36031:"操作失败，此评论不存在或被删除。",B36032:"操作失败，此评论不存在或被删除。",B36033:"操作失败，此评论不存在或被删除。",B36041:"请输入回复内容。",B36042:"回复内容必须是1000中文或2000字符以内，请重新输入。",B36043:"操作失败，自己不能回复自己的评论。",B36101:"操作失败，此博文不存在或被删除。",B36102:"评论发布失败，此博文设置不允许评论。",B36103:"操作失败，此评论不存在或被删除。",B36104:"评论已发布，需要审核后才能显示，请稍候…",B36113:"博主已关闭匿名评论，请登录后再评论",B36105:"请输入评论内容。",B36106:"请输入验证码。",B36107:"请输入登录名。",B36108:"请输入密码。",B36109:"读取中，请稍候…",B36110:"读取失败，请刷新。",B36111:"确定要删除此评论吗？删除后不可恢复。",B36112:"确定要删除此回复吗？删除后不可恢复。",B36115:"请拖动滑块儿开始验证",B36201:"确定要删除此评论吗？删除后不可恢复。",B36202:"确定要删除此回复吗？删除后不可恢复。",B36203:"请选择要删除的内容。",B36204:"已回复该评论，请勿重复提交。",B36998:"系统维护中，服务暂不可用",B36999:"对不起，您短时间发表的评论过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注！",36999:"对不起，您短时间发表的评论过多，请多休息会，注意身体！感谢您对新浪博客的支持和关注！",A20013:"您已经发送多条相似内容了哦，请先休息一下吧~",A20014:"已经有很多博主发过相似评论了，换个内容会更精彩~",B36205:"请登录后在回复评论",B36206:"对不起，您已被对方列入黑名单，无法发评论。",B36207:"请登录后在删除评论",B36208:"评论内容必须是140中文或280字符以内，请重新输入",B36209:"此条评论已被原博主删除",B36210:"博主已关闭评论功能",B36211:"此博文已被博主设为私密",B11113:"积分不足，神回复失败",B11114:"操作失败，神回复不合法"});Core.Dom.insertAfter=function(newElement,targetElement){if(!targetElement)return;var parent=targetElement.parentNode;if(parent.lastChild==targetElement){parent.appendChild(newElement)}else{parent.insertBefore(newElement,targetElement.nextSibling)}return newElement};Core.Dom.wrap=function(elm,tagName){var wrapper=$C(tagName);Core.Dom.insertAfter(wrapper,elm);if(!elm)return;wrapper.appendChild(elm);return wrapper};Lib.checkManager=function(obj){this.checkObj=null;this.init(obj)};Lib.checkManager.prototype={init:function(obj_int){var self=this;if(obj_int&&obj_int.id){this.geetest=new CommentV2.Geetest(obj_int.id)}else{this.geetest=new CommentV2.Geetest("#checkCodeBox")}var geetestHD=setInterval(function(){if(self.geetest.geetestObj){clearInterval(geetestHD);self.checkObj=self.geetest.geetestObj;self.checkObj.onReady(function(){if(self.geetest.options.type==="float"){var gt_hoder=Core.Dom.byClz(document,"div","gt_holder");gt_hoder[gt_hoder.length-1].style.zIndex="9999"}})}else if(scope.check_code_type==="old"){clearInterval(geetestHD);this.checkObj=new Lib.imgCheck;var dom=$E("comment_get_vcode");var cont=Core.Dom.wrap(dom,"span");if(cont){Lib.AudioCheck.render(cont,Lib.AudioCheck.soundUrl+"?"+(new Date).getTime())}}},20)},refresh:function(){this.checkObj.refresh()},validate:function(){return this.checkObj.getValidate()},setFreshChk:function(flag){this.checkObj.fresh_chk&&(this.checkObj.fresh_chk=flag)},getPostData:function(paramm){var data={};var extend=function(o,n){for(var p in n)if(n.hasOwnProperty(p)&&!o.hasOwnProperty(p))o[p]=n[p]};validate=this.validate();if(typeof validate==="object"){for(var i in validate){data[i]=validate[i]}}else{data.authcode=validate}extend(data,paramm);return data},getErrorCode:function(){var errCode="B36115";if(scope.check_code_type==="old"){errCode="B36106"}return errCode}};Lib.Invite_Base=Core.Class.create();var checkManager=null;Lib.Invite_Base.prototype={html:['<div class="CP_layercon2 addFriendItem">','<div class="toWho">#{head_image}<span>#{nickname}</span></div>','<div class="formTowho">','<div class="row1" style="display:#{login};">登录名：','<input id="invite_loginname" type="text" class="fm1" style="width:80px;"/>&nbsp;&nbsp;&nbsp;','密码：<input id="invite_password" type="password" class="fm1" style="width:73px;" maxlength="16"/>','&nbsp;&nbsp;<a target="_blank" href="https://login.sina.com.cn/getpass.html">找回密码</a><em class="SG_txtc">','|</em><a target="_blank" href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid='+scope.$uid+'&src=blogicp">注册</a>','<input id="saveOnline_invite" type="checkbox" checked value="" style="display:inline-block;margin-top:3px;"/><label for="saveOnline_invite" style="margin-top:10px; display:inline-block;">记住登录状态</label>','<span id="saveCaution_invite" style="color:#999; margin-left:10px; display:none;">建议在网吧/公用电脑上取消该选项</span>','</div><p id="invite_user_error" class="ErrTips" style="display:none;">请输入正确的登录名或密码</p>','<div class="row2"><textarea id="invite_content"></textarea></div>','<div class="row1"><span id="invite_limit" class="SG_floatR SG_txtc">您还可以输入#{content_length}个汉字</span>','<div id="checkCodeBox" class="check-code-box clearfix" style="padding: 29px 0px 9px;"></div>',"</div>",'<div class="btn">','<a id="invite_submit" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite>',"#{dialogTitle}</cite></a>&nbsp;&nbsp;",'<a id="invite_cancel" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite>取消</cite></a>',"</div>","</div>","</div>"].join(""),dialogName:"invite",initialize:function(sUid,onlineTime){this.uid=sUid;this.onlineTime=onlineTime||15;Lib.checkAuthor();if(!this.isAllowSend()){return}var checkCodeBox_main_invite={id:"#checkCodeBox"};checkManager=new Lib.checkManager(checkCodeBox_main_invite);var data={head_image:this.headImage!=null?this.headImage:'<img src="'+("http://portrait"+(this.uid%8+1)+".sinaimg.cn/"+this.uid+"/blog/50")+'" align="absmiddle" alt="'+scope.owenerNickName+'" title="'+scope.owenerNickName+'" />',nickname:this.title(),login:$isLogin?"none":"",checkImage:"http://interface.blog.sina.com.cn/riaapi/checkwd_image.php?"+Math.random(),content_length:this.contentLength/2,dialogTitle:this.dialogTitle};var content=new Ui.Template(this.html).evaluate(data);if(this.dialog==null){window.$inviteDialog=this.dialog=winDialog.createCustomsDialog({content:"",title:this.dialogTitle,tpl:Lib.invite_tpl});this.dialog.addEventListener("hidden",function(){this.destroy()})}else{}this.dialog.setContent(content);this.dialog.setMiddle();this.dialog.show();this.dialog.setAreaLocked(true);Utils.Form.limitMaxLen($E("invite_content"),this.contentLength);Core.Events.addEvent("invite_submit",Core.Function.bind2(this.checkData,this));Core.Events.addEvent("invite_cancel",Core.Function.bind2(this.closeDailog,this));Core.Events.addEvent("invite_content",Core.Function.bind2(function(){clearInterval(this.check);this.check=setInterval(Core.Function.bind2(function(){var lengthOfContent=Core.String.byteLength($E("invite_content").value);var visibleCount=Math.max(0,Math.floor((this.contentLength-lengthOfContent)/2));$E("invite_limit").innerHTML="您还可以输入"+visibleCount+"个汉字"},this),500)},this),"focus");Core.Events.addEvent("invite_content",Core.Function.bind2(function(){clearInterval(this.check);this.check=null},this),"blur");this.initSaveCaution();this.reloadName()},isAllowSend:function(){return true},initSaveCaution:function(){var cautionCheck=$E("saveOnline_invite");var cautionTip=$E("saveCaution_invite");if(!$isLogin){cautionCheck[$IE?"onclick":"onchange"]=validChecked}var cancelStatus=1;function validChecked(){if(cautionCheck.checked){cautionTip.style.display="inline-block"}else{cautionTip.style.display="none"}if(cancelStatus){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00002&rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}});cancelStatus=null}}},reloadName:function(){var userInfo=Lib.Login.info();var defaultName=userInfo.ln;if(defaultName){$E("invite_loginname").value=defaultName}},checkData:function(){if(!$isLogin){this.username=Core.String.trim($E("invite_loginname").value);this.password=Core.String.trim($E("invite_password").value);if(this.username==""||this.password==""){$E("invite_user_error").style.display="";return}else{$E("invite_user_error").style.display="none"}}this.checkcode=checkManager.validate();if(!checkManager.validate()){showError(checkManager.getErrorCode());return}if(!$isLogin){if($E("saveOnline_invite").checked){v7sendLog("48_01_39_1")}else{v7sendLog("48_01_39_0")}this.login()}else{var me=this;scope.blogOpener.showDialog(function(){me.postContent()})}},login:function(){this.request=new Lib.Login.LoginPost(Core.Function.bind2(function(loginStatus){if(loginStatus.result){if(this.postContent){var me=this;Lib.checkAuthor(function(){scope.blogOpener.showDialog(function(){me.postContent()})},"invite_login"+(new Date).getTime());$tray.renderLogin()}}else{trace("登陆失败 ："+loginStatus.reason);$E("invite_user_error").style.display=""}},this),false,"referer:"+location.hostname+location.pathname+",func:000"+(/messagesend/.test(this.Interface.url.url)?"2":"3"));this.request.login(this.username,this.password,$E("saveOnline_invite").checked?this.onlineTime:null)},resultHTML:new Ui.Template(['<div class="CP_layercon1">','<div class="CP_prompt">','<img class="SG_icon #{icon}" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"',' width="50" height="50" align="absmiddle" />','<table class="CP_w_ttl"><tr><td>#{content}</td></tr></table>','<p class="CP_w_btns_Mid"><a class="SG_aBtn SG_aBtnB" href="#" ','onclick="window.$inviteDialog && window.$inviteDialog.hidden();return false;"><cite> 确定 </cite></a></p>',"</div>","</div>"].join("")),postContent:function(){$tray.renderLogin();var i_addInvite=this.Interface;var param_m={tuid:this.uid,fuid:$UID,content:$E("invite_content").value,varname:"addFriendRequest",version:7,rnd:(new Date).valueOf()};var param=null;param=checkManager.getPostData(param_m);i_addInvite.request({GET:param,onSuccess:Core.Function.bind2(function(){v7sendLog("45_01_13_"+scope.$uid);var data={icon:"SG_icon203",content:this.successMSG()};this.dialog.setContent(this.resultHTML.evaluate(data));if(this.afterSubmit!=null){this.afterSubmit()}},this),onError:Core.Function.bind2(function(oData){if(oData.code=="A20109"||oData.code=="A20004"){winDialog.alert($SYSMSG[oData.code])}else if(oData.code=="A20003"||oData.code=="A20103"){winDialog.alert("验证码错误");checkManager.refresh()}else if(oData.code=="A11007"){var msg=$SYSMSG["A11007"].replace("#{linkNewBlog}","http://blog.sina.com.cn/u/"+$UID);winDialog.alert(msg)}else{var data={icon:"SG_icon202",content:$SYSMSG[oData.code].replace(/#{nick}/,scope.owenerNickName)};this.dialog.setContent(this.resultHTML.evaluate(data))}if(this.afterSubmit!=null){this.afterSubmit()}},this),onFail:Core.Function.bind2(function(){var data={icon:"SG_icon202",content:$SYSMSG.A00001};this.dialog.setContent(this.resultHTML.evaluate(data));this.afterSubmit()},this)})},closeDailog:function(){this.dialog.hidden()}};Lib.Invite=Core.Class.define(Lib.Invite_Base.prototype.initialize,Lib.Invite_Base,{dialogTitle:"加好友",contentLength:200,title:function(){var owenerWType=isNaN(scope.owenerWType)?-1:parseInt(scope.owenerWType);var userV=Lib.blogv.getVHTML(owenerWType);return'加"'+scope.owenerNickName+userV+'"为好友'},successMSG:function(){return["邀请发送成功，请等待对方确认。",'<div class="CP_w_cnt SG_txtb" style="font-size:12px;font-weight:normal;">以后对方的动态（发博文，图片，投票等），都可以在<span style="color: red;">个人中心</span>查看啦！</div>','<ul class="CP_w_part CP_w_aLine">','<li><a style="font-weight:normal;font-size:12px;" href="http://control.blog.sina.com.cn/blogprofile/index.php?type=3&from=addfiend" target="_blank">到个人中心查看其他好友动态&gt;&gt;</a></li>',"</ul>"].join("")},Interface:new Interface("http://control.blog.sina.com.cn/riaapi/profile/invitesend.php","jsload"),isAllowSend:function(){if(!scope||!scope.$private)return true;var invitSet=scope.$private.invitationset||0;if(0===invitSet){return true}else{winDialog.alert($SYSMSG["A20106"]);return false}}});Lib.invite=function(sUid){new Lib.Invite(sUid)};Lib.invite3=function(sUid,name){scope.owenerNickName=name;new Lib.Invite(sUid)};Lib.Scrip=Core.Class.define(Lib.Invite_Base.prototype.initialize,Lib.Invite_Base,{dialogTitle:"发纸条",headImage:"",contentLength:300,title:function(){return"发纸条给："+scope.owenerNickName},successMSG:function(){return"给"+scope.owenerNickName+"的纸条发送成功！"},Interface:new Interface("http://control.blog.sina.com.cn/riaapi/profile/messagesend.php","jsload"),afterSubmit:function(){},isAllowSend:function(){if(!scope||!scope.$private)return true;var pageSet=scope.$private.pageset||0;if(1===pageSet){this._showMsg("A20009");return false}if($isLogin){var isFriend=-1!=$E("comp901_btn_invite").innerHTML.indexOf("已是好友");if(2===pageSet&&!isFriend){this._showMsg("A30006");return false}}return true},_showMsg:function(code){winDialog.alert($SYSMSG[code])}});Lib.scrip=function(sUid){new Lib.Scrip(sUid)};if(typeof SinaEx==="undefined"){SinaEx={}}SinaEx.findNode=function(element,direction,start){for(var node=element[start];node;node=node[direction]){if(node.nodeType==1){return node}}return null};SinaEx.prev=function(element){return SinaEx.findNode(element,"previousSibling","previousSibling")};SinaEx.next=function(element){return SinaEx.findNode(element,"nextSibling","nextSibling")};SinaEx.firstChild=function(element){return SinaEx.findNode(element,"nextSibling","firstChild")};SinaEx.parent=function(node,nodeName){nodeName=nodeName.toLowerCase();while(node){if(node.nodeName.toLowerCase()===nodeName){return node}node=node.parentNode}return null};SinaEx.createNode=function(html){var node=document.createElement("div");node.innerHTML=html;return node.firstChild};SinaEx.addClass=function(node,classname){var cn=node.className;if((" "+cn+" ").indexOf(" "+classname+" ")===-1){node.className=classname+" "+cn}};SinaEx.removeClass=function(node,classname){var cn=(" "+node.className+" ").replace(" "+classname+" "," ");node.className=cn.replace(/^\s+/,"").replace(/\s+$/,"")};if(document.documentElement.contains){SinaEx.contains=function(a,b){return a.contains?a.contains(b):true}}else if(document.documentElement.compareDocumentPosition){SinaEx.contains=function(a,b){return a===b||!!(a.compareDocumentPosition(b)&16)}}else{SinaEx.contains=function(a,b){while(b){if(a===b){return true}b=b.parentNode}return false}}$registComp(901,{baseHTML:[""+'<div class="info">'+'<div class="info_img" id="comp_901_head">'+'<img src="http://portrait'+(scope.$uid*1%8+1)+".sinaimg.cn/"+scope.$uid+'/blog/180" id="comp_901_head_image" width="180" height="180" alt="" />'+"</div>"+'<div class="info_txt">'+'<div class="info_nm">'+'<img id="comp_901_online_icon" style="display:none;" class="SG_icon SG_icon1" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" align="absmiddle" /><span class="SG_txtb"><strong id="comp_901_nickname">&nbsp;</strong></span>'+'<span class="info_into"><a class="SG_linka" href="http://space.sina.com.cn/u/1406758883"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="空间" align="absmiddle" />进入我的空间</a></span>'+'<div class="clearit"></div>'+"</div>"+'<div class="info_btn1">'+'<a href="http://you.video.sina.com.cn/'+scope.$uhost+'" class="SG_aBtn SG_aBtn_ico" target="_blank">'+"<cite>"+'<img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" align="absmiddle" />播客'+"</cite>"+'</a><a href="http://weibo.com/'+scope.$uid+'?source=blog" class="SG_aBtn SG_aBtn_ico">'+"<cite>"+'<img class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" align="absmiddle" />微博'+"</cite>"+"</a>"+'<div class="clearit"></div>'+"</div>"+'<div class="SG_j_linedot"></div>'+'<div class="info_list">'+'<ul class="info_list1">'+"<li>"+'<span class="SG_txtc">博客等级：</span><span id="comp_901_grade">读取中…</span>'+"</li>"+"<li>"+'<span class="SG_txtc">博客积分：</span><span id="comp_901_score">读取中…</span>'+"</li>"+"</ul>"+'<ul class="info_list2">'+"<li>"+'<span class="SG_txtc">博客访问：</span><span id="comp_901_pv">读取中…</span>'+"</li>"+"<li>"+'<span class="SG_txtc">关注人气：</span><span id="comp_901_attention">读取中…</span>'+"</li>"+"</ul>"+"</div>"+'<div class="clearit"></div>'+"</div>"+'<div class="clearit"></div>'+"</div>"].join(""),load:function(){var _this=this;if($E("comp_901_head")==null){_this.setContent(_this.baseHTML)}Lib.checkAuthor(function(){if($isAdmin==false&&$isLogin){_this.loadIsFriend()}else if($isAdmin==false&&!$isLogin){_this.isFriend=false;_this.loadOnline()}else{_this.isOnline=true}if(scope.$pageid!="fakeIndex"){Lib.Uic.getNickName([scope.$uid],function(data){var _trim=Core.String.trim;var ownernickEl=$E("ownernick")||$E("comp_901_nickname");var nickName=_trim(ownernickEl.textContent||ownernickEl.innerText);var nickHTML=_trim(ownernickEl.innerHTML);if(Core.String.byteLength(data[scope.$uid])>20){var nick=data[scope.$uid].replace(/(.{10})/g,"$1<br/>")}else{var nick=data[scope.$uid]}if(!nickName&&nickName!=nickHTML){ownernickEl.innerHTML=nick+"&nbsp;"+nickHTML}else if(nickName&&nickName!=nickHTML){try{var imgs=ownernickEl.getElementsByTagName("a");var cons=imgs&&imgs[0].innerHTML;ownernickEl.innerHTML=nick+'&nbsp;<a href="http://blog.sina.com.cn/v/verify" target="_blank">'+cons+"</a>"}catch(e){ownernickEl.innerHTML=nick}}else{ownernickEl.innerHTML=nick}})}if($E("comp_901_nickname")){_this.loadNickname()}else{_this.renderHead();var ownernickEl=$E("ownernick");var _trim=Core.String.trim;var byteLength=Core.String.byteLength;var tmp,oldNick;if(ownernickEl){tmp=_trim(ownernickEl.textContent||ownernickEl.innerText).replace(/(\r|\n)/g,"");var len=byteLength(tmp);scope.owenerNickName=tmp}}_this.loadOtherInfo();if(scope.$pageid=="pageSetM"&&_this.setManage&&scope.$private.ad==0&&scope.$private.adver==0&&scope.$private.p4p==0){_this.setManage()}_this.mapEnter()},"comp_901"+(new Date).getTime())},fixNick:function(nick){var byteLength=Core.String.byteLength;var leftB=Core.String.leftB;var _trim=Core.String.trim;var len=byteLength(nick);var tmp;nick=_trim(nick);if(22<len){tmp=leftB(nick,20);nick=tmp+"<br>"+nick.replace(tmp,"")}return nick},showOnlineInfo:function(){if(!$isAdmin&&this.isOnline){Core.Dom.setStyle($E("comp_901_online_icon"),"display","");$E("comp_901_online_icon").alt="在线";$E("comp_901_online_icon").title="在线"}},showNickName:function(oResult){var nickname=oResult[scope.$uid]||"";nickname=Core.String.encodeHTML(nickname);var nickEl=$E("comp_901_nickname");nickEl.innerHTML=nickname;scope.owenerNickName=nickEl.textContent||nickEl.innerText;this.renderHead(nickname)},renderHead:function(nickname){if(!$isAdmin){if(nickname){$E("comp_901_head_image").title=nickname}}else{$E("comp_901_head").innerHTML='<a href="http://control.blog.sina.com.cn/blogprofile/nick.php"'+' title="点击上传头像" target="_blank"><img id="comp_901_head_image" width="180" height="180" alt="点击上传头像" src="http://portrait'+(scope.$uid*1%8+1)+".sinaimg.cn/"+scope.$uid+'/blog/180" /></a>'}},loadOtherInfo:function(){this.loadPv();this.loadGoldpan();this.loadAttention();if(scope.$pageid=="index"||scope.$pageid=="indexM"||scope.$pageid=="pageSetM"){this.loadAdManage()}},loadNewIcon:function(){var _link=$C("a");_link.href="http://move.blog.sina.com.cn/";_link.target="_blank";_link.position="absolute";var _img=$C("img");_img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";_img.className="fiveyearsIcon";if($IE6){_img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://simg.sinajs.cn/blog7style/images/special/move/move_hz.png',sizingMethod='image')"}else{_img.style.backgroundImage="url(http://simg.sinajs.cn/blog7style/images/special/move/move_hz.png)"}_img.alt="邀请MSN好友获得朋友徽章";_img.title="邀请MSN好友获得朋友徽章";_img.style.border="none";_link.appendChild(_img);$E("comp_901_head").appendChild(_link);_link.onclick=function(){Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnGuideCount.php?type=hitMedal")};_link=null},loadPv:function(){var refer=document.referrer=="0"?"":encodeURIComponent(document.referrer);if(scope.totalPv&&!isNaN(scope.totalPv)){$SetPV(scope.totalPv)}else{var pvurl="";if(scope.$articleid){pvurl="http://comet.blog.sina.com.cn/api?maintype=hits&act=4&aid="+scope.$articleid+"&ref="+refer}else{var $uidhex=(scope.$uid*1).toString(16);$uidhex.length<8?$uidhex=("00000000"+$uidhex).substr($uidhex.length,8):$uidhex;pvurl="http://comet.blog.sina.com.cn/api?maintype=hits&act=3&uid="+$uidhex+"&ref="+refer}Utils.Io.JsLoad.request(pvurl,{onComplete:function(data){if(data&&typeof data.pv!="undefined"){scope.totalPv=data.pv;$SetPV(data.pv)}},onException:function(){$SetPV(0)}})}},loadBadge:function(data){var names=["点亮荣誉勋章","新新博主","新锐博主","先锋博主","精英博主","风云博主","资深博主","元老博主",0,0,"图片博主","兑换图片博主服务","私密博文","兑换私密博文","金笔","兑换金笔"];var aTpl='<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_action.php" title="[title]"><img title="[title]" alt="[title]" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="badge" style="background-image:url([imgPath].png);_background-image: url([imgPath].gif);"></a>';var el=$E("comp_901_badge");if(!el){return}var badges=[];if(data.medal>0){data.medal>7?data.medal=7:"";badges.push({medal:data.medal,title:names[data.medal]})}else{badges.push({medal:8,title:names[0]})}if(data.pic_vip==1){badges.push({medal:10,title:names[10]})}else{badges.push({medal:11,title:names[11]})}if(data["private"]==1){badges.push({medal:12,title:names[12]})}else{badges.push({medal:13,title:names[13]})}if(data["goldpen"]>0){names[14]="现有金笔"+data["goldpen"]/1+"支";badges.push({medal:14,title:names[14]})}else{badges.push({medal:15,title:names[15]})}var htmlStr="";for(var i=0;i<badges.length;i++){var item=badges[i];var n=item.medal<10?"0"+item.medal:item.medal;imgPath="http://simg.sinajs.cn/blog7style/images/common/badge/badge"+n;htmlStr+=aTpl.replace(/\[imgPath\]/g,imgPath).replace(/\[title\]/g,item.title)}Core.Dom.insertHTML(el,htmlStr,"beforeend")},loadGoldpan:function(){var dEl=$E("comp_901_d_goldpen");var rEl=$E("comp_901_r_goldpen");if(dEl&&rEl){Utils.Io.JsLoad.request("http://comet.blog.sina.com.cn/api?maintype=goldpen&uid="+scope.$uid,{onComplete:function(data){if(data){rEl.innerHTML=data.donate;dEl.innerHTML=data.receive}},onException:function(){}})}},loadScore:function(){setTimeout(function(){Utils.Io.JsLoad.request("http://blogcnfv5.sinajs.cn/blogscr?uid="+scope.$uid+"&varname=blogScore&.js",{onComplete:function(){if(typeof blogScore!="undefined"||$E("comp_901_score")==null){var _a=blogScore.coefficient.a;var _b=blogScore.coefficient.b;var _c=blogScore.coefficient.c;var _d=blogScore.coefficient.d;var _x1=blogScore.x;var _y1=blogScore.y;var _z1=blogScore.z;var _w1=blogScore.w;var _score=_x1*_a+_y1*_b+_z1*_c+_w1*_d;$E("comp_901_score").innerHTML="<strong>"+Core.String.formatNumber(_score)+"</strong>"}},noreturn:true})},1)},loadAttention:function(){var me=this;var attention=new Interface("http://blogtj.sinajs.cn/api/get_attention_num.php","jsload");var getVal={uid:scope.$uid,suid:$isLogin?$UID:"0",attention:"suid",userpointuid:scope.$uid,s:"1"};if(this.mashAddFriend){var friendattuid=scope.$uid;var friendattsuid=$UID;if(friendattuid&&friendattsuid){getVal.friendattuid=friendattuid;getVal.friendattsuid=friendattsuid}else{this.mashAddFriend=false}}attention.request({GET:getVal,onSuccess:Core.Function.bind2(function(oData){Lib.checkAuthor();if($E("comp_901_attention")){var att_num=Core.String.formatNumber(oData.num[scope.$uid]);$E("comp_901_attention").innerHTML="<strong>"+(att_num<0?0:att_num)+"</strong>"}if(oData.is_attention&&oData.is_attention[scope.$uid]==1){this.isAttentioned=true;if($E("module_901_attention")){$E("module_901_attention").innerHTML="已关注"}}if(typeof oData.userpoint!="undefined"){if($E("comp_901_score")){$E("comp_901_score").innerHTML='<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_action.php" title="积分"><strong>'+oData.userpoint+'</strong><img width="15" height="15" align="top" title="积分" alt="积分" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon11">'}}if(this.mashAddFriend){var data=[{uid:scope.$uid,status:oData.friendattr}];this.friendSuccessCallback(data)}if(oData.svr_time){scope.$svr_time=oData.svr_time}this.loadBadge(oData)},this),onError:function(){if($E("comp_901_attention")){$E("comp_901_attention").innerHTML="<strong>0</strong>"}if(me.mashAddFriend){me.friendErrorCallback()}me.loadBadge()},onFail:function(){if($E("comp_901_attention")){$E("comp_901_attention").innerHTML="<strong>0</strong>"}if(me.mashAddFriend){me.friendErrorCallback()}me.loadBadge()}})},loadWorldCupIcon:function(){if(scope.$isWorldcupUser==1){var _link=$C("a");_link.href="http://blog.2010.sina.com.cn/yunying/2010worldcup/";_link.target="_blanks";var _img=$C("img");_img.id="comp_901_wcIcon";_img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";_img.className="worldcup_icon worldcup_icon_l";_img.alt="记录激动时刻，赢取超级大奖！快一起参加吧！";_img.title="记录激动时刻，赢取超级大奖！快一起参加吧！";_link.appendChild(_img);$E("comp_901_head").appendChild(_link)}},load7YearsIcon:function(){var headPic=$E("comp_901_head");var medalObj={medal0:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_wmm.png",medal1:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_xx.png",medal2:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_xr.png",medal3:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_xf.png",medal4:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_jy.png",medal5:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_fy.png?v20120917",medal6:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_zs.png",medal7:"http://simg.sinajs.cn/blog7style/images/activity/blog7year/icon_yl.png"};var medalType=scope.$private.medal7;medalType=7<medalType?7:medalType;if(medalType){var _a=$C("a");_a.setAttribute("target","_blank");_a.setAttribute("href","http://control.blog.sina.com.cn/blog_7years/index.php");var _img=$C("img");_img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";_img.className="sevenyearsIcon";if($IE6){_img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+medalObj["medal"+medalType]+"',sizingMethod='image')"}else{_img.style.backgroundImage="url("+medalObj["medal"+medalType]+")"}_img.style.border="none";_a.appendChild(_img);$E("comp_901_head").appendChild(_a)}else if(!scope.$private.medal&&$UID==scope.$uid){var _a=$C("a");_a.setAttribute("target","_blank");_a.setAttribute("href","http://control.blog.sina.com.cn/blog_7years/index.php");var _img=$C("img");_img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";_img.className="sevenyearsIcon";if($IE6){_img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+medalObj["medal0"]+"',sizingMethod='image')"}else{_img.style.backgroundImage="url("+medalObj["medal0"]+")"}_img.style.border="none";_a.appendChild(_img);$E("comp_901_head").appendChild(_a)}},load5YearsIcon:function(){if(scope.$private.medal7){return}trace("【活动】显示用户勋章。");try{var text=["纪念勋章","一","二","三","四","五"];var medal=scope.$private.medal;if(medal>0||medal===0){var _a=$C("a");_a.setAttribute("target","_blank");_a.setAttribute("href","http://control.blog.sina.com.cn/blog_7years/index.php");var _img=$C("img");_img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";_img.className="fiveyearsIcon";if($IE6){_img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://simg.sinajs.cn/blog7style/images/special/fiveyears/at/"+medal+"y.png',sizingMethod='image')"}else{_img.style.backgroundImage="url(http://simg.sinajs.cn/blog7style/images/special/fiveyears/at/"+medal+"y.png)"}_img.alt=medal>0?text[medal]+"周年勋章":text[0];_img.title=medal>0?text[medal]+"周年勋章":text[0];_img.style.border="none";_a.appendChild(_img);$E("comp_901_head").appendChild(_a);if($UID==scope.$uid){var _span=$C("span");var spanClassName1="updateIcon_1";var spanClassName2="updateIcon_2";_span.className=spanClassName1;_a.appendChild(_span);var flag=0;setInterval(function(){if(flag%2==1){_span.className=spanClassName1;i=0}else{_span.className=spanClassName2}flag++},500)}trace("【活动】显示用户勋章完成。")}else{trace("【活动】用户还没有获得勋章。")}}catch(e){trace("【活动】显示用户勋章发生异常。")}},loadPhotoCount:function(){},loadVideoCount:function(){},loadAdManage:function(){if($isAdmin&&scope.$private!=null&&scope.$private.ad!=null&&scope.$private.ad!=0&&$E("comp_901_adlink")==null){Debug.info("添加广告共享计划管理链接");var adHTML=['<div class="info_locate2"><div class="SG_j_linedot"/></div>'+'<div id="comp_901_adlink" class="info_AD"><a href="http://share.sass.sina.com.cn/widget_ad/widget_ad_index.php"'+' target="_blank">管理广告共享计划</a></div>'].join("");var buttonNode=Core.Dom.getElementsByClass(this.getContent(),"div","info_txt");if(buttonNode){buttonNode=buttonNode[0].lastChild;Core.Dom.insertHTML(buttonNode,adHTML,"BeforeBegin")}}},showVisitButton:function(){if($isAdmin){return}if($E("info_locate_id")){var p=$E("comp901_btn_invite");if(p){p.href="javascript:void(0)";if(this.isFriend==false){p.innerHTML="<cite>加好友</cite>";p.onclick=function(){if(!$isLogin){v7sendLog("48_01_28")}Lib.checkAuthor(function(){Lib.invite(scope.$uid)},"showVisitButton_jiahaoyou"+(new Date).getTime());return false}}else{p.innerHTML="<cite>已是好友</cite>"}}p=$E("comp901_btn_sendpaper");if(p){p.href="javascript:void(0)";p.onclick=function(){if(!$isLogin){v7sendLog("48_01_27")}Lib.checkAuthor(function(){Lib.scrip(scope.$uid)},"showVisitButton_fazhitiao"+(new Date).getTime());return false}}p=$E("comp901_btn_msninfo");if(p){p.onclick=function(){if(!$isLogin){v7sendLog("48_01_29")}};p.href="http://blog.sina.com.cn/s/profile_"+scope.$uid+".html#write"}p=$E("comp901_btn_follow");if(p){var self=this;if(this.isAttentioned){p.innerHTML="<cite>已关注</cite>"}else{p.innerHTML="<cite>加关注</cite>"}p.onclick=function(){if(self.isAttentioned){self.deleteAttention()
}else{Lib.Component.Attention();this.innerHTML="<cite>已关注</cite>";self.isAttentioned=true}return false}}return}else{var buttonNode;var inviteButtonHTML="";if(this.isFriend==false){inviteButtonHTML="Lib.invite("+scope.$uid+');return false;" class="SG_aBtn"><cite>加好友'}else{inviteButtonHTML+="><cite>已是好友"}var result=['<div id="info_locate_id" class="info_locate"><div class="SG_j_linedot"></div>','<div class="info_btn2">','<p><a href="#" onclick="'+inviteButtonHTML,"</cite></a>",'<a href="#" onclick="Lib.scrip('+scope.$uid+');return false;" class="SG_aBtn">',"<cite>发纸条</cite></a></p>",'<p><a href="http://blog.sina.com.cn/s/profile_'+scope.$uid+'.html#write" class="SG_aBtn" target="_blank">',"<cite>写留言</cite></a>",'<a id="module_901_attention" href="#" onclick="return false;" class="SG_aBtn'+(this.isAttentioned?" SG_aBtn_dis":"")+'">','<cite onclick="Lib.Component.'+(this.isAttentioned?" isAttentioned":"Attention")+'();">'+(this.isAttentioned?"已":"加")+"关注</cite></a></p>",'<div class="clearit"></div>',"</div></div>"].join("");if(this.size==210){buttonNode=Core.Dom.getElementsByClass(this.getContent(),"div","info_btn1");if(buttonNode){buttonNode=buttonNode[0];Core.Dom.insertHTML(buttonNode,result,"AfterEnd")}}else{buttonNode=Core.Dom.getElementsByClass(this.getContent(),"div","info_txt");if(buttonNode){buttonNode=buttonNode[0];Core.Dom.insertHTML(buttonNode,result,"BeforeEnd")}}}},mapEnter:function(){var module_901=$E("module_901");if(!module_901){return}info_list=selectClassOnce(module_901,"info_list","div");if(info_list){var div=document.createElement("div");div.className="info_list";div.innerHTML='<a href="http://blog.sina.com.cn/lm/map/" target="_blank" title=""><img src="http://simg.sinajs.cn/blog7style/images/blog_editor/ten_map.png" alt="博客十周年地图"></a>';info_list.parentNode.insertBefore(div,info_list);Core.Events.addEvent(div.firstChild,function(evt){v7sendLog("15_04_13_"+scope.$uid)})}function selectClassOnce(elem,className,tagName){if(elem.querySelector){var selector=tagName?tagName+"."+className:"."+className;return elem.querySelector(selector)}else{var nodes=elem.getElementsByTagName(tagName||"*")||[],reg=new RegExp("(^|\\s)"+className+"(\\s|$)");for(var n=0;n<nodes.length;n++){var item=nodes[n];if(reg.test(item.className)){return item}}return null}}},tenyears:function(){var module_901=$E("module_901");if(!module_901){return}info_list=selectClassOnce(module_901,"info_list","div");if(info_list){var div=document.createElement("div");div.className="info_list";div.innerHTML='<a href="http://blog.sina.com.cn/lm/ten" target="_blank" title=""><img src="http://simg.sinajs.cn/blog7style/images/blog_editor/ten_182_48.png" alt="博客十周年"></a>';info_list.parentNode.insertBefore(div,info_list);Core.Events.addEvent(div.firstChild,function(evt){v7sendLog("15_04_13_"+scope.$uid)})}function selectClassOnce(elem,className,tagName){if(elem.querySelector){var selector=tagName?tagName+"."+className:"."+className;return elem.querySelector(selector)}else{var nodes=elem.getElementsByTagName(tagName||"*")||[],reg=new RegExp("(^|\\s)"+className+"(\\s|$)");for(var n=0;n<nodes.length;n++){var item=nodes[n];if(reg.test(item.className)){return item}}return null}}},deleteAttention:function(){var self=this;winDialog.confirm("是否要取消关注？",{funcOk:function(){new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_del.php","jsload").request({GET:{uid:$UID,aid:scope.$uid},onSuccess:function(){var attentionButton=$E("comp901_btn_follow");attentionButton.className="SG_aBtn";attentionButton.innerHTML="<cite>加关注</cite>";self.isAttentioned=false},onError:function(){winDialog.alert("取消失败！请重试。")},onFail:function(){winDialog.alert("取消失败！请重试。")}})},funcCancel:function(){return},textOk:"是",textCancel:"否"})}},901);$registComp(903,{load:function(){if($E("atcPicList")){this.loadPicture_new()}else{this.loadArticle()}},loadArticle:function(){var _tagcode=typeof $tag_code!="undefined"?$tag_code:"";Utils.Io.Ijax.request("http://tag.blog.sina.com.cn/tag/tag_walist_v7.php",{GET:{blog_id:scope.$articleid,tag:encodeURI($tag),tag_code:_tagcode},onComplete:function(data){this.loadPicture('<div class="atcTitList relaList">'+data+"</div>")}.bind2(this),onException:function(){}})},loadPicture:function(sResult){var _pic_url="http://blog.sina.com.cn/lm/iframe/article/sort_"+this.articleCate[scope.$sort_id]+"_"+Math.ceil(Math.random()*3)+"_v7.html";Utils.Io.Ajax.request(_pic_url,{onComplete:function(data){var noPicture=/<ul>\s+<\/ul>/i.test(data);this.getContent().innerHTML=sResult.replace(/<!-- relative_pic_blog-->/,noPicture?"":data)}.bind2(this),onException:function(){}})},loadPicture_new:function(sResult){var _pic_url="http://blog.sina.com.cn/lm/iframe/article/sort_"+this.articleCate[scope.$sort_id]+"_"+Math.ceil(Math.random()*3)+"_v7.html";Utils.Io.Ajax.request(_pic_url,{onComplete:function(data){var picList=$E("atcPicList");picList.innerHTML=data}.bind2(this),onException:function(){}})},articleCate:{105:"105",102:"117",104:"104",149:"149",113:"113",153:"117",111:"117",152:"122",122:"122",131:"131",127:"108",134:"149",145:"108",108:"108",130:"130",116:"116",129:"129",136:"129",125:"125",141:"108",118:"118",117:"117"}},"dymanic");$registComp(904,{load:function(){if(Core.Dom.byClz(this.getContent(),"div","wdtLoading").length>0){var _url="http://blog.sina.com.cn/main/top_new/article_sort/"+scope.$sort_id+"_day.v7.html";Utils.Io.Ajax.request(_url,{onComplete:function(data){data='<div class="atcTitList relaList">'+data+"</div>";this.setContent(data)}.bind2(this),onException:function(){this.showError()}.bind2(this)})}else{}}},"dymanic");Core.String.shorten=function(str,len,suffix){if(Core.String.byteLength(str)<=len){return str}if(suffix!=""){suffix=suffix||"..."}else{suffix=""}return Core.String.leftB(str,len)+suffix};$registComp(909,{load:function(){if($E("tj_id")){this.showTJList($E("tj_id"))}},showTJList:function(_container){Utils.Io.JsLoad.request("http://blogtj.sinajs.cn/api/tj/get_tj_article_info.php",{GET:{uid:scope.$uid},onComplete:function(result){var tp='<li><p><span class="SG_dot"></span><a href="#{href}" target="_blank">#{content}</a></p>'+'<div class="w_list SG_txtc"><a href="#{srcHref}" target="_blank">#{src}</a></div></li>';var content="";var data=result.data;var len=result.data.length>5?5:result.data.length;if(len===0){_container.innerHTML='<li class="no_text">暂无被推荐博文</li>';return}for(var i=0;i<len;i++){var info={};info.href="http://blog.sina.com.cn/s/blog_"+data[i].blog_id+".html?tj=1";info.content=Core.String.byteLength(data[i].blog_title)>26?Core.String.shorten(data[i].blog_title,26,"…"):data[i].blog_title;info.content=Core.String.encodeHTML(info.content);info.srcHref=data[i].tj_chanel_id_url;info.src=data[i].tj_chanel_id_str;var temp=new Ui.Template(tp).evaluate(info);content+=temp}_container.innerHTML=content}.bind2(this),onException:function(){this.showError()}.bind2(this)})}},"dymanic");Core.String.toInt=function(str,i){return parseInt(str,i)};Core.String.a2u=function(str){return str.replace(/\\u[\da-fA-F]{4}/gi,function(a){a=Core.String.toInt(a.substr(2),16);return String.fromCharCode(a)})};Lib.register("util.cutNickName",function(){return function(nickName,wtype,len){var byteLength=Core.String.byteLength;var leftB=Core.String.leftB;len=len||6;if(0<=wtype&&8>wtype){return byteLength(nickName)>len?leftB(nickName,len-2)+"…":leftB(nickName,len)}else{return byteLength(nickName)>len+2?leftB(nickName,len)+"…":leftB(nickName,len+2)}}});$registComp("12",{Interface:new Interface("http://footprint.cws.api.sina.com.cn/list.php","jsload"),PromoteUserBlogInterface:new Interface("http://control.blog.sina.com.cn/riaapi/profile/AdTaskTools.php","jsload"),isDisabled:function(){var disabledStr=$_GLOBAL.disableVisitor;if(disabledStr&&disabledStr.indexOf("|"+this.requestParam.uid+"|")>-1){this.showDisabled();return true}return false},_getMessage:function(promoteUid){if(!promoteUid){promoteUid={}}var _getVHTML=Lib.blogv.getVHTML;var _cutNickName=Lib.util.cutNickName;this.Interface.request({GET:this.requestParam,onSuccess:Core.Function.bind2(function(oData){Core.Array.foreach(oData.record,Core.Function.bind2(function(oItem){oItem.vString=this.formatTime(oItem.vtime,oData.stime);var nickname=Core.String.a2u(oItem.name);if(isNaN(oItem.wtype)){oItem.wtype=-1}oItem.wtype=parseInt(oItem.wtype,13);oItem.shortName=_cutNickName(nickname,oItem.wtype,9);if(promoteUid[oItem.uid]){oItem.isPromote=true}oItem.userV=_getVHTML(oItem.wtype);oItem.shortName=Core.String.encodeHTML(oItem.shortName)},this));this.cacheData=oData.record;this.total=oData.total;this["render_"+this.size](this.cacheData);promoteUid=null},this),onError:Core.Function.bind2(function(oData){this.showError($SYSMSG[oData.code])},this),onFail:Core.Function.bind2(function(){this.showError($SYSMSG.A80101)},this)})},load:function(){var _this=this;if(_this.requestParam==null){_this.show("请提供访客组件的接口参数")}else{Lib.checkAuthor(function(){if(!$isLogin){_this.requestParam.varname="requestId_visitor_list"}if(scope.unreadMsg&&scope.unreadMsg.foot==0){_this.requestParam.add=1}if(_this.isDisabled()){return}},"comp_12"+(new Date).getTime());_this._getMessage({1259295385:true})}},formatTime:function(nVisitTime,nSystemTime){var result="";var nSystemDay=new Date(nSystemTime*1e3);var nVisitDay=new Date(nVisitTime*1e3);if(nSystemDay.getFullYear()==nVisitDay.getFullYear()&&nSystemDay.getMonth()==nVisitDay.getMonth()&&nSystemDay.getDate()==nVisitDay.getDate()){var diffTime=Math.max(0,nSystemTime-nVisitTime);Debug.warning("diffTime : "+diffTime);if(diffTime<60*60){result=Math.ceil(diffTime/60)+"分钟前"}else{var visitTime=new Date(nVisitTime*1e3);result=("今天0"+visitTime.getHours()+":0"+visitTime.getMinutes()).replace(/(\d{3,3})/g,function(a,b){return b.substr(1)})}}else{var visitDate=new Date(nVisitTime*1e3);result=visitDate.getMonth()+1+"月"+visitDate.getDate()+"日"}return result},reload:function(sSize,bAddManage,bForceRequest){var sizeCorrect=sSize==null||sSize&&(sSize==210||sSize==510||sSize==730);if(!sizeCorrect){Debug.error("请检查传入的组件尺寸是否正确。"+sSize);return}this.size=sSize||this.size;this.getContent().innerHTML='<div class="wdtLoading"><img src="http://simg.sinajs.cn/blog7style/'+'images/common/loading.gif" />加载中…</div>';if(bForceRequest==true||this.cacheData==null){this.load()}else{this["render_"+this.size]()}}},"dynamic");Lib.deleteVisitByUid=function(sUid,sProductId,fCallBack,sSubId){Lib.checkAuthor(function(){if(!$isLogin){var Login=new Lib.Login.Ui;Login.login(Core.Function.bind3(Lib.deleteWallByMsgid,null,arguments));return}Debug.log("删除访客："+sUid);var confirmMsg="";if($isAdmin){confirmMsg=$SYSMSG.A80203}else if($isLogin){confirmMsg=$SYSMSG.A80201}else{return true}winDialog.confirm(confirmMsg,{funcOk:function(){var i_deleteVisit=new Interface("http://footprint.cws.api.sina.com.cn/del.php","jsload");var param={pid:sProductId,uid:scope.$uid,deleteuid:sUid};if(sSubId!=null){param.subid=sSubId}if($E("comp_12_deleteToBlack")&&$E("comp_12_deleteToBlack").checked==true){param.inblack=1}i_deleteVisit.request({GET:param,onSuccess:function(){if(fCallBack){fCallBack(null,null,true)}else{Debug.log("Reload page");window.location.reload()}}})},subText:$isAdmin?$SYSMSG.A80204:$SYSMSG.A80202,textOk:"是",textCancel:"否",icon:"04"})},"deleteVisitByUid"+(new Date).getTime())};$SYSMSG.extend({B80001:"暂无访客",B80002:"暂无留言",B80003:"暂无博客评论",B80004:"暂无好友",B80005:"暂无图片专辑",B80006:"暂无视频",B80007:"暂无归档博文",B80101:"你确定删除此评论吗？<br/>删除后不可恢复",B80102:"你确定删除此留言吗？<br/>删除后不可恢复",B80103:['<ul class="CP_w_part SG_txtb">'+'<li><input type="checkbox" id="comp_2_deleteToBlack" class="CP_w_fm1" />'+'<label for="comp_2_deleteToBlack" >将此人加入黑名单</label></li>'+"</ul>"].join(""),A00101:'<div class="SG_nodata">留言板非公开</div>',B36023:"对不起，黑名单已达到上限"});scope.getPromoteURL=function(cfg){var tempUrl="http://blog.sina.com.cn/u/"+cfg.uid;var promoteURLSuffix="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,290418,295665&cid=0,0,0&sid=288937&advid=358&camid=37389&show=ignore";if(cfg.isPromote){tempUrl=promoteURLSuffix+($UID?"&kv={0}|99999&url={1}".format($UID,tempUrl):"&url={0}".format(tempUrl))}if(cfg.uid==1259295385){var bumaURL="http://blog.sina.com.cn/u/"+cfg.uid;tempUrl="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,256856,261931&cid=0,0,0&sid=253209&advid=358&camid=37389&show=ignore&url="+bumaURL}return tempUrl};$registComp(12,{requestParam:{uid:scope.$uid,pagesize:"18",pid:1},html:["<li ","onmouseover=\"if(this.childNodes[2].className=='del'){this.childNodes[2].style.display='';}\" ","onmouseout=\"if(this.childNodes[2].className=='del'){this.childNodes[2].style.display='none';}\">",'<span class="pt_imgs"><img class="SG_icon SG_icon35" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="#{name}" align="absmiddle" /></span>','<span class="pt_nms"><a suda-uatrack="key=blog_article&value=h_article51" href="#{uhref}" target="_blank" title="#{name}">#{shortName}</a>#{userV}</span>',"#{manage}",'<span class="pt_tms">#{vString}</span>',"</li>"].join(""),render_210:function(oData){oData=oData||this.cacheData;oData=oData.slice(0,12);this.parseToHTML(oData)},render_510:function(oData){oData=oData||this.cacheData;oData=oData.slice(0,12);this.parseToHTML(oData)},render_730:function(oData){oData=oData||this.cacheData;this.parseToHTML(oData)},parseToHTML:function(oData){var _this=this;if(oData.length==0){_this.showEmpty()}else{Lib.checkAuthor(function(){Core.Array.foreach(oData,Core.Function.bind2(function(oItem){oItem.manage=oItem.uid==$UID?'<span class="del" style="display: none;" onmouseover="_this.style.display = \'\';"'+" onmouseout=\"_this.style.display = 'none';\""+'><img class="SG_icon SG_icon6" src="http://simg.sinajs.cn/blog7style'+'/images/common/sg_trans.gif" width="15" height="15" title="删除访问记录" '+"onclick=\"Lib.deleteVisitByUid('"+oItem.uid+"', 1, Core.Function.bind2(Lib.Component.instances["+_this.compId+"].reload, Lib.Component.instances["+_this.compId+"])"+(scope.$articleid==null?"":",'"+scope.$articleid+"'")+');return false;" align="absmiddle" /></span>':"";oItem.uhref=scope.getPromoteURL(oItem)},_this));var template=new Ui.Template(_this.html);var result='<ul class="ad_ptlist">'+template.evaluateMulti(oData)+"</ul>";if((scope.$pageid=="indexM"||scope.$pageid=="pageSetM")&&$isAdmin==true&&(_this.size<730&&_this.total>12||_this.size==730&&_this.total>18)){result+='<div class="moreLink SG_j_linedot1"><span class="SG_more"><a href="http://control.blog.sina.com.cn/blogprofile/visitor.php?showtype=1" target="_blank">更多</a>&gt;&gt;</span></div>'}else{result+='<div class="moreLink" style="padding-top:0;"></div>'}_this.show(result);var vUID="1062753310";var linkVisited=$E("linkVisited_"+vUID);linkVisited&&(linkVisited.href="http://sina.allyes.com/main/adfclick?db=sina&bid=204720,256856,261931&cid=0,0,0&sid=253209&advid=358&camid=37389&show=ignore&url=http://blog.sina.com.cn/u/"+vUID)},"comp_12"+(new Date).getTime())}if(scope.$pageid=="pageSetM"&&_this.setManage){_this.setManage()}},showEmpty:function(){this.setContent('<div class="SG_nodata">'+$SYSMSG.B80001+"</div>")},showDisabled:function(){var msg="尊敬的用户您好，为了给大家提供更好的服务，近期访客组件进行升级维护，维护过程中将影响部分用户无法正常浏览，给您带来不便敬请谅解！感谢您对新浪博客一直以来的支持！";this.setContent('<div class="SG_nodata" style="padding-left:1.5em; padding-right:1.5em; text-indent:2em; text-align:left">'+msg+"</div>")},setManage:function(){if($isAdmin&&this.getManage()){this.getManage().innerHTML='<span class="move"><a href="#" '+'onclick="funcMoveUpDown.up('+this.compId+');return false;">↑</a><a href="#" '+'onclick="funcMoveUpDown.down('+this.compId+');return false;">↓</a></span>'+'<a href="#" onclick="hiddenComponents(\''+this.compId+'\');return false;" class="CP_a_fuc">[<cite>隐藏</cite>]</a>'}}},12);$registComp(47,{requestParam:{uid:scope.$uid,pagesize:"12",pid:1,subid:scope.$articleid}},12);$registComp(102,{load:function(){trace("comp_1023");this.loadArticle()},loadArticle:function(){Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/riaapi/photoblog/get_hotblog_list.php",{GET:{uid:scope.$uid,version:7},onComplete:function(data){trace("---------------code:"+data.code);var htmlStr=['<div class="photoBlog">'];var json=data;var list=json.data;for(var n=0,m=list.length;n<m;n++){var tj=list[n].tj?list[n].tj:"";htmlStr.push('<div class="photoBlog_cell"><div class="photoBlog_view"><table><tr><td><a href="');htmlStr.push(list[n].blogurl);htmlStr.push('" target="_blank"><img class="borderc" src="');htmlStr.push(list[n].picurl);htmlStr.push('" alt="');htmlStr.push(list[n].title);htmlStr.push('" title="');htmlStr.push(list[n].title);htmlStr.push('"/></a></td></tr></table></div><p class="photoBlog_nm">');htmlStr.push(tj);htmlStr.push('<a href="');htmlStr.push(list[n].blogurl);htmlStr.push('" target="_blank">');htmlStr.push(list[n].title);htmlStr.push("</a></p><p>阅读(");htmlStr.push(list[n].hitsnum);htmlStr.push(") 评论(");htmlStr.push(list[n].commentnum);htmlStr.push(")</p></div>")}htmlStr.push("</div>");this.getContent().innerHTML=htmlStr.join("")}.bind2(this),onException:function(){trace("connect error")}})},tpl:""+'<div class="photoBlog_cell">'+'<div class="photoBlog_view">'+"<table>"+"<tr>"+"<td>"+'<a href="{0}" target="_blank"><img class="borderc" src="{5}" alt="{7}" title="{7}"/></a>'+"</td>"+"</tr>"+"</table>"+"</div>"+'<p class="photoBlog_nm">{6}<a href="{0}" target="_blank">{1}</a> <span class="count">({2}张)</span></p>'+"<p>阅读({3}) 评论({4})</p>"+"</div>"},"dymanic");var DialogManager={dialogs:[],activeDialog:{},backShadow:null,create:function(tpl,name){var _this=this;var dialog=new Dialog(tpl);this.dialogs.push(dialog);this.activeDialog=dialog;dialog.name=name||dialog.getUniqueID();dialog.entity.style.zIndex=1024;dialog.onDrag=function(){if($IE6){if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}};dialog.onClose=function(){_this.removeDialog(this.name);_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onHidden=function(){this.isHidden=true;if(this==_this.activeDialog){_this.activeDialog=null}_this.updateActiveDialog();_this.updateShadow();if(_this.activeDialog){_this.activeDialog.setFocus()}};dialog.onShow=function(){if(this.isHidden){this.isHidden=false;var i,len=_this.dialogs.length;for(i=0;i<len;i++){if(_this.dialogs[i]==this){document.body.appendChild(_this.dialogs[i].entity);_this.dialogs.push(_this.dialogs[i]);_this.dialogs.splice(i,1)}}_this.activeDialog=this;_this.backShadow.show();_this.updateShadow()}};if(this.backShadow.isShow){this.updateShadow()}else{this.backShadow.show()}dialog.hidden();return dialog},getDialog:function(name){var i=0,len=this.dialogs.length;for(i=0;i<len;i++){if(this.dialogs[i].name==name){return this.dialogs[i]}}},removeDialog:function(name){var i=0,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs.splice(i,1);this.activeDialog=this.dialogs[this.dialogs.length-1];break}}},updateActiveDialog:function(){var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(!this.dialogs[i].isHidden){this.activeDialog=this.dialogs[i];break}}},updateShadow:function(){if(this.activeDialog&&!this.activeDialog.isHidden){this.backShadow.insertBefore(this.activeDialog.entity);this.activeDialog.updateFixed()}else{this.backShadow.hidden()}},close:function(name){if(!name){if(this.activeDialog){this.activeDialog.close()}return}var i,len=this.dialogs.length;for(i=len-1;i>=0;i--){if(this.dialogs[i].name==name){this.dialogs[i].close();break}}}};var BackShadow=function(opacity){this.entity=null;this.isShow=false;this._ie6Fixed=function(){if(_this.entity){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.entity.style.left=document.documentElement.scrollLeft+"px";if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;_this.ifm.style.left=_this.entity.style.left}_this.updateSize()}};var _this=this;!function initialize(){_this.entity=$C("div");_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=1024;_this.entity.style.backgroundColor="black";document.body.appendChild(_this.entity);_this._setOpacity(_this.entity,isNaN(opacity)?.5:opacity);if($IE6){_this.entity.style.top=document.documentElement.scrollTop+"px";_this.addIframe()}Core.Events.addEvent(window,function(){if(_this.entity){if($IE6&&_this.isShow){document.documentElement.scrollLeft=0;_this._ie6Fixed()}setTimeout(function(){_this.updateSize()},1)}},"resize");_this.setFixed(true);_this.hidden()}()};BackShadow.prototype={show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}this.isShow=true;this.onShow()},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.isShow=false;this.onHidden()},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},addIframe:function(){this.ifm=$C("iframe");this._setOpacity(this.ifm,0);this.ifm.style.position="absolute";this.ifm.style.zIndex=this.entity.style.zIndex;this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;document.body.insertBefore(this.ifm,this.entity)},insertBefore:function(obj){document.body.insertBefore(this.entity,obj);if(this.ifm){document.body.insertBefore(this.ifm,this.entity)}},updateSize:function(){this.entity.style.width=this.getAreaWidth()+"px";this.entity.style.height=this.getAreaHeight()+"px";if(this.ifm){this.ifm.style.width=this.getAreaWidth()+"px";this.ifm.style.height=this.getAreaHeight()+"px"}},getAreaHeight:function(){return document.documentElement.clientHeight},getAreaWidth:function(){return document.documentElement.clientWidth},setFixed:function(state){if($IE6){var _this=this;if(state){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}},_setOpacity:function(obj,v){if($IE&&$IE<=9){obj.style.filter="alpha(opacity="+v*100+")"}else{obj.style.opacity=v}},onShow:function(){},onHidden:function(){}};function CustomsDialog(tpl,name){this.nodesPattern=/[^\{\}]+(?=\})/g;this._dialog=DialogManager.create(tpl,name);this.entity=this._dialog.entity;this.templateString="";this.nodes={};var _this=this;!function initialize(){_this._dialog.onDrag=function(){if($IE6){if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left)-document.documentElement.scrollLeft,y:parseInt(this.entity.style.top)-document.documentElement.scrollTop})}}else{if(this.getProperty().isFixed){this.setPosition({x:parseInt(this.entity.style.left),y:parseInt(this.entity.style.top)})}}_this.onDrag()};_this.updateNodes();if(_this.nodes.btnClose){Core.Events.addEvent(_this.nodes.btnClose,function(){var e=Core.Events.getEvent();if(e){e.cancelBubble=true}},"mousedown")}}();this._hiddenDialog=function(){_this.hidden()};this._closeDialog=function(){_this.close()}}CustomsDialog.prototype={isSetMiddle:false,setContent:function(tpl){var _contentTemplate=tpl;this.templateString=_contentTemplate.match(this.nodesPattern);var tmp=new Ui.Template(_contentTemplate);this.nodes.content.innerHTML=tmp.evaluate(this.getContentNodes("i"));this.updateNodes()},setTitle:function(title){if(this.nodes.titleName){this.nodes.titleName.innerHTML=title}},setHelp:function(helpLink){if(this.nodes.btnHelp){if(helpLink){this.nodes.btnHelp.href=helpLink}else{this.nodes.btnHelp.innerHTML=""}}},setClose:function(mode){var _this=this;if(_this.nodes.btnClose){mode=mode||"hidden";switch(mode){case"hidden":Core.Events.addEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");break;case"close":Core.Events.addEvent(_this.nodes.btnClose,_this._closeDialog,"click");break}}},setPosition:function(x,y){this._dialog.setPosition({x:x,y:y})},setMiddle:function(){var win=Core.System.winSize();var _x,_y;var displayState=this._dialog.entity.style.display;this._dialog.setPosition({x:-1e4});this._dialog.entity.style.display="";var titleBarOffsetHeight=this.nodes.titleBar?this.nodes.titleBar.offsetHeight:0;var areaHeight=win.height-this.nodes.content.offsetHeight-titleBarOffsetHeight;var goldenSection=(Math.sqrt(5)-1)/2;var totalSection=1;var goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection);_x=win.width/2-this.nodes.content.offsetWidth/2;_x=_x<0?0:_x;_y=goldenSectionY<0?0:goldenSectionY;if(!this._dialog.getProperty().isFixed){_x=_x+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);_y=_y+Math.max(document.documentElement.scrollTop,document.body.scrollTop)}this._dialog.entity.style.display=displayState;this._dialog.setPosition({x:_x,y:_y});this.isSetMiddle=true},setSize:function(width,height){this._dialog.setSize({width:width,height:height})},setFixed:function(state){this._dialog.setFixed(state)},setAreaLocked:function(state){this._dialog.setAreaLocked(state)},setFocusNode:function(focusNode){this._dialog.getProperty().focusNode=focusNode},setDisplayMode:function(mode){this._dialog.getProperty().displayMode=mode||"normal"},getWidth:function(){return this._dialog.getProperty().width},getHeight:function(){return this._dialog.getProperty().height},getX:function(){return this._dialog.getProperty().x},getY:function(){return this._dialog.getProperty().y},show:function(){if(this.isSetMiddle){this.setMiddle()}this._dialog.show();this.onShow()},hidden:function(){this._dialog.hidden();this.onHidden()},close:function(){var _this=this;_this._dialog.close();_this.onClose();if(_this.nodes.btnClose){Core.Events.removeEvent(_this.nodes.btnClose,_this._hiddenDialog,"click");Core.Events.removeEvent(_this.nodes.btnClose,_this._CloseDialog,"click")}},updateNodes:function(){this.nodes=this._dialog.getNodes();var contentNodes=this.getContentNodes();for(k in contentNodes){this.nodes[k]=contentNodes[k]}},getContentNodes:function(mode){var m=mode||"o";var i;var nodes={};var result=this.templateString;if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E(this.nodes.content.id+"_"+r);break;case"i":nodes[r]=this.nodes.content.id+"_"+r;break}}}return nodes},setOnDisplaied:function(func){this._dialog.onDisplaied=func},setOnDisplayFinished:function(func){this._dialog.onDisplayFinished=func},onDrag:function(){},onShow:function(){},onHidden:function(){},onClose:function(){}};var LayerTemplate={alert:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容区域 -->"+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+"<p/>"+"</div>"+"</div>"+'<div class="btnRow"><a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a></div>'+"</div>"+"<!-- 内容区域 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",confirm:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容开始 -->"+'<div class="gDialogDoc">'+'<div class="diaBd">'+'<div class="gDiaC1"><img id="#{icon}" width="50" height="50" class="" src="http://simg.sinajs.cn/tiezi/images/icon/icon.gif" alt=""/></div>'+'<div class="gDiaC2">'+'<h5 id="#{text}"></h5>'+'<div id="#{subText}"></div>'+"<p/>"+"</div>"+"</div>"+'<div class="btnRow">'+'<a class="gBtnb gBtnbClr" id="#{linkOk}" href="javascript:;"><cite id="#{btnOk}"><em id="#{ok}"></em></cite></a>'+'<a class="gBtnb gBtnbClr" id="#{linkCancel}" href="javascript:;"><cite id="#{btnCancel}"><em id="#{cancel}"></em></cite></a>'+"</div>"+"</div>"+"<!-- 内容结束 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",iframe:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+'<div id="#{loadState}">Loading...</div>'+'<iframe style="width:100%;height:500px;" id="#{iframe}" src="#{iframeURL}"></iframe>'+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>",customs:'<table id="#{entity}"  class="gModLy">'+'<thead id="#{titleBar}">'+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"><div class="gModLyHeader"><div class="gFl"><div class="gML_tit"><strong id="#{titleName}"></strong></div></div>'+'<div class="gFr"><ul><li><a href="javascript:;" id="#{btnClose}" class="iconClose"></a></li><li><a href="#" class="help" >帮助</a></li></ul></div></div></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain"></td>'+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tbgleft"><div></div></td>'+'<td class="tdmain" id="layer_2">'+'<div id="#{content}" class="gModLyCont">'+"<!-- 内容区域 -->"+"<!-- 内容区域 -->"+"</div>"+"</td>"+'<td class="tbgright"><div></div></td>'+"</tr>"+"</tbody>"+"</table>"};!function(){var WindowDialog=function(backShadow,objTemplate){this.template=objTemplate||{};DialogManager.backShadow=backShadow};WindowDialog.prototype={iconSet:{"01":{"class":"SG_icon SG_icon201",alt:"警告"},"02":{"class":"SG_icon SG_icon202",alt:"失败"},"03":{"class":"SG_icon SG_icon203",alt:"成功"},"04":{"class":"SG_icon SG_icon204",alt:"询问"},"06":{"class":"SG_icon SG_icon148",alt:"警告"}},alert:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(cfg.template||this.template.alert||LayerTemplate.alert,name);var win=Core.System.winSize();var nodes=dialog.getNodes();
dialog.onDisplaied=cfg["funcDisplaied"];dialog.onDisplayFinished=cfg["funcDisplayFinished"];dialog.setSize({width:cfg["width"],height:cfg["height"]});dialog.setFixed(true);this._setDialogMiddle(dialog);dialog.show();dialog.setAreaLocked(true);nodes.linkOk.focus();nodes.text.innerHTML=text;if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["01"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["01"]["alt"]}nodes.ok.innerHTML=cfg["textOk"]||"确定";if(nodes.subText){nodes.subText.innerHTML=cfg["subText"]||""}dialog.getProperty().focusNode=nodes.linkOk;Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){if(cfg["funcClose"]&&dialog.getProperty().enabled){cfg["funcClose"]()}dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},newAlert:function(text,cfg,name){cfg.template=this.template.newAlert;this.alert(text,cfg,name)},confirm:function(text,cfg,name){cfg=cfg||{};var dialog=DialogManager.create(cfg.template||this.template.confirm||LayerTemplate.confirm,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.onDisplaied=cfg["funcDisplaied"];dialog.onDisplayFinished=cfg["funcDisplayFinished"];dialog.setSize({width:cfg["width"],height:cfg["height"]});dialog.setFixed(true);this._setDialogMiddle(dialog);dialog.show();dialog.setAreaLocked(true);if(cfg["defaultButton"]==0){nodes.linkCancel.focus();dialog.getProperty().focusNode=nodes.linkCancel}else{nodes.linkOk.focus();dialog.getProperty().focusNode=nodes.linkOk}nodes.text.innerHTML=text;if(nodes.titleName){nodes.titleName.innerHTML=cfg["title"]||"提示"}if(nodes.icon){nodes.icon.className=cfg["icon"]?this.iconSet[cfg["icon"]]["class"]:this.iconSet["04"]["class"];nodes.icon.alt=cfg["icon"]?this.iconSet[cfg["icon"]]["alt"]:this.iconSet["04"]["alt"]}nodes.ok.innerHTML=cfg["textOk"]||"确定";nodes.cancel.innerHTML=cfg["textCancel"]||"取消";if(nodes.subText){nodes.subText.innerHTML=cfg["subText"]||""}Core.Events.addEvent(nodes.btnOk,function(){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkOk,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcOk"]&&dialog.getProperty().enabled){cfg["funcOk"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnCancel,function(){if(cfg["funcCancel"]&&dialog.getProperty().enabled){cfg["funcCancel"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.linkCancel,function(){var e=Core.Events.getEvent();if(e.keyCode=="13"){if(cfg["funcCancel"]&&dialog.getProperty().enabled){cfg["funcCancel"]()}dialog.close()}},"keydown");Core.Events.addEvent(nodes.btnClose,function(){if(cfg["funcClose"]&&dialog.getProperty().enabled){cfg["funcClose"]();Core.Events.stopEvent()}dialog.close();return false},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},newConform:function(text,cfg,name){cfg.template=this.template.newConfirm;this.confirm(text,cfg,name)},showIframe:function(cfg,name){cfg=cfg||{};var dialog=DialogManager.create(this.template.iframe||LayerTemplate.iframe,name);var win=Core.System.winSize();var nodes=dialog.getNodes();dialog.setSize({width:cfg["width"]||320,height:cfg["height"]||150});var _x=win.width/2-dialog.getProperty().width/2<0?0:win.width/2-dialog.getProperty().width/2;var _y=win.height/2-dialog.getProperty().height/2<0?0:win.height/2-dialog.getProperty().height/2;if(cfg["fixed"]){dialog.setPosition({x:_x,y:_y})}else{dialog.setPosition({x:_x+document.documentElement.scrollLeft,y:_y+document.documentElement.scrollTop})}if(!$IE6){dialog.getProperty().displayMode="alpha"}dialog.setFixed(!!cfg.fixed);dialog.show();dialog.setAreaLocked(true);nodes.titleName.innerHTML=cfg["title"]||"";nodes.iframe.src=cfg["url"]||"about:blank";Core.Events.addEvent(nodes.iframe,function(){nodes.iframe.style.display="";nodes.loadState.style.display="none"},"load");Core.Events.addEvent(nodes.btnClose,function(){dialog.close()},"click");Core.Events.addEvent(nodes.btnClose,function(){var e=Core.Events.getEvent();e.cancelBubble=true},"mousedown")},createCustomsDialog:function(cfg,name){cfg=cfg||{};var customsDialog=new CustomsDialog(cfg.tpl||this.template.customs||LayerTemplate.customs,name);cfg.content&&customsDialog.setContent(cfg.content);customsDialog.setTitle(cfg.title||"提示");customsDialog.setHelp(cfg.help||"");customsDialog.setClose("hidden");customsDialog.setOnDisplaied(cfg["funcDisplaied"]);customsDialog.setOnDisplayFinished(cfg["funcDisplayFinished"]);return customsDialog},getDialog:function(name){return DialogManager.getDialog(name)},close:function(name){DialogManager.close(name)},_setDialogMiddle:function(dialog){var win=Core.System.winSize();var nodes=dialog.getNodes();var _x,_y;var displayState=dialog.entity.style.display;dialog.setPosition({x:-1e4});dialog.entity.style.display="";var titleBarOffsetHeight=nodes.titleBar?nodes.titleBar.offsetHeight:0;var areaHeight=win.height-nodes.content.offsetHeight-titleBarOffsetHeight;var goldenSection=(Math.sqrt(5)-1)/2;var totalSection=1;var goldenSectionY=areaHeight*goldenSection/(goldenSection+totalSection);_x=win.width/2-nodes.content.offsetWidth/2;_x=_x<0?0:_x;_y=goldenSectionY<0?0:goldenSectionY;if(!dialog.getProperty().isFixed){_x=_x+document.documentElement.scrollLeft;_y=_y+document.documentElement.scrollTop}dialog.entity.style.display=displayState;dialog.setPosition({x:_x,y:_y})}};Sina.Ui.WindowDialog=WindowDialog}();Core.String.expand=function(str){var r=str.replace(/([\u00ff-\ufffe])/gi,"￿$1");return r};Core.String.collapse=function(str){return str.replace(/\uffff/gi,"")};scope.searchFilm=function(a){var loginBarSearchForm=$E("loginBarSearchForm");var url=loginBarSearchForm.action;var loginBarSearchT=$E("loginBarSearchT");var loginBarSearchS=$E("loginBarSearchS");var loginBarSearchTS=$E("loginBarSearchTS");var loginBarSearchType=$E("loginBarSearchType");var loginBarSearchSType=$E("loginBarSearchSType");var loginBarSearchInput=$E("loginBarSearchInput");var tObj={url:url,loginBarSearchT:loginBarSearchT.value,loginBarSearchS:loginBarSearchS.value,loginBarSearchS:loginBarSearchS.value,loginBarSearchType:loginBarSearchType.value,loginBarSearchSType:loginBarSearchSType.value,loginBarSearchInput:loginBarSearchInput.value};loginBarSearchInput.value="影评 "+a;loginBarSearchT.value="blog";loginBarSearchSType.value="tag";loginBarSearchForm.action="http://uni.sina.com.cn/c.php";loginBarSearchForm.submit();loginBarSearchForm.action=tObj["url"];loginBarSearchT.value=tObj["loginBarSearchT"];loginBarSearchS.value=tObj["loginBarSearchS"];loginBarSearchS.value=tObj["loginBarSearchS"];loginBarSearchType.value=tObj["loginBarSearchType"];loginBarSearchSType.value=tObj["loginBarSearchSType"];loginBarSearchInput.value=tObj["loginBarSearchInput"]};$registComp(122,{getLatestComm:new Interface("http://control.blog.sina.com.cn/riaapi/film/get_latest_filmcomment.php","jsload"),load:function(){this.getLatestComm.request({onSuccess:Core.Function.bind2(function(oData){trace("---------ok----------");this.cacheData=oData;this.toHTML(this.cacheData)},this),onError:Core.Function.bind2(function(oData){trace("---------error----------");this.showError(oData.code)},this),onFail:Core.Function.bind2(function(oData){this.showError($SYSMSG.A80101)},this)})},toHTML:function(data){var d=data;if(data.length==0){this.handleEmpty();return}var titleLen=11,commentLen=12;for(var i=0,len=data.length;i<len;i++){var filmname=data[i]["filmname"];data[i]["filmname_limit"]=filmname;for(var j=0,length=data[i]["comment"].length;j<length;j++){data[i]["comment"][j].title_limit=checkStrLen(data[i]["comment"][j].title,commentLen)}data[i]["num"]=Core.String.formatNumber(data[i]["num"])}function addSpace(str,pos){str=Core.String.expand(str);if(str.length<=pos){pos=str.length-1}str=str.substr(0,pos)+" "+str.substr(pos);str=Core.String.collapse(str);return str}function checkStrLen(str,max){var temp=Core.String.expand(str);if(temp.length>max){temp=temp.substr(0,max)}temp=Core.String.collapse(temp);return temp}var html="";for(var m=0,mlen=data.length;m<mlen;m++){var type=data[m].type==2?"movie":"tv";var url="http://data.ent.sina.com.cn/"+type+"/"+data[m]["filmid"]+".html";var filmname=data[m]["filmname"],filmname_limit=data[m]["filmname_limit"];var imgurl=data[m]["imgurl"],num=data[m]["num"];html+=['<li class="cur">','<a href="'+url+'" target="_blank" title="'+filmname+'"><img alt="'+filmname+'" src="'+imgurl+'"></a>',"<p>共"+'<strong><a href="javascript:void(0);" onclick="scope.searchFilm(\''+filmname+"')\">"+num+"</a></strong>篇</p>","<ul>"].join("");for(var n=0,nlen=data[m]["comment"].length;n<nlen;n++){html+='<li><a title="'+data[m]["comment"][n].title+'" href="'+data[m]["comment"][n].url+'" target="_blank">'+data[m]["comment"][n].title_limit+"</a></li>"}var dot=m==mlen-1?"":'<div class="SG_j_linedot"></div>';html+=["</ul>",dot,'<div class="clearit"></div>',"</li>"].join("")}var innerHTML=['<div class="hotmovies">',"<ul>",html,"</ul>",'</div><div class="clearit"></div>'].join("");this.setContent(innerHTML)},handleEmpty:function(){trace("没有最新影评数据");var innerHTML=['<div class="SG_nodata">',"<p>还没有影评。</p>","</div>"].join("");this.setContent(innerHTML)}},"dynamic");Lib.Component.renderByList=function(arrDefaultList){Core.Array.foreach(arrDefaultList,function(oItem){try{if($E("module_"+oItem)!=null){var comp=Lib.Component.instances[oItem]||new Lib.Component["Comp_"+oItem](oItem);if(comp.size!=null&&comp.load!=null){comp.size=Lib.Component.compSize[oItem];try{comp.load()}catch(e){}Debug.log("组件："+oItem+" 初始化成功")}else{Debug.error("组件："+oItem+" 初始化失败，组件尺寸信息不存在")}}else{Debug.error("组件："+oItem+" 初始化失败，页面内缺少组件的HTML节点")}}catch(e){Debug.error(e.message||"组件："+oItem+" 初始化失败，请确认该组件类是否定义过")}finally{}})};Lib.Component.lazyRenderByList=function(arrDefaultList){var lazyList=[];Core.Array.foreach(arrDefaultList,function(oItem){try{if($E("module_"+oItem)!=null){var comp=Lib.Component.instances[oItem]||new Lib.Component["Comp_"+oItem](oItem);if(comp.size!=null&&comp.load!=null){comp.size=Lib.Component.compSize[oItem];try{lazyList.push({dom:$E("module_"+oItem),callback:Lib.Component.instances[oItem].load.bind2(Lib.Component.instances[oItem])})}catch(e){}Debug.log("组件："+oItem+" 初始化成功")}else{Debug.error("组件："+oItem+" 初始化失败，组件尺寸信息不存在")}}else{Debug.error("组件："+oItem+" 初始化失败，页面内缺少组件的HTML节点")}}catch(e){Debug.error(e.message||"组件："+oItem+" 初始化失败，请确认该组件类是否定义过")}finally{}});Lib.LazyLoad(lazyList,{})};$registJob("articleComp1",function(){var list=[901,102,122];if(Lib.Component.getInitCompSize()===null){Debug.error("无法获得页面内组件的尺寸，请检查页面内输出的组件配置信息是否存在。。。");return}trace("文章页组件渲染列表: "+list.toString());Lib.Component.renderByList(list)});$registJob("articleComp2",function(){var list=[903,904,909,47];if(Lib.Component.getInitCompSize()===null){Debug.error("无法获得页面内组件的尺寸，请检查页面内输出的组件配置信息是否存在。。。");return}trace("文章页组件渲染列表: "+list.toString());Lib.Component.lazyRenderByList(list)});$SYSMSG.extend({1103:"抱歉您所在的IP已经被封了，请稍后再试！",1104:"抱歉您的账号异常，请稍后再试！",1105:"抱歉您的账户昵称不合符规范，<br>请修改后再试！",1106:"发表成功，稍后显示。",1107:"网络繁忙！",2000:"评论内容不能重复！",2004:"涉政地区频次限制",2005:"涉政uid频次限制",2006:"留言板关闭",2100:"发送频率过高，请稍后再试！",4001:"发表成功，稍后显示。",A00111:"抱歉，该文章禁止评论！",A00110:"抱歉，该文章禁止评论！",A00103:"抱歉，您已被对方加入黑名单！"});Ui.Pagination={config:{pageNode:null,nodeClassNamePrefix:"CP",curPage:1,maxPage:1,minPage:1,pageTpl:"@page@.html",type:1,showPrevNext:true,viewSize:5,dotIsPage:false,dotRate:5,showGoto:false,countTpl:"",language:"zh-cn",theme:1,showLastPage:true,showTotal:false},_list:{},_resource:{"en-us":["Pages (@data@): ","Go to First Page","Go to Previous Page (@data@)","Go to Page @data@","Go to Next Page (@data@)","Go to Last Page","Current Page in View"],"zh-cn":["共 @data@ 页","跳转至第一页","跳转至前 @data@ 页","跳转至第 @data@ 页","跳转至后 @data@ 页","跳转至最后一页","当前所在页"]},_template:'<li class="#{class}" title="#{title}">#{link}</li>',init:function(oOption){var node=$E(oOption.pageNode);if(node==null){trace("分页指定的父容器不存在");return}Ui.Pagination._list[node.id]={};var hash=Ui.Pagination._list[node.id];for(var key in this.config){hash[key]=oOption[key]===undefined?this.config[key]:oOption[key]}if(hash.type==2){hash.viewSize=4}hash.minPage=Math.min(hash.minPage,hash.maxPage)*1;hash.maxPage=Math.max(hash.minPage,hash.maxPage)*1;hash.curPage=hash.curPage>hash.maxPage?hash.minPage:hash.curPage;hash.curPage=hash.curPage*1;if(hash.curPage+hash.viewSize>=100){hash.viewSize=3}this._cache_node=hash;return this},show:function(oNode,nCurPage){nCurPage=nCurPage*1;var hash=this._cache_node;if(oNode!=null){this._cache_node=hash=Ui.Pagination._list[oNode.id];hash.curPage=nCurPage}var ambit=[];if(hash.viewSize*2+1>=hash.maxPage){ambit[1]=hash.minPage;ambit[2]=hash.maxPage}else if(hash.curPage<=hash.minPage+hash.viewSize){ambit[1]=hash.minPage;ambit[2]=hash.minPage+(hash.viewSize*2-1);ambit[3]=hash.maxPage}else if(hash.curPage>=hash.maxPage-hash.viewSize){ambit[0]=hash.minPage;ambit[1]=hash.maxPage-(hash.viewSize*2-1);ambit[2]=hash.maxPage}else{ambit[0]=hash.minPage;ambit[1]=hash.curPage-(hash.viewSize-1);ambit[2]=hash.curPage+(hash.viewSize-1);ambit[3]=hash.maxPage}var result=[];if(hash.countTpl!=null){result.push(this._createPage("","","","",hash.countTpl))}if(hash.type!=2&&hash.curPage!=hash.minPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgprev",hash.curPage-1,3,hash.curPage-1,"上页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgprev",hash.curPage-1,3,hash.curPage-1,"< 上一页"))}if(hash.type!=3){if(ambit[0]!=null){var str=ambit[0]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",ambit[0]):this._createPage("",1,1,ambit[0],ambit[0]);result.push(str)}if(hash.type==1&&ambit[0]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}for(var i=ambit[1];i<=ambit[2];i++){if(i==ambit[1]&&i!=hash.minPage&&hash.type==2){var LS=hash.curPage-hash.dotRate;LS=LS<hash.minPage?hash.minPage:LS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,2,hash.curPage-hash.viewSize-1,"..."))}else if(i==ambit[2]&&i!=hash.maxPage&&hash.type==2){var RS=hash.curPage+hash.dotRate;RS=RS>hash.maxPage?hash.maxPage:RS;result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip",hash.viewSize+1,4,hash.curPage+hash.viewSize+1,"..."))}else{str=i==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",1,6,"",i):this._createPage("",i,3,i,i);result.push(str)}}if(hash.type==1&&ambit[3]!=null){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgelip","","","","..."))}if(ambit[3]!=null&&hash.showLastPage){str=ambit[3]==hash.curPage?this._createPage(hash.nodeClassNamePrefix+"_pgon",hash.curPage-1,3,"",ambit[3]):this._createPage("",1,5,ambit[3],ambit[3]);result.push(str)}}else{result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnum","","","","<strong>"+hash.curPage+"</strong>/"+hash.maxPage))}if(hash.type!=2&&hash.curPage!=hash.maxPage){if(hash.type==3)result.push(this._createPage(hash.nodeClassNamePrefix+"_s_pgnext",hash.curPage+1,3,hash.curPage+1,"下页"));else result.push(this._createPage(hash.nodeClassNamePrefix+"_pgnext",hash.curPage+1,3,hash.curPage+1,"下一页 >"))}if(hash.showTotal==true){result.push(this._createPage(hash.nodeClassNamePrefix+"_pgttl","","","","共"+hash.maxPage+"页"))}$E(hash.pageNode).innerHTML='<ul class="'+hash.nodeClassNamePrefix+'_pages">'+result.join("")+"</ul>"},_createPage:function(sClass,sTipPage,nTipIndex,nHrefPage,sHrefText){if(sHrefText==""){return""}var sTitle=sTipPage===""||nTipIndex==""?"":this._getTips(sTipPage,nTipIndex);var sLink=nHrefPage!==""?"<a "+this._getUrl(nHrefPage)+">"+sHrefText+"</a>":sHrefText;return this._template.replace(/(#\{\w+\})/g,function(a,b){switch(b){case"#{class}":return sClass;case"#{title}":return sTitle;case"#{link}":return sLink}})},showPage:function(sParentNodeID,nCurPage){this._cache_node=Ui.Pagination._list[sParentNodeID];var _autoShowPage=this._cache_node.pageTpl(nCurPage);if(_autoShowPage!=false){Ui.Pagination.show($E(sParentNodeID),nCurPage)}},_getUrl:function(idx){if(typeof this._cache_node.pageTpl=="string"){return'href="'+this._cache_node.pageTpl.replace(/@page@/,idx)+'"'}else{return"href=\"javascript:Ui.Pagination.showPage('"+this._cache_node.pageNode+"',"+idx+');"'}},_getTips:function(nPage,nIndex){return this._resource[this._cache_node.language][nIndex].replace(/@data@/g,nPage)}};CommentV2.getConfigInfo=function(config){var reg=/&*([^=]*)=([^&]*)/g,result;var info={};while(result=reg.exec(config)){info[result[1]]=decodeURIComponent(result[2])}return info};Utils.Json={eval:function(str){return eval("("+str+")")},flatten:function(x){var self=Utils.Json;if(x==null)return null;else if(x.constructor.toString()==String)return self.str2json(x);else if(x.constructor.toString()==Array)return self.arr2json(x);else if(x.constructor.toString()==Object)return self.obj2json(x);else if(x.constructor.toString()==Boolean)return self.bool2json(x);else if(x.constructor.toString()==Number)return self.num2json(x);else if(x.constructor.toString()==Date)return self.date2json(x);else return null},arr2json:function(x){var self=Utils.Json;var p=[];var l=x.length;var t;for(var i=0;i<l;++i){t=self.flatten(x[i]);if(t)p.push(t)}return"["+p.join(",")+"]"},obj2json:function(x){var self=Utils.Json;var p=[];var t;for(var i in x){t=self.flatten(x[i]);if(t)p.push(self.flatten(i)+":"+t)}return"{"+p.join(",")+"}"},date2json:function(x){function f(n){return n<10?"0"+n:n}return'"'+x.getFullYear()+"-"+f(x.getMonth()+1)+"-"+f(x.getDate())+"T"+f(x.getHours())+":"+f(x.getMinutes())+":"+f(x.getSeconds())+'"'},stringify:function(jsonObject){var self=Utils.Json;return self.flatten(jsonObject)},parse:function(jsonStr){return Utils.Json.eval(jsonStr)},num2json:function(x){return x?String(x):"0"},bool2json:function(x){return String(x)},str2json:function(x){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(x)){return'"'+x.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c)return c;c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+x+'"'}};CommentV2.List=function(opt){this.containerNode="",this.type="",this.operation="",this.data="",this.page=1,this.total=0,this.url="";this.trim=Core.String.trim;this.jsonUtil=Utils.Json;this.init(opt)}.$define({init:function(opt){trace("super init");this.__merge(opt);this.load(this.page)},__merge:function(opt){for(var index in opt){this[index]=opt[index]}},load:function(page){},render:function(){},bindEvent:function(){var __this=this;if(!scope.commentlistIsBind){this.addEvent(this.containerNode,__this.delegate.bind2(__this),"click");this.onListener()}scope.commentlistIsBind=true},delegate:function(e){trace("CommentV2.CommentList.delegate");e=e||window.event;var tar=e.target||e.srcElement;var node,actionType,type,operation,dataObj;node=this.getTarget(tar,this.containerNode);if(node){actionType=this.getType(node);if(actionType){type=actionType.split("_")[0];operation=actionType.split("_")[1];dataObj=this.str2obj(this.getData(node));if(type=="comment"){var containerNode=$E("comment_"+dataObj.commentid);this[operation]({type:type,operation:operation,articleid:scope.$articleid,data:dataObj,containerNode:containerNode,node:node})}else{var containerNode=$E("reply_"+dataObj.id);this.replyList[dataObj.stair_cms_id][operation]({type:type,operation:operation,articleid:scope.$articleid,data:dataObj,containerNode:containerNode,node:node})}}}},onListener:function(){Lib.Listener.on({name:"commentlist-commentadd",callBack:this.add,scope:this});Lib.Listener.on({name:"reload-cnmt-list",callBack:this.reloadCnmtList,scope:this});Lib.Listener.on({name:"update-total-num",callBack:this.updateTotalNum,scope:this})},updateTotalNum:function(){},removeEvent:function(){trace("CommentV2.CommentList.removeEvent");this.removeEvent(this.containerNode,this.delegate,"click")},toggle:function(){this.isDisplay()?this.hide():this.show()},show:function(){this.containerNode.style.display=""},hide:function(){this.containerNode.style.display="none"},isDisplay:function(){return this.containerNode?this.containerNode.style.display!=="none":false},error:function(code){this.containerNode.innerHTML='<li class="CP_litem"><div class="CP_cmt_none">'+$SYSMSG[code]+"</div></li>"},paging:function(){},add:function(){},del:function(){},reloadCnmtList:function(){},report:function(){},reply:function(){},share:function(){},obj2str:function(obj){return encodeURIComponent(this.jsonUtil.flatten(obj))},str2obj:function(str){return this.jsonUtil.eval(decodeURIComponent(str))},getTarget:function(node,parent){while(node&&node!==parent){if(node.tagName.toLowerCase()=="a"){return node}node=node.parentNode}return null},getType:function(node){return node&&node.getAttribute("action-type")},getData:function(node){return node&&node.getAttribute("action-data")}});Core.Dom.getElementsByAttr=function(node,attname,attvalue){var nodes=[];for(var i=0,l=node.childNodes.length;i<l;i++){if(node.childNodes[i].nodeType==1){if(node.childNodes[i].getAttribute(attname)==attvalue){nodes.push(node.childNodes[i])}if(node.childNodes[i].childNodes.length>0){nodes=nodes.concat(arguments.callee.call(null,node.childNodes[i],attname,attvalue))}}}return nodes};!function(){var utils={},ds=document.selection;utils.selectionStart=function(oElement){if(!ds){try{return oElement.selectionStart}catch(e){return 0}}var er=ds.createRange(),value,len,s=0;var er1=document.body.createTextRange();try{er1.moveToElementText(oElement)}catch(e){}for(s;er1.compareEndPoints("StartToStart",er)<0;s++){er1.moveStart("character",1)}return s};utils.selectionBefore=function(oElement){return oElement.value.slice(0,utils.selectionStart(oElement))};utils.selectText=function(oElement,nStart,nEnd){oElement.focus();if(!ds){oElement.setSelectionRange(nStart,nEnd);return}var c=oElement.createTextRange();c.collapse(1);c.moveStart("character",nStart);c.moveEnd("character",nEnd-nStart);c.select()};utils.insertText=function(oElement,sInsertText,nStart,nLen){oElement.focus();nLen=nLen||0;if(!ds){var text=oElement.value,start=nStart-nLen,end=start+sInsertText.length;oElement.value=text.slice(0,start)+sInsertText+text.slice(nStart,text.length);utils.selectText(oElement,end,end);return}var c=ds.createRange();c.moveStart("character",-nLen);c.text=sInsertText};utils.replaceText=function(oElement,sInsertText){oElement.focus();var text=oElement.value;var selectedText=utils.getSelectedText(oElement);var dl=selectedText.length;if(selectedText.length==0){utils.insertText(oElement,sInsertText,utils.getCursorPos(oElement))}else{var start=utils.getCursorPos(oElement);if(ds){var c=ds.createRange();c.text=sInsertText;utils.setCursor(oElement,start+sInsertText.length)}else{var end=start+selectedText.length;oElement.value=text.slice(0,start)+sInsertText+text.slice(start+dl,text.length);utils.setCursor(oElement,start+sInsertText.length);return}}};utils.getCursorPos=function(obj){var CaretPos=0;if($IE){obj.focus();var range=null;range=ds.createRange();var stored_range=range.duplicate();stored_range.moveToElementText(obj);stored_range.setEndPoint("EndToEnd",range);obj.selectionStartIE=stored_range.text.length-range.text.length;obj.selectionEndIE=obj.selectionStartIE+range.text.length;CaretPos=obj.selectionStartIE}else if(obj.selectionStart||obj.selectionStart=="0"){CaretPos=obj.selectionStart}return CaretPos};utils.getSelectedText=function(obj){var selectedText="";var getSelection=function(e){if(e.selectionStart!=undefined&&e.selectionEnd!=undefined)return e.value.substring(e.selectionStart,e.selectionEnd);else return""};if(window.getSelection){selectedText=getSelection(obj)}else{selectedText=ds.createRange().text}return selectedText};utils.setCursor=function(obj,pos,coverlen){pos=pos==null?obj.value.length:pos;coverlen=coverlen==null?0:coverlen;obj.focus();if(obj.createTextRange){var range=obj.createTextRange();range.move("character",pos);range.moveEnd("character",coverlen);range.select()}else{obj.setSelectionRange(pos,pos+coverlen)}};utils.unCoverInsertText=function(obj,str,pars){pars=pars==null?{}:pars;pars.rcs=pars.rcs==null?obj.value.length:pars.rcs*1;pars.rccl=pars.rccl==null?0:pars.rccl*1;var text=obj.value,fstr=text.slice(0,pars.rcs),lstr=text.slice(pars.rcs+pars.rccl,text==""?0:text.length);obj.value=fstr+str+lstr;this.setCursor(obj,pars.rcs+(str==null?0:str.length))};CommentV2.TextAreaUtils=utils}();window.WEIBOFACEDATA=[{phrase:"[神兽羊驼]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7a/shenshou_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7a/shenshou_thumb.gif",value:"[神兽羊驼]",picid:""},{phrase:"[神马]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/60/horse2_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/60/horse2_thumb.gif",value:"[神马]",picid:""},{phrase:"[浮云]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/bc/fuyun_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]",picid:""},{phrase:"[给力]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c9/geili_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c9/geili_thumb.gif",value:"[给力]",picid:""},{phrase:"[围观]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f2/wg_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f2/wg_thumb.gif",value:"[围观]",picid:""},{phrase:"[威武]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/70/vw_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/70/vw_thumb.gif",value:"[威武]",picid:""},{phrase:"[熊猫]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6e/panda_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6e/panda_thumb.gif",value:"[熊猫]",picid:""},{phrase:"[兔子]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/81/rabbit_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/81/rabbit_thumb.gif",value:"[兔子]",picid:""},{phrase:"[奥特曼]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/bc/otm_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]",picid:""},{phrase:"[囧]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/15/j_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/15/j_thumb.gif",value:"[囧]",picid:""},{phrase:"[互粉]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/89/hufen_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/89/hufen_thumb.gif",value:"[互粉]",picid:""},{phrase:"[礼物]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c4/liwu_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c4/liwu_thumb.gif",value:"[礼物]",picid:""},{phrase:"[呵呵]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/ac/smilea_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]",picid:""},{phrase:"[嘻嘻]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/0b/tootha_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/0b/tootha_thumb.gif",value:"[嘻嘻]",picid:""},{phrase:"[哈哈]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6a/laugh.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6a/laugh.gif",value:"[哈哈]",picid:""},{phrase:"[可爱]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/14/tza_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/14/tza_thumb.gif",value:"[可爱]",picid:""},{phrase:"[可怜]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/af/kl_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/af/kl_thumb.gif",value:"[可怜]",picid:""},{phrase:"[挖鼻屎]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a0/kbsa_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a0/kbsa_thumb.gif",value:"[挖鼻屎]",picid:""},{phrase:"[吃惊]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f4/cj_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f4/cj_thumb.gif",value:"[吃惊]",picid:""},{phrase:"[害羞]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6e/shamea_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6e/shamea_thumb.gif",value:"[害羞]",picid:""},{phrase:"[挤眼]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c3/zy_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c3/zy_thumb.gif",value:"[挤眼]",picid:""},{phrase:"[闭嘴]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/29/bz_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/29/bz_thumb.gif",value:"[闭嘴]",picid:""},{phrase:"[鄙视]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/71/bs2_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/71/bs2_thumb.gif",value:"[鄙视]",picid:""},{phrase:"[爱你]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6d/lovea_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6d/lovea_thumb.gif",value:"[爱你]",picid:""},{phrase:"[泪]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/9d/sada_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/9d/sada_thumb.gif",value:"[泪]",picid:""},{phrase:"[偷笑]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/19/heia_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/19/heia_thumb.gif",value:"[偷笑]",picid:""},{phrase:"[亲亲]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/8f/qq_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/8f/qq_thumb.gif",value:"[亲亲]",picid:""},{phrase:"[生病]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/b6/sb_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/b6/sb_thumb.gif",value:"[生病]",picid:""},{phrase:"[太开心]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/58/mb_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/58/mb_thumb.gif",value:"[太开心]",picid:""},{phrase:"[懒得理你]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/17/ldln_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/17/ldln_thumb.gif",value:"[懒得理你]",picid:""},{phrase:"[右哼哼]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/98/yhh_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/98/yhh_thumb.gif",value:"[右哼哼]",picid:""},{phrase:"[左哼哼]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6d/zhh_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6d/zhh_thumb.gif",value:"[左哼哼]",picid:""},{phrase:"[嘘]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a6/x_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a6/x_thumb.gif",value:"[嘘]",picid:""},{phrase:"[衰]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/af/cry.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/af/cry.gif",value:"[衰]",picid:""},{phrase:"[委屈]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/73/wq_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/73/wq_thumb.gif",value:"[委屈]",picid:""},{phrase:"[吐]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/9e/t_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/9e/t_thumb.gif",value:"[吐]",picid:""},{phrase:"[打哈欠]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f3/k_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f3/k_thumb.gif",value:"[打哈欠]",picid:""},{phrase:"[抱抱]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/27/bba_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/27/bba_thumb.gif",value:"[抱抱]",picid:""},{phrase:"[怒]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7c/angrya_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7c/angrya_thumb.gif",value:"[怒]",picid:""},{phrase:"[疑问]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/5c/yw_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/5c/yw_thumb.gif",value:"[疑问]",picid:""},{phrase:"[馋嘴]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a5/cza_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/a5/cza_thumb.gif",value:"[馋嘴]",picid:""},{phrase:"[拜拜]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/70/88_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/70/88_thumb.gif",value:"[拜拜]",picid:""},{phrase:"[思考]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e9/sk_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e9/sk_thumb.gif",value:"[思考]",picid:""},{phrase:"[汗]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/24/sweata_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/24/sweata_thumb.gif",value:"[汗]",picid:""},{phrase:"[困]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7f/sleepya_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7f/sleepya_thumb.gif",value:"[困]",picid:""},{phrase:"[睡觉]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6b/sleepa_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6b/sleepa_thumb.gif",value:"[睡觉]",picid:""},{phrase:"[钱]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/90/money_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/90/money_thumb.gif",value:"[钱]",picid:""},{phrase:"[失望]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/0c/sw_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/0c/sw_thumb.gif",value:"[失望]",picid:""},{phrase:"[酷]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/cool_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/cool_thumb.gif",value:"[酷]",picid:""},{phrase:"[花心]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/8c/hsa_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/8c/hsa_thumb.gif",value:"[花心]",picid:""},{phrase:"[哼]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/49/hatea_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/49/hatea_thumb.gif",value:"[哼]",picid:""},{phrase:"[鼓掌]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/36/gza_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/36/gza_thumb.gif",value:"[鼓掌]",picid:""},{phrase:"[晕]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d9/dizzya_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d9/dizzya_thumb.gif",value:"[晕]",picid:""},{phrase:"[悲伤]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/1a/bs_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/1a/bs_thumb.gif",value:"[悲伤]",picid:""},{phrase:"[抓狂]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/62/crazya_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/62/crazya_thumb.gif",value:"[抓狂]",picid:""},{phrase:"[黑线]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/91/h_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/91/h_thumb.gif",value:"[黑线]",picid:""},{phrase:"[阴险]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6d/yx_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6d/yx_thumb.gif",value:"[阴险]",picid:""},{phrase:"[怒骂]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/89/nm_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/89/nm_thumb.gif",value:"[怒骂]",picid:""},{phrase:"[心]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/hearta_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/hearta_thumb.gif",value:"[心]",picid:""},{phrase:"[伤心]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/ea/unheart.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/ea/unheart.gif",value:"[伤心]",picid:""},{phrase:"[猪头]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/58/pig.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/58/pig.gif",value:"[猪头]",picid:""},{phrase:"[ok]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d6/ok_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d6/ok_thumb.gif",value:"[ok]",picid:""},{phrase:"[耶]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d9/ye_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d9/ye_thumb.gif",value:"[耶]",picid:""},{phrase:"[good]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d8/good_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d8/good_thumb.gif",value:"[good]",picid:""},{phrase:"[不要]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c7/no_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/c7/no_thumb.gif",value:"[不要]",picid:""},{phrase:"[赞]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d0/z2_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d0/z2_thumb.gif",value:"[赞]",picid:""},{phrase:"[来]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/come_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/40/come_thumb.gif",value:"[来]",picid:""},{phrase:"[弱]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d8/sad_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d8/sad_thumb.gif",value:"[弱]",picid:""},{phrase:"[蜡烛]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/91/lazu_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/91/lazu_thumb.gif",value:"[蜡烛]",picid:""},{phrase:"[钟]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d3/clock_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d3/clock_thumb.gif",value:"[钟]",picid:""},{phrase:"[话筒]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/1b/m_org.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/1b/m_thumb.gif",value:"[话筒]",picid:""},{phrase:"[蛋糕]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6a/cake.gif",hot:false,common:true,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/6a/cake.gif",value:"[蛋糕]",picid:""},{phrase:"[微博益起来]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/95/yiqilai_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/95/yiqilai_thumb.gif",value:"[微博益起来]",picid:""},{phrase:"[微公益爱心]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/11/lxhgongyi_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/11/lxhgongyi_thumb.gif",value:"[微公益爱心]",picid:""},{phrase:"[笑哈哈]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/32/lxhwahaha_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/32/lxhwahaha_thumb.gif",value:"[笑哈哈]",picid:""},{phrase:"[转发]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/02/lxhzhuanfa_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/02/lxhzhuanfa_thumb.gif",value:"[转发]",picid:""},{phrase:"[得意地笑]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d4/lxhdeyidixiao_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/d4/lxhdeyidixiao_thumb.gif",value:"[得意地笑]",picid:""},{phrase:"[moc转发]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/cb/moczhuanfa_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/cb/moczhuanfa_thumb.gif",value:"[moc转发]",picid:""},{phrase:"[劲能样]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f4/jingnengyang_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f4/jingnengyang_thumb.gif",value:"[劲能样]",picid:""},{phrase:"[bm可爱]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/95/bmkeai_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/95/bmkeai_thumb.gif",value:"[bm可爱]",picid:""},{phrase:"[xkl转圈]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f4/xklzhuanquan_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f4/xklzhuanquan_thumb.gif",value:"[xkl转圈]",picid:""},{phrase:"[ppb鼓掌]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7e/ppbguzhang_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/7e/ppbguzhang_thumb.gif",value:"[ppb鼓掌]",picid:""},{phrase:"[din推撞]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/dd/dintuizhuang_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/dd/dintuizhuang_thumb.gif",value:"[din推撞]",picid:""},{phrase:"[xb压力]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e0/xbyali_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/e0/xbyali_thumb.gif",value:"[xb压力]",picid:""},{phrase:"[放假啦]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/37/lxhfangjiale_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/37/lxhfangjiale_thumb.gif",value:"[放假啦]",picid:""},{phrase:"[国旗]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/dc/flag_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/dc/flag_thumb.gif",value:"[国旗]",picid:""},{phrase:"[带着微博去旅行]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f5/weitripballoon_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/f5/weitripballoon_thumb.gif",value:"[带着微博去旅行]",picid:""},{phrase:"[玩去啦]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/92/weitrip_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/92/weitrip_thumb.gif",value:"[玩去啦]",picid:""},{phrase:"[ali哇]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/de/aliwanew_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/de/aliwanew_thumb.gif",value:"[ali哇]",picid:""},{phrase:"[酷库熊顽皮]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/46/kxwanpi_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/46/kxwanpi_thumb.gif",value:"[酷库熊顽皮]",picid:""},{phrase:"[BOBO爱你]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/74/boaini_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/74/boaini_thumb.gif",value:"[BOBO爱你]",picid:""},{phrase:"[偷乐]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/fa/lxhtouxiao_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/fa/lxhtouxiao_thumb.gif",value:"[偷乐]",picid:""},{phrase:"[泪流满面]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/64/lxhtongku_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/64/lxhtongku_thumb.gif",value:"[泪流满面]",picid:""},{phrase:"[lt切克闹]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/73/ltqiekenao_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/73/ltqiekenao_thumb.gif",value:"[lt切克闹]",picid:""},{phrase:"[江南style]",type:"face",url:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/67/gangnamstyle_org.gif",hot:true,common:false,category:"",icon:"http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/67/gangnamstyle_thumb.gif",value:"[江南style]",picid:""}];
if(document.documentElement.contains){Core.Dom.contains=function(oParentNode,oNode){return oParentNode.contains?oParentNode.contains(oNode):true}}else if(document.documentElement.compareDocumentPosition){Core.Dom.contains=function(oParentNode,oNode){return oParentNode===oNode||!!(oParentNode.compareDocumentPosition(oNode)&16)}}else{Core.Dom.contains=function(oParentNode,oNode){while(oNode){if(oParentNode===oNode){return true}oNode=oNode.parentNode}return false}}var Tabs=Core.Class.create();Tabs.prototype={initialize:function(container,option){option=option||{};var className=option.className||"";this.tabsArr=[];this.htmlEle=$C("ul");this.htmlEle.className=className;container.appendChild(this.htmlEle)},add:function(tab){this.tabsArr.push(tab);this.htmlEle.appendChild(tab.element);Core.Events.addEvent(tab.element,Core.Function.bind3(this.swapTags,this,[tab]))},swapTags:function(tab){if(tab.isFocus==false){for(var i=0;i<this.tabsArr.length;i++){this.tabsArr[i].setAbort()}tab.setFocus()}else{return}}};var Tab=Core.Class.create();Tab.prototype={isShow:true,initialize:function(title,option){this.id=Core.Math.getUniqueId();this.option=option||{};var isFocus=option.isFocus||false;this.className=option.className||"";this.focus=option.onfocus?[option.onfocus]:[];this.abotrts=option.onabort?[option.onabort]:[];this.element=$C("li");if(option.cls){this.element.className=option.cls}isFocus?this.setFocus():this.setAbort();this.element.innerHTML=title},setAbort:function(){if(this.isFocus==false){return}if(this.option.cls){this.element.className=this.option.cls}else{this.element.className=""}this.isFocus=false;this.onabort()},setFocus:function(){this.element.className=this.className;this.isFocus=true;this.onfocus()},onabort:function(){for(var i=0;i<this.abotrts.length;i++){this.abotrts[i]()}},onfocus:function(){for(var i=0;i<this.focus.length;i++){this.focus[i]()}},addOnAbort:function(abortFunc){this.abotrts.push(abortFunc)},addOnFocus:function(focusFunc){this.focus.push(focusFunc)},hidden:function(){this.element.style.display="none"},hidden:function(){this.element.style.display="none";this.isShow=false},show:function(){this.element.style.display="block";this.isShow=true}};Lib.register("util.JSON",function(lib){var json=function(wnd,undefined){if(wnd.JSON)return wnd.JSON;var json={parse:function(sJSON){return new Function("return "+sJSON)()},stringify:function(vContent){if(vContent instanceof Object){var sOutput="";if(vContent.constructor===Array){for(var nId=0;nId<vContent.length;sOutput+=this.stringify(vContent[nId])+",",nId++);return"["+sOutput.substr(0,sOutput.length-1)+"]"}if(vContent.toString!==Object.prototype.toString){return'"'+vContent.toString().replace(/"/g,"\\$&")+'"'}for(var sProp in vContent){sOutput+='"'+sProp.replace(/"/g,"\\$&")+'":'+this.stringify(vContent[sProp])+","}return"{"+sOutput.substr(0,sOutput.length-1)+"}"}return typeof vContent==="string"?'"'+vContent.replace(/"/g,"\\$&")+'"':String(vContent)}};return json}(window);return json});CommentV2.FaceDialog=Core.Class.create();CommentV2.FaceDialog.prototype={initialize:function(srcEl,tarea){this._src=srcEl;this._tarea=tarea;this._json=Lib.util.JSON;this.dialog=new Dialog(this._tpl);this.dialogNodes=this.dialog.getNodes();var pos=this.getSrcPos(srcEl);this.faceDatas={};this.generaFaces=[];this.hotFaces=[];this.dialog.setPosition(pos);this.dialog.show();this.initTab();this._bindEvents()},_tpl:['<table class="CP_w" id="#{entity}">',"<thead>","<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong>插入表情</strong><cite><a href="#" id="#{close}"class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="faceItemList" id="#{facelistbox}">','<div class="CP_w_tag" id="#{facetabs}" style="display:none"></div>','<div id="#{general}">','<div class="tab_subsort" id="#{generaltabs}" style="display:none"></div>','<div class="details">','<ul class="face_tp face_lt" id="#{hotFace}"></ul>','<ul class="face_tp" id="#{inner}"></ul>','<div class="SG_page" id="#{page}"><ul id="#{pagelist}" class="SG_pages"></ul></div>',"</div>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),_bindEvents:function(){var _this=this;Core.Events.addEvent(this.dialogNodes.close,function(e){var e=Core.Events.getEvent();Core.Events.stopEvent(e);_this.dialog.hidden()},"click");Core.Events.addEvent(document.body,function(e){var e=Core.Events.getEvent();var target=e.target||e.srcElement;if(!Core.Dom.contains(_this.dialogNodes.entity,target)&&target!=_this._src){_this.dialog.hidden()}},"click");this.bindDelegateAction()},getSrcPos:function(){var srcEl=this._src;var spos=Core.Dom.getXY(srcEl);var height=srcEl.offsetHeight;var pos={};pos.x=spos[0];pos.y=spos[1]+height+5;return pos},show:function(){this.dialog.show()},initTab:function(){this.tab=new Tabs(this.dialogNodes.facetabs,{});highTab=new Tab("<div><em>常用表情</em></div>",{isFocus:true,className:"cur"});highTab.addOnFocus(Core.Function.bind3(this.initGeneralFace,this));this.tab.add(highTab);this.initGeneralFace()},getFaceData:function(fun){if(this.faceDatas.face){return}var _this=this;if(!window.WEIBOFACEDATA){var url="http://i2.api.weibo.com/2/emotions.json?source=1617465124&type=face&language=cnname&callback=jsonpfacedata";window.jsonpfacedata=function(result){if(result.code==1&&result.data){window.WEIBOFACEDATA=result.data;_this.faceDatas.face=_this.formartFaceData(result.data);fun()}};Utils.Io.JsLoad.request(url,{onComplete:function(result){}.bind2(this),charset:"UTF-8"})}else{this.faceDatas.face=_this.formartFaceData(window.WEIBOFACEDATA);fun()}},formartFaceData:function(data){var _data={};for(var i=0,len=data.length;i<len;i++){var item=data[i];if(!item.category){item.category="默认"}if(item.hot){this.hotFaces.push(item)}else{if(_data[item.category]){_data[item.category].push(item)}else{_data[item.category]=[];this.generaFaces.push(item.category);_data[item.category].push(item)}}}return _data},initGeneralFace:function(){this.getFaceData(this.initGeneralTab.bind2(this))},initGeneralTab:function(){var tabs=this.initGeneralTabList();this.initGeneralTabPage(tabs)},initGeneralTabList:function(){var tabs=new Tabs(this.dialogNodes.generaltabs,{});tabs.add=function(tab){this.tabsArr.push(tab);this.htmlEle.appendChild(tab.element);var _this=this;Core.Events.addEvent(tab.element,function(e){var e=Core.Events.getEvent();Core.Events.stopEvent(e);_this.swapTags(tab)})}.bind2(tabs);for(var i=0,len=this.generaFaces.length;i<len;i++){var itme=this.generaFaces[i];var isFocus=false;if(i==0){isFocus=true}var tabitem=new Tab('<a href="#">'+itme+"</a>",{isFocus:isFocus,className:"cur"});tabitem.addOnFocus(Core.Function.bind3(this.showGeneralFaces,this,[itme]));if(i>4){tabitem.hidden()}tabs.add(tabitem);if(i==0){this.showGeneralFaces(itme)}}return tabs},initGeneralTabPage:function(tabs){var _html='<div class="btn_func" ><a href="#" node-type="generalTabPagePre" class="arrow_preview"></a><a href="#" node-type="generalTabPageNext" class="arrow_next"></a></div>';Core.Dom.insertHTML(this.dialogNodes.generaltabs,_html,"BeforeEnd");var pre=Core.Dom.getElementsByAttr(this.dialogNodes.generaltabs,"node-type","generalTabPagePre")[0];var next=Core.Dom.getElementsByAttr(this.dialogNodes.generaltabs,"node-type","generalTabPageNext")[0];var focuspage=1;var step=5;var preTabArr=[];var focusTabArr=tabs.tabsArr.slice(focuspage-1,step);var total=this.generaFaces.length;var remainder=total%step;var totalpage=remainder>0?(total-remainder)/step+1:total/step;Core.Events.addEvent(pre,function(e){var e=Core.Events.getEvent();Core.Events.stopEvent(e);if(focuspage<=1){focuspage=1;return}else{focuspage--}setpage()});Core.Events.addEvent(next,function(e){var e=Core.Events.getEvent();Core.Events.stopEvent(e);if(focuspage>=totalpage){focuspage=totalpage;return}else{focuspage++}setpage()});function setpage(){preTabArr=focusTabArr;focusTabArr=tabs.tabsArr.length>=focuspage*step-1?tabs.tabsArr.slice((focuspage-1)*step,focuspage*step):tabs.tabsArr.slice((focuspage-1)*step);for(var prelen=preTabArr.length-1;prelen>=0;--prelen){var preitem=preTabArr[prelen];preitem.hidden()}for(var focuslen=focusTabArr.length-1;focuslen>=0;--focuslen){var focusitem=focusTabArr[focuslen];focusitem.show()}}},showTheHotFace:function(){if(this.hotFaces){var data=this.hotFaces.slice(0,12);var list=this.setHotFaceList(data)}},memoryFocusTab:function(tabname){this.dialogNodes.generaltabs.setAttribute("data-focustab",tabname)},showGeneralFaces:function(tabname){this.memoryFocusTab(tabname);if(this.faceDatas.face&&this.faceDatas.face[tabname]){if(tabname=="默认"){this.dialogNodes.hotFace.style.display="block"}else{this.dialogNodes.hotFace.style.display="none"}var data=this.faceDatas.face[tabname];this.setGeneralFaceList(data)}},setHotFaceList:function(data){var tpl=this.getFaceItemsTpl(data);this.dialogNodes.hotFace.innerHTML=tpl},setGeneralFaceList:function(data){var page=this.getFaceListPageData(data);this.initFaceListPage(page);this.updateGeneralFaceList(data,page)},updateGeneralFaceList:function(data,page){var data=this.getFaceListData(data,page);var tpl=this.getFaceItemsTpl(data);this.dialogNodes.inner.innerHTML=tpl},getFaceItemsTpl:function(data){var list=[];for(var i=0,len=data.length;i<len;i++){var item=data[i];list.push('<li action-type="insert" action-data="'+item.phrase+'"><img src="'+item.icon+'" alt="'+item.phrase+'" title="'+item.phrase+'"></li>')}return list.join("")},getFaceListPageData:function(data){var page={};page.step=72;page.focus=1;page.total=data.length;page.totalpage=page.total>page.step?page.total%page.step>0?(page.total-page.total%page.step)/page.step+1:page.total/page.step:1;this.dialogNodes.page.setAttribute("data-page",this._json.stringify(page));return page},initFaceListPage:function(page){var pgtpl=[];if(page.totalpage>1){this.dialogNodes.page.style.display="block";for(var i=1;i<=page.totalpage;i++){if(i==page.focus){pgtpl.push('<li class="SG_pgon">'+i+"</li>")}else{pgtpl.push('<li><a href="#" action-type="facePageNums">'+i+"</a></li>")}}this.dialogNodes.pagelist.innerHTML=pgtpl.join("")}else{this.dialogNodes.page.style.display="none"}},getFaceListData:function(data,page){var step=page.step;var total=page.total;var totalpage=page.totalpage;var focus=page.focus;if(focus<1){focus=1}if(focus>totalpage){focus=totalpage}var _data=step<total?data.slice((focus-1)*step,focus*step):data;return _data},bindDelegateAction:function(){Core.Events.addEvent(this.dialogNodes.facelistbox,function(e){insert(e);bindPageEvent(e)});var _this=this;function bindPageEvent(e){var datas=Lib.util.getActionData(e,"facePageNums");if(datas){Core.Events.stopEvent(e);var focus=datas.targetEl.innerHTML;var page=_this._json.parse(_this.dialogNodes.page.getAttribute("data-page"));page.focus=focus-0;_this.dialogNodes.page.setAttribute("data-page",_this._json.stringify(page));_this.initFaceListPage(page);var tabname=_this.dialogNodes.generaltabs.getAttribute("data-focustab");var data=_this.faceDatas.face[tabname];_this.updateGeneralFaceList(data,page)}}function insert(e){var datas=Lib.util.getActionData(e,"insert");if(datas){var text=datas.data;var index=CommentV2.TextAreaUtils.selectionStart(_this._tarea);CommentV2.TextAreaUtils.insertText(_this._tarea,text,index);_this.dialog.hidden()}}Core.Events.addEvent(this.dialogNodes.facelistbox,function(e){hover(e)},"mouseover");function hover(e){var datas=Lib.util.getActionData(e,"insert");if(datas){datas.targetEl.className="hover"}}Core.Events.addEvent(this.dialogNodes.facelistbox,function(e){out(e)},"mouseout");function out(e){var datas=Lib.util.getActionData(e,"insert");if(datas){datas.targetEl.className=""}}}};CommentV2.autoHeightTextArea=function(option){var getStyle=Core.Dom.getStyle;var addEvent=Core.Events.addEvent;function getTextAreaHeight(el){var snapHeight;if(!el.defaultHeight){el.defaultHeight=parseInt(getStyle(el,"height"),10)||parseInt(el.offsetHeight,10)||20}if($IE){var paddingHeight=parseInt(getStyle(el,"paddingTop"),10)+parseInt(getStyle(el,"paddingBottom"),10);snapHeight=Math.max(el.scrollHeight-paddingHeight,el.defaultHeight)}else{var paddingHeight=$MOZ?0:parseInt(getStyle(el,"paddingTop"),10)+parseInt(getStyle(el,"paddingBottom"),10);var textArea=$E("_____textarea_____");if(!textArea){textArea=$C("textarea");textArea.id="_____textarea_____";document.body.appendChild(textArea)}if(textArea.currentTarget!=el){var cssText=[];cssText.push("width:"+getStyle(el,"width"));cssText.push("font-size:"+getStyle(el,"fontSize"));cssText.push("font-family:"+getStyle(el,"fontFamily"));cssText.push("line-height:"+getStyle(el,"lineHeight"));cssText.push("padding-left:"+getStyle(el,"paddingLeft"));cssText.push("padding-right:"+getStyle(el,"paddingRight"));cssText.push("padding-top:"+getStyle(el,"paddingTop"));cssText.push("padding-bottom:"+getStyle(el,"paddingBottom"));cssText.push("top:-1000px");cssText.push("height:0px");cssText.push("position:absolute");cssText.push("overflow:hidden");cssText.push("");cssText=cssText.join(";");textArea.style.cssText=cssText}textArea.value=el.value;snapHeight=Math.max(textArea.scrollHeight-paddingHeight,el.defaultHeight);textArea.currentTarget=el}return snapHeight}function getCssText(el){var snapHeight;var cssText=[];cssText.push("width:"+getStyle(el,"width"));cssText.push("font-size:"+getStyle(el,"fontSize"));cssText.push("font-family:"+getStyle(el,"fontFamily"));cssText.push("line-height:"+getStyle(el,"lineHeight"));cssText.push("padding-left:"+getStyle(el,"paddingLeft"));cssText.push("padding-right:"+getStyle(el,"paddingRight"));cssText.push("padding-top:"+getStyle(el,"paddingTop"));cssText.push("padding-bottom:"+getStyle(el,"paddingBottom"));cssText.push("top:-1000px");cssText.push("height:0px");cssText.push("position:absolute");cssText.push("overflow:hidden");cssText.push("");cssText=cssText.join(";");return cssText}var textArea=option.textArea,maxHeight=option.maxHeight,inputListener=option.inputListener,textStyle=textArea.style,listener;(listener=function(){typeof inputListener==="function"&&inputListener();setTimeout(function(){var nSnapHeight=getTextAreaHeight(textArea)||0,viewHeight;maxHeight=maxHeight||nSnapHeight;var temp=nSnapHeight>maxHeight;viewHeight=temp?maxHeight:nSnapHeight;textStyle.overflowY=temp?"auto":"hidden";textStyle.height=Math.min(maxHeight,nSnapHeight)+"px"},0)})();if(!textArea.binded){addEvent(textArea,listener,"keyup");addEvent(textArea,listener,"focus");addEvent(textArea,listener,"blur");textArea.binded=true;textArea.style.overflow="hidden"}};CommentV2.CommentArea=Core.Class.create();CommentV2.CommentArea.prototype={initialize:function(option){this._container=option.container;this._place=option.place||"BeforeEnd";this._maxtext=(option.maxtext||140)*2;this._sid=option.sid||(new Date).getTime();option.shownum=option.shownum||"yes";this._shownum=option.shownum=="yes"?1:0;option.autolineheight=option.autolineheight||"no";this._autolineheight=option.autolineheight=="no"?0:1;option.alertnotice=option.alertnotice||"yes";this._alertnotice=option.alertnotice=="yes"?1:0;this._maxheight=option.maxheight||100;this._okhandler=option.okhandler||function(){};this._initTareBox();this._initDom();this._bindEvent();this._clock=null},setReplyData:function(plugs,opt){this._plugs=plugs;this._replaydata=opt},setValues:function(option){var value=option.comment;var index=CommentV2.TextAreaUtils.selectionStart(this._tarea);this._tarea.value="";CommentV2.TextAreaUtils.insertText(this._tarea,value,index);CommentV2.TextAreaUtils.setCursor(this._tarea,0);this._checkNum()},getValue:function(){return this._tarea.value},_setTpl:function(argument){this.tpl=['<div id="tare'+this._sid+'">','<div class="count" node-type="num">您还能输入'+this._maxtext/2+"字</div>",'<textarea  node-type="textEl"></textarea>','<div class="func"> <a href="#" class="fico" node-type="faceBtn"></a>','<div class="fr">','<label style="display:none;">','<input node-type="shareIpt" type="checkbox">',"将评论分享到微博 </label>",'<a href="#" class="SG_aBtn btn_reply" node-type="subtnEl"><cite>回复</cite></a></div>',"</div>","</div>"].join("")},_initTareBox:function(){this._setTpl();Core.Dom.insertHTML(this._container,this.tpl,this._place);this._selfcontainer=$E("tare"+this._sid)},_initDom:function(){var container=this._selfcontainer;if(!container){return}this._tarea=Core.Dom.getElementsByAttr(container,"node-type","textEl")[0];this._num=Core.Dom.getElementsByAttr(container,"node-type","num")[0];this._subtn=Core.Dom.getElementsByAttr(container,"node-type","subtnEl")[0];this._facebtn=Core.Dom.getElementsByAttr(container,"node-type","faceBtn")[0];this._shareitp=Core.Dom.getElementsByAttr(container,"node-type","shareIpt")[0];this._shareitp.checked=false;if(!this._shownum){this._num.style.display="none"}},_bindEvent:function(){var _this=this;Core.Events.addEvent(this._shareitp,function(e){if(scope.$PRODUCT_NAME=="blog7"){v7sendLog("32_01_09")}if(scope.$PRODUCT_NAME=="blog7icp"){v7sendLog("32_01_13")}},"click");Core.Events.addEvent(this._tarea,this._checkNum.bind2(this),"keydown");Core.Events.addEvent(this._tarea,function(e){_this._checkNum();var e=Core.Events.getEvent();var target=e.target||e.srcElement;_this._checkValue()},"keyup");Core.Events.addEvent(this._tarea,this._bindKeyEvent.bind2(this),"keydown");Core.Events.addEvent(this._subtn,function(e){var e=Core.Events.getEvent();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}_this._submitForm()},"click");Core.Events.addEvent(this._facebtn,function(e){if(scope.$PRODUCT_NAME=="blog7"){v7sendLog("32_01_11")}if(scope.$PRODUCT_NAME=="blog7icp"){v7sendLog("32_01_15")}var e=Core.Events.getEvent();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}_this._showFacePanel()},"click");if(this._autolineheight){CommentV2.autoHeightTextArea({textArea:this._tarea,maxHeight:this._maxheight,inputListener:function(){trace("--autoHeightTextArea--")}})}},_checkValue:function(){},_checkNum:function(){var num=this._getUnoccupiedNum();if(this._shownum){var showtext=num>=0?"还可以输入"+num+"字":'<em class="red">已超出'+-num+"字</em>";this._num.innerHTML=showtext}},_jsOverflow:function(){var num=this._getUnoccupiedNum();return num<0?true:false},_getUnoccupiedNum:function(){var text=this._tarea.value;var textlen=this._getLen(text);var max=this._maxtext;var num=(max-textlen)%2==0?(max-textlen)/2:(max-textlen-1)/2;return num},_getLen:function(a){if(!a){return 0}var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)},_bindKeyEvent:function(e){if(e.keyCode==13&&e.ctrlKey){this._submitForm()}},_validate:function(){var _this=this;if(Core.String.trim(this._tarea.value)==""){winDialog.alert($SYSMSG["B36041"],{icon:"01",funcOk:function(){_this._tarea.focus()}});return false}if(this._jsOverflow()){winDialog.alert($SYSMSG["B36208"],{icon:"01",funcOk:function(){_this._tarea.focus()}});return false}return true},_submitForm:function(){if(scope.$PRODUCT_NAME=="blog7"){v7sendLog("32_01_10")}if(scope.$PRODUCT_NAME=="blog7icp"){v7sendLog("32_01_14")}if(!this._validate()){return}if(this._plugs){this._replaydata.reply_content=Core.String.trim(this._tarea.value);this._replaydata.is_t=this._shareitp.checked?1:0;this._setShareWbSign();this._plugs.add(this._replaydata,this.successFun.bind2(this),this.errorFun.bind2(this))}},_setShareWbSign:function(){if(this._shareitp){if(this._shareitp.checked){if($E("bb")){$E("bb").checked=true}}else{if($E("bb")){$E("bb").checked=false}}}},successFun:function(data){this._tarea.value="";this._checkNum();var _this=this;if(this._alertnotice){winDialog.alert("发布成功",{icon:"03",funcOk:function(){_this._plugs.sucOkFun&&_this._plugs.sucOkFun()}})}this._okhandler()},errorFun:function(data){if(scope.$PRODUCT_NAME=="blog7"){v7sendLog("32_01_12")}if(scope.$PRODUCT_NAME=="blog7icp"){v7sendLog("32_01_16")}var errorinfo=data?$SYSMSG[data.code]:"发布失败，请稍后再试";winDialog.alert(errorinfo,{icon:"01",funcOk:function(){_this._plugs.errOkFun&&_this._plugs.errOkFun()}})},_showFacePanel:function(){if(!this.facedialog){this.facedialog=new CommentV2.FaceDialog(this._facebtn,this._tarea)}else{this.facedialog.show()}}};!function(){function CutString(string,limit){this.tempDiv=document.createElement("div");this.tempDiv.id="TempNodeForTest";this.tempDiv.innerHTML=string;this.charCount=0;this.limit=limit}CutString.prototype.cut=function(){var newDiv=document.createElement("div");this.searchEnd(this.tempDiv,newDiv);return newDiv.innerHTML};CutString.prototype.searchEnd=function(parseDiv,newParent){var ele;var newEle;for(var j=0;j<parseDiv.childNodes.length;j++){ele=parseDiv.childNodes[j];if(ele.nodeType!=3){newEle=ele.cloneNode(true);newParent.appendChild(newEle);if(ele.childNodes.length===0)continue;newEle.innerHTML="";var res=this.searchEnd(ele,newEle);if(res)return res;else{continue}}if(Core.String.byteLength(ele.nodeValue)+this.charCount>=this.limit){newEle=ele.cloneNode(true);newEle.nodeValue=ele.nodeValue.substr(0,this.limit-this.charCount);newParent.appendChild(newEle);return true}newEle=ele.cloneNode(true);newParent.appendChild(newEle);this.charCount+=Core.String.byteLength(ele.nodeValue)}return false};Core.String.cutHtmlString=function($string,$limit){var output=new CutString($string,$limit);return output.cut()}}();Lib.HtmlTemplate=function(tmpl,uniqueID){this.uniqueID=uniqueID}.$extends(Ui.Template).$define({getHtmlString:function(){if(!this._htmlStr){this._htmlStr=this.evaluate(this.getNodeIds())}return this._htmlStr},getNodeIds:function(){if(!this._nodes){var p=/\{[^\}]+(?=\})/g,i,nodes={},rets,r,uniqueID=this._getUniqueID();this.__templateNodesIDs=this.tmpl.match(p);rets=this.__templateNodesIDs;if(rets){i=rets.length;while(i--){r=rets[i].replace("{","");nodes[r]="_"+uniqueID+"_"+r}}this._nodes=nodes}return this._nodes},getNodeId:function(name){if(!this._nodes){this.getNodeIds()}return this._nodes[name]},getNode:function(name){var id=this.getNodeId(name);return!id?null:$E(id)},_getUniqueID:function(){if(!this.uniqueID){this.uniqueID=parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}return this.uniqueID}});CommentV2.decodeReplyContent=function(str){try{str=decodeURIComponent(str)}catch(e){}var _userContent=str.replace(/\r\n|\n/gi,"###line-return###");_userContent=Core.String.encodeHTML(_userContent);var re=/\[([^\]]*)\]/g;_userContent=_userContent.replace(re,function(matchVal){var result="";for(var i=0;i<WEIBOFACEDATA.length;i++){if(matchVal===WEIBOFACEDATA[i].value){result='<img src="'+WEIBOFACEDATA[i].icon+'" title="'+WEIBOFACEDATA[i].value+'">'}}if(!result){return matchVal}else{return result}});_userContent=_userContent.replace(/###line-return###/gi,"<br/>");return _userContent};CommentV2.needAuthTrueName=function(code){if(code!="1005"){return false}winDialog.confirm("抱歉，您还没有认证实名，<br>请点击确认认证后，继续发表评论！",{icon:"01",funcOk:function(){window.open("https://security.sina.com.cn/account/index?entry=sina_shiming","_blank")}});return true};CommentV2.isAllowSubmit=function(code){if(code==="A00006"||code==="A00102"){return true}winDialog.alert($SYSMSG[code]||$SYSMSG["A00001"]);return false};Utils.Io.Ijax2={request:function(url,option){if(!this.ifrId){this.ifrId=this.initIframe()}var callbackName="iJaxCallback_"+(new Date).getTime();option.POST.callback=callbackName;window[callbackName]=function(data){try{delete window[callbackName]}catch(error){}option.onComplete(data)};this.initForm(url,option)},initIframe:function(){var iframe=$C("iframe");var ifrId="requestIjax_"+(new Date).getTime();iframe.id=ifrId;iframe.name=ifrId;iframe.style.display="none";iframe.className="invisible";document.body.appendChild(iframe);return ifrId},initForm:function(_url,option){var oIjaxForm=$C("form");oIjaxForm.id="IjaxForm2";oIjaxForm.action=_url;oIjaxForm.method="post";oIjaxForm.target=this.ifrId;for(var oItem in option.POST){var value;if(option.noEncode){value=Core.String.encodeDoubleByte(option.POST[oItem])}else{value=option.POST[oItem]}var oInput=$C("input");oInput.type="hidden";oInput.name=oItem;oInput.value=value;oIjaxForm.appendChild(oInput)}document.body.appendChild(oIjaxForm);oIjaxForm.submit()}};CommentV2.Add=function(opt){var opt=opt||{};this.tpl=opt.tpl||"";this.url=opt.url||"";this.type=opt.type||"comment";this.data=opt.data||"";this.jsonUtil=Utils.Json;this.leftB=Core.String.leftB;this.cutHtmlString=Core.String.cutHtmlString;this.loader=new Interface(this.url,"ijax");this.init()}.$define({init:function(){trace("CommentV2.Add.Init");if(!this.tpl){this.tpl=this.getTpl()}Lib.checkAuthor()},post:function(data,sucFn,errFn){var __this=this;if(!$isLogin){(new Lib.Login.Ui).login(function(){scope.blogOpener.showDialog(function(){data.uid=$UID;data.login_name=scope.$loginNick||$nick;__this.post(data,sucFn,errFn)})});return}trace("CommentV2.Add.Post");trace(data);Utils.Io.Ijax2.request("http://comment5.news.sina.com.cn/cmnt/submit",{POST:{channel:"blog",parent:data.id,newsid:data.articleid,content:data.reply_content,usertype:"blogpc",ie:"utf-8",oe:"utf-8",share_url:data.is_t===1?"http://blog.sina.com.cn/s/blog_"+data.articleid+".html":"",ispost:data.is_t===1?1:0},returnType:"json",onComplete:function(_data){if(_data.result.status.code=="20003"||_data.result.status.code=="10013"){winDialog.alert("您还没有开通微博，请先开通，再进行评论同步到微博操作！",{icon:"02"});return}if(!CommentV2.isAllowSubmit(_data.result.blog_code)){return false}if(_data.result.status.code!==0){winDialog.alert("未知错误，请稍后再试!",{icon:"02"});return}if(CommentV2.needAuthTrueName(_data.result.filter_code)){return}switch(_data.result.filter_code){case"1103":case"1104":case"1105":case"1107":case"1106":case"2000":case"2004":case"2005":case"2006":case"2100":case"4001":winDialog.alert($SYSMSG[_data.result.filter_code]);break;case"4000":case"4002":var tmp={stair_cms_id:data.stair_cms_id||data.id,id:_data.result.id,cms_body:data.reply_content,fromProduct:"blog",articleid:data.articleid,source_id:data.id,source_uid:data.comm_uid,source_uname:data.uname,source_ria_index_url:"http://blog.sina.com.cn/u/"+data.comm_uid,comm_uid:$UID,uname:_data.result.user.nick,user_image:"http://portrait3.sinaimg.cn/"+$UID+"/blog/50",ria_index_url:"http://blog.sina.com.cn/u/"+$UID,cms_pubdate:_data.result.time};var item=tmp;item.action_data=__this.obj2str(tmp);var li=__this.render(item,-1,data.cms_reply_num);__this.appendItem(li,item.stair_cms_id);if(sucFn&&typeof sucFn==="function"){sucFn(_data.result)}break;default:winDialog.alert($SYSMSG["A00001"]);break}}.bind2(this),onException:function(){}.bind2(this)})},render:function(item,index,len){var li=$C("li");li.className="SG_j_linedot1";item.vimg=item.vimg?item.vimg:"";item.source_vimg=item.source_vimg?item.source_vimg:"";item.from="";if(item.fromProduct=="weibo"){var weiboImg='<img height="15" align="absmiddle" width="15" class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif">';item.user_from_weibo='来自<a target="_blank" href="'+item.ulink+'">'+weiboImg+item.weibo_uname+"</a>的评论"}if(item.cms_reply_num==0){item.cms_reply_num="("+item.cms_reply_num+")"}else{item.cms_reply_num=item.cms_reply_num?"("+item.cms_reply_num+")":""}item.show_more="none";item.moreInfo="";if(this.type==="comment"){item.cms_body=CommentV2.decodeContent(item.cms_body);item.god_comment=item.god==1?'<span class="god_reply">神评</span>':"";li.id="cmt_"+item.id;if(index===0){li.className=""}if(item.comm_uid==0){item.user_image_place='<img src="'+item.user_image+'">';item.user_nick_place=item.uname}else{item.user_image_place='<a href="'+item.ria_index_url+'" target="_blank"><img src="'+item.user_image+'"></a>';item.user_nick_place='<a href="'+item.ria_index_url+'">'+item.uname+"</a>"}if(item.fromProduct==="blog"){function strip(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||""}var num=this.__getLen(strip(item.cms_body));if(num>280){item.show_more="";item.moreInfo='<div class="SG_revert_Inner SG_txtb" id="body_cmt_full_'+item.id+'" style="display:none;">'+item.cms_body+'<a href="javascript:void(0);" class="btn_artsq" style="display:"";" action-type="comment_more" action-data="'+item.action_data+'"></a>'+"</div>";item.cms_body=this.cutHtmlString(item.cms_body,280)}}}else if(this.type==="reply"){li.id="reply_"+item.id;item.cms_body=CommentV2.decodeReplyContent(item.cms_body);if(len>=1&&index===len-1){li.className=""}if(len==0&&index==-1){li.className=""}if(item.source_uid==0){item.soure_user_info="&nbsp;"+item.source_uname+"&nbsp;："}else{item.soure_user_info='&nbsp;<a href="'+item.source_ria_index_url+'" target="_blank">'+item.source_uname+"</a>"+item.source_vimg+"："}}if($UID&&(item.comm_uid==$UID||scope.$uid==$UID)){item.show_del=""}else{item.show_del="none"}if(item.fromProduct!="qing"){item.show_report=""}else{item.show_report="none"}var severtime=new Date;var commtime=new Date(item.cms_pubdate.replace(/-/g,"/"));item._cms_pubdate=this.dateFormat(severtime,commtime);var htmlStr=new Lib.HtmlTemplate(this.tpl).evaluate(item);li.innerHTML=htmlStr;return li},appendItem:function(node,id){var parent=$E("comment_"+id+"_replylist");parent.insertBefore(node,parent.firstChild);parent.style.display=""},getTpl:function(){if(this.type==="comment"){return'<div class="SG_revert_Left">'+"#{user_image_place}"+"</div>"+'<div class="SG_revert_Cont">'+'<p><span class="SG_revert_Tit">'+"#{user_nick_place}"+"#{god_comment}</span>#{vimg}"+"</p>"+'<div class="SG_revert_Inner SG_txtb" id="body_cmt_#{id}">#{cms_body}'+'<a href="javascript:void(0);" class="btn_artzk" style="display:#{show_more}" action-type="comment_more" action-data="#{action_data}"></a>'+"</div>"+"#{moreInfo}"+'<p class="myReFrom">'+'<em class="SG_txtc">#{_cms_pubdate}</em>#{user_from_weibo}'+'<span class="SG_revert_Func">'+'<a href="javascript:void(0);" class="SG_a_fuc" action-type="comment_report" action-data="#{action_data}" style="display:#{show_report}"><cite>举报</cite></a>'+'<a href="javascript:void(0);" class="SG_a_fuc" action-type="comment_del" action-data="#{action_data}" style="display:#{show_del}">删除</a>'+'<a href="javascript:void(0);" class="SG_a_fuc" action-type="comment_share" action-data="#{action_data}" style="display:#{show_share}"><cite>分享</cite></a>'+'<a href="javascript:void(0);" class="SG_a_fucs" action-type="comment_reply" action-data="#{action_data}" style="display:#{show_reply}"><cite>回复#{cms_reply_num}</cite></a>'+"</span>"+"</p>"+'<div class="SG_reply" id="comment_#{id}" style="display:none;">'+"</div>"+"</div>"}else{return'<div class="img"><a href="#{ria_index_url}" target="_blank"><img src="#{user_image}"></a></div>'+'<div class="txt">'+"<p"+($FF?' style="white-space:pre-wrap;"':' style="white-space:pre-wrap;"')+'><a href="#{ria_index_url}" target="_blank">#{uname}</a>#{vimg}&nbsp;回复'+"#{soure_user_info}"+"#{cms_body}"+"(#{_cms_pubdate})</p>"+"</div>"+'<div class="links">'+'<a href="javascript:void(0);" action-type="reply_report" action-data="#{action_data}" style="display:#{show_report}">举报</a>'+'<a href="javascript:void(0);" action-type="reply_del" action-data="#{action_data}" style="display:#{show_del}">删除</a>'+'<a href="javascript:void(0);" action-type="reply_share" action-data="#{action_data}" style="display:#{show_share}">分享</a>'+'<a href="javascript:void(0);" class="links_s" action-type="reply_reply" action-data="#{action_data}" style="display:#{show_reply}">回复</a>'+"</div>"}},__getLen:function(a){if(!a){return 0}var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)},obj2str:function(obj){return encodeURIComponent(this.jsonUtil.flatten(obj))},str2obj:function(str){return this.jsonUtil.eval(decodeURIComponent(str))},dateFormat:function(dServerTime,dFeedTime){var MTEXT="月";var DTEXT="日";var TODAYTEXT="今天";var BSTEXT="秒前";var BMTEXT="分钟前";var server_year=dServerTime.getFullYear();var feed_year=dFeedTime.getFullYear();var server_month=dServerTime.getMonth()+1;var feed_month=dFeedTime.getMonth()+1;
var server_day=dServerTime.getDate();var feed_day=dFeedTime.getDate();var server_hour=dServerTime.getHours();var feed_hour=dFeedTime.getHours();if(feed_hour<10)feed_hour="0"+feed_hour;feed_hour="&nbsp;"+feed_hour;var feed_minute=dFeedTime.getMinutes();if(feed_minute<10)feed_minute="0"+feed_minute;var diff_time=dServerTime-dFeedTime;diff_time=diff_time>0?diff_time:0;diff_time=diff_time/1e3;if(server_year!=feed_year){return feed_year+"-"+feed_month+"-"+feed_day+" "+feed_hour+":"+feed_minute}else if(server_month!=feed_month||server_day!=feed_day){return feed_month+MTEXT+feed_day+DTEXT+feed_hour+":"+feed_minute}else if(server_hour!=feed_hour&&diff_time>60*60){return TODAYTEXT+feed_hour+":"+feed_minute}else if(diff_time<51){diff_time=diff_time<1?1:diff_time;return Math.floor((diff_time-1)/10)+1+"0"+BSTEXT}else{return Math.floor(diff_time/60+1)+BMTEXT}return""}});Core.Dom.opacity=function(elm,value){elm=typeof elm=="string"?$E(elm):elm;elm.style.filter="alpha(opacity="+value+")";elm.style.opacity=value/100};Ui.Slide=Core.Class.create();Ui.Slide.prototype={node:null,container:null,status:"show",offset:0,onSlideIn:new Function,onSlideOut:new Function,initialize:function(node,options){var options=options||{};this.node=$E(node);this.container=Core.Dom.wrap(this.node,"div");this.container.style.overflow="hidden";this.offset=this.node.offsetHeight;this.opacity=true;this.animation=options.animation||"strongEaseOut";this.duration=options.duration||1;this.container.style.height=this.offset+"px";this.node.style.marginTop="0px"},slideIn:function(opt){opt=opt||{};if(this.opacity){new Ui.tween(this.node,"opacity",1,this.duration,this.animation,{})}new Ui.tween(this.container,"height",this.offset,this.duration,this.animation,opt);new Ui.tween(this.node,"marginTop",0,this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideIn})},slideOut:function(opt){opt=opt||{};if(this.opacity){new Ui.tween(this.node,"opacity",0,this.duration,this.animation,{})}new Ui.tween(this.container,"height",0,this.duration,this.animation,opt);new Ui.tween(this.node,"marginTop",-this.offset,this.duration,this.animation,{end:this.onSlideOut})},show:function(){if(this.opacity){}this.container.style.height=this.offset+"px";this.node.style.marginTop=0+"px"},hide:function(){if(this.opacity){}this.container.style.height=0+"px";this.node.style.marginTop=-this.offset+"px"}};CommentV2.inblack=function(uid,targetUid){new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/deleblackuid.php","jsload").request({GET:{uid:uid,friend_uid:targetUid,inblack:1},onSuccess:function(){},onError:function(res){if(typeof res){if(res.code=="blacklist_full"){winDialog.alert("抱歉！您的黑名单已经满了",{icon:"02"})}else{winDialog.alert($SYSMSG["A00001"]||"系统繁忙，请稍候再试。",{icon:"02"})}}else{}}})};CommentV2.Delete=function(opt){Lib.checkAuthor()}.$define({deleteComment:function(opt,delSucc){trace("CommentV2.CommentDel.deleteComment");var __this=this;var data=opt.data;var styleState="",subText="",title="确认需要删除此条评论？<br/>删除后不可恢复。";if($UID==data.comm_uid||data.comm_uid==0){styleState=' style="display:none" '}if(data.fromProduct!=="qing"){subText="<div "+styleState+'><input id="cbAddToBlock_'+data.commentid+'" type="checkbox"/><label for="cbAddToBlock_'+data.commentid+'">将此人加入黑名单</label></div>'}winDialog.confirm(title,{subText:subText,textOk:"删除",funcOk:function(){var inBlack=styleState===""&&$E("cbAddToBlock_"+data.commentid).checked;Utils.Io.Ajax.request("http://comment5.news.sina.com.cn/api/cmnt/delete",{POST:{channel:"blog",newsid:scope.$articleid,mid:data.id,opertype:$UID==data.comm_uid||data.comm_uid==0?0:1},returnType:"json",onComplete:function(result){if(result.result.status.code!==0){__this.showError();return}if(inBlack){CommentV2.inblack($UID,data.comm_uid)}var node=$E("body_cmt_"+data.commentid).parentNode.parentNode;var slide=new Ui.Slide(node);slide.onSlideOut=function(){Core.Dom.removeNode(node)};slide.slideOut();if(delSucc&&typeof delSucc==="function"){var replyBtn,tmpNode=opt.node,replyNum=0;while(replyBtn=tmpNode.nextSibling){if(replyBtn&&replyBtn.getAttribute("action-type")==="comment_reply"){var _tmpNumStr=replyBtn.innerHTML;if(/\d+/.test(_tmpNumStr)){replyNum=/\d+/.exec(_tmpNumStr)[0]-0}break}else{tmpNode=tmpNode.nextSibling}}delSucc({cms_reply_num:replyNum})}}.bind2(this),onException:function(){__this.showError()}.bind2(this)})}})},deleteReply:function(opt,delSucc){trace("CommentV2.CommentDel.deleteReply");var __this=this;var data=opt.data;var styleState="",subText="",title="确认需要删除此条回复？<br/>删除后不可恢复。";if($UID==data.comm_uid){styleState=' style="display:none" '}if(data.fromProduct!=="qing"){subText="<div "+styleState+'><input id="cbAddToBlock_'+data.id+'" type="checkbox"/><label for="cbAddToBlock_'+data.id+'">将此人加入黑名单</label></div>'}winDialog.confirm(title,{subText:subText,textOk:"删除",funcOk:function(){var inBlack=styleState===""&&$E("cbAddToBlock_"+data.id).checked;Utils.Io.Ajax.request("http://comment5.news.sina.com.cn/api/cmnt/delete",{POST:{channel:"blog",newsid:scope.$articleid,mid:data.id,opertype:$UID==data.comm_uid||data.comm_uid==0?0:1},returnType:"json",onComplete:function(result){if(result.result.status.code!==0){__this.showError();return}if(inBlack){CommentV2.inblack($UID,data.comm_uid)}setTimeout(function(){var node=$E("reply_"+data.id);var slide=new Ui.Slide(node);slide.onSlideOut=function(){Core.Dom.removeNode(node)};slide.slideOut();if(delSucc&&typeof delSucc==="function"){delSucc()}},100)}.bind2(this),onException:function(){__this.showError()}.bind2(this)})}})},showError:function(){winDialog.alert("删除失败，请重试",{icon:"02"})}});Core.String.decodeHTML=function(str){var div=document.createElement("div");div.innerHTML=str;return div.innerText==undefined?div.textContent:div.innerText};Utils.Form.Radio={};Utils.Form.Radio.get=function(radioObj){if(!radioObj)return"";var radioLength=radioObj.length;if(radioLength==undefined)if(radioObj.checked)return radioObj.value;else return"";for(var i=0;i<radioLength;i++){if(radioObj[i].checked){return radioObj[i].value}}return""};Utils.Form.Radio.set=function(radioObj,newValue){if(!radioObj)return;var radioLength=radioObj.length;if(radioLength==undefined){radioObj.checked=radioObj.value==newValue.toString();return}for(var i=0;i<radioLength;i++){radioObj[i].checked=false;if(radioObj[i].value==newValue.toString()){radioObj[i].checked=true}}};scope.reportMainTpl=['<div id="#{entity}" class="blog_report">','<div id="#{titleBar}" class="BRpt_topTit" style="background:url(http://simg.sinajs.cn/blog7style/images/common/report/bg_toptit.gif) no-repeat left top;" >','<a href="#" onclick="return false;" id="#{btnClose}" title=""><img src="http://simg.sinajs.cn/blog7style/images/common/report/icon_clo.gif" /></a>',"</div>",'<div id="#{content}" class="BRpt_mid">',"</div>","</div>"].join("");scope.reportStartTpl=['<div class="BRpt_Mtop" style="background:url(http://simg.sinajs.cn/blog7style/images/common/report/bg_top.gif) no-repeat left top;" >',"<p>新浪博客愿和您一起共同打造健康和谐的网络信息交流平台。并有7×24小时的值班服务，及时有效的处理您的举报。</p>","</div>",'<div class="Brpt_RtConn">','<p id="#{resumeInfo}" class="Brpt_RtInf"></p>','<textarea id="#{resumeContent}" readonly="readonly" class="Brpt_RtTxt"></textarea>','<p class="Brpt_Rhost"><input type="checkbox" id="#{cbBlogHost}" /><label for="#{cbBlogHost}">同时举报博主</label></p>','<div class="clear"></div>','<div class="Brpt_choCla">','<p class="claTit">请选择您举报类别（<span class="cho">必选</span>）：</p>','<p class="cla_conn">','<input id="ero" value="1" type="radio" name="chocla" /><label for="ero">色情</label>','<input id="pol" value="2" type="radio" name="chocla" /><label for="pol">政治</label>','<input id="adv" value="5" type="radio" name="chocla" /><label for="adv">广告</label>','<input id="oth" value="4" type="radio" name="chocla" /><label for="oth">其他</label>',"</p>",'<p>对部分内容(个人侵权、企业侵权等)的举报投诉，请拨打新浪网客服电话4006900000，转人工服务、索取《新浪网删帖申请文档》并提供相关证明材料。<br/><span style="color:red;">新浪网删帖不收取任何费用</span></p>',"</div>",'<p class="Brpt_othInt">您可以填写更多举例说明：</p>','<textarea id="#{reportReason}" class="Brpt_RtTxt"></textarea>',"</div>",'<div class="Brpt_RCBtn">','<a class="BRpt_btnGy" href="#" onclick="return false;" id="#{btnOk}" title=""><span>确认</span></a>','<a class="BRpt_btn" href="#" onclick="return false;" id="#{btnCancel}" title=""><span>取消</span></a>','<div class="clearit"></div>',"</div>"].join("");scope.reportBadTpl=['<div class="BRpt_Mtop" style="background:url(http://simg.sinajs.cn/blog7style/images/common/report/bg_top.gif) no-repeat left top;">',"<p>新浪博客愿和您一起共同打造健康和谐的网络信息交流平台。并有7×24小时的值班服务，及时有效的处理您的举报。</p>","</div>",'<div class="Brpt_exclt">','<p class="Brpt_extP1">您已经成功举报了该信息，工作人员会尽快处理。</p>','<p class="Brpt_extP2">再次感谢您对新浪博客的支持！</p>','<div class="Brpt_extBtn"><a class="BRpt_btn" href="#" onclick="return false;" id="#{btnOk}" title=""><span>确认</span></a><div class="clear"></div></div>',"</div>"].join("");scope.reportSuccessTpl=['<div class="BRpt_Mtop" style="background:url(http://simg.sinajs.cn/blog7style/images/common/report/bg_top.gif) no-repeat left top;">',"<p>新浪博客愿和您一起共同打造健康和谐的网络信息交流平台。并有7×24小时的值班服务，及时有效的处理您的举报。</p>","</div>",'<div class="Brpt_extRst">','<p class="Brpt_eRTit">举报完成！感谢您对我们工作的支持，我们将在24小时内处理。</p>','<div class="Brpt_eRmtd">','<p class="tit">您还可以：</p>','<div class="conn">','<p class="mtd">','<input type="checkbox" id="#{cbCustom}"/>','<label for="#{cbCustom}">我是新浪博客用户，我要接收处理结果</label><span id="#{guestText}">(您还没有登录)</span>',"</p>","</div>",'<div class="conn2">','<p class="mtd"><input type="checkbox" id="#{cbOtherMethod}" /><label for="#{cbOtherMethod}">我要通过其他方式接收处理结果</label></p>','<div id="#{userForm}" style="display:none;">','<p class="perInf"><span>您的姓名：</span><input id="#{userName}" type="text" /></p>','<p class="perInf"><span>您的邮箱：</span><input id="#{userEmail}" type="text" /></p>','<p class="perInf"><span>您的电话：</span><input id="#{userTel}" type="text" /></p>',"</div>","</div>","</div>",'<div class="Brpt_eRBtn"><a class="BRpt_btnGy" href="#" onclick="return false;" id="#{btnOk}" title=""><span>确认</span></a><div class="clear"></div></div>'].join("");scope.reportFinishedTpl=['<div class="BRpt_Mtop" style="background:url(http://simg.sinajs.cn/blog7style/images/common/report/bg_top.gif) no-repeat left top;">',"<p>新浪博客愿和您一起共同打造健康和谐的网络信息交流平台。并有7×24小时的值班服务，及时有效的处理您的举报。</p>","</div>",'<div class="Brpt_thx">',"<p>再次感谢您对新浪博客举报的大力支持！</p>",'<div class="Brpt_thxBtn"><a class="BRpt_btnGy" href="#" onclick="return false;" id="#{btnCancel}" title=""><span>关闭</span></a></div>',"</div>"].join("");scope.GeneralReport=Core.Class.create();scope.GeneralReport.prototype={type:"",_hashType:{comment:{"class":"2",initFunction:null},blog:{"class":"1",initFunction:null},guestBook:{"class":"3",initFunction:null},friend:{"class":"4",initFunction:null},photoComment:{"class":"5",initFunction:null},paperlist:{"class":"6",initFunction:null}},dataInterface:null,canSubmit:true,bodyID:"",reportUID:"",userNameInfo1:"",userNameInfo2:"",titleInfo:"",nickName:"",contentInfo:"",tUID:"",_isInitDialog:false,_dialog:null,initialize:function(){this.dataInterface=new Interface("http://control.blog.sina.com.cn/admin/advice/impeach_post_content.php?version=7","ijax");this._hashType["comment"]["initFunction"]=this._commentInit;this._hashType["blog"]["initFunction"]=this._blogInit;this._hashType["guestBook"]["initFunction"]=this._guestBookInit;this._hashType["friend"]["initFunction"]=this._friendInit;this._hashType["photoComment"]["initFunction"]=this._photoCommentInit;this._hashType["paperlist"]["initFunction"]=this._paperlistInit},show:function(){!this._isInitDialog&&this._initDialog();this._dialog.setAreaLocked(true);this._dialog.setMiddle();this._dialog.show();this._isInitDialog=true;this._hashType[this.type]["initFunction"].call(this)},hidden:function(){this._dialog.hidden()},clear:function(){var nd=this._dialog.nodes;nd.resumeInfo.innerHTML="";nd.resumeContent.value="";nd.cbBlogHost.checked=false;Utils.Form.Radio.set($N("chocla"),"");nd.reportReason.value=""},submit:function(){var me=this;if(this.type==="comment"){Utils.Io.Ijax2.request("http://comment5.news.sina.com.cn/cmnt/submit",{POST:{channel:"feedback",newsid:2,content:"channel=blog&newsid="+/[^_]*/.exec(me.bodyID)[0]+"&"+"mid="+/_(.*)/.exec(me.bodyID)[1]+"&"+"type="+Utils.Form.Radio.get($N("chocla"))+"&"+"fnickname="+me.nickName+"&"+"body_id="+me.bodyID+"&"+"fuid="+me.reportUID+"&"+"tuid="+me.tUID+"&"+"is_report="+me._dialog.nodes["cbBlogHost"].checked+"&"+"content="+me._dialog.nodes["reportReason"].value,usertype:"blogpc",ie:"utf-8",oe:"utf-8"},returnType:"json",onComplete:function(_data){me.canSubmit=true;if(_data.result.filter_code=="1005"){me.hidden();CommentV2.needAuthTrueName(_data.result.filter_code);return}if(_data.result.status.code!==0){me.onError();return}me.onSuccessed()},onException:function(){me.canSubmit=true;me.onError()}});return}this.dataInterface.request({POST:{body_id:me.bodyID,"class":me._hashType[me.type]["class"],type:Utils.Form.Radio.get($N("chocla")),fnickname:me.nickName,fuid:me.reportUID,tuid:me.tUID,reason:me._dialog.nodes["reportReason"].value,is_report:me._dialog.nodes["cbBlogHost"].checked},onSuccess:function(data){me.canSubmit=true;me.onSuccessed(data)},onError:function(err){me.canSubmit=true;me.onError(err)},onFail:function(){me.canSubmit=true}})},_initDialog:function(){this._dialog=winDialog.createCustomsDialog({tpl:scope.reportMainTpl,content:scope.reportStartTpl});var me=this,nd=this._dialog.nodes;Core.Events.addEvent(nd.btnOk,function(){if(me.canSubmit){me.canSubmit=false;me.submit()}},"click");Core.Events.addEvent(nd.btnCancel,function(){me._dialog.hidden();me.clear()},"click");Core.Events.addEvent(nd.btnClose,function(){me.clear()},"click");Utils.Form.limitMaxLen(nd.reportReason,400)},_commentInit:function(){this._dialog.nodes["resumeInfo"].innerHTML="您要举报的是"+this.userNameInfo1+"在博文"+this.titleInfo+"中发表的评论，摘要如下：";this._dialog.nodes["resumeContent"].value=this.contentInfo;this._dialog.nodes["cbBlogHost"].checked=false},_blogInit:function(){this._dialog.nodes["resumeInfo"].innerHTML="您要举报的是"+this.userNameInfo1+"发表的"+this.titleInfo+"，摘要如下：";this._dialog.nodes["resumeContent"].value=this.contentInfo;this._dialog.nodes["cbBlogHost"].checked=false},_guestBookInit:function(){this._dialog.nodes["resumeInfo"].innerHTML="您要举报的是"+this.userNameInfo1+"在"+this.userNameInfo2+"博客的留言，摘要如下：";this._dialog.nodes["resumeContent"].value=this.contentInfo;this._dialog.nodes["cbBlogHost"].checked=false},_friendInit:function(){this._dialog.nodes["resumeInfo"].innerHTML="您要举报的是"+this.userNameInfo1+"给您发的好友申请，摘要如下：";this._dialog.nodes["resumeContent"].value=this.contentInfo;this._dialog.nodes["cbBlogHost"].checked=true},_photoCommentInit:function(){this._dialog.nodes["resumeInfo"].innerHTML="您要举报的是"+this.userNameInfo1+"在图片"+this.titleInfo+"中发表的评论，摘要如下：";this._dialog.nodes["resumeContent"].value=this.contentInfo;this._dialog.nodes["cbBlogHost"].checked=false},_paperlistInit:function(){this._dialog.nodes["resumeInfo"].innerHTML="您要举报的是"+this.userNameInfo1+"给您发送的纸条，摘要如下：";this._dialog.nodes["resumeContent"].value=this.contentInfo;this._dialog.nodes["cbBlogHost"].checked=false},onSuccessed:function(data){},onError:function(err){}};Utils.Form.inputListen=function(el,nLen,oOption){el=$E(el);if(typeof nLen!="undefined"){nLen=isNaN(nLen)?null:nLen*1}if(el==null||nLen==null||el.nodeType!=1){return false}oOption=oOption||{};var limitRe=oOption.limitRe;var doubleByte=oOption.doubleByte;doubleByte=doubleByte==null?true:doubleByte;var userinput=function(){try{var evt=Core.Events.getEvent();if(evt){var keyCode=evt.which||evt.keyCode;if(keyCode==37||keyCode==39){return false}}}catch(e){}var nLength=el.max;while(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}if(doubleByte==true){if(Core.String.byteLength(el.value)>nLength){var str=el.value.substr(0,nLength);while(Core.String.byteLength(str)>nLength){str=str.replace(/.$/,"")}el.value=str;el.maxLength=str.length}else{el.maxLength=nLength-el.value.replace(/[\x00-\xff]/g,"").length}}else{el.maxLength=nLength}if(nLength<el.value){el.value=el.value.substr(0,nLength)}};var Blur=function(){if(limitRe!=null&&limitRe.test(el.value)){el.value=el.value.replace(limitRe,"")}};el.max=nLen;el.maxLength=nLen;userinput();if(el.beWatched==null){el.beWatched=true;if(!$IE){Core.Events.addEvent(el,userinput,"input")}else{Core.Events.addEvent(el,userinput,"keyup");Core.Events.addEvent(el,userinput,"keypress");Core.Events.addEvent(el,userinput,"mouseout")}Core.Events.addEvent(el,Blur,"blur")}};scope.SuccessedReport=Core.Class.create();scope.SuccessedReport.prototype={loginUI:null,_isInitDialog:false,canSubmit:true,dataInterface:null,dataID:"",bodyID:"",userInfo:{nickName:""},initialize:function(){this.dataInterface=new Interface("http://control.blog.sina.com.cn/admin/advice/impeach_post_userinfo.php?version=7","ijax");this.loginUI=new Lib.Login.Ui},show:function(){!this._isInitDialog&&this._initDialog();this._dialog.setAreaLocked(true);this._dialog.setMiddle();this._dialog.show();this._isInitDialog=true},displayUserInfo:function(state){this._dialog.nodes["userForm"].style.display=state===false?"none":""},login:function(){var me=this;this.loginUI.login(function(){me.submit()})},clear:function(){var nd=this._dialog.nodes;nd.cbCustom.checked=false;nd.cbOtherMethod.checked=false;nd.userForm.style.display="none";nd.userName.value="";nd.userEmail.value="";nd.userTel.value=""},hidden:function(){this._dialog.hidden()},submit:function(){var me=this,nd=this._dialog.nodes;Lib.checkAuthor(function(){me.canSubmit=false;me.dataInterface.request({POST:{id:me.dataID,body_id:me.bodyID,nickname:typeof $nick=="undefined"?"":$nick,name:nd.userName.value,email:nd.userEmail.value,phone:nd.userTel.value,uid:$UID,is_login:nd.cbCustom.checked?"1":"0"},onSuccess:function(data){me.canSubmit=true;me.onSuccessed(data)},onError:function(err){me.canSubmit=true;me.onError(err)},onFail:function(){me.canSubmit=true}})},"SuccessedReport"+(new Date).getTime())},_initDialog:function(){this._dialog=winDialog.createCustomsDialog({tpl:scope.reportMainTpl,content:scope.reportSuccessTpl});var me=this,nd=this._dialog.nodes;this._dialog.addEventListener("hidden",function(){me.clear()});Lib.checkAuthor(function(){nd.guestText.style.display=$isLogin?"none":""},"SuccessedReport"+(new Date).getTime());Core.Events.addEvent(nd.btnOk,function(){if(me.canSubmit){Lib.checkAuthor(function(){if(!$isLogin&&nd.cbCustom.checked){me.login()}else{me.submit()}},"SuccessedReport"+(new Date).getTime())}},"click");Core.Events.addEvent(nd.cbOtherMethod,function(){me.displayUserInfo(nd.cbOtherMethod.checked)},"click");Utils.Form.inputListen(nd.userName,100);Utils.Form.inputListen(nd.userEmail,200);Utils.Form.inputListen(nd.userTel,100)},onSuccessed:function(data){},onError:function(err){}};$SYSMSG.extend({B04102:"您输入的电子邮件格式错误，请重新输入",B04105:"很抱歉，您输入的内容过多，请删减后重新提交",B04107:"您要举报的内容已经不存在，感谢您的支持",B04108:"举报分类错误",B04109:"您还没有选择举报类别，请选择后继续操作",B04110:"您的昵称为空，请输入后继续操作",B04111:"系统繁忙，请稍后再试",B04112:"您已经举报过该用户，再次感谢您的支持",B04113:"系统繁忙，请稍后再试",B04114:"系统繁忙，请稍后再试",B04115:"系统繁忙，请稍后再试",B04116:"系统繁忙，请稍后再试"});Lib.BlogReport=Core.Class.create();Lib.BlogReport.prototype={generalReport:null,successedReport:null,badReport:null,finishedReport:null,isBRInit:false,isFRInit:false,initialize:function(){this.generalReport=new scope.GeneralReport;this.successedReport=new scope.SuccessedReport},start:function(type,nickName,bodyID,reportUID,userNameInfo1,userNameInfo2,titleInfo,contentInfo,tUID){var me=this,gr=this.generalReport;contentInfo=Core.String.decodeHTML(contentInfo);gr.nickName=nickName;gr.type=type;gr.reportUID=reportUID;gr.userNameInfo1=userNameInfo1;gr.userNameInfo2=userNameInfo2;gr.titleInfo=titleInfo;gr.contentInfo=Core.String.byteLength(contentInfo)>800?Core.String.shorten(contentInfo,800):contentInfo;gr.bodyID=bodyID;gr.tUID=tUID?tUID:"";gr.onSuccessed=function(data){if(gr.type==="comment"){this.hidden();me.finished();return}me.reportSuccess(nickName,bodyID,data["dataID"]);this.hidden()};gr.onError=function(err){if(err["code"]==="B04112"){me.showBad();this.hidden()}else{winDialog.alert($SYSMSG[err["code"]])}};gr.show()},showBad:function(){var me=this;if(!this.isBRInit){this.badReport=winDialog.createCustomsDialog({tpl:scope.reportMainTpl,content:scope.reportBadTpl});Core.Events.addEvent(this.badReport.nodes["btnOk"],function(){me.badReport.hidden()},"click")}this.badReport.setAreaLocked(true);this.badReport.setMiddle();this.badReport.show()},reportSuccess:function(nickName,bodyID,dataID){var me=this,sr=this.successedReport;sr.bodyID=bodyID;sr.dataID=dataID;sr.userInfo.nickName=nickName;sr.onSuccessed=function(data){me.finished();this.hidden()};sr.onError=function(err){winDialog.alert($SYSMSG[err["code"]])};sr.show()},finished:function(){var me=this;if(!this.isFRInit){this.finishedReport=winDialog.createCustomsDialog({tpl:scope.reportMainTpl,content:scope.reportFinishedTpl});Core.Events.addEvent(this.finishedReport.nodes["btnCancel"],function(){me.finishedReport.hidden()},"click")}this.finishedReport.setAreaLocked(true);this.finishedReport.setMiddle();this.finishedReport.show()}};CommentV2.decodeContent=function(str,type){try{str=decodeURIComponent(str)}catch(e){}var imgPath="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/";if(type=="god"){imgPath="http://simg.sinajs.cn/blog7style/images/common/godreply/"}var _userContent=str.replace(/\r\n|\n/gi,"###line-return###").replace(/\\n/g,"###line-return###");_userContent=Core.String.encodeHTML(_userContent);var _re=/\[emoticons=(E___\w*)\]([^[]*)\[\/emoticons\]/gi;var _html='<img src="'+imgPath+'$1T.gif" style="margin:1px;" border="0" title="$2" />';_userContent=_userContent.replace(_re,_html);var _magicReg=/\[magicemoticons=([E|W]___\w*)\&nbsp\;swfname=(\w+\.swf)\]([^[]*)\[\/magicemoticons\]/gi;var _magichtml='<img src="'+imgPath+'$1T.gif" style="margin:1px;" border="0" title="$3" width="50" height="50"/>';_userContent=_userContent.replace(_magicReg,_magichtml);_userContent=_userContent.replace(/###line-return###/gi,"<br/>");return _userContent};CommentV2.Report=function(){this.BR=new Lib.BlogReport}.$define({commentReport:function(data){trace("CommentV2.Report.commentReport");var param={cms_id:data.commentid,uid:data.src_uid,decode:CommentV2.decodeContent};this.setReport(data,param)},showError:function(){winDialog.alert($SYSMSG["A00001"],{icon:"01"})},replyReport:function(data){trace("CommentV2.Report.replyReport");var param={cms_id:data.id,uid:data.source_uid,decode:CommentV2.decodeReplyContent};this.setReport(data,param)},setReport:function(data,param){var __this=this;var bID=scope.$articleid,cID=param.cms_id,bodyID=bID+"_"+cID,nickName=data.uname,reportUID=param.cms_id,userNameInfo1="",userNameInfo2="",titleInfo='<a target="_blank" href="http://blog.sina.com.cn/s/blog_'+bID+'.html">'+$E("t_"+bID).innerHTML+"</a>";data.ulink=data.ulink?data.ulink:"http://blog.sina.com.cn/u/"+data.comm_uid;if(data.comm_uid!=0){userNameInfo1='<a href="'+data.ulink+'" target="_blank">'+nickName+"</a>"}else{userNameInfo1="<strong>"+nickName+"</strong>"}Utils.Io.JsLoad.request("http://comment5.news.sina.com.cn/cmnt/info",{GET:{channel:"blog",newsid:data.articleid,mid:param.cms_id,_:(new Date).getTime(),callback:"reportComment",varname:"reportComment",ie:"utf-8",oe:"utf-8"},returnType:"jsonp",onComplete:function(_data){if(_data.result.status.code!==0){this.showError();return}var contentInfo=param.decode(_data.result.cmntlist[param.cms_id].content);__this.BR.start("comment",nickName,bodyID,reportUID,userNameInfo1,userNameInfo2||"举报",titleInfo,contentInfo)}.bind2(this),onException:function(){this.showError()}.bind2(this)})}});CommentV2.Share=function(){trace("CommentV2.Share");this.shorten=Core.String.shorten;this.getInterface=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/getCms.php","jsload");this.getWeiboNameInterface=new Interface("http://i2.api.weibo.com/2/users/show.json","jsload")}.$define({commentShare:function(data){var __this=this;this.data=data||{};this.__commentShare()},replyShare:function(data){var __this=this;this.data=data||{};this.type="reply";var cms_id=this.data.id;this.__getCmsBody(cms_id,$UID,data.articleid)},__getCmsBody:function(cms_id,uid,articleid){var __this=this;var param={cms_id:cms_id,uid:uid,origin:1,article_id:articleid};this.getInterface.request({GET:param,onSuccess:__this.__getWeiboName.bind2(__this),onError:function(_data){},onFail:function(){}})},__getWeiboName:function(result){var __this=this;this.body=result.cms_body;this.uid=result.uid;this.src_title=result.src_title;window.jsonpweiboname=function(res){if(res.code==1&&res.data){__this.name=encodeURIComponent("@"+res.data.name)}else{__this.name=encodeURIComponent(" "+__this.data.uname)||""}__this.__share()};var param={uid:this.uid,source:"1617465124",callback:"jsonpweiboname"};this.getWeiboNameInterface.request({GET:param,onSuccess:function(){},onError:function(){},onFail:function(){}})},__share:function(){var body=this.body;if(this.type==="comment"){if(this.data.fromProduct==="blog"){var _re=/\[emoticons=(E___\w*)\]([^[]*)\[\/emoticons\]/gi;var _magicReg=/\[magicemoticons=([E|W]___\w*)\&nbsp\;swfname=(\w+\.swf)\]([^[]*)\[\/magicemoticons\]/gi;body=body.replace(_re,"[$2]");body=body.replace(_magicReg,"[$3]")}else{var _weiboReg=/<img\s[\S]*\salt=[\]["][^-]*[-]?([\S]*)[\]["]\s?[\][\/]>/gi;body=body.replace(_weiboReg,"[$1]")}}body=encodeURIComponent(this.shorten(body,100));var url=encodeURIComponent(location.href);var blogTitle=encodeURIComponent(this.src_title)||encodeURIComponent($E("t_"+scope.$articleid).innerHTML);var content="分享"+this.name+" 对博文【"+blogTitle+"】的评论："+body+" 查看原文：";var title=encodeURIComponent(content);var f="http://v.t.sina.com.cn/share/share.php?",r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"selectionshare","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2)},__commentShare:function(){var title=$E("t_"+scope.$articleid).innerHTML;title=title.replace(/\&nbsp\;/g," ");var cms_id=this.data.commentid;var bodyNode=$E("body_cmt_"+cms_id);var body,name;if(typeof bodyNode.innerText==="string"){body=bodyNode.innerText}else{body=bodyNode.textContent}if(this.data.fromProduct==="blog"){var _re=/\[emoticons=(E___\w*)\]([^[]*)\[\/emoticons\]/gi;var _magicReg=/\[magicemoticons=([E|W]___\w*)\&nbsp\;swfname=(\w+\.swf)\]([^[]*)\[\/magicemoticons\]/gi;body=body.replace(_re,"[$2]");body=body.replace(_magicReg,"[$3]");name=" "+this.data.uname}else{var _weiboReg=/<img\s[\S]*\salt=[\]["][^-]*[-]?([\S]*)[\]["]\s?[\][\/]>/gi;body=body.replace(_weiboReg,"[$1]");name="@"+this.data.uname}body=this.shorten(body,100);title=this.shorten(title,60);var content="分享"+name+" 对博文【"+title+"】的评论："+body+" 查看原文：";var t=encodeURIComponent(content),r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+t+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"selectionshare","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2)}});CommentV2.ReplyList=function(opt){this.type="reply";this.cmtAdd=new CommentV2.Add({type:this.type,url:"http://control.blog.sina.com.cn/admin/comment_new/cms_usereply_post.php?domain=2",tpl:opt.replyTpl||""});this.ownerNickName=opt.data.ownerNickName||"";this.cmtDel=new CommentV2.Delete;this.cmtReport=new CommentV2.Report;this.cmtShare=new CommentV2.Share;this._openAreas={}}.$extends(CommentV2.List).$define({load:function(page){var __this=this;this.initContainerAndTextArea();this.show();if(this.data.cms_reply_num==0){return}this.showLoading();setTimeout(function(){__this.renderList(__this.subReplyList)},300)},render:function(result){this.renderList(result)},initContainerAndTextArea:function(argument){if(this.containerIsReady){return}var str='<div class="SG_reply_con borderc">'+'<div class="bd">'+'<div id="comment_'+this.data.commentid+'_textarea">'+"</div>"+'<div class="reply_list">'+'<ul id="comment_'+this.data.commentid+'_replylist" style="display:none;">'+"</ul>"+"</div>"+'<div class="rp2" id="loading_'+this.data.commentid+'" style="display:none"><div class="SG_reply_con"><div class="bd"><div class="loading"><span class="ico_loading"></span><p>正在加载，请稍后...</p></div></div></div></div>'+'<div class="SG_page" style="display:none;">'+'<ul class="SG_pages" id="comment_'+this.data.commentid+'_pages">'+"</ul>"+"</div>"+"</div>"+"</div>";this.containerNode.innerHTML=str;this.renderTextArea();this.containerIsReady=1},renderTextArea:function(){var commentArea=new CommentV2.CommentArea({container:$E("comment_"+this.data.commentid+"_textarea")});var item=this.data;var ownernickEl=$E("ownernick");var ownernickname=ownernickEl?this.trim(ownernickEl.innerHTML):"";commentArea.setReplyData(this,{stair_cms_id:item.id,id:item.id,articleid:item.articleid,source_id:item.id,blog_title:$E("t_"+item.articleid)?this.trim($E("t_"+item.articleid).innerHTML):"",comm_uid:item.comm_uid,uname:item.uname,is_t:0})},renderList:function(resultData){var _this=this;var oFragment=document.createDocumentFragment();var li;_this.hideLoading();var len=resultData.length;for(var i=0;i<len;i++){var item=resultData[i];item.action_data=_this.obj2str({stair_cms_id:item.stair_cms_id,id:item.id,fromProduct:item.fromProduct,articleid:item.articleid,source_id:item.source_id,source_uid:item.source_uid,source_uname:item.source_uname,source_ria_index_url:item.source_ria_index_url,comm_uid:item.comm_uid,uname:item.uname,user_image:item.user_image,ria_index_url:item.ria_index_url,cms_pubdate:item.cms_pubdate});li=_this.cmtAdd.render(item,i,len);oFragment.appendChild(li)}$E("comment_"+_this.data.commentid+"_replylist").appendChild(oFragment);$E("comment_"+_this.data.commentid+"_replylist").style.display="";location.hash="cmt_"+_this.data.commentid},show:function(){CommentV2.ReplyList.$super.show.call(this);v7sendLog("32_01_01");var strHtml=this.node.innerHTML;strHtml=strHtml.replace(/回复|取消回复/,"取消回复");this.node.innerHTML=strHtml},hide:function(){CommentV2.ReplyList.$super.hide.call(this);v7sendLog("32_01_02");var strHtml=this.node.innerHTML;strHtml=strHtml.replace("取消","");this.node.innerHTML=strHtml},showLoading:function(){$E("comment_"+this.data.commentid+"_replylist").innerHTML="";$E("loading_"+this.data.commentid).style.display=""},hideLoading:function(){$E("loading_"+this.data.commentid).style.display="none"},paging:function(){var __this=this;var paging=$E("comment_"+this.data.commentid+"_pages");if(paging){var perpage=20,pages=0;if(this.total%perpage==0){pages=Math.ceil(this.total/perpage)}else{pages=Math.floor(this.total/perpage)+1}if(this.total>perpage){paging.parentNode.style.display="block";paging.style.display="block";Ui.Pagination.init({pageNode:"comment_"+__this.data.commentid+"_pages",nodeClassNamePrefix:"SG",curPage:this.page,maxPage:pages,pageTpl:function(page){__this.load(page);location.hash=""}}).show()}else{paging.parentNode.style.display="none"}}},setSrcComment:function(id,uid,commentArea){Utils.Io.JsLoad.request("http://comment5.news.sina.com.cn/cmnt/info",{returnType:"jsonp",GET:{channel:"blog",newsid:scope.$articleid,mid:id,ie:"utf-8",oe:"utf-8",callback:"getSingleCnmt",_:(new Date).getTime()},onComplete:function(data){var cnmtInfo=data.result.cmntlist[id];var cms_body=cnmtInfo.content;var configInfo=CommentV2.getConfigInfo(cnmtInfo.config);var nick_name=scope.$loginNick||scope.nickname||$UID;var source_uname=configInfo.wb_screen_name||cnmtInfo.nick;if(cms_body){var comment="//@"+nick_name+" 回复 @"+source_uname+" :"+cms_body;commentArea.setValues({comment:comment})}}.bind2(this),onException:function(){}.bind2(this)})},reply:function(opt){var __this=this;if(!opt.containerNode.isInited){v7sendLog("32_01_05");opt.node.innerHTML="<cite>取消回复</cite>";
var str='<div class="SG_reply_con">'+'<div class="bd" id="reply_'+opt.data.id+'_textarea">'+"</div>"+"</div>";var div=document.createElement("div");div.className="SG_reply borderc rp2";div.innerHTML=str;div.id="reply_"+opt.data.id+"_textcon";opt.containerNode.appendChild(div);opt.containerNode.isInited=true;var replyArea=$E("reply_"+opt.data.id+"_textarea");var item=opt.data;this._openAreas[opt.data.id]=new CommentV2.CommentArea({container:replyArea,autolineheight:"yes",sid:(new Date).getTime(),shownum:"no",okhandler:function(){var replyCon=$E("reply_"+opt.data.id+"_textcon");if(replyCon){replyCon.style.display="none";opt.node.innerHTML="<cite>回复</cite>"}}});this._openAreas[opt.data.id].setReplyData(__this,{id:opt.data.id,articleid:opt.data.articleid,source_id:opt.data.source_id,source_uid:opt.data.source_uid,source_uname:opt.data.source_uname,source_ria_index_url:opt.data.source_ria_index_url,stair_cms_id:opt.data.stair_cms_id,blog_title:$E("t_"+opt.articleid).innerHTML,comm_uid:opt.data.comm_uid,uname:opt.data.uname,is_t:0});this.setSrcComment(item.id,item.src_uid,this._openAreas[opt.data.id])}else{var replyCon=$E("reply_"+opt.data.id+"_textcon");if(replyCon.style.display=="none"){v7sendLog("32_01_05");replyCon.style.display="";if(this._openAreas[opt.data.id].getValue()==""){this.setSrcComment(opt.data.id,opt.data.src_uid,this._openAreas[opt.data.id])}opt.node.innerHTML="<cite>取消回复</cite>"}else{replyCon.style.display="none";opt.node.innerHTML="<cite>回复</cite>"}}},add:function(data,sucFn,errFn){trace("CommentV2.ReplyList.add");trace(data);this.cmtAdd.post(data,function(){Lib.Listener.notify("update-total-num",{type:"add",num:1});this.total++;var str=this.node.innerHTML;this.node.innerHTML=str.replace(/(\d+)/,this.total);var str=$E("c_"+this.articleid).innerHTML;var num=parseInt(/(\d+)/.exec(str)[0],10);num++;$E("c_"+this.articleid).innerHTML="("+num+")";sucFn()}.bind2(this),errFn)},share:function(opt){trace("CommentV2.ReplyList.share");v7sendLog("32_01_06");this.cmtShare.replyShare(opt.data)},del:function(opt){trace("CommentV2.ReplyList.del");v7sendLog("32_01_08");this.cmtDel.deleteReply(opt,this.delSucc.bind2(this))},delSucc:function(res){this.total=this.total--?this.total:0;Lib.Listener.notify({type:"reduce",num:1});var str=this.node.innerHTML;this.node.innerHTML=str.replace(/(\d+)/,this.total);var str=$E("c_"+this.articleid).innerHTML;var num=parseInt(/(\d+)/.exec(str)[0],10);num=num--?num:0;$E("c_"+this.articleid).innerHTML="("+num+")";if(this.total==0){$E("comment_"+this.data.stair_cms_id+"_replylist").style.display="none"}},report:function(opt){trace("CommentV2.ReplyList.report");v7sendLog("32_01_07");this.cmtReport.replyReport(opt.data)}});CommentV2.CommentList=function(opt){this.ownerNickName="";this.type="comment";this.defaultAnchor="#comment";this.replyList={};this.replyCache={};this.addEvent=Core.Events.addEvent;this.removeEvent=Core.Events.removeEvent;this.anchorEnAble=false;this.cmtAdd=new CommentV2.Add({type:this.type,tpl:opt.commentTpl||""});this.cmtDel=new CommentV2.Delete;this.cmtReport=new CommentV2.Report;this.cmtShare=new CommentV2.Share;this.bindEvent();this.initPageNew()}.$extends(CommentV2.List).$define({load:function(page){this.replyList={};var __this=this;this.page=page;Utils.Io.JsLoad.request(this.url,{returnType:"jsonp",GET:{callback:"getCmntList",_:(new Date).getTime(),page:this.page,page_size:50,oe:"utf-8",score:0,fake:1,thread:1,list:"asc",t_size:1e3},onComplete:__this.render.bind2(__this),onException:function(){this.error("B36110")}.bind2(this)})},updateTotalNum:function(data){switch(data.type){case"add":this.total+=data.num-0;break;case"reduce":this.total-=data.num-0;if(this.total<0){this.total=0}break}},render:function(result){var _this=this;result=result.result;Lib.checkAuthor(function(){if(_this.page==1){_this.containerNode.innerHTML=""}if(result.status.code!=0){_this.error($isAdmin?"B36021":"B36020");return}else{var oFragment=document.createDocumentFragment();var li,item,_renderItem,_tmp;_this.total=result.count.show;if(_this.total==0){_this.renderNoComment()}for(var i=0,len=result.cmntlist.length;i<len;i++){_renderItem={},_tmp={};item=result.cmntlist[i];var _selfInfo=CommentV2.getConfigInfo(item.config);_tmp={id:item.mid,commentid:item.mid,articleid:item.newsid,cms_body:item.content,fromProduct:item.channel||"blog",comm_uid:item.uid,uname:_selfInfo.wb_screen_name||item.nick||"用户"+item.uid,src_uid:scope.$uid,cms_pubdate:item.time,ria_index_url:item.channel==="blog"?"http://blog.sina.com.cn/u/"+item.uid:"http://weibo.com/u/"+item.uid,user_image:"http://portrait3.sinaimg.cn/"+item.uid+"/blog/50",source_ria_index_url:"http://blog.sina.com.cn/u/"+item.uid};if(result.threaddict[item.mid]){_this.replyCache[item.mid]=_this.reInitSubList(item,result.threaddict[item.mid].list);_tmp.cms_reply_num=result.threaddict[item.mid].count}else{_tmp.cms_reply_num=0}_renderItem=_tmp;_renderItem.action_data=_this.obj2str(_tmp);li=_this.cmtAdd.render(_renderItem,i);oFragment.appendChild(li)}_this.containerNode.appendChild(oFragment)}_this.pagingMore(result.cmntlist.length);if(!_this.anchorEnAble){_this.anchorEnAble=true}_this.sendEvents(result)},"CommentList"+(new Date).getTime())},findParent:function(mid,rootParent,list){if(mid===rootParent.mid){return rootParent}for(var i=0;i<list.length;i++){if(mid===list[i].mid){return list[i]}}},reInitSubList:function(parent,subList){var list=[],_self=this;for(var i=0;i<subList.length;i++){var item=subList[i];var configInfo=CommentV2.getConfigInfo(item.config);var _item={stair_cms_id:parent.mid,id:item.mid,cms_body:item.content,fromProduct:item.channel||"blog",articleid:item.newsid,source_id:item.parent,source_uid:item.parent_uid,source_uname:configInfo.p_nick||item.parent_nick||"用户"+item.parent_uid,source_ria_index_url:"http://blog.sina.com.cn/u/"+item.parent_uid,comm_uid:item.uid,uname:configInfo.wb_screen_name||item.nick||"用户"+item.uid,user_image:configInfo.wb_profile_img||item.profile_img,ria_index_url:"http://blog.sina.com.cn/u/"+item.uid,cms_pubdate:item.time};list.push(_item)}return list},sendEvents:function(data){Lib.Listener.notify("commentlist-isready",data);scope.$commentlistIsReady=1},dictCnmt:function(list,item){var pushFlag=true;for(var i=0;i<list.length;i++){var curItem=list[i];if(curItem.id===item.id){pushFlag=false;break}}if(pushFlag){list.push(item)}},renderNoComment:function(){this.containerNode.innerHTML='<li><div class="noCommdate"><span class="SG_txtb">做第一个评论者吧！ '+'<img class="SG_icon SG_icon134" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="18" height="18" title="" align="absmiddle">'+'<a href="#post">抢沙发&gt;&gt;</a></span></div></li>'},add:function(data){var item=data.item,fun=data.fun;var li=this.cmtAdd.render(data.item);fun(li)},reloadCnmtList:function(){this.load(1);winDialog.alert("发帖成功",{icon:"03"})},del:function(opt){trace("CommentV2.CommentList.del");this.cmtDel.deleteComment(opt,this.delSucc.bind2(this))},delSucc:function(res){this.total=this.total-res.cms_reply_num-1;this.total=this.total<=0?0:this.total;var str=$E("c_"+scope.$articleid).innerHTML;var num=parseInt(/(\d+)/.exec(str)[0],10);num=num-res.cms_reply_num-1?num-res.cms_reply_num-1:0;$E("c_"+scope.$articleid).innerHTML="("+num+")";if(this.total==0){this.renderNoComment()}else{if(this.containerNode.getElementsByTagName("li").length==0){this.page--;this.load(this.page)}}},reply:function(opt){trace("CommentV2.CommentList.reply");var that=this;var subReplyList=this.replyCache[opt.data.id];subReplyList=subReplyList?subReplyList:[];Lib.Uic.getNickName([scope.$uid],function(data){that.ownerNickName=data[scope.$uid]||"";opt.replyTpl=that.replyTpl||"";opt.data.ownerNickName=that.ownerNickName;opt.subReplyList=subReplyList;opt.total=opt.data.cms_reply_num;opt.data.stair_cms_id=opt.data.id;var id=opt.data.id;if(that.replyList[id]){that.replyList[id].toggle()}else{that.replyList[id]=new CommentV2.ReplyList(opt)}})},report:function(opt){trace("CommentV2.CommentList.report");this.cmtReport.commentReport(opt.data)},share:function(opt){trace("CommentV2.CommentList.share");this.cmtShare.commentShare(opt.data)},more:function(opt){trace("CommentV2.CommentList.more");var id=opt.data.commentid;var partCmsNode=$E("body_cmt_"+id);var fullCmsNode=$E("body_cmt_full_"+id);if(opt.node.className=="btn_artzk"){v7sendLog("32_01_03");partCmsNode&&(partCmsNode.style.display="none");fullCmsNode&&(fullCmsNode.style.display="")}else if(opt.node.className=="btn_artsq"){v7sendLog("32_01_04");partCmsNode&&(partCmsNode.style.display="");fullCmsNode&&(fullCmsNode.style.display="none")}},initPageNew:function(){var paging=$E("commentPaging");paging.style.display="none";paging.style.textAlign="center";paging.innerHTML='<a href="javascript:void(0);" style="">点击加载更多</a>';this.addEvent(paging.children[0],function(){this.load(this.page+1)}.bind2(this),"click")},pagingMore:function(len){var paging=$E("commentPaging");if(len>=50){paging.parentNode.style.display="block";paging.style.display="block"}else{paging.parentNode.style.display="none";paging.style.display="none"}},paging:function(){var __this=this;var paging=$E("commentPaging");if(paging){var perpage=50,pages=0;if(this.total%perpage==0){pages=Math.ceil(this.total/perpage)}else{pages=Math.floor(this.total/perpage)+1}if(this.total>perpage){paging.parentNode.style.display="block";$E("commentPaging").style.display="block";Ui.Pagination.init({pageNode:"commentPaging",nodeClassNamePrefix:"SG",curPage:this.page,maxPage:pages,pageTpl:function(page){__this.load(page)}}).show();paging.onclick=this.sudaClick}else{paging.parentNode.style.display="none"}}},sudaClick:function(event){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="a"){Lib.sendSuda(function(){try{SUDA.log("","blog_blogcomment_page")}catch(e){}})}else{return}},anchor:function(posId){var url=window.location.href;if(this.anchorEnAble){window.location.href=url.replace(location.hash,"")+"#"+posId}},showError:function(result){winDialog.alert($SYSMSG[code],{icon:"02"})}});Sina.pkg("Utils.Flash");if(typeof deconcept=="undefined")var deconcept=new Object;if(typeof deconcept.util=="undefined")deconcept.util=new Object;if(typeof deconcept.SWFObjectUtil=="undefined")deconcept.SWFObjectUtil=new Object;deconcept.SWFObject=function(swf,id,w,h,ver,c,quality,xiRedirectUrl,redirectUrl,detectKey){if(!document.getElementById){return}this.DETECT_KEY=detectKey?detectKey:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}if(w){this.setAttribute("width",w)}if(h){this.setAttribute("height",h)}if(ver){this.setAttribute("version",new deconcept.PlayerVersion(ver.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(c){this.addParam("bgcolor",c)}var q=quality?quality:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var xir=xiRedirectUrl?xiRedirectUrl:window.location;this.setAttribute("xiRedirectUrl",xir);this.setAttribute("redirectUrl","");if(redirectUrl){this.setAttribute("redirectUrl",redirectUrl)}};deconcept.SWFObject.prototype={useExpressInstall:function(path){this.xiSWFPath=!path?"expressinstall.swf":path;this.setAttribute("useExpressInstall",true)},setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs[variablePairs.length]=key+"="+variables[key]}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}swfNode='<embed pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+="flashvars="+pairs+'&realfull=1&moz=1"'}swfNode+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},write:function(elementId){if(this.getAttribute("useExpressInstall")){var expressInstallReqVer=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(expressInstallReqVer)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}var n=typeof elementId=="string"?document.getElementById(elementId):elementId;var oldTitle=document.title;n.innerHTML=this.getSWFHTML();if(oldTitle!==document.title){document.title=oldTitle}return true}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var PlayerVersion=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new deconcept.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};deconcept.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major)return false;if(this.major>fv.major)return true;if(this.minor<fv.minor)return false;if(this.minor>fv.minor)return true;if(this.rev<fv.rev)return false;return true};deconcept.util={getRequestParameter:function(param){var q=document.location.search||document.location.hash;if(param==null){return q}if(q){var pairs=q.substring(1).split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return pairs[i].substring(pairs[i].indexOf("=")+1)}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;Utils.Flash.swfObject=deconcept.SWFObject;Core.Dom.getTop=function(element){var top=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){top+=el.offsetTop;el=el.offsetParent}}else if(el.y){top+=el.y}return top};Core.Dom.getLeft=function(element){var left=0;var el=$E(element);if(typeof el.offsetParent!="unknown"){while(el.offsetParent){left+=el.offsetLeft;el=el.offsetParent}}else if(el.x){left+=el.x}return left};Lib.applyIf=function(o,s,defaults){if(defaults){Lib.applyIf(o,defaults)}if(o&&s&&Lib.isObject(s)){for(var p in s){if(s.hasOwnProperty(p)&&!o[p]){o[p]=s[p]}}}return o};Lib.isObject=function(o){return Object.prototype.toString.call(o)==="[object Object]"};Lib.apply=function(o,ref,defaults,deep,original){if(defaults){Lib.applyIf(o,defaults)}for(var p in ref){if(original&&o[p]&&!Lib.isObject(o[p])){continue}if(ref.hasOwnProperty(p)){if(deep&&Lib.isObject(ref[p])){o[p]=Lib.apply(o[p]||{},ref[p],deep,original)}else{o[p]=ref[p]}}}return o};Lib.Panel=Core.Class.create();Lib.Panel.prototype={noIframe:!1,isPostion:!0,appendTo:null,entity:null,backIframe:null,uniqueID:null,isFixed:false,isShow:!1,isHidden:!0,x:0,y:0,template:"",initialize:function(cfg){Lib.apply(this,cfg);var _this=this;this.uniqueID=this._getUniqueID();this._ie6Fixed=function(){if(_this.entity){_this.entity.style.left=document.documentElement.scrollLeft+_this.x+"px";_this.entity.style.top=document.documentElement.scrollTop+_this.y+"px"}if(_this.backIframe){_this.backIframe.style.left=_this.entity.style.left;_this.backIframe.style.top=_this.entity.style.top}}},getNode:function(name){return this.tpl.getNode(name)},setTemplate:function(template){this.template=template;if(this.entity&&this.entity.parentNode){this.entity.parentNode.removeChild(this.entity);this.backIframe&&this.backIframe.parentNode.removeChild(this.backIframe)}this.entity=$C("div");var tempEntity=$C("div");var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;tempEntity.innerHTML=tmp.getHtmlString();tempEntity.style.display="none";if(this.appendTo){$E(this.appendTo).appendChild(tempEntity)}else{document.body.appendChild(tempEntity)}this.entity=$E("_"+this.uniqueID+"_panel");if(this.isPostion){this.entity.style.position="absolute"}this.entity.style.display="none";if(this.appendTo){$E(this.appendTo).replaceChild(this.entity,tempEntity)}else{document.body.replaceChild(this.entity,tempEntity)}tempEntity=null;if(!this.noIframe){this.backIframe=$C("iframe");this.backIframe.style.display="none";this.backIframe.style.border="none";this.backIframe.style.zIndex=this.entity.style.zIndex-1;document.body.appendChild(this.backIframe);this._updateBackIframe()}},setPosition:function(x,y){this.x=x;this.y=y;this.entity.style.left=x+"px";this.entity.style.top=y+"px";if($IE6&&this.isFixed){this.entity.style.left=x+document.documentElement.scrollLeft+"px";this.entity.style.top=y+document.documentElement.scrollTop+"px"}if(this.backIframe){this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top}},setFixed:function(state){this.isFixed=state;if($IE6){var _this=this;this.entity.style.position="absolute";if(this.isFixed){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}return}this.entity.style.position=this.isFixed?"fixed":"absolute";if(this.backIframe){this.backIframe.style.position=this.entity.style.position}},show:function(){this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}},hidden:function(){this.hide()},hide:function(){this.entity.style.display="none";this.isHidden=!0;this.isShow=!1;if(this.backIframe){this.backIframe.style.display="none"}},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.backIframe){this.backIframe.parentNode.removeChild(this.backIframe);this.backIframe=null}},showWithDom:function(dom,offsetLeft,offsetTop){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}this.setPosition(x,y);this.show()},getWidth:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";w=this.entity.offsetWidth;this.entity.style.display=ld;this.entity.style.visibility=lv;return w},getHeight:function(){var ld=this.entity.style.display;var lv=this.entity.style.visibility;this.entity.style.visibility="hidden";this.entity.style.display="";h=this.entity.offsetHeight;this.entity.style.display=ld;this.entity.style.visibility=lv;return h},getX:function(){return parseInt(this.entity.style.left)},getY:function(){return parseInt(this.entity.style.top)},getNodes:function(mode){var m=mode||"o";var pattern=/[^\{\}]+(?=\})/g;var i;var nodes={};var result=this.template.match(pattern);if(result){for(i=0;i<result.length;i++){var r=result[i];switch(m){case"o":nodes[r]=$E("_"+this.uniqueID+"_"+r);break;case"i":nodes[r]="_"+this.uniqueID+"_"+r;break}}}return nodes},_updateBackIframe:function(){Core.Dom.setStyle(this.backIframe,"opacity",0);this.backIframe.style.display="";this.backIframe.style.position=this.entity.style.position;this.backIframe.style.width=this.entity.offsetWidth+"px";this.backIframe.style.height=this.entity.offsetHeight+"px";this.backIframe.style.left=this.entity.style.left;this.backIframe.style.top=this.entity.style.top},_getUniqueID:function(){return parseInt(Math.random()*1e3).toString()+(new Date).getTime().toString()}};var showUpTips=function(){winDialog.alert('您可以在<a href="http://get.adobe.com/flashplayer/" target="_blank">此处下载免费的Adobe flash player installer</a>。成功安装程序后，可返回此处查看。',{icon:"01"})};scope.magicCfg={};window.$magicFacePlay=function(swfName){var ver;if(!scope.flashVersion){scope.flashVersion=deconcept.SWFObjectUtil.getPlayerVersion()}ver=scope.flashVersion;if(ver.major<9){showUpTips();return}Core.Events.stopEvent();var cfg={alphaNodeId:"alphaNode",containerDiv:"magicFaceCon"};var layer=['<div id="magicFaceCon" title="" alt="" style="height:360px; width:360px;">',"</div>"].join("");scope.magicCfg.layer=new Lib.Panel;scope.magicCfg.layer.setTemplate('<div style="position:absolute;z-index:2000;" id="#{panel}" title="" alt="">'+layer+"</div>");scope.magicCfg.layer.show();var swfId="magicFace";var addSwf=function(){scope.magicCfg.shadow=new BackShadow(.4);scope.magicCfg.shadow.entity.setAttribute("title","点击关闭动画");scope.magicCfg.shadow.entity.setAttribute("alt","点击关闭动画");scope.magicCfg.shadow.entity.onclick=removeSwf;Core.Events.addEvent(document,escDown,"keydown");scope.magicCfg.shadow.show();var win=Core.System.winSize();var scroll=Core.System.getScrollPos(document);var _x=win.width/2-360/2+scroll[1];var _y=win.height/2-360/2+scroll[0];scope.magicCfg.layer.setPosition(_x,_y);var overlayDiv=document.createElement("div");overlayDiv.id="___flashOverlay";overlayDiv.style.cssText="cursor:pointer;visibility:hidden;background:white;;z-index:3000;position:absolute;width:360px;height:360px;top:"+_y+"px;left:"+_x+"px";document.body.appendChild(overlayDiv);if(document.all){overlayDiv.style.filter="Alpha(Opacity=0)"}else{overlayDiv.style.opacity=0}overlayDiv.style.visibility="visible";Core.Events.addEvent(overlayDiv,function(){window.open("http://blog.sina.com.cn/myshow2010")});overlayDiv=null;var FlashPlayer=new Utils.Flash.swfObject("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/"+swfName+"?t="+Core.Math.getUniqueId(),swfId,360,360,9,"#FFFFFF");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.write(cfg.containerDiv)};var removeSwf=function(){trace("swf remove!!!");var con=$E(cfg.containerDiv);if(con){con.innerHTML=""}window.clearInterval(timer);Core.Events.removeEvent(document,escDown,"keydown");try{scope.magicCfg.shadow.close();scope.magicCfg.layer.close();Core.Events.stopEvent()}catch(e){}if($E("___flashOverlay")){document.body.removeChild($E("___flashOverlay"))}};var escDown=function(e){var curKey=e.keyCode||e.which||e.charCode;if(curKey===27){removeSwf();Core.Events.removeEvent(document,escDown,"keydown");Core.Events.stopEvent();return false}};addSwf();var timer=window.setInterval(function(){trace("……追踪 进度……");var swf=$E(swfId);var snap=0;if(swf&&swf.PercentLoaded()==100){swf.onclick=function(){Core.Events.stopEvent()};trace("swf 加载完毕了………………");var con=swf.parentNode;var scroll=Core.System.getScrollPos(document);var win=Core.System.winSize();var _x=win.width/2-con.offsetWidth/2+scroll[1];var _y=win.height/2-con.offsetHeight/2+scroll[0];scope.magicCfg.layer.setPosition(_x,_y);scope.magicCfg.layer.show();trace("flash size x="+con.offsetWidth+"  y="+con.offsetHeight);window.clearInterval(timer);timer=window.setInterval(function(){var curr=swf.CurrentFrame();var total;try{total=swf.TotalFrames()}catch(e){total=swf.TotalFrames}if(curr<0){return}if(curr<total&&snap<=curr){snap=curr}else{removeSwf()}},80)}},100)};$registJob("articleCommentV2",function(){if(!scope.$comment_is_load_page_1&&scope.$private.cms!=1&&scope.$isCommentAllow!=1){var myComment=new CommentV2.CommentList({url:"http://comment5.news.sina.com.cn/page/info?channel=blog&newsid="+scope.$articleid,containerNode:$E("article_comment_list")})}});if(typeof App=="undefined"){var App={}}$ScriptLoader={callback:{},response:function(sId,oData){var sUidHex=(scope.$uid*1).toString(16);var sUidLen=sUidHex.length;if(8>sUidLen){for(var i=0,len=8-sUidLen;i<len;i++){sUidHex="0"+sUidHex}}var result={};for(var key in oData){result[sUidHex+"01"+key]=oData[key]}this.callback[sId].func(result);var pageId=scope.$pageid;if(pageId=="article_new"||pageId=="articleM_new"||pageId=="article"||pageId=="articleM"||!pageId.indexOf("articletj")){var func=scope.useNewInterfaceToGetNum;if(!func){scope.useNewInterfaceToGetNum={};func=scope.useNewInterfaceToGetNum}var diggerNum=0;for(var x in oData){diggerNum=oData[x]["d"];break}if(func){var diggNumStr="digg_m_"+scope.$articleid;var obj={};obj[diggNumStr]=diggerNum;if(func.onSuccess){func.onSuccess(obj)}else{var count=0;var timmer=setInterval(function(){if(count>300){clearInterval(timmer);if(func&&func.onException){func.onException(obj)}return}if(func&&func.onSuccess){clearInterval(timmer);func.onSuccess(obj)}count++},100)}}}}};App.getArticlesDetailNumber=function(sUid,aArticleLists,fCallBack){if(aArticleLists==null||aArticleLists.length==0){return{}}sUid=sUid||scope.$uid;var sUidHex=(scope.$uid*1).toString(16);var sUidLen=sUidHex.length;if(8>sUidLen){for(var i=0,len=8-sUidLen;i<len;i++){sUidHex="0"+sUidHex}}var aids=[];Core.Array.foreach(aArticleLists,function(oItem){aids.push(oItem.replace(sUidHex+"01",""))});var js=$C("script");var random=Math.ceil(Math.random()*1e4);while($ScriptLoader.callback[random]!=null){random=Math.ceil(Math.random()*1e4)}var requestId="aritlces_number_"+random;$ScriptLoader.callback[requestId]={func:fCallBack,uid:sUid};var src="http://comet.blog.sina.com.cn/api?maintype=num&uid="+sUidHex+"&aids="+aids.join(",")+"&requestId="+requestId;if(scope.$pageid=="indexM"||scope.$pageid=="index"){src+="&fetch=r,c,z,f"}if(scope.$pageid=="articlelist"||scope.$pageid=="articlelistM"){src+="&fetch=c,r"}js.src=src;js.charset="utf-8";js.onload=js.onerror=js.onreadystatechange=Core.Function.bind2(function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}js.onload=js.onreadystatechange=js.onerror=null;js.src="";js.parentNode.removeChild(js);js=null},this);document.getElementsByTagName("head")[0].appendChild(js)};$registJob("articleNumberV2",function(){Lib.checkAuthor(function(){if(scope.$pn_x_rank=="1"&&!$isAdmin){return false}var uid=scope.$uid;var articleid=scope.$articleid;App.getArticlesDetailNumber(uid,[articleid],function(x){var data=x[articleid];for(var i in data){if(scope.$pageid==="articletjTech"){}if($E(i+"_"+articleid)){$E(i+"_"+articleid).innerHTML="("+data[i]+")"}if(i==="c"){if($E("blog_comments_num")){var num=data[i]||0;num=num>999?"999+":num;$E("blog_comments_num").innerHTML=num}}}if(scope.$pageid==="articleM"&&data["z"]){$E("quote_sign_count")&&($E("quote_sign_count").innerHTML=data["z"])}})},"articleNumberV2"+(new Date).getTime())});scope.faceTemplate=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">插入表情</strong>','<cite><a id="#{btnClose}" href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="faceItemContent">','<div class="bigface">','<div id="#{faceTab}" class="faceSidebar">',"</div>",'<div id="#{faceContent}" class="faceShowAll">',"</div>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");Lib.Face=Core.Class.create();Lib.Face.prototype={dialog:null,dialogNodes:null,tabs:null,faceConfig:null,template:null,txtContentArea:null,x:0,y:0,isShowed:false,_isInitDialog:false,insertImageFile:"",initialize:function(txtContentArea,tpl){var _this=this;this.txtContentArea=txtContentArea;this.template=tpl;window.$insertFace=function(code,name){_this.insertFace(code,name)}},load:function(){var _this=this;this.dialog=new Dialog(this.template||scope.faceTemplate);this.dialogNodes=this.dialog.getNodes();this.tabs=new Tabs(this.dialogNodes["faceTab"]);Core.Events.addEvent(this.dialog.entity,function(){Core.Events.stopEvent()},"mousedown");Core.Events.addEvent(document.body,function(){_this.hidden()},"mousedown");this.initFaceConfig(function(){if(_this.tabs.tabsArr[0]){_this.tabs.tabsArr[0].setFocus()}Core.Events.addEvent(_this.dialogNodes["btnClose"],function(){_this.hidden()},"mousedown");_this.onInitialized()});this._isInitDialog=true},initFaceConfig:function(callBack){var _this=this;Utils.Io.JsLoad.request("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig.js?varname=smileConfig&"+(new Date).getTime(),{onComplete:function(data){_this.faceConfig=data;_this.initFaceData();if(callBack){callBack()}},charset:"gb2312"})},initFaceData:function(){var k,_this=this;for(k in this.faceConfig){this.addTab(k,this.faceConfig[k]["name"],this.faceConfig[k]["data"])
}},onInitialized:function(){},textWatchOn:function(){var _oTextNode=this.txtContentArea;var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};Core.Events.addEvent(_oTextNode,getPos,"keyup");Core.Events.addEvent(_oTextNode,getPos,"focus");Core.Events.addEvent(_oTextNode,getPos,"select");Core.Events.addEvent(_oTextNode,getPos,"click")},addTab:function(key,tabName,contentData){var _this=this;var tab=new Tab('<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+key+'.gif" height="20" width="20" align="absmiddle"><span><a href="#" onclick="return false;">'+tabName+"</a></span><em>("+contentData.length+")</em>",{isFocus:false,className:"cur"});tab.addOnAbort(function(){tab.content.style.display="none"});tab.addOnFocus(function(){if(!tab.isShowed){tab.isShowed=true;tab.content=$C("ul");tab.content.innerHTML=_this._getTabContent(key,contentData);_this.dialogNodes["faceContent"].appendChild(tab.content)}tab.content.style.display=""});this.tabs.add(tab)},_getTabContent:function(key,contentData){var str=[],faceName;var i,len=contentData.length;for(i=0;i<len;i++){faceName=contentData[i]["name"];faceName=Core.String.byteLength(faceName)>8?Core.String.leftB(faceName,6)+"...":faceName;str.push("<li><a onclick=\"$insertFace('"+contentData[i]["code"]+"','"+contentData[i]["name"]+'\');return false;" href="#"><img style="width:50px;height:50px;" title="'+contentData[i]["name"]+'" src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+contentData[i]["code"]+'T.gif"/></a><span>'+faceName+"</span></li>")}return str.join("")},insertFace:function(code,name){this.insertImageFile=code+"T.gif";this.onInsert();if(!this.txtContentArea){return}var faceValue="[emoticons="+code+"]"+name+"[/emoticons]";if($IE){if(this.txtContentArea.createTextRange&&this.txtContentArea.caretPos){var caretPos=this.txtContentArea.caretPos;caretPos.text=caretPos.text.charAt(caretPos.text.length-1)==" "?faceValue+" ":faceValue;this.txtContentArea.focus()}else{this.txtContentArea.value+=faceValue;this.txtContentArea.focus()}}else{if(this.txtContentArea.setSelectionRange){var rangeStart=this.txtContentArea.selectionStart;var rangeEnd=this.txtContentArea.selectionEnd;var tempStr1=this.txtContentArea.value.substring(0,rangeStart);var tempStr2=this.txtContentArea.value.substring(rangeEnd);this.txtContentArea.value=tempStr1+faceValue+tempStr2}else{this.txtContentArea.value+=faceValue}}this.hidden();return false},onInsert:function(){},setPosition:function(x,y){this.x=x;this.y=y;this.dialog.setPosition({x:x,y:y})},show:function(){!this._isInitDialog&&this.load();this.dialog.show();this.isShowed=true},hidden:function(){this.isShowed=false;this.dialog.hidden()}};Core.Dom.addHTML=function(oParentNode,sHTML){oParentNode.insertAdjacentHTML("beforeend",sHTML)};if(!$C("div").insertAdjacentHTML){Core.Dom.addHTML=function(oParentNode,sHTML){var oRange=oParentNode.ownerDocument.createRange();oRange.setStartBefore(oParentNode);var oFrag=oRange.createContextualFragment(sHTML);oParentNode.appendChild(oFrag)}}App.smilesTemplate=['<table id="#{entity}" class="CP_w faceItemContent" style="visibility: visible;">','<thead id="#{titleBar}"><tr><th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">插入表情</strong><cite><a id="#{btnClose}"',' href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th></tr></thead>','<tfoot><tr><td class="tLeft"><span></span></td><td class="tMid"><span></span></td>','<td class="tRight"><span></span></td></tr></tfoot>',"<tbody><tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="insertface">','<div class="insertface_top">','<h3>热门动漫表情</h3><div class="insertface_search">','<input id="#{searchText}" type="text" class="SG_input" value="输入关键字、动漫形象"',' style="color:#9b9b9a;" maxlength="20" /><a id="#{searchBtn}" href="#" onclick="return false;" ','hidefocue="true" class="SG_aBtn SG_aBtnB"><cite>查找表情</cite></a></div>','<div class="clearit"></div>',"</div>",'<div class="insertface_hot">','<span class="insertface_keyword">热门关键字：<span id="#{hotKeyword}"></span></span>','<span class="insertface_hotslider"></span>',"</div>",'<div class="bigface">','<div class="faceSidebar">','<div id="#{keyCtrl}" class="facekeyword" style="display:none;">','<p><< <a id="#{keyCtrlBack}" href="#" onclick="return false;">返回全部关键字</a></p>','<p>关键字：<span id="#{keyWord}"></span></p></div>','<h3 id="#{allSort}" class="facetitle" style="font-weight:600;"><a href="#"',' onclick="return false;">全部</a></h3>','<div id="#{sortList}" class="facelist"></div>','<div id="#{sortCtrl}" class="facearrow"></div>',"</div>",'<div class="faceShowAll">','<div id="#{smileEmpty}" class="faceShownone" style="display:none;"><p>找不到和关键字相符的表情。','<br /><br /><a id="#{smileEmptyBack}" href="#" onclick="return false;">&lt;&lt;返回首页</a></p></div>','<ul class="faceShowAll_list" id="#{smileList}"></ul>','<div class="SG_page"><ul class="SG_pages">','<li id="#{smilePagePrev}" class="SG_s_pgprev"></li>','<li id="#{smilePageShow}" class="SG_s_pgnum"></li>','<li id="#{smilePageNext}" class="SG_s_pgnext"></li>','<li class="play" id="#{magicTip}">点击<img align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif">预览动画效果</li>',"</ul></div>","</div>","</div>","</div>",'</td><td class="tRight"><span></span></td>',"</tr></tbody></table>"].join("");App.smilesDialog2=Core.Class.create();App.smilesDialog2.prototype={pageSize:24,defaultConfig:{sortId:"0",htmlTpl:App.smilesTemplate,callback:function(){}},initialize:function(oOption){this.option=oOption||{};for(var key in this.defaultConfig){if(this.option[key]==null){this.option[key]=this.defaultConfig[key]}}this.dialog=new Dialog(this.option.htmlTpl);this.dialog.setAreaLocked(true);this.dialogNodes=this.dialog.getNodes();this.getKeyWord();if(scope.smilesData!=null){this.data=scope.smilesData;this.dataSettle();this.eventListen()}else{var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig8.js?varname=smileConfig"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.dataSettle();__this.eventListen()},onException:function(){}})}return this},dataSettle:function(oData,nCount){oData=oData||this.data;nCount=nCount||9;this.tabsData=[];this.allData=[];for(var key in oData){var _item=oData[key];_item.sortId=key;this.tabsData.push(_item);for(var i=0,len=_item.data.length;i<len;i++){_item.data[i].sid=key;_item.data[i].sname=_item.name}this.allData=this.allData.concat(_item.data)}if(this.allDataBack==null){this.allDataBack=this.allData.slice(0)}this.showTab(1,nCount);if(this.dialogNodes.smileList.childNodes.length==0){this.showAll()}},children:function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr},showTab:function(nPage,nCount){nPage=nPage||1;nCount=nCount||9;this.dialogNodes.sortList.innerHTML="";this.dialogNodes.smileList.innerHTML="";Core.Dom.setStyle(this.dialogNodes.sortList,"height",nCount==9?"279px":"217px");this.tabs=new Tabs(this.dialogNodes.sortList);this.tabsObject={};var _this=this;for(var i=0;i<nCount;i++){var _indexBase=(nPage-1)*nCount;if(this.tabsData[_indexBase+i]==null){break}var _sortId=this.tabsData[_indexBase+i].sortId;var _name=this.tabsData[_indexBase+i].name;var _data=this.tabsData[_indexBase+i].data;var tab=new Tab('<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_sortId+'.gif" height="20" width="20" align="absmiddle"><div><span><a href="#" onclick="return false;" title="'+_name+'">'+_name+"</a></span><em>("+_data.length+")</em></div>",{isFocus:false,className:"cur"});tab.addOnAbort(Core.Function.bind3(function(tab){},null,[tab]));tab.addOnFocus(Core.Function.bind3(function(tab,key,data,sid){_this.showSmile(data,1,_this.pageSize);_this.currentTab=tab;_this.dialogNodes.allSort.style.fontWeight=400;if(!_this.isFromUp){var pId=scope.$pageid;if(pId){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pId][isComm]+"_16_020_"+sid,pId,"")}}}_this.isFromUp=null},null,[tab,_indexBase+i,_data,_sortId]));this.tabsObject[_sortId]=tab;this.tabs.add(tab)}var _tabPageCount=Math.ceil(this.tabsData.length/nCount);if(_tabPageCount>0){this.showTabPage(nPage||1,_tabPageCount,nCount)}else{this.dialogNodes.sortCtrl.innerHTML=""}},showSmile:function(oData,nPage,nCount){var me=this;nCount=nCount||this.pageSize;var __this=this;var _smiles=oData;var _count=_smiles.length;var _totalPages=Math.ceil(_count/nCount);var _smilesDom=document.createDocumentFragment();var _pageLink;this.dialogNodes.smileList.innerHTML="";this.dialogNodes.magicTip.style.cssText="display:none;";for(var i=0;i<nCount;i++){var _smile=_smiles[(nPage-1)*nCount+i];if(_smile==null){break}var _li=$C("li");var _a=$C("a");_a.href="#";_a.onclick=function(){return false};_a.onmousedown=Core.Function.bind3(function(nCode,sName,swfName){__this.hide();__this.option.callback(nCode,sName,swfName)},null,[_smile.code,_smile.name,_smile.swf||null]);_a.innerHTML='<img style="width:50px;height:50px;" src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_smile.code+'T.gif" alt="'+_smile.name+'" title="'+_smile.name+'" />';_li.appendChild(_a);_a.setAttribute("key",_smile.code);var _span=$C("span");_span.title=_smile.name;_span.innerHTML=Core.String.byteLength(_smile.name)>8?Core.String.leftB(_smile.name,6)+"…":_smile.name;_li.appendChild(_span);if(_smile.swf){var _div=$C("div");_div.innerHTML='<a href="#"   onclick="window.$magicFacePlay(\''+_smile.swf+'\');return false;"><img height="13" title="播放表情" align="absmiddle" width="14" alt="" src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif"></a>';_div.className="arr_r";_li.appendChild(_div);this.dialogNodes.magicTip.style.cssText="display:block;"}_smilesDom.appendChild(_li);Core.Events.addEvent(_a,function(ele){return function(){var pId=scope.$pageid;if(pId){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pId][isComm]+"_16_010_"+ele.getAttribute("key"),pId,"")}}}}(_a),"mousedown")}this.dialogNodes.smileList.appendChild(_smilesDom);if(_count>nCount){if(nPage==1){this.dialogNodes.smilePagePrev.innerHTML="上一页"}else{this.dialogNodes.smilePagePrev.innerHTML="";_pageLink=$C("a");_pageLink.href="#";_pageLink.onclick=function(){return false};_pageLink.onmousedown=function(){__this.showSmile(_smiles,nPage-1,nCount)};_pageLink.innerHTML="上一页";this.dialogNodes.smilePagePrev.appendChild(_pageLink)}this.dialogNodes.smilePageShow.innerHTML=nPage+"/"+_totalPages;if(nPage>=_totalPages){this.dialogNodes.smilePageNext.innerHTML="下一页"}else{this.dialogNodes.smilePageNext.innerHTML="";_pageLink=$C("a");_pageLink.href="#";_pageLink.onclick=function(){return false};_pageLink.onmouseup=function(){__this.showSmile(_smiles,nPage+1,nCount)};_pageLink.innerHTML="下一页";this.dialogNodes.smilePageNext.appendChild(_pageLink)}}else{this.dialogNodes.smilePagePrev.innerHTML="";this.dialogNodes.smilePageShow.innerHTML="";this.dialogNodes.smilePageNext.innerHTML=""}},showTabPage:function(nPageNum,nPageCount,nTabsPerPage){this.dialogNodes.sortCtrl.innerHTML="";this.dialogNodes.smilePagePrev.innerHTML="";this.dialogNodes.smilePageShow.innerHTML="";this.dialogNodes.smilePageNext.innerHTML="";var __this=this;var _arrow;if(nPageNum==1){if(nPageNum!=nPageCount){this.dialogNodes.sortCtrl.innerHTML='<a href="#" onclick="return false;" title="向上" class="up_off"></a>';_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向下";_arrow.className="down";_arrow.onmousedown=function(){__this.showTab(nPageNum+1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow)}else{}}else if(nPageNum<nPageCount){_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向上";_arrow.className="up";_arrow.onmousedown=function(){__this.showTab(nPageNum-1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow);_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向下";_arrow.className="down";_arrow.onmousedown=function(){__this.showTab(nPageNum+1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow)}else{_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向上";_arrow.className="up";_arrow.onmousedown=function(){__this.showTab(nPageNum-1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow);Core.Dom.addHTML(this.dialogNodes.sortCtrl,'<a href="#" onclick="return false;" title="向下" class="down_off"></a>')}},eventListen:function(){var __this=this;var _searchText=__this.dialogNodes.searchText;var _searchBtn=__this.dialogNodes.searchBtn;var _keywordBack=__this.dialogNodes.keyCtrlBack;var _allSort=__this.dialogNodes.allSort;var _smileEmptyBack=__this.dialogNodes.smileEmptyBack;Core.Events.addEvent(document.body,function(cls){var _event=Core.Events.getEvent(),_eventTarget=$IE?_event.srcElement:_event.target;if(__this.dialogNodes.entity!=null&&(Core.Dom.contains(__this.dialogNodes.entity,_eventTarget)==false||cls==true)){__this.hide()}});Core.Events.addEvent(this.dialogNodes.btnClose,function(){__this.hide()});Core.Events.addEvent(_searchText,function(){if(Core.String.trim(_searchText.value)=="输入关键字、动漫形象"){_searchText.value="";_searchText.style.color="#000"}_searchText.select()},"focus");Core.Events.addEvent(_searchText,function(){if(Core.String.trim(_searchText.value)==""){_searchText.value="输入关键字、动漫形象";_searchText.style.color="#9b9b9a"}},"blur");Core.Events.addEvent(_searchText,function(e){var _evt=Core.Events.getEvent();var _key=_evt.which||_evt.keyCode;var _keyword=Core.String.trim(_searchText.value);if(_key==13&&_keyword!=""){__this.searchKey(_keyword)}},"keydown");Utils.Form.limitMaxLen(_searchText,20);Core.Events.addEvent(_searchBtn,function(){if(_searchText.value=="输入关键字、动漫形象"||_searchText.value==""){}else{__this.searchKey(_searchText.value);_searchText.focus()}});var _backHome=function(){__this.dataSettle(__this.data,9);__this.dialogNodes.keyCtrl.style.display="none";__this.dialogNodes.smileEmpty.style.display="none";__this.dialogNodes.smileList.style.display="";__this.dialogNodes.searchText.value="输入关键字、动漫形象";__this.dialogNodes.searchText.style.color="#9b9b9a"};Core.Events.addEvent(_keywordBack,_backHome);Core.Events.addEvent(_smileEmptyBack,_backHome);Core.Events.addEvent(_allSort,function(){__this.showAll()})},showAll:function(){this.showSmile(this.allData,1,this.pageSize);this.dialogNodes.allSort.style.fontWeight=600;if(this.currentTab!=null){this.currentTab.setAbort()}},setSort:function(sId,fCallback){this.isFromUp=sId;this.option.sortId=sId;this.option.callback=fCallback;if(sId==0){this.dialogNodes.allSort.style.fontWeight=600;this.dataSettle()}else{this.dataSettle();this.tabs.swapTags(this.tabsObject[sId])}},getKeyWord:function(){if(this.keywordData!=null){return}var __this=this;var smileData=Utils.Io.JsLoad.request("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileKeywordConfig.js?varname=smileKeywordConfig",{onComplete:function(oData){__this.keywordData=oData;var _hotkey=oData.E___00000000000||"顶|路过|哭|啦啦|美女";var _hotDom=document.createDocumentFragment();_hotkey=_hotkey.split("|");for(var i=0,len=_hotkey.length;i<len;i++){var _link=$C("a");_link.href="#";_link.onclick=function(){return false};_link.onmousedown=Core.Function.bind3(function(sHotkey){__this.searchKey(sHotkey)},null,[_hotkey[i]]);_link.innerHTML=_hotkey[i];if(_hotkey[i]=="魔法表情"){var img=$C("img");img.style.cssText="height:15px; width:15px;";img.setAttribute("align","absmiddle");img.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";img.className="SG_icon SG_icon68 img_m";_hotDom.appendChild(img)}_hotDom.appendChild(_link)}if(__this.dialogNodes.hotKeyword.innerHTML==""){__this.dialogNodes.hotKeyword.appendChild(_hotDom)}var _hotKeyAll="";for(var key in oData){if(key!="E___00000000000"){_hotKeyAll+="∑"+key+"§"+oData[key]}}__this.keywordStr=_hotKeyAll},onException:function(){}})},searchKey:function(sHotkey){var _regSearchKey=sHotkey.replace(/([\\^$*+?{}.|])/gi,"\\$1");var searchReg=new RegExp("∑([^§]+)§[^∑]*"+_regSearchKey+"[^∑]*","gi");var _resultArray=[];this.keywordStr.replace(searchReg,function(a,b){_resultArray.push(b)});_resultArray=_resultArray.join(",");var _result={};var _allData=this.allDataBack;var _len=_allData.length;var _count=0;for(var i=0;i<_len;i++){if(_resultArray.indexOf(_allData[i].code)!=-1||_allData[i].sname.indexOf(sHotkey)!=-1||_allData[i].name.indexOf(sHotkey)!=-1){if(_result[_allData[i].sid]==null){_result[_allData[i].sid]={name:_allData[i].sname,data:[]}}_result[_allData[i].sid].data.push(_allData[i]);_count++}}var pid=scope.$pageid;if(_count==0){this.dialogNodes.smileEmpty.style.display="";this.dialogNodes.smileList.style.display="none";if(pid){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pid][isComm]+"_16_030_"+encodeURIComponent(sHotkey),pid,"")}}}else{this.dialogNodes.smileList.style.display="";this.dialogNodes.smileEmpty.style.display="none";if(pid){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pid][isComm]+"_16_031_"+encodeURIComponent(sHotkey),pid,"")}}}this.dataSettle(_result,7);this.dialogNodes.keyCtrl.style.display="";this.dialogNodes.keyWord.innerHTML=sHotkey.split("").join("<wbr/>");Core.Dom.setStyle(this.dialogNodes.sortList,"height","217px")},setPosition:function(x,y){this.x=x;this.y=y;this.dialog.setPosition({x:x,y:y})},show:function(){this.dialogNodes.searchText.value="输入关键字、动漫形象";this.dialogNodes.searchText.style.color="#9b9b9a";this.dialog.show()},hide:function(){this.dialog.hidden();this.dialogNodes.keyCtrl.style.display="none"}};scope.smilesDataV2={302:{name:"小新小浪",contract:"GY00000001",data:[{name:"灌水",code:"E___0173EN00SIG"},{name:"赞",code:"E___0480ZH00SIG"},{name:"美好",code:"E___0305EN00SIG"},{name:"顶",code:"E___0022EN00SIG"},{name:"顶",code:"E___0088EN00SIG"},{name:"顶",code:"E___0472ZH00SIG"},{name:"开心",code:"E___0092EN00SIG"},{name:"路过",code:"E___0177EN00SIG"}]}};App.insertSmilesForm2=Core.Class.create();App.insertSmilesForm2.prototype={defalutConfig:{sortCount:6,clickCallback:function(){},recommCount:8},initialize:function(oOption){this.option=oOption||{};if(this.option.sortNode==null){return}for(var key in this.defalutConfig){if(this.option[key]==null){this.option[key]=this.defalutConfig[key]}}if(scope.smilesDataV2==null){this.getSmilesData()}else{this.data=scope.smilesDataV2;this.renderUI()}},getSmilesData:function(){var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig8.js?varname=smileConfig"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.renderUI()},onException:function(){}})},renderUI:function(){var __this=this;var count=1;var first6sort=[];var first6hot=[];var firstSort;var _fragement=document.createDocumentFragment();var _sorts=$C("div");var _more=$C("span");var _clearit=$C("div");firstSort=this.data&&this.data["302"]&&this.data["302"].data;if($E(this.option.recommNode)!=null){_fragement=document.createDocumentFragment();for(var i=0;i<this.option.recommCount;i++){_title=firstSort[i].name;var _code=firstSort[i].code;var _swfName=firstSort[i].swf;node=$C("li");!function(val){node.onclick=Core.Function.bind3(function(key,title,swfName){__this.option.clickCallback(key,title,swfName);v7sendLog("32_01_20");var pid=scope.$pageid;if(pid){val+="";val=val.length==1?"0"+val:val;v7sendLog($_GLOBAL.faceCountRecommLinkTable[pid]+"_"+val+"_010_"+key,pid,"")}Core.Events.stopEvent();return false},null,[_code,_title,_swfName])}(i+8);node.hideFocus=true;var tempHTML='<a href="#"><img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_code+'T.gif" alt="'+_title+'" title="'+_title+'" height="50" width="50"/></a>';if(_swfName){tempHTML=tempHTML+'<div class="arr"><a href="#" onclick="window.$magicFacePlay(\''+_swfName+'\');return false;" ><img src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif" width="14" height="13" title="播放表情" alt="" align="absmiddle" /></a></div>'}node.innerHTML=tempHTML;_fragement.appendChild(node)}$E(this.option.recommNode).appendChild(_fragement)}count=first6sort=first6hot=firstSort=_fragement=_sorts=_more=_morelink=_clearit=_code=key=_title=node=null}};Lib.children=function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr};App.insertSmilesDialog2=function(sSortId,fCallback,sPositionNode,arrPosiPix){App.insertSmilesDialog2.callback=fCallback;if(scope.smileDialog==null){scope.smileDialog=new App.smilesDialog2}scope.smileDialog.setSort(sSortId,fCallback);var xy=Core.Dom.getXY($E(sPositionNode));var x=xy[0]+arrPosiPix[0];var y=xy[1]+arrPosiPix[1];scope.smileDialog.setPosition(x,y);scope.smileDialog.show()};App.formInsertSmile2=function(sTextarea,sSortNode,sRecommNode,fCallBack,sPositionNode,arrPix,sFrame,opt_evnets,cfg){var _oTextNode=$E(sTextarea);cfg=cfg||{};var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};if(!scope.commEditor){scope.commEditor=new commEditor}scope.commEditor.append(sFrame,sTextarea,opt_evnets);Core.Events.addEvent(_oTextNode,getPos,"keyup");Core.Events.addEvent(_oTextNode,getPos,"focus");Core.Events.addEvent(_oTextNode,getPos,"select");Core.Events.addEvent(_oTextNode,getPos,"click");var smileCfg={sortNode:sSortNode,clickCallback:function(nCode,sName,swfname){setTimeout(function(){var tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'"width="50" height="50" />';if(swfname){tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'" swfname="'+swfname+'"  width="50" height="50" />'}scope.commEditor.insertHTML(sFrame,tempHTML)},20);if(fCallBack){fCallBack()}},recommNode:sRecommNode,positionNode:sPositionNode||sSortNode,arrPosPix:arrPix||[0,0],sortCount:cfg.sortCount||6,recommCount:cfg.recommCount||8};new App.insertSmilesForm2(smileCfg)};var commEditor=function(frame,area){this.fids=[];this.areas={};this.wins={};this.docs={};this.intervals={};this.actions={}};commEditor.prototype={init:function(sFrame){var doc=this.docs[sFrame];try{doc.body.designMode="on"}catch(e){}doc.open();doc.writeln(this.getEditorHTML(""));doc.body.contentEditable=true;var win=doc.parentWindow;Lib.checkAuthor(function(){doc.body.onkeydown=function(e){try{if((e||win.event).keyCode==9){$E("login_"+($isLogin?"check":"name")).focus();return false}}catch(err){}};doc.close()},"insertSmilesFormInitV2"+(new Date).getTime())},lazyInit:function(fId){var me=this;return function(){var cDoc=me.docs[fId];if(cDoc.body.getAttribute("inited")){return}trace("执行一次:"+fId);me.init(fId);me.bindListener(fId);cDoc.body.setAttribute("inited","yes")}},append:function(sFrame,sTextarea,actions){actions=actions||{};if(!actions.interval){actions.interval={}}if(!actions.interval.before){actions.interval.before=function(){}}if(!actions.interval.after){actions.interval.after=function(){}}var frame=$E(sFrame);this.wins[sFrame]=frame.contentWindow;this.actions[sFrame]=actions;var me=this;function getDoc(){try{me.docs[sFrame]=frame.contentWindow.document;me.areas[sFrame]=$E(sTextarea);if($IE){me.docs[sFrame].body.onclick=me.lazyInit(sFrame)}else{me.lazyInit(sFrame)()}}catch(e){setTimeout(getDoc,150)}}getDoc()},frameFilter:function(body){var d=false;var val=body.innerHTML;val=val.replace(/<script[\s\S]*<\/script>/gi,"");val=val.replace(/<style[\s\S]*<\/style>/gi,"");val=val.replace(/<!-{2,}[\s\S]*?-{2,}>/g,"");val=val.replace(/<([^>]+).*?>/gi,function(all,str){var tagName=str.split(" ")[0].toLowerCase();switch(tagName){case"/p":return"<br>";case"br":return all;case"img":if(all.toLowerCase().indexOf("http://www.sinaimg.cn/uc/myshow/blog")>0||all.toLowerCase().indexOf("http://simg.sinajs.cn/blog7style/images/common")>0){if(all.toLowerCase().indexOf("t.gif")==-1&&all.toLowerCase().indexOf("img_arrow_r.gif")==-1){return""}return all}else{return""}default:return""}});val=val.replace(/\n/g,"");body.innerHTML=val},bindListener:function(sFrame){var doc=this.docs[sFrame];var area=this.areas[sFrame];var win=this.wins[sFrame];var actions=this.actions[sFrame];var me=this;if($IE){doc.onkeydown=function(){var event=win.event;if(event.keyCode==8){var ele=me.getFocusElement(sFrame);if(ele&&ele.tagName.toUpperCase()=="IMG"){ele.parentNode.removeChild(ele);event.keyCode=0;event.returnValue=false}}}}Core.Events.addEvent(doc.body,function(frameBody){return function(e){me.intervals[sFrame]=setInterval(function(){actions.interval.before(sFrame,area);me.clearFrameHTML(frameBody);var imgs=frameBody.getElementsByTagName("img");for(var i=0;imgs[i];i++){imgs[i].removeAttribute("style");imgs[i].removeAttribute("height");imgs[i].removeAttribute("width")}actions.interval.after(sFrame,area)},400)}}(doc.body),"focus");Core.Events.addEvent(doc.body,function(frameBody){return function(e){clearInterval(me.intervals[sFrame])}}(doc.body),"blur");if(actions.normal){for(var event in actions.normal){Core.Events.addEvent(doc.body,actions.normal[event],event)}}},clearFrameHTML:function(frameBody){var me=this;var arr=["a","input"];var needIt=false;for(var i=0;arr[i];i++){if(frameBody.getElementsByTagName(arr[i]).length>0){needIt=true;break}}if(needIt){me.frameFilter(frameBody)}else{var imgs=frameBody.getElementsByTagName("img");for(var i=0;imgs[i];i++){var srcInd=imgs[i].src.indexOf("http://www.sinaimg.cn/uc/myshow/blog");var tInd=imgs[i].src.toLowerCase().indexOf("t.g");var playButton=imgs[i].src.indexOf("http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif");if((srcInd==-1||tInd==-1)&&playButton==-1){me.frameFilter(frameBody);break}}}},getFocusElement:function(fid){if(!$IE){var select=this.win.getSelection();var range=select.getRangeAt(0);var elm=range.commonAncestorContainer;if(elm.tagName){if(elm.tagName.toLowerCase()=="body"){return elm}}if(!range.collapsed){if(range.startContainer==range.endContainer||1&&range.startContainer==range.endContainer.parentNode){if(range.startOffset-range.endOffset<2||1){if(range.startContainer.hasChildNodes()){return range.startContainer.childNodes[range.startOffset]}}}return elm.parentNode}else{return elm.parentNode}}else{var range=this.docs[fid].selection.createRange();return range.item?range.item(0):range.parentElement()}},clearHTML:function(fId){var doc=this.docs[fId];doc.body.innerHTML="";doc.body.setAttribute("contenteditable",false);doc.body.setAttribute("contenteditable",true)},insertHTML:function(fId,s_html){if($IE){this.lazyInit(fId)()}var win=this.wins[fId];var doc=this.docs[fId];if($IE){try{win.focus();var oRang=doc.selection.createRange();if(doc.selection.type.toLowerCase()=="control"){var tempRange=doc.body.createTextRange();tempRange.moveToElementText(oRang.item(0));oRang=tempRange}oRang.pasteHTML(s_html);oRang.collapse(false);oRang.select()}catch(e){}}else{if(($CHROME||$SAFARI)&&(encodeURIComponent(doc.body.innerHTML)=="%0A"||doc.body.innerHTML=="")){doc.body.focus()}this.execCommand("insertHTML",s_html,fId);if(!$CHROME&&!$SAFARI){doc.body.focus()}}},execCommand:function(cmd,value,fId){var win=this.wins[fId];var doc=this.docs[fId];win.focus();doc.execCommand(cmd,"",value);win.focus()},handleChange:function(fId){var body=this.docs[fId].body;this.areas[fId].value=this.getHandledStr(body)},getHandledStr:function(body){var strArr=[];if(body.hasChildNodes()){body=body.childNodes;for(var i=0;body[i];i++){strArr.push(this.handleDom(body[i]))}}else{strArr.push(this.handleDom(body))}return strArr.join("").replace(/\u00A0/gi," ")},handleDom:function(ele){if(ele.nodeType==3){var val=ele.nodeValue;if(!Core.String.trim(val)){return""}return this.reEscapeHTML(val)}else if(ele.nodeType==1){if(ele.hasChildNodes()&&(ele.childNodes.length!=1||ele.childNodes.length==1&&ele.childNodes[0].tagName)){var strArr=[];if(ele.tagName){var tN=ele.tagName.toUpperCase();if(tN=="DIV"||tN=="P"){strArr.push("\n")}}ele=ele.childNodes;for(var i=0;ele[i];i++){strArr.push(this.handleDom(ele[i]))}return strArr.join("")}else{var tN=ele.tagName.toUpperCase();if(tN=="IMG"){if(ele.src.indexOf("http://www.sinaimg.cn/uc/myshow/blog")!=-1){if(ele.src.indexOf("T.g")==-1){return""}var nCode=ele.src.split("T.g")[0];nCode=nCode.substring(nCode.lastIndexOf("/")+1,nCode.length);var sName=ele.getAttribute("title");var swfname=ele.getAttribute("swfname");if(!swfname&&nCode[0]=="W"){swfname=nCode+"S.swf"}if(sName){if(swfname){return"[magicemoticons="+nCode+" swfname="+swfname+"]"+sName+"[/magicemoticons]"}else{return"[emoticons="+nCode+"]"+sName+"[/emoticons]"}}}else{return""}}else if(tN=="BR"){return"\n"}else if(tN=="DIV"||tN=="P"){var val=ele.innerHTML||"";return"\n"+this.reEscapeHTML(val)}else if(tN=="SCRIPT"||tN=="STYLE"){return""}else{val=ele.innerHTML||ele.value||"";return this.reEscapeHTML(val)}}}return""},reEscapeHTML:function(str){str=str.replace(/\n/g,"");str=str.replace(/&nbsp;/g," ");str=str.replace(/&quot;/g,'"');str=str.replace(/&lt;/g,"<");str=str.replace(/&gt;/g,">");str=str.replace(/&amp;/g,"&");return str},getEditorHTML:function(sContent){var html="";html+="<html>";html+="<head>";html+='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />';html+="<style>		p {			*margin:0.2em auto;		}		body {			margin: 0;			scrollbar-face-color: #ffffff;			scrollbar-highlight-color: #ffffff;			scrollbar-shadow-color: #c0c1bb;			scrollbar-3dlight-color: #c0c1bb;			scrollbar-arrow-color: #c9cbb6;			scrollbar-track-color: #f4f5f0;			scrollbar-darkshadow-color: #ffffff;			scrollbar-base-color: #ffffff;			padding: 10px;			word-wrap: break-word;			overflow: scroll;			overflow-x: auto;			height: 90%;			font-size: 14px;		}		body, td, textarea, input, br, div, span{			font-family: '', Verdana,Arial, Helvetica, sans-serif;			line-height:1.5;		}		img{			border: 0;		}		html{			height: 100%;			cursor: text;		}		pre{			white-space:normal;		}		form{margin: 0;}		body table{font-size: 14px;}		.border{ border:1px dashed #cfcfcf;}		</style>		<script>document.domain='sina.com.cn';</script>		";html+="</head>";html+="<body>";html+=sContent;html+="</body>";html+="</html>";return html}};App.insertSmilesForm2=Core.Class.create();App.insertSmilesForm2.prototype={defalutConfig:{sortCount:6,clickCallback:function(){},recommCount:8},initialize:function(oOption){this.option=oOption||{};if(this.option.sortNode==null){return}for(var key in this.defalutConfig){if(this.option[key]==null){this.option[key]=this.defalutConfig[key]}}if(scope.smilesData==null){this.getSmilesData()}else{this.data=scope.smilesData;this.renderUI()}},getSmilesData:function(){var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig8.js?varname=smileConfig"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.renderUI()},onException:function(){}})},renderUI:function(){var __this=this;var count=1;var first6sort=[];var first6hot=[];var firstSort;var _fragement=document.createDocumentFragment();var _sorts=$C("div");var _more=$C("span");var _clearit=$C("div");_sorts.className="facestyle";for(var key in this.data){if(count==1){firstSort=this.data[key]||{data:{}};firstSort=firstSort.data}if(count<=this.option.sortCount){var _title=this.data[key].name;var node=$C("a");node.href="#";node.setAttribute("key",key);node.onclick=function(){Core.Events.stopEvent();return false};node.onmousedown=Core.Function.bind3(function(key){App.insertSmilesDialog2(key,__this.option.clickCallback,__this.option.positionNode,__this.option.arrPosPix)},null,[key]);node.hideFocus=true;node.innerHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+key+'-25.gif" alt="'+_title+'" title="'+_title+'" />';_sorts.appendChild(node);count++}else{break}}var timpStamp=(new Date).getTime();_sorts.id="recomm_"+timpStamp;_fragement.appendChild(_sorts);_more.className="SG_more";var _morelink=$C("a");
_morelink.href="#";_morelink.onclick=function(){Core.Events.stopEvent();return false};_morelink.onmousedown=function(ele){return function(){App.insertSmilesDialog2(0,__this.option.clickCallback,__this.option.positionNode,__this.option.arrPosPix);var pid=scope.$pageid;if(pid){var ppId=ele.parentNode.parentNode.id.split("_")[0];if(ppId){scope.isFromtheCommonhzh=$_GLOBAL.faceCountMoreLinkTable[pid][ppId][1];v7sendLog($_GLOBAL.faceCountMoreLinkTable[pid][ppId][0]+"_07_000_000",pid,"")}}}}(_morelink);_morelink.innerHTML="更多>>";_more.appendChild(_morelink);_fragement.appendChild(_more);_clearit.className="clearit";_fragement.appendChild(_clearit);$E(this.option.sortNode).appendChild(_fragement);if($E(this.option.recommNode)!=null){_fragement=document.createDocumentFragment();for(var i=0;i<this.option.recommCount;i++){_title=firstSort[i].name;var _code=firstSort[i].code;var _swfName=firstSort[i].swf;node=$C("li");!function(val){node.onclick=Core.Function.bind3(function(key,title,swfName){__this.option.clickCallback(key,title,swfName);var pid=scope.$pageid;if(pid){val+="";val=val.length==1?"0"+val:val;v7sendLog($_GLOBAL.faceCountRecommLinkTable[pid]+"_"+val+"_010_"+key,pid,"")}Core.Events.stopEvent();return false},null,[_code,_title,_swfName])}(i+8);node.hideFocus=true;var tempHTML='<a href="#"><img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_code+'T.gif" alt="'+_title+'" title="'+_title+'" height="50" width="50"/></a>';if(_swfName){tempHTML=tempHTML+'<div class="arr"><a href="#" onclick="window.$magicFacePlay(\''+_swfName+'\');return false;" ><img src="http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif" width="14" height="13" title="播放表情" alt="" align="absmiddle" /></a></div>'}node.innerHTML=tempHTML;_fragement.appendChild(node)}$E(this.option.recommNode).appendChild(_fragement)}var _sChildren=Lib.children($E("recomm_"+timpStamp).childNodes);for(var i=0;_sChildren[i];i++){Core.Events.addEvent(_sChildren[i],function(ele,val){return function(){var pid=scope.$pageid;if(pid){var ppId=ele.parentNode.parentNode.id.split("_")[0];if(ppId){scope.isFromtheCommonhzh=$_GLOBAL.faceCountMoreLinkTable[pid][ppId][1];v7sendLog($_GLOBAL.faceCountMoreLinkTable[pid][ppId][0]+"_0"+val+"_020_"+ele.getAttribute("key"),pid,"")}}}}(_sChildren[i],i+1),"mousedown")}count=first6sort=first6hot=firstSort=_fragement=_sorts=_more=_morelink=_clearit=_code=key=_title=node=null}};Lib.children=function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr};App.insertSmilesDialog2=function(sSortId,fCallback,sPositionNode,arrPosiPix){App.insertSmilesDialog2.callback=fCallback;if(scope.smileDialog==null){scope.smileDialog=new App.smilesDialog2}scope.smileDialog.setSort(sSortId,fCallback);var xy=Core.Dom.getXY($E(sPositionNode));var x=xy[0]+arrPosiPix[0];var y=xy[1]+arrPosiPix[1];scope.smileDialog.setPosition(x,y);scope.smileDialog.show()};App.formInsertSmile2=function(sTextarea,sSortNode,sRecommNode,fCallBack,sPositionNode,arrPix,sFrame,opt_evnets,cfg){var _oTextNode=$E(sTextarea);cfg=cfg||{};var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};if(!scope.commEditor){scope.commEditor=new commEditor}scope.commEditor.append(sFrame,sTextarea,opt_evnets);Core.Events.addEvent(_oTextNode,getPos,"keyup");Core.Events.addEvent(_oTextNode,getPos,"focus");Core.Events.addEvent(_oTextNode,getPos,"select");Core.Events.addEvent(_oTextNode,getPos,"click");var smileCfg={sortNode:sSortNode,clickCallback:function(nCode,sName,swfname){setTimeout(function(){var tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'"width="50" height="50" />';if(swfname){tempHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+nCode+'T.gif" alt="'+sName+'" title="'+sName+'" swfname="'+swfname+'"  width="50" height="50" />'}scope.commEditor.insertHTML(sFrame,tempHTML)},20);if(fCallBack){fCallBack()}},recommNode:sRecommNode,positionNode:sPositionNode||sSortNode,arrPosPix:arrPix||[0,0],sortCount:cfg.sortCount||6,recommCount:cfg.recommCount||8};new App.insertSmilesForm2(smileCfg)};var commEditor=function(frame,area){this.fids=[];this.areas={};this.wins={};this.docs={};this.intervals={};this.actions={}};commEditor.prototype={init:function(sFrame){var doc=this.docs[sFrame];try{doc.body.designMode="on"}catch(e){}doc.open();doc.writeln(this.getEditorHTML(""));doc.body.contentEditable=true;var win=doc.parentWindow;Lib.checkAuthor(function(){doc.body.onkeydown=function(e){try{if((e||win.event).keyCode==9){$E("login_"+($isLogin?"check":"name")).focus();return false}}catch(err){}};doc.close()},"insertSmilesFormInit"+(new Date).getTime())},lazyInit:function(fId){var me=this;return function(){var cDoc=me.docs[fId];if(cDoc.body.getAttribute("inited")){return}trace("执行一次:"+fId);me.init(fId);me.bindListener(fId);cDoc.body.setAttribute("inited","yes")}},append:function(sFrame,sTextarea,actions){actions=actions||{};if(!actions.interval){actions.interval={}}if(!actions.interval.before){actions.interval.before=function(){}}if(!actions.interval.after){actions.interval.after=function(){}}var frame=$E(sFrame);this.wins[sFrame]=frame.contentWindow;this.actions[sFrame]=actions;var me=this;function getDoc(){try{me.docs[sFrame]=frame.contentWindow.document;me.areas[sFrame]=$E(sTextarea);if($IE){me.docs[sFrame].body.onclick=me.lazyInit(sFrame)}else{me.lazyInit(sFrame)()}}catch(e){setTimeout(getDoc,150)}}getDoc()},frameFilter:function(body){var d=false;var val=body.innerHTML;val=val.replace(/<script[\s\S]*<\/script>/gi,"");val=val.replace(/<style[\s\S]*<\/style>/gi,"");val=val.replace(/<!-{2,}[\s\S]*?-{2,}>/g,"");val=val.replace(/<([^>]+).*?>/gi,function(all,str){var tagName=str.split(" ")[0].toLowerCase();switch(tagName){case"/p":return"<br>";case"br":return all;case"img":if(all.toLowerCase().indexOf("http://www.sinaimg.cn/uc/myshow/blog")>0||all.toLowerCase().indexOf("http://simg.sinajs.cn/blog7style/images/common")>0){if(all.toLowerCase().indexOf("t.gif")==-1&&all.toLowerCase().indexOf("img_arrow_r.gif")==-1){return""}return all}else{return""}default:return""}});val=val.replace(/\n/g,"");body.innerHTML=val},bindListener:function(sFrame){var doc=this.docs[sFrame];var area=this.areas[sFrame];var win=this.wins[sFrame];var actions=this.actions[sFrame];var me=this;if($IE){doc.onkeydown=function(){var event=win.event;if(event.keyCode==8){var ele=me.getFocusElement(sFrame);if(ele&&ele.tagName.toUpperCase()=="IMG"){ele.parentNode.removeChild(ele);event.keyCode=0;event.returnValue=false}}}}Core.Events.addEvent(doc.body,function(frameBody){return function(e){me.intervals[sFrame]=setInterval(function(){actions.interval.before(sFrame,area);me.clearFrameHTML(frameBody);var imgs=frameBody.getElementsByTagName("img");for(var i=0;imgs[i];i++){imgs[i].removeAttribute("style");imgs[i].removeAttribute("height");imgs[i].removeAttribute("width")}actions.interval.after(sFrame,area)},400)}}(doc.body),"focus");Core.Events.addEvent(doc.body,function(frameBody){return function(e){clearInterval(me.intervals[sFrame])}}(doc.body),"blur");if(actions.normal){for(var event in actions.normal){Core.Events.addEvent(doc.body,actions.normal[event],event)}}},clearFrameHTML:function(frameBody){var me=this;var arr=["a","input"];var needIt=false;for(var i=0;arr[i];i++){if(frameBody.getElementsByTagName(arr[i]).length>0){needIt=true;break}}if(needIt){me.frameFilter(frameBody)}else{var imgs=frameBody.getElementsByTagName("img");for(var i=0;imgs[i];i++){var srcInd=imgs[i].src.indexOf("http://www.sinaimg.cn/uc/myshow/blog");var tInd=imgs[i].src.toLowerCase().indexOf("t.g");var playButton=imgs[i].src.indexOf("http://simg.sinajs.cn/blog7style/images/common/img_arrow_r.gif");if((srcInd==-1||tInd==-1)&&playButton==-1){me.frameFilter(frameBody);break}}}},getFocusElement:function(fid){if(!$IE){var select=this.win.getSelection();var range=select.getRangeAt(0);var elm=range.commonAncestorContainer;if(elm.tagName){if(elm.tagName.toLowerCase()=="body"){return elm}}if(!range.collapsed){if(range.startContainer==range.endContainer||1&&range.startContainer==range.endContainer.parentNode){if(range.startOffset-range.endOffset<2||1){if(range.startContainer.hasChildNodes()){return range.startContainer.childNodes[range.startOffset]}}}return elm.parentNode}else{return elm.parentNode}}else{var range=this.docs[fid].selection.createRange();return range.item?range.item(0):range.parentElement()}},clearHTML:function(fId){var doc=this.docs[fId];doc.body.innerHTML="";doc.body.setAttribute("contenteditable",false);doc.body.setAttribute("contenteditable",true)},insertHTML:function(fId,s_html){if($IE){this.lazyInit(fId)()}var win=this.wins[fId];var doc=this.docs[fId];if($IE){try{win.focus();var oRang=doc.selection.createRange();if(doc.selection.type.toLowerCase()=="control"){var tempRange=doc.body.createTextRange();tempRange.moveToElementText(oRang.item(0));oRang=tempRange}oRang.pasteHTML(s_html);oRang.collapse(false);oRang.select()}catch(e){}}else{if(($CHROME||$SAFARI)&&(encodeURIComponent(doc.body.innerHTML)=="%0A"||doc.body.innerHTML=="")){doc.body.focus()}this.execCommand("insertHTML",s_html,fId);if(!$CHROME&&!$SAFARI){doc.body.focus()}}},execCommand:function(cmd,value,fId){var win=this.wins[fId];var doc=this.docs[fId];win.focus();doc.execCommand(cmd,"",value);win.focus()},handleChange:function(fId){var body=this.docs[fId].body;this.areas[fId].value=this.getHandledStr(body)},getHandledStr:function(body){var strArr=[];if(body.hasChildNodes()){body=body.childNodes;for(var i=0;body[i];i++){strArr.push(this.handleDom(body[i]))}}else{strArr.push(this.handleDom(body))}return strArr.join("").replace(/\u00A0/gi," ")},handleDom:function(ele){if(ele.nodeType==3){var val=ele.nodeValue;if(!Core.String.trim(val)){return""}return this.reEscapeHTML(val)}else if(ele.nodeType==1){if(ele.hasChildNodes()&&(ele.childNodes.length!=1||ele.childNodes.length==1&&ele.childNodes[0].tagName)){var strArr=[];if(ele.tagName){var tN=ele.tagName.toUpperCase();if(tN=="DIV"||tN=="P"){strArr.push("\n")}}ele=ele.childNodes;for(var i=0;ele[i];i++){strArr.push(this.handleDom(ele[i]))}return strArr.join("")}else{var tN=ele.tagName.toUpperCase();if(tN=="IMG"){if(ele.src.indexOf("http://www.sinaimg.cn/uc/myshow/blog")!=-1){if(ele.src.indexOf("T.g")==-1){return""}var nCode=ele.src.split("T.g")[0];nCode=nCode.substring(nCode.lastIndexOf("/")+1,nCode.length);var sName=ele.getAttribute("title");var swfname=ele.getAttribute("swfname");if(!swfname&&nCode[0]=="W"){swfname=nCode+"S.swf"}if(sName){if(swfname){return"[magicemoticons="+nCode+" swfname="+swfname+"]"+sName+"[/magicemoticons]"}else{return"[emoticons="+nCode+"]"+sName+"[/emoticons]"}}}else{return""}}else if(tN=="BR"){return"\n"}else if(tN=="DIV"||tN=="P"){var val=ele.innerHTML||"";return"\n"+this.reEscapeHTML(val)}else if(tN=="SCRIPT"||tN=="STYLE"){return""}else{val=ele.innerHTML||ele.value||"";return this.reEscapeHTML(val)}}}return""},reEscapeHTML:function(str){str=str.replace(/\n/g,"");str=str.replace(/&nbsp;/g," ");str=str.replace(/&quot;/g,'"');str=str.replace(/&lt;/g,"<");str=str.replace(/&gt;/g,">");str=str.replace(/&amp;/g,"&");return str},getEditorHTML:function(sContent){var html="";html+="<html>";html+="<head>";html+='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />';html+="<style>		p {			*margin:0.2em auto;		}		body {			margin: 0;			scrollbar-face-color: #ffffff;			scrollbar-highlight-color: #ffffff;			scrollbar-shadow-color: #c0c1bb;			scrollbar-3dlight-color: #c0c1bb;			scrollbar-arrow-color: #c9cbb6;			scrollbar-track-color: #f4f5f0;			scrollbar-darkshadow-color: #ffffff;			scrollbar-base-color: #ffffff;			padding: 10px;			word-wrap: break-word;			overflow: scroll;			overflow-x: auto;			height: 90%;			font-size: 14px;		}		body, td, textarea, input, br, div, span{			font-family: '', Verdana,Arial, Helvetica, sans-serif;			line-height:1.5;		}		img{			border: 0;		}		html{			height: 100%;			cursor: text;		}		pre{			white-space:normal;		}		form{margin: 0;}		body table{font-size: 14px;}		.border{ border:1px dashed #cfcfcf;}		</style>		<script>document.domain='sina.com.cn';</script>		";html+="</head>";html+="<body>";html+=sContent;html+="</body>";html+="</html>";return html}};App.smilesTemplate=['<table id="#{entity}" class="CP_w faceItemContent" style="visibility: visible;">','<thead id="#{titleBar}"><tr><th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong id="#{titleName}">插入表情</strong><cite><a id="#{btnClose}"',' href="#" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th></tr></thead>','<tfoot><tr><td class="tLeft"><span></span></td><td class="tMid"><span></span></td>','<td class="tRight"><span></span></td></tr></tfoot>',"<tbody><tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="insertface">','<div class="insertface_top">','<h3>热门动漫表情</h3><div class="insertface_search">','<input id="#{searchText}" type="text" class="SG_input" value="输入关键字、动漫形象"',' style="color:#9b9b9a;" maxlength="20" /><a id="#{searchBtn}" href="#" onclick="return false;" ','hidefocue="true" class="SG_aBtn SG_aBtnB"><cite>查找表情</cite></a></div>','<div class="clearit"></div>',"</div>",'<div class="insertface_hot">','<span class="insertface_keyword">热门关键字：<span id="#{hotKeyword}"></span></span>','<span class="insertface_hotslider"></span>',"</div>",'<div class="bigface">','<div class="faceSidebar">','<div id="#{keyCtrl}" class="facekeyword" style="display:none;">','<p><< <a id="#{keyCtrlBack}" href="#" onclick="return false;">返回全部关键字</a></p>','<p>关键字：<span id="#{keyWord}"></span></p></div>','<h3 id="#{allSort}" class="facetitle" style="font-weight:600;"><a href="#"',' onclick="return false;">全部</a></h3>','<div id="#{sortList}" class="facelist"></div>','<div id="#{sortCtrl}" class="facearrow"></div>',"</div>",'<div class="faceShowAll">','<div id="#{smileEmpty}" class="faceShownone" style="display:none;"><p>找不到和关键字相符的表情。','<br /><br /><a id="#{smileEmptyBack}" href="#" onclick="return false;">&lt;&lt;返回首页</a></p></div>','<ul class="faceShowAll_list" id="#{smileList}"></ul>','<div class="SG_page"><ul class="SG_pages">','<li id="#{smilePagePrev}" class="SG_s_pgprev"></li>','<li id="#{smilePageShow}" class="SG_s_pgnum"></li>','<li id="#{smilePageNext}" class="SG_s_pgnext"></li>',"</ul></div>","</div>","</div>","</div>",'</td><td class="tRight"><span></span></td>',"</tr></tbody></table>"].join("");App.smilesDialog=Core.Class.create();App.smilesDialog.prototype={pageSize:24,defaultConfig:{sortId:"0",htmlTpl:App.smilesTemplate,callback:function(){}},initialize:function(oOption){this.option=oOption||{};for(var key in this.defaultConfig){if(this.option[key]==null){this.option[key]=this.defaultConfig[key]}}this.dialog=new Dialog(this.option.htmlTpl);this.dialogNodes=this.dialog.getNodes();this.getKeyWord();if(scope.smilesData!=null){this.data=scope.smilesData;this.dataSettle();this.eventListen()}else{var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig.js?varname=smileConfig",charset:"GBK"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.dataSettle();__this.eventListen()},onException:function(){}})}return this},dataSettle:function(oData,nCount){oData=oData||this.data;nCount=nCount||9;this.tabsData=[];this.allData=[];for(var key in oData){var _item=oData[key];_item.sortId=key;this.tabsData.push(_item);for(var i=0,len=_item.data.length;i<len;i++){_item.data[i].sid=key;_item.data[i].sname=_item.name}this.allData=this.allData.concat(_item.data)}if(this.allDataBack==null){this.allDataBack=this.allData.slice(0)}this.showTab(1,nCount);if(this.dialogNodes.smileList.childNodes.length==0){this.showAll()}},children:function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr},showTab:function(nPage,nCount){nPage=nPage||1;nCount=nCount||9;this.dialogNodes.sortList.innerHTML="";this.dialogNodes.smileList.innerHTML="";Core.Dom.setStyle(this.dialogNodes.sortList,"height",nCount==9?"279px":"217px");this.tabs=new Tabs(this.dialogNodes.sortList);this.tabsObject={};var _this=this;for(var i=0;i<nCount;i++){var _indexBase=(nPage-1)*nCount;if(this.tabsData[_indexBase+i]==null){break}var _sortId=this.tabsData[_indexBase+i].sortId;var _name=this.tabsData[_indexBase+i].name;var _data=this.tabsData[_indexBase+i].data;var tab=new Tab('<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_sortId+'.gif" height="20" width="20" align="absmiddle"><span><a href="#" onclick="return false;">'+_name+"</a></span><em>("+_data.length+")</em>",{isFocus:false,className:"cur"});tab.addOnAbort(Core.Function.bind3(function(tab){},null,[tab]));tab.addOnFocus(Core.Function.bind3(function(tab,key,data,sid){_this.showSmile(data,1,_this.pageSize);_this.currentTab=tab;_this.dialogNodes.allSort.style.fontWeight=400;if(!_this.isFromUp){var pId=scope.$pageid;if(pId){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pId][isComm]+"_16_020_"+sid,pId,"")}}}_this.isFromUp=null},null,[tab,_indexBase+i,_data,_sortId]));this.tabsObject[_sortId]=tab;this.tabs.add(tab)}var _tabPageCount=Math.ceil(this.tabsData.length/nCount);if(_tabPageCount>0){this.showTabPage(nPage||1,_tabPageCount,nCount)}else{this.dialogNodes.sortCtrl.innerHTML=""}},showSmile:function(oData,nPage,nCount){var me=this;nCount=nCount||this.pageSize;var __this=this;var _smiles=oData;var _count=_smiles.length;var _totalPages=Math.ceil(_count/nCount);var _smilesDom=document.createDocumentFragment();var _pageLink;this.dialogNodes.smileList.innerHTML="";for(var i=0;i<nCount;i++){var _smile=_smiles[(nPage-1)*nCount+i];if(_smile==null){break}var _li=$C("li");var _a=$C("a");_a.href="#";_a.onclick=function(){return false};_a.onmousedown=Core.Function.bind3(function(nCode,sName){__this.option.callback(nCode,sName);__this.hide()},null,[_smile.code,_smile.name]);_a.innerHTML='<img style="width:50px;height:50px;" src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_smile.code+'T.gif" alt="'+_smile.name+'" title="'+_smile.name+'" />';_li.appendChild(_a);_a.setAttribute("key",_smile.code);var _span=$C("span");_span.title=_smile.name;_span.innerHTML=Core.String.byteLength(_smile.name)>8?Core.String.leftB(_smile.name,6)+"…":_smile.name;_li.appendChild(_span);_smilesDom.appendChild(_li);Core.Events.addEvent(_a,function(ele){return function(){var pId=scope.$pageid;if(pId){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pId][isComm]+"_16_010_"+ele.getAttribute("key"),pId,"")}}}}(_a),"mousedown")}this.dialogNodes.smileList.appendChild(_smilesDom);if(_count>nCount){if(nPage==1){this.dialogNodes.smilePagePrev.innerHTML="上一页"}else{this.dialogNodes.smilePagePrev.innerHTML="";_pageLink=$C("a");_pageLink.href="#";_pageLink.onclick=function(){return false};_pageLink.onmousedown=function(){__this.showSmile(_smiles,nPage-1,nCount)};_pageLink.innerHTML="上一页";this.dialogNodes.smilePagePrev.appendChild(_pageLink)}this.dialogNodes.smilePageShow.innerHTML=nPage+"/"+_totalPages;if(nPage>=_totalPages){this.dialogNodes.smilePageNext.innerHTML="下一页"}else{this.dialogNodes.smilePageNext.innerHTML="";_pageLink=$C("a");_pageLink.href="#";_pageLink.onclick=function(){return false};_pageLink.onmouseup=function(){__this.showSmile(_smiles,nPage+1,nCount)};_pageLink.innerHTML="下一页";this.dialogNodes.smilePageNext.appendChild(_pageLink)}}else{this.dialogNodes.smilePagePrev.innerHTML="";this.dialogNodes.smilePageShow.innerHTML="";this.dialogNodes.smilePageNext.innerHTML=""}},showTabPage:function(nPageNum,nPageCount,nTabsPerPage){this.dialogNodes.sortCtrl.innerHTML="";this.dialogNodes.smilePagePrev.innerHTML="";this.dialogNodes.smilePageShow.innerHTML="";this.dialogNodes.smilePageNext.innerHTML="";var __this=this;var _arrow;if(nPageNum==1){if(nPageNum!=nPageCount){this.dialogNodes.sortCtrl.innerHTML='<a href="#" onclick="return false;" title="向上" class="up_off"></a>';_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向下";_arrow.className="down";_arrow.onmousedown=function(){__this.showTab(nPageNum+1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow)}else{}}else if(nPageNum<nPageCount){_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向上";_arrow.className="up";_arrow.onmousedown=function(){__this.showTab(nPageNum-1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow);_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向下";_arrow.className="down";_arrow.onmousedown=function(){__this.showTab(nPageNum+1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow)}else{_arrow=$C("a");_arrow.href="#";_arrow.onclick=function(){return false};_arrow.title="向上";_arrow.className="up";_arrow.onmousedown=function(){__this.showTab(nPageNum-1,nTabsPerPage);__this.showAll()};this.dialogNodes.sortCtrl.appendChild(_arrow);Core.Dom.addHTML(this.dialogNodes.sortCtrl,'<a href="#" onclick="return false;" title="向下" class="down_off"></a>')}},eventListen:function(){var __this=this;var _searchText=__this.dialogNodes.searchText;var _searchBtn=__this.dialogNodes.searchBtn;var _keywordBack=__this.dialogNodes.keyCtrlBack;var _allSort=__this.dialogNodes.allSort;var _smileEmptyBack=__this.dialogNodes.smileEmptyBack;Core.Events.addEvent(document.body,function(cls){var _event=Core.Events.getEvent(),_eventTarget=$IE?_event.srcElement:_event.target;if(__this.dialogNodes.entity!=null&&(Core.Dom.contains(__this.dialogNodes.entity,_eventTarget)==false||cls==true)){__this.hide()}});Core.Events.addEvent(this.dialogNodes.btnClose,function(){__this.hide()});Core.Events.addEvent(_searchText,function(){if(Core.String.trim(_searchText.value)=="输入关键字、动漫形象"){_searchText.value="";_searchText.style.color="#000"}_searchText.select()},"focus");Core.Events.addEvent(_searchText,function(){if(Core.String.trim(_searchText.value)==""){_searchText.value="输入关键字、动漫形象";_searchText.style.color="#9b9b9a"}},"blur");Core.Events.addEvent(_searchText,function(e){var _evt=Core.Events.getEvent();var _key=_evt.which||_evt.keyCode;var _keyword=Core.String.trim(_searchText.value);if(_key==13&&_keyword!=""){__this.searchKey(_keyword)}},"keydown");Utils.Form.limitMaxLen(_searchText,20);Core.Events.addEvent(_searchBtn,function(){if(_searchText.value=="输入关键字、动漫形象"||_searchText.value==""){}else{__this.searchKey(_searchText.value);_searchText.focus()}});var _backHome=function(){__this.dataSettle(__this.data,9);__this.dialogNodes.keyCtrl.style.display="none";__this.dialogNodes.smileEmpty.style.display="none";__this.dialogNodes.smileList.style.display="";__this.dialogNodes.searchText.value="输入关键字、动漫形象";__this.dialogNodes.searchText.style.color="#9b9b9a"};Core.Events.addEvent(_keywordBack,_backHome);Core.Events.addEvent(_smileEmptyBack,_backHome);Core.Events.addEvent(_allSort,function(){__this.showAll()})},showAll:function(){this.showSmile(this.allData,1,this.pageSize);this.dialogNodes.allSort.style.fontWeight=600;if(this.currentTab!=null){this.currentTab.setAbort()}},setSort:function(sId,fCallback){this.isFromUp=sId;this.option.sortId=sId;this.option.callback=fCallback;if(sId==0){this.dialogNodes.allSort.style.fontWeight=600;this.dataSettle()}else{this.dataSettle();this.tabs.swapTags(this.tabsObject[sId])}},getKeyWord:function(){if(this.keywordData!=null){return}var __this=this;var smileData=Utils.Io.JsLoad.request("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileKeywordConfig.js?varname=smileKeywordConfig&rnd="+Math.random(),{onComplete:function(oData){__this.keywordData=oData;var _hotkey=oData.E___00000000000||"顶|路过|哭|啦啦|美女";var _hotDom=document.createDocumentFragment();_hotkey=_hotkey.split("|");for(var i=0,len=_hotkey.length;i<len;i++){var _link=$C("a");_link.href="#";_link.onclick=function(){return false};_link.onmousedown=Core.Function.bind3(function(sHotkey){__this.searchKey(sHotkey)},null,[_hotkey[i]]);_link.innerHTML=_hotkey[i];_hotDom.appendChild(_link)}if(__this.dialogNodes.hotKeyword.innerHTML==""){__this.dialogNodes.hotKeyword.appendChild(_hotDom)}var _hotKeyAll="";for(var key in oData){if(key!="E___00000000000"){_hotKeyAll+="∑"+key+"§"+oData[key]}}__this.keywordStr=_hotKeyAll},onException:function(){}})},searchKey:function(sHotkey){var _regSearchKey=sHotkey.replace(/([\\^$*+?{}.|])/gi,"\\$1");var searchReg=new RegExp("∑([^§]+)§[^∑]*"+_regSearchKey+"[^∑]*","gi");var _resultArray=[];this.keywordStr.replace(searchReg,function(a,b){_resultArray.push(b)});_resultArray=_resultArray.join(",");var _result={};var _allData=this.allDataBack;var _len=_allData.length;var _count=0;for(var i=0;i<_len;i++){if(_resultArray.indexOf(_allData[i].code)!=-1||_allData[i].sname.indexOf(sHotkey)!=-1||_allData[i].name.indexOf(sHotkey)!=-1){if(_result[_allData[i].sid]==null){_result[_allData[i].sid]={name:_allData[i].sname,data:[]}}_result[_allData[i].sid].data.push(_allData[i]);_count++}}var pid=scope.$pageid;if(_count==0){this.dialogNodes.smileEmpty.style.display="";this.dialogNodes.smileList.style.display="none";if(pid){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pid][isComm]+"_16_030_"+encodeURIComponent(sHotkey),pid,"")}}}else{this.dialogNodes.smileList.style.display="";this.dialogNodes.smileEmpty.style.display="none";if(pid){var isComm=scope.isFromtheCommonhzh;if(isComm){v7sendLog($_GLOBAL.faceChooseTable[pid][isComm]+"_16_031_"+encodeURIComponent(sHotkey),pid,"")}}}this.dataSettle(_result,7);this.dialogNodes.keyCtrl.style.display="";this.dialogNodes.keyWord.innerHTML=sHotkey.split("").join("<wbr/>");Core.Dom.setStyle(this.dialogNodes.sortList,"height","217px")},setPosition:function(x,y){this.x=x;this.y=y;this.dialog.setPosition({x:x,y:y})},show:function(){this.dialogNodes.searchText.value="输入关键字、动漫形象";this.dialogNodes.searchText.style.color="#9b9b9a";this.dialog.show()},hide:function(){this.dialog.hidden();this.dialogNodes.keyCtrl.style.display="none"}};App.insertSmilesForm=Core.Class.create();App.insertSmilesForm.prototype={defalutConfig:{sortCount:6,clickCallback:function(){},recommCount:8},initialize:function(oOption){this.option=oOption||{};if(this.option.sortNode==null){return}for(var key in this.defalutConfig){if(this.option[key]==null){this.option[key]=this.defalutConfig[key]}}if(scope.smilesData==null){this.getSmilesData()}else{this.data=scope.smilesData;this.renderUI()}},getSmilesData:function(){var __this=this;var smileData=Utils.Io.JsLoad.request([{url:"http://www.sinaimg.cn/uc/myshow/blog/misc/gif/smileConfig.js?varname=smileConfig",charset:"GBK"}],{onComplete:function(oData){scope.smilesData=oData;__this.data=oData;__this.renderUI()},onException:function(){}})},renderUI:function(){var __this=this;var count=1;var first6sort=[];var first6hot=[];var firstSort;var _fragement=document.createDocumentFragment();var _sorts=$C("div");var _more=$C("span");var _clearit=$C("div");_sorts.className="facestyle";for(var key in this.data){if(count==1){firstSort=this.data[key]||{data:{}};firstSort=firstSort.data}if(count<=this.option.sortCount){var _title=this.data[key].name;var node=$C("a");node.href="#";node.setAttribute("key",key);node.onclick=function(){Core.Events.stopEvent();return false};node.onmousedown=Core.Function.bind3(function(key){App.insertSmilesDialog(key,__this.option.clickCallback,__this.option.positionNode,__this.option.arrPosPix)},null,[key]);node.hideFocus=true;node.innerHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+key+'-25.gif" alt="'+_title+'" title="'+_title+'" />';_sorts.appendChild(node);count++}else{break}}var timpStamp=(new Date).getTime();_sorts.id="recomm_"+timpStamp;_fragement.appendChild(_sorts);_more.className="SG_more";var _morelink=$C("a");_morelink.href="#";_morelink.onclick=function(){Core.Events.stopEvent();return false};_morelink.onmousedown=function(ele){return function(){App.insertSmilesDialog(0,__this.option.clickCallback,__this.option.positionNode,__this.option.arrPosPix);var pid=scope.$pageid;if(pid){var ppId=ele.parentNode.parentNode.id.split("_")[0];if(ppId){scope.isFromtheCommonhzh=$_GLOBAL.faceCountMoreLinkTable[pid][ppId][1];v7sendLog($_GLOBAL.faceCountMoreLinkTable[pid][ppId][0]+"_07_000_000",pid,"")}}}}(_morelink);_morelink.innerHTML="更多>>";_more.appendChild(_morelink);_fragement.appendChild(_more);_clearit.className="clearit";_fragement.appendChild(_clearit);$E(this.option.sortNode).appendChild(_fragement);if($E(this.option.recommNode)!=null){_fragement=document.createDocumentFragment();for(var i=0;i<this.option.recommCount;i++){_title=firstSort[i].name;var _code=firstSort[i].code;node=$C("a");node.href="#";!function(val){node.onclick=Core.Function.bind3(function(key,title){__this.option.clickCallback(key,title);var pid=scope.$pageid;if(pid){val+="";val=val.length==1?"0"+val:val;v7sendLog($_GLOBAL.faceCountRecommLinkTable[pid]+"_"+val+"_010_"+key,pid,"")}Core.Events.stopEvent();return false},null,[_code,_title])}(i+8);node.hideFocus=true;node.innerHTML='<img src="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/'+_code+'T.gif" alt="'+_title+'" title="'+_title+'" />';_fragement.appendChild(node)}$E(this.option.recommNode).appendChild(_fragement)}var _sChildren=Lib.children($E("recomm_"+timpStamp).childNodes);for(i=0;_sChildren[i];i++){Core.Events.addEvent(_sChildren[i],function(ele,val){return function(){var pid=scope.$pageid;if(pid){var ppId=ele.parentNode.parentNode.id.split("_")[0];if(ppId){scope.isFromtheCommonhzh=$_GLOBAL.faceCountMoreLinkTable[pid][ppId][1];v7sendLog($_GLOBAL.faceCountMoreLinkTable[pid][ppId][0]+"_0"+val+"_020_"+ele.getAttribute("key"),pid,"")}}}}(_sChildren[i],i+1),"mousedown")}count=first6sort=first6hot=firstSort=_fragement=_sorts=_more=_morelink=_clearit=_code=key=_title=node=null}};Lib.children=function(chs){var cArr=[];for(var i=0;chs[i];i++){if(chs[i].nodeType==1){cArr.push(chs[i])}}return cArr};App.insertSmilesDialog=function(sSortId,fCallback,sPositionNode,arrPosiPix){App.insertSmilesDialog.callback=fCallback;if(scope.smileDialog==null){scope.smileDialog=new App.smilesDialog}scope.smileDialog.setSort(sSortId,fCallback);var xy=Core.Dom.getXY($E(sPositionNode));var x=xy[0]+arrPosiPix[0];var y=xy[1]+arrPosiPix[1];scope.smileDialog.setPosition(x,y);scope.smileDialog.show()};App.formInsertSmile=function(sTextarea,sSortNode,sRecommNode,fCallBack,sPositionNode,arrPix){var _oTextNode=$E(sTextarea);var getPos=function(){if(_oTextNode.createTextRange){_oTextNode.caretPos=document.selection.createRange().duplicate()}};Core.Events.addEvent(_oTextNode,getPos,"keyup");Core.Events.addEvent(_oTextNode,getPos,"focus");Core.Events.addEvent(_oTextNode,getPos,"select");Core.Events.addEvent(_oTextNode,getPos,"click");new App.insertSmilesForm({sortNode:sSortNode,clickCallback:function(nCode,sName){var faceValue="[emoticons="+nCode+"]"+sName+"[/emoticons]";if($IE){if(_oTextNode.createTextRange&&_oTextNode.caretPos){var caretPos=_oTextNode.caretPos;caretPos.text=caretPos.text.charAt(caretPos.text.length-1)==" "?faceValue+" ":faceValue;_oTextNode.focus()}else{_oTextNode.value+=faceValue;_oTextNode.focus()}}else{if(_oTextNode.setSelectionRange){var rangeStart=_oTextNode.selectionStart;var rangeEnd=_oTextNode.selectionEnd;var tempStr1=_oTextNode.value.substring(0,rangeStart);var tempStr2=_oTextNode.value.substring(rangeEnd);_oTextNode.value=tempStr1+faceValue+tempStr2}else{_oTextNode.value+=faceValue}}if(fCallBack){fCallBack()}},recommNode:sRecommNode,positionNode:sPositionNode||sSortNode,arrPosPix:arrPix||[0,0]})};Core.Dom.removeParentNode=function(node){node=$E(node);var parentNode=node.parentNode;Core.Dom.insertAfter(node,parentNode);parentNode.parentNode.removeChild(parentNode)};TweenStrategyEx=function(startValue,endValue,duration,motion){this.startValue=startValue||[];this.endValue=endValue||[];this.duration=duration||0;this.motion=motion||Ui.Transition.simple;this.__eventDispatcher=new Core.Events.EventDispatcher(this)
}.$define({motion:null,duration:0,startValue:0,endValue:0,_itvID:0,_isTweenning:false,addEventListener:function(type,handle){this.__eventDispatcher.addEventListener(type,handle);return this},removeEventListener:function(type,handle){this.__eventDispatcher.removeEventListener(type,handle);return this},start:function(){if(this._isTweenning){return}this._isTweenning=true;var me=this,t,sv=this.startValue,ev=this.endValue,d=this.duration,value=[],startTime=(new Date).getTime();this._itvID=window.setInterval(function(){t=((new Date).getTime()-startTime)/1e3;t>me.duration&&(t=me.duration);for(var i=0;i<sv.length;i++){value[i]=me.motion(t,sv[i],ev[i]-sv[i],d)}me.onTween&&me.onTween(value);me.__eventDispatcher.dispatchEvent("tween",value);t==me.duration&&me.stop()},25);return this},stop:function(){window.clearInterval(this._itvID);this._isTweenning=false;this.onEnd&&this.onEnd();this.__eventDispatcher.dispatchEvent("end");return this},onTween:function(value){},onEnd:function(){}});Core.Events.getEventTarget=function(ev){ev=ev||Core.Events.getEvent();Core.Events.fixEvent(ev);return ev.target};Comment2TSina=Core.Class.create();Comment2TSina.prototype={anonyous:false,data:null,initialize:function(anonyous,data){this.anonyous=anonyous||false;this.data=data||{};scope.$temp_commCtt=this.data.weibo_content;scope.$temp_commId=this.data.blog_id},writeCommTips:function(){if(!$E("bb")){return}var html="";var tips=$E("writeComm_tips");if(!tips){var tips_box=$C("div");tips_box.className="writeComm_tips_box";tips_box.style.display="none";tips_box.innerHTML='<span class="writeComm_tips" id="writeComm_tips"><strong></strong><cite><a href="javascript:;">关闭</a></cite></span>';var writeComm=Core.Dom.byClz(document,"div","writeComm");if(writeComm){writeComm[0].insertBefore(tips_box,writeComm[0].childNodes[0])}else{return}tips=tips_box.firstChild;Core.Events.addEvent(tips.lastChild,function(){tips_box.style.display="none"},"click");this.bindTipsEvents(tips)}var tbox=tips.parentNode,content=tips.firstChild;tbox.style.display="none";if(this.anonyous||$E("anonymity")&&$E("anonymity").checked||this.data.re_weibo==="no_blog"){content.innerHTML='评论发表成功，<a href="javascript:void(0);">点此还可以同步到微博，分享给我的粉丝。</a>';tbox.style.display="block"}else if(this.data.re_weibo==="success"){content.innerHTML='评论成功同步到微博，<a href="http://weibo.com/'+this.data.t_sina+'/profile" target="_blank">点此查看</a>';tbox.style.display="block"}else if(this.data.re_weibo==="no_bind"){content.innerHTML='评论分享失败，您需要先<a href="javascript:void(0);">绑定微博</a>';tbox.style.display="block"}},bindTipsEvents:function(tips){Core.Events.addEvent(tips.firstChild,function(event){Core.Events.stopBubble(event);if(Core.Events.getEventTarget(event).tagName.toLowerCase()!="a"){return}var txt=tips.firstChild.lastChild.innerHTML;if(txt==="点此查看"){tips.parentNode.style.display="none"}else if(txt==="绑定微博"){$E("writeComm_tips").parentNode.style.display="none";this.bindToTSina()}else{if(checkUserProduct.flag==true){this.openStep()}else{this.shareToT()}}}.bind2(this),"click")},openStep:function(){var me=this;Utils.Io.Ijax.request("http://control.blog.sina.com.cn/riaapi/tshow/send_cms_weibo.php",{POST:{uid:$UID,blog_id:scope.$temp_commId,content:scope.$temp_commCtt,isphoto:0},onComplete:function(data){data=eval("("+data+")")||{};if(data.code==="A00006"){var tips=$E("writeComm_tips");tips.parentNode.style.display="block";tips.firstChild.innerHTML='评论成功同步到微博，<a href="http://weibo.com/'+data.data+'/profile" target="_blank">点此查看</a>'}else if(data.code==="B00001"){winDialog.alert("您的博客还未绑定新浪微博，现在绑定？",{icon:"04",funcOk:function(){me.bindToTSina()}})}else if(data.code==="A00004"||data.code==="A11007"){me.shareToT()}else{winDialog.alert("网络繁忙，请稍后再试。",{icon:"01"})}},onException:function(msg,url){winDialog.alert("网络繁忙，请稍后再试。",{icon:"01"})}})},bindToTSina:function(){var me=this;var url="http://control.blog.sina.com.cn/t_sina_blog/bind_weibo_form.php?from=js&domain="+document.domain;window.open(url,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);window.tOkBack=function(){trace("微博绑定回调ok函数！");winDialog.alert("绑定微博成功",{icon:"03",funcOk:function(){me.openStep()},funcClose:function(){me.openStep()}})};window.tFailBack=function(){trace("微博绑定 fail");winDialog.alert("网络繁忙，请稍后再试。",{icon:"01"})}},shareToT:function(){var shareWord=scope.$temp_commCtt;if(shareWord){var title=encodeURIComponent(shareWord);var f="http://v.t.sina.com.cn/share/share.php?",r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"selectionshare","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2)}else{winDialog.alert("分享的内容不能为空",{icon:"01"})}$E("writeComm_tips").parentNode.style.display="none"}};var checkUserProduct={isinit:false,func:null,product:"",flag:true,getReturn:function(name){switch(name){case"blog":var tmp="0x"+scope.userProducts&1;if(tmp!=0){this.flag=true}else{this.flag=false}break;case"photo":var tmp="0x"+scope.userProducts&8;if(tmp!=0){this.flag=true}else{this.flag=false}break;default:this.flag=true}this.func()},check:function(name,func){this.product=name;this.func=func||function(){};if(scope.userProducts){this.getReturn(name)}else{var url="http://uic.sso.sina.com.cn/uic/Query.php?"+"UID="+$UID+"&Check=null&UserInfoTypes=[4]&ProductType=2";Utils.Io.JsLoad.request(url,{onComplete:function(result){if(typeof result=="object"){scope.userProducts=result.UserInfo[0][1];this.getReturn(this.product);this.isinit=true}else{this.flag=false;this.isinit=true}}.bind2(this),charset:"UTF-8"})}}};CommentV2.formatTime=function(time){var s=new Date;if(time){s.setTime(s)}var month=s.getMonth()+1>=10?s.getMonth()+1:"0"+(s.getMonth()+1);var date=s.getDate()>=10?s.getDate():"0"+s.getDate();var time=(new Date).toTimeString().split(" ")[0];var t=s.getFullYear()+"-"+month+"-"+date+" "+time;return t};CommentV2.Post=Core.Class.create();CommentV2.Post.prototype={articleid:0,totle:0,anonyous:false,onSuccess:new Function,onError:new Function,initialize:function(){},post:function(data){try{this.data=data;this.data.article_id=this.articleid;this.data.uid=$isLogin?$UID:"";this.data.fromtype="commentadd";this.data.anonymity=this.data.anonymity||this.anonyous||false;if(this.data.anonymity){this.data.login_name=this.data.comment_anonyous}var _this=this;Lib.checkAuthor(function(){if($isLogin){_this.data.login_name=$nick;_this.postComment(_this.data)}else{if(_this.anonyous){_this.postComment(_this.data)}else{if($E("login_remember")){if(_this.data.login_remember){v7sendLog("48_01_37_1")}else{v7sendLog("48_01_37_0")}}new Lib.Login.LoginPost(function(res){Lib.checkAuthor(function(){if($isLogin){_this.data.login_name=$nick;_this.postComment(_this.data);_this.renderLogin()}else{if(res&&res.errno&&(res.errno==="4049"||res.errno==="2070")){_this.loginNeedSafeCode(res);return}else{winDialog.alert(res&&res.reason||"登录名或密码错误！",{icon:"02"})}_this.refreshCKIMG();$E("commentloginM").style.display="none";$E("commentlogin").style.display="block";$E("commentNick").style.display="";$E("commentNick").innerHTML="";if($E("anonymity_cont")){$E("anonymity").checked=false;$E("anonymity_cont").style.display="none"}}},"post"+(new Date).getTime())}.bind2(_this),false,"referer:"+location.hostname+location.pathname+",func:0001").login(data.login_name,data.login_pass,data.login_remember==true?15:0)}}},"post"+(new Date).getTime())}catch(e){trace(e)}},renderLogin:function(){$tray.renderLogin();$E("commentlogin").style.display="none";var _this=this;var commentNick=$E("commentNick");var showNickPlace=function(){if(checkUserProduct.flag==true){scope.setNickTime=setInterval(function(){var vHTML=Lib.blogv.getVHTML(scope.loginUserWtype);if(typeof scope.$loginNick=="undefined"){Lib.Uic.getNickName([$UID],function(oResult){for(var key in oResult){scope.$loginNick=oResult[key];commentNick.innerHTML=scope.$loginNick+"&nbsp;"+vHTML+":";commentNick.style.display=""}});clearInterval(scope.setNickTime)}else{commentNick.innerHTML=scope.$loginNick+"&nbsp;"+vHTML+":"}},500)}else{_this._showOpenBlogInfo()}};if(commentNick.innerHTML==""){if(checkUserProduct.isinit==false){window.checkuserinterval=setInterval(function(){if(checkUserProduct.isinit==false){checkUserProduct.check("blog",showNickPlace)}else{clearInterval(window.checkuserinterval)}},500)}else{showNickPlace()}}if($E("anonymity_cont")){$E("anonymity_cont").style.display=""}},_showOpenBlogInfo:function(){for(var child=$E("commentNick").firstChild;child;child=child.nextSibling){$E("commentNick").removeChild(child)}$E("commentNick").style.display="";$E("commentNick").innerHTML='<div id="openblog-li" style="cursor:pointer;"><a href="javascript:void(0);"><span id="openblog-nickname"></span>您还未开通博客，点击一秒开通。</a></div>';scope.addBlogOpenerEvent($E("openblog-li"));if($E("anonymity")){$E("commentloginM").style.display="";$E("anonymity").checked=true;$E("quote_comment_p").style.display="none"}var nickNameTime=setInterval(function(){if(!scope.nickname){return}$E("openblog-nickname").innerHTML=scope.nickname+"：";clearInterval(nickNameTime)},500)},postComment:function(data){v7sendLog("32_01_19");var startTime=(new Date).getTime();var _this=this;function recordHttpTime(nTime){if(!nTime){var endTime=(new Date).getTime();nTime=endTime-startTime}Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/admin/article/ria_debug.php",{GET:{type:"addBlogComment",usetime:nTime},noreturn:true})}var option={POST:data,onComplete:function(result){if(typeof result=="string"){result=result.replace(/;$/,"")}result=typeof result=="string"&&/\s*{/.test(result)?Core.String.j2o(result):result;if(result!=null&&typeof result.code=="undefined"){trace("接口数据异常："+this.url,"#F00");return}var _this=this;if(result.code=="A00006"){v7sendLog("45_01_12_"+scope.$uid);result=result.data;if(data.is_mobile){if(result.insertid.charAt(0)==="N"){result.insertid=result.insertid.slice(1)}var tsina=result.t_sina;if(tsina&&tsina.charAt(0)==="N"){result.t_sina=tsina.slice(1)}}Lib.checkAuthor(function(){var str=$E("c_"+scope.$articleid).innerHTML;var num=parseInt(/(\d+)/.exec(str)[0],10);num++;$E("c_"+_this.articleid).innerHTML="("+num+")";if($isLogin){_this.renderLogin()}_this.addNewComment(data,result);var c2s=new Comment2TSina(_this.anonyous,result);if($E("bb")&&$E("bb").checked){v7sendLog("32_01_18")}c2s.writeCommTips();_this.onSuccess();if($E("comment_get_vcode")){Lib.AudioCheck.render($E("comment_get_vcode").parentNode,Lib.AudioCheck.soundUrl+"?"+(new Date).getTime())}else{}},"post_option"+(new Date).getTime())}else{v7sendLog("32_01_21");this.refreshCKIMG();if(result.code=="B36113"){winDialog.alert("博主已关闭匿名评论，请登录后再评论",{funcOk:function(){if($E("anonymity_cont")){$E("anonymity_cont").checked=false;$E("anonymity_cont").style.display="none"}$E("commentlogin").style.display="";$E("commentloginM").style.display="none"}})}else if(result.code=="B36002"){winDialog.alert($SYSMSG["B36002"],{funcOk:function(){$E("login_check").value="";$E("login_check").focus()}})}else{showError(result.code)}if(result.code!=null){Lib.checkAuthor(function(){if($isLogin){return}if($E("anonymity_cont")){$E("anonymity").checked=false;$E("anonymity_cont").style.display="none"}if($E("anonymity").checked==true){$E("commentloginM").style.display="block";$E("anonymity").checked="checked"}else{$E("commentloginM").style.display="none";$E("commentlogin").style.display="block"}$E("commentNick").innerHTML="";$isLogin=false;_this.anonyous=true},"post_option"+(new Date).getTime())}}}.bind2(this),onException:function(result){v7sendLog("32_01_21");recordHttpTime(-1);trace("post comment error");winDialog.alert($SYSMSG[result.code]||"发评论失败！请重试。",{icon:"02"})}.bind2(this)};Utils.Io.Ijax2.request("http://comment5.news.sina.com.cn/cmnt/submit",{POST:{channel:"blog",newsid:data.article_id,content:data.comment,usertype:"blogpc",ie:"utf-8",oe:"utf-8",share_url:data.is_t===1?location.href.replace(/\.html.*$/,".html"):"",ispost:data.is_t===1?1:0,iframe:1},returnType:"json",onComplete:function(data){if(!CommentV2.isAllowSubmit(data.result.blog_code)){return false}if(data.result.status.code=="20003"||data.result.status.code=="10013"){winDialog.alert("您还没有开通微博，请先开通，再进行评论同步到微博操作！",{icon:"02"});return}if(data.result.status.code!==0){winDialog.alert("未知错误，请稍后再试!",{icon:"02"});return}if(CommentV2.needAuthTrueName(data.result.filter_code)){return}switch(data.result.filter_code){case"1103":case"1104":case"1105":case"1107":case"1106":case"2000":case"2004":case"2005":case"2006":case"2100":winDialog.alert($SYSMSG[data.result.filter_code]);break;case"4001":try{$E("postCommentIframe").contentWindow.document.body.innerHTML=""}catch(e){}winDialog.alert($SYSMSG[data.result.filter_code]);break;case"4000":case"4002":v7sendLog("45_01_12_"+scope.$uid);setTimeout(function(){Lib.Listener.notify("reload-cnmt-list");Lib.Listener.notify("update-total-num",{type:"add",num:1})},500);var str=$E("c_"+scope.$articleid).innerHTML;var num=parseInt(/(\d+)/.exec(str)[0],10);num++;$E("c_"+scope.$articleid).innerHTML="("+num+")";_this.onSuccess();break;default:winDialog.alert($SYSMSG["A00001"]);break}}.bind2(this),onException:function(data){v7sendLog("32_01_21");trace("post comment error");winDialog.alert($SYSMSG[result.code]||"发评论失败！请重试。",{icon:"02"})}.bind2(this)})},refreshCKIMG:function(){if($E("comment_check_img")){$E("comment_check_img").src="http://interface.blog.sina.com.cn/riaapi/checkwd_image.php?"+(new Date).valueOf()}if($E("comment_get_vcode")){Lib.AudioCheck.render($E("comment_get_vcode").parentNode,Lib.AudioCheck.soundUrl+"?"+(new Date).getTime())}},addNewComment:function(data,cId){var _this=this;Lib.checkAuthor(function(){_this.getPostTemplet(data,cId)},"post"+(new Date).getTime())},commentTween:function(li){var me=this;var commentContent=$E("article_comment_list");var beginEl;if(scope.$pageid.indexOf("articletj")===-1){commentContent.appendChild(li);beginEl=$E("postCommentIframe")}else{var firstLi=$T(commentContent,"li")[0];if(firstLi){firstLi.className="SG_j_linedot1";commentContent.insertBefore(li,firstLi)}else{commentContent.appendChild(li)}beginEl=$E("postcommentid")}var endPos=Core.Dom.getXY(li);var beginPos=Core.Dom.getXY(beginEl);new rockIt(li,beginPos,endPos,0,300,"elasticEaseInOut",{end:function(o){o.clear();Core.Dom.opacity(li,0);if(scope.$pageid.indexOf("articletj")===-1){commentContent.appendChild(li);beginEl=$E("postCommentIframe")}else{commentContent.insertBefore(li,commentContent.firstChild);beginEl=$E("postcommentid")}var opacVal=0;var opac=function(){Core.Dom.opacity(li,opacVal);if(opacVal==100){clearInterval(opTimer);opacVal=0}opacVal+=20};var opTimer=setInterval(opac,10);var real=me.getScollTop();var posY=Core.Dom.getXY(li)[1];if(posY>real){return}var sReal=Math.abs(real);var step=0;var start=100;if(sReal<=100){step=sReal==real?1:-1;start=sReal}else{step=real/100}var _start=+new Date;var _duration=500;var timer=setInterval(function(){var func=window.$transitions["regularEaseOut"];var now=+new Date;if(now-_start<_duration){var pass=now-_start}else{var pass=_duration;clearInterval(timer)}me.setScollTop(func(pass,real,posY-real,_duration))},15)}})},getScollTop:function(){var scrOfX=0;var scrOfY=0;if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){scrOfY=document.body.scrollTop;scrOfX=document.body.scrollLeft}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){scrOfY=document.documentElement.scrollTop;scrOfX=document.documentElement.scrollLeft}return scrOfY},setScollTop:function(val){if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){document.body.scrollTop=val}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){document.documentElement.scrollTop=val}},getPostTemplet:function(data,cId){var __this=this;var isworldcup=cId.isworldcup;var res=cId;var cId=res.insertid||cId;var item={};item.id=cId;item.user_image=res.user_img;item.src_uid=scope.$uid;if(data.anonymity){item.uname=data.comment_anonyous;item.comm_uid=0}else{item.ulink="http://blog.sina.com.cn/u/"+(data.uid||$UID);item.ria_index_url=item.ulink;var vHTML=Lib.blogv.getVHTML(scope.loginUserWtype);item.uname=scope.nickname||data.login_name;if(vHTML){item.vimg=vHTML}item.comm_uid=$UID}if(data.god==1){item.god=1;item.cms_body=this.changeToContent(data.comment,"god")}else{item.cms_body=this.changeToContent(data.comment)}item.cms_pubdate=CommentV2.formatTime();item.fromProduct=res.from_product;item.cms_reply_num="0";item.action_data=encodeURIComponent(Utils.Json.flatten({commentid:item.id,articleid:res.blog_id,fromProduct:res.from_product,comm_uid:item.comm_uid,uname:item.uname,ulink:item.ulink,src_uid:scope.$uid,cms_reply_num:item.cms_reply_num}));var lisData={};lisData.item=item;lisData.fun=function(li){__this.commentTween(li)};Lib.Listener.notify("commentlist-commentadd",lisData);var noComm=this.isNoCotent();var isMid=scope&&scope.$pageid==="articletj";if(noComm){noComm.parentNode.removeChild(noComm)}},isNoCotent:function(){var outContainer=$E("article_comment_list");var li=outContainer.getElementsByTagName("li");for(var i=0;li[i];i++){var div=li[i].getElementsByTagName("div");for(var j=0;div[j];j++){if(div[j].className.toUpperCase().indexOf("NOCOMMDATE")!=-1){return li[i]}}}return null},changeToContent:function(str,type){var imgPath="http://www.sinaimg.cn/uc/myshow/blog/misc/gif/";if(type=="god"){imgPath="http://simg.sinajs.cn/blog7style/images/common/godreply/"}var _userContent=str.replace(/\r\n|\n/gi,"###line-return###");_userContent=Core.String.encodeHTML(_userContent);var _re=/\[emoticons=(E___\w*)\]([^[]*)\[\/emoticons\]/gi;var _html='<img src="'+imgPath+'$1T.gif" style="margin:1px;" border="0" title="$2" />';_userContent=_userContent.replace(_re,_html);var _magicReg=/\[magicemoticons=([E|W]___\w*)\&nbsp\;swfname=(\w+\.swf)\]([^[]*)\[\/magicemoticons\]/gi;var _magichtml='<img src="'+imgPath+'$1T.gif" style="margin:1px;" border="0" title="$3" width="50" height="50"/>';_userContent=_userContent.replace(_magicReg,_magichtml);_userContent=_userContent.replace(/###line-return###/gi,"<br/>");return _userContent},loginNeedSafeCode:function(res){var that=this;var safeimgsrc="https://login.sina.com.cn/cgi/pin.php";var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite><a title="关闭" class="CP_w_shut"  id="#{btnClose}" href="javascript:;">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="" style="width:auto;" id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");var content='<div class="CP_layercon1">'+'<div class="verifyPrompt"><p>为了保护你的账号安全，请输入验证码进行登录</p>'+'<div class="row1"><strong>验证码：</strong>'+'<input type="text" maxlength="5" id="xssSafeCodeDiag_checkword" class="fm1">'+'<img width="100" align="absmiddle" src="https://login.sina.com.cn/cgi/pin.php?r=11681364785467546&amp;s=0" maxlength="5" id="xssSafeCodeDiag_safeimg">'+'<a id="" href="javascript:void(0); return false;" onclick="scope.xssSafeCodeDiag.changeSafeCode();">换一换</a>'+"</div>"+'<p class="CP_w_btns">'+'<a id="" href="javascript:void(0); return false;" class="CP_a_btn2" onclick="scope.xssSafeCodeDiag.ok();"><cite><span>登录</span></cite></a>'+'<span style="display:none" id="xssSafeCodeDiag_ErrTips" class="ErrTips"></span>'+"</p>"+"</div>"+"</div>";if(typeof scope.xssSafeCodeDiag=="undefined"){scope.xssSafeCodeDiag=winDialog.createCustomsDialog({tpl:tpl,title:"提示",content:content,width:282,height:180,funcDisplayFinished:function(){}},"note");scope.xssSafeCodeDiag.changeSafeCode=function(){$E("xssSafeCodeDiag_checkword").value="";$E("xssSafeCodeDiag_safeimg").src="https://login.sina.com.cn/cgi/pin.php?r="+Core.Math.getUniqueId()+"&s=0"};scope.xssSafeCodeDiag.ok=function(){var v=$E("xssSafeCodeDiag_checkword").value;if(v===""){$E("xssSafeCodeDiag_ErrTips").innerHTML="请输入验证码";$E("xssSafeCodeDiag_ErrTips").style.display="";return}if(typeof sinaSSOController!="undefined"&&typeof sinaSSOController.loginExtraQuery!="undefined"){if(typeof sinaSSOController.loginExtraQuery.door!="undefined"){sinaSSOController.loginExtraQuery.door=v||1}}sinaSSOController.loginExtraQuery.door=v||1;that.post(that.data);scope.xssSafeCodeDiag.hidden()};scope.xssSafeCodeDiag.displayError=function(res){if(res.errno!=="4049"){$E("xssSafeCodeDiag_ErrTips").innerHTML=res.reason;$E("xssSafeCodeDiag_ErrTips").style.display=""}else{$E("xssSafeCodeDiag_ErrTips").style.display="none"}}}scope.xssSafeCodeDiag.show();scope.xssSafeCodeDiag.setMiddle();scope.xssSafeCodeDiag.changeSafeCode();scope.xssSafeCodeDiag.displayError(res)}};function rockIt(node,startPos,endPos,rounds,duration,mode,func){if(!node)return;var uid=_getNodeUid(node);if(!uid){node.setAttribute("rotationId",uid=_getNodeUid())}var inst=rockIt.instances||(rockIt.instances={});if(inst[uid]){_destroy(uid)}var transitions=Ui.Transition;window.$transitions=transitions;if(typeof func.begin=="function"){func.begin()}node.style.position="absolute";document.body.appendChild(node);inst[uid]={node:node,startPos:startPos,endPos:endPos,round:rounds,func:func,sTime:+new Date,duration:duration,mode:mode||"simple",degree:0,timer:0};inst[uid].timer=setInterval(function(){var dt=+new Date;if(inst[uid]["sTime"]+inst[uid]["duration"]<dt){_renderNode(uid,inst[uid]["duration"]);if(typeof func.end=="function"){func.end({clear:_clearStyle})}_destroy(uid)}else{_renderNode(uid,dt-inst[uid]["sTime"])}},15);function _getNodeUid(node){if(node){return node.getAttribute("rotationId")}else{return parseInt(Math.random()*1e4)+ +new Date}}function _destroy(uid){clearInterval(inst[uid].timer);for(var key in inst[uid]){delete inst[uid][key]}delete inst[uid]}function _renderNode(uid,t){var trans=transitions[inst[uid]["mode"]];var obj=inst[uid];var nodeStyle=obj.node.style;var d=obj["duration"];var b=obj["startPos"][0];var c=obj["endPos"][0]-obj["startPos"][0];nodeStyle.left=trans(t,b,c,d)+"px";b=obj["startPos"][1];c=obj["endPos"][1]-obj["startPos"][1];nodeStyle.top=trans(t,b,c,d)+"px";b=0;c=obj["round"]==0||t==d?0:Math.PI*2*obj["round"];_rotation(obj.node,trans(t,b,c,d))}function _rotation(node,deg){costheta=Math.cos(deg);sintheta=Math.sin(deg);if($IE){node.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+costheta+",M12="+-sintheta+",M21="+sintheta+",M22="+costheta+',SizingMethod="auto expand")'}else if($FF){node.style["MozTransform"]="matrix("+costheta+", "+sintheta+", "+-sintheta+", "+costheta+", 0, 0)"}else if(/WebKit/i.test(navigator.userAgent)){node.style["WebkitTransform"]="matrix("+costheta+", "+sintheta+", "+-sintheta+", "+costheta+", 0, 0)"}}function _clearStyle(){var style=inst[uid].node.style;style.position="";style.left="";style.top=""}}CommentV2.commentFaceTemplate=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}">插入表情</strong>','<cite><a id="#{btnClose}" href="javascript:;" onclick="return false;" class="CP_w_shut" title="关闭">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid" id="#{content}">','<div class="faceItemContent">','<div class="bigface">','<div id="#{faceTab}" class="faceSidebar">',"</div>",'<div id="#{faceContent}" class="faceShowAll">',"</div>","</div>","</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");CommentV2.count=function(num){var perpage=50;var pages=0;if(num%perpage==0)pages=Math.ceil(num/perpage);else pages=Math.floor(num/perpage)+1;return pages};var Comment={};CommentV2.insertSmile=Core.Class.create();CommentV2.insertSmile.prototype={initialize:function(){},show:function(){this.btnShowFaceEditor=$E("article_comment_insertSmile");this.txtComment=$E("commentArea");this.faceEditor=new Lib.Face(this.txtComment);var _this=this;_this.bindFace()},bindFace:function(){var _this=this;Core.Events.addEvent(this.btnShowFaceEditor,function(){if(_this.faceEditor.isShowed){_this.faceEditor.hidden()}else{if(!_this.faceEditor.isLoad){_this.faceEditor.load();_this.initFace();_this.faceEditor.isLoad=true}var x=Core.Dom.getLeft(_this.btnShowFaceEditor)-450;var y=Core.Dom.getTop(_this.btnShowFaceEditor)+_this.btnShowFaceEditor.offsetHeight;_this.faceEditor.setPosition(x,y);_this.faceEditor.show()}Core.Events.stopEvent()},"mousedown")},initFace:function(){var _this=this;Core.Events.addEvent(this.faceEditor.dialogNodes["btnClose"],function(){_this.faceEditor.hidden()},"mousedown");Core.Events.addEvent(document.body,function(){_this.faceEditor.hidden()},"mousedown");Core.Events.addEvent(this.faceEditor.dialog.entity,function(){Core.Events.stopEvent()},"mousedown")}};$SYSMSG.extend({B119001:"不能转载自己的文章!",B119002:"转帖功能为新版博客专属功能，点击确认立即升级你的博客吧！<br/><span style='font-weight: 100; font-size: 12px;'><a target='_blank' href='http://blog.sina.com.cn/lm/iframe/xhtml/2010/blogspread.html'>了解新版博客详情</a></span>",B119003:"被转载文章不存在!",B119004:"请访问原文进行转载！",B119005:"对不起，博主设置不允许转载该文章",B119006:"对不起，博主设置不允许转载其文章",B119007:"很抱歉，转载失败，请稍后再试",B119008:"已经转载很多啦，看看其他的精彩文章",B119009:"您短时间转载过多，请稍后再试"});App.getArticlesSort=function(fCallBack,uid){uid=uid||scope.$uid;var js=$C("script");var _this=this;Lib.checkAuthor(function(){js.src="http://comet.blog.sina.com.cn/api?maintype=acate&varname=x&uid="+uid;js.charset="utf-8";js.onload=js.onerror=js.onreadystatechange=Core.Function.bind2(function(){if(js&&js.readyState&&js.readyState!="loaded"&&js.readyState!="complete"){return}App.ArticlesSort=x;if(fCallBack!=null){fCallBack(App.ArticlesSort)}js.onload=js.onreadystatechange=js.onerror=null;js.src="";js.parentNode.removeChild(js);js=null},_this);document.getElementsByTagName("head")[0].appendChild(js)},"getArticlesSort"+(new Date).getTime())};var cateDialog=Core.Class.create();cateDialog.prototype={uid:"",initialize:function(action){this.action=action||false},show:function(uid){this.uid=uid||scope.$uid;this.initDialog();this.dialog.show();this.dialog.setFixed(true);this.dialog.setAreaLocked(true);this.dialog.setMiddle()},initDialog:function(){var me=this;var data={width:492,height:0,url:"http://control.blog.sina.com.cn/admin/article/article_class_list.php?"+(this.action?"action=editor":"")};me.url="http://control.blog.sina.com.cn/admin/article/article_class_save2.php?uid="+$UID+(me.action?"&action=editor":"");me.id=Core.Math.getUniqueId();me.manage=null;me.manage=new cateMng(me.id,me.itemTpl,me.uid);me.manage.onSuccess=function(list){me.onSuccess(list)};var temp=new Ui.Template("<div style='width: #{width}px; height: #{height}px;' id='category_"+me.id+"'></div>");var obj={ad:false,drag:true,title:"分类管理",content:temp.evaluate(data),shadow:1,width:data.width,height:data.height};var func={};var dialog=winDialog.createCustomsDialog(obj,func);me.dialog=dialog;$E("category_"+me.id).innerHTML=me.tpl.join("");me.dialog.nodes["btnClose"].href="javascript:;";me.dialog.nodes["btnClose"].onclick=function(){if(me.manage.getEdit()){winDialog.confirm("是否保存此更改？",{funcOk:function(){me.manage.saveHandler(me.url)},funcCancel:function(){me.close()},funcClose:function(){me.dialog.show()},textOk:"是",textCancel:"否"})}else{me.close()}};me.initEvent()},initEvent:function(){this.manage.nameEvent();this.manage.createEvent();this.manage.dataProvider();this.manage.saveEvent(this.url)},hidden:function(){this.dialog.hidden()},close:function(){this.dialog.hidden();this.dialog.destroy()},showOld:function(){this.dialog.show()},reset:function(){window.CateDialog.dialog.setCloseEvent(true);window.CateDialog.dialog.hidden();window.CateDialog.dialog=null;window.CateDialog.init=false},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize(nWidth,nHeight);ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},setCloseEvent:function(bClose){},getDialog:function(){return this.dialog},getId:function(){return this.id},getDataList:function(){return this.manage.list},onSuccess:function(res){},init:false,dialog:null,tpl:['<div id="categoryBody">','<div id="categoryTitle">',"</div>",'<div id="categoryHead">',"<table>","<tr>",'<td><input type="text" maxlength="28" value="最多可输入14个中文字符" id="categoryName"/></td>','<td width="80"><a id="categoryCreate" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>创建分类</cite></a></td>','<td><span class="SG_txtc">请用中文、英文或数字。</span></td>',"</tr>","</table>",'<div id="errTips"></div>',"</div>",'<form method="post" id="categoryForm" name="form">','<div id="categoryList">','<ul class="clearfix" id="datalist">&nbsp;</ul>','<div class="SG_j_linedot"></div>',"</div>",'<div id="categoryBottom" style="text-align:center">','<a id="categorySave" href="javascript:void(0);" class="SG_aBtn SG_aBtnB SG_aBtn_sub"><cite>保存设置<input type="button" value="保存设置"/></cite></a>',"</div>","</form>","</div>"],itemTpl:['<li class="{class}">','<span class="htit" style="color:#000000" id="cate_{index}">{cate}</span>','<input type="hidden" value="{cate}" name="typename[]" class="catName"/>','<input type="hidden" value="{id}" name="number[]"/>','<span id="ctrl_{index}" class="control">','<div class="manage">','<a class="CP_a_fuc" id="edit_{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.editCate(this);">[<cite>编辑</cite>]</a>','<a class="CP_a_fuc" id="del_{index}" index="{index}" href="javascript:;" onclick="javascript:window.CateDialog.manage.delCate(this);">[<cite>删除</cite>]</a>',"</div>",'<div class="arrow">','<a id="up_{index}" class="{up_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.upHandler(this);"/>','<a id="down_{index}" class="{down_class}" href="javascript:;" onclick="javascript:window.CateDialog.manage.downHandler(this);"/>',"</div>","</span>",'<div id="editctrl_{index}" class="writeinfo" style="display:none">','<input id="new_{index}" type="text" value="" /><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>',"<div/>","</li>"]};var cateMng=Core.Class.create();cateMng.prototype={list:null,orilen:0,edit:false,uid:null,initialize:function(id,itemTpl,uid){this.uid=uid||scope.$uid;this.id=id;this.itemTpl=itemTpl;Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length){return false}this.splice(dx,1)}},nameEvent:function(){var _this=this;$E("categoryName").onfocus=function(){if(this.value=="最多可输入14个中文字符"){this.value=""}};$E("categoryName").onblur=function(){var re=/[ ><\\\'\;\"`\|\t\r\n|\u3000]/gi;this.value=this.value.replace(re,"");if(Core.String.trim($E("categoryName").value)==""){this.value="最多可输入14个中文字符";this.edit=false}else{this.edit=true}_this.showTips("")};$E("categoryName").onkeyup=function(){var value=Core.String.trim(this.value);if(Core.String.byteLength(value)>28){this.value=Core.String.leftB(value,28)}else if(value!=this.value){this.value=value}};_this.showTips("")},createEvent:function(){var _this=this;var code="";$E("categoryCreate").onclick=function(){if(checkCate()&&$E("categoryName").edit){var obj={id:-1,name:$E("categoryName").value};$E("categoryName").value="最多可输入14个中文字符";$E("categoryName").edit=false;_this.list.push(obj);_this.update()}_this.showTips(code)};function checkCate(){var value=Core.String.trim($E("categoryName").value);
code="";if(value==""||value=="最多可输入14个中文字符"){code="分类名称不能为空"}else if(value.indexOf("&")!=-1||value.indexOf("＆")!=-1){code="分类名称不能包含&符号"}else if(_this.list.length>=15){code="抱歉！最多可创建15条分类"}else if(Core.String.byteLength(value)>28){code="最多可输入14个中文字符"}for(var i=0;i<_this.list.length;i++){if(_this.list[i].name==value){code="您已经添加过此分类";break}}if(code!=""){return false}else{return true}}},saveEvent:function(url){Core.Events.stopEvent();var _this=this;$E("categorySave").onclick=function(){_this.saveHandler(url)}},saveHandler:function(url){var _this=this;var length=_this.list.length;if(_this.orilen-length>2){winDialog.confirm("您本次删除的博文分类太多，确定删除？",{funcOk:function(){_this.orilen=length;$E("categorySave").onclick()}});return}var cateName=[];var cateId=[];for(var i=0;i<length;i++){var item=_this.list[i];cateName.push(item.name);cateId.push(item.id)}Utils.Io.Ijax.request(url+"&r="+Math.random(),{POST:{typename:cateName.join("|"),number:cateId.join("|")},onComplete:function(res){eval("var result = "+res);try{try{if($E("module_3")){Lib.Component.refresh(3,{width:scope.catedialogwidth||210})}if($E("module_7")){location.reload()}}catch(error){trace(error)}try{window.ArticleCateFuncs.reloadCate(result.msg)}catch(error){}window.CateDialog.close()}catch(e){}var r;eval("r="+res);_this.onSuccess(r.msg)},onException:function(res){}})},editCate:function(dom){var _this=this;var index=dom.id.split("_")[1];var old=$E("cate_"+index).innerHTML;var li=$E("cate_"+index).parentNode;$E("ctrl_"+index).className="control hide";li.className=index%2==0?"editName":"cline editName";var tpl='<div id="editctrl_'+index+'" class="writeinfo"><input id="new_'+index+'" type="text" value="'+old+'"><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>确定</cite></a><a class="SG_aBtn SG_aBtnB SG_aBtn_sub" href="javascript:;"><cite>取消</cite></a></div>';li.innerHTML=tpl;$E("new_"+index).onkeyup=function(){var re=/[ >&<\\\'\,\;\"`\|\t\r\n|\u3000]/gi;var value=Core.String.trim(this.value.replace(re,""));if(value!=this.value){this.value=value}if(value==""){$E("editctrl_"+index).childNodes[1].disabled=true}else{$E("editctrl_"+index).childNodes[1].disabled=false}};$E("new_"+index).onblur=function(){if(Core.String.byteLength(this.value)>=28){this.value=Core.String.leftB(this.value,28)}};$E("editctrl_"+index).childNodes[1].onclick=function(){if($E("new_"+index).value==old){setName(old,2)}else{setName($E("new_"+index).value,1)}};$E("editctrl_"+index).childNodes[2].onclick=function(){setName(old,2)};function setName(nvl,type){var value=nvl;var code="";if(Core.String.byteLength(value)>28){value=Core.String.leftB(value,28)}if(type==1){for(var i=0;i<_this.list.length;i++){if(_this.list[i].name==value){code="您已经添加过此分类";break}}}if(code!=""){if(!$E("err_"+index)){Core.Dom.addHTML($E("editctrl_"+index),'<div id="err_'+index+'" class="errTips">'+code+"</div>");li.style.height="60px"}else{$E("err_"+index).value=code}}else{_this.list[index].name=value;var tpl=_this.itemTpl.join("");tpl=tpl.replace('<li class="{class}">',"");tpl=tpl.replace("</li>");var item=_this.list[index];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,index);tpl=tpl.replace(/\{up_class\}/,index==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,index==_this.list.length-1?"down_disabled":"down");li.innerHTML=tpl;li.className=index%2==0?"":"cline";li.style.height="30px";if(type==1){_this.edit=true}}code=""}},delCate:function(dom){var _this=this;var index=dom.id.split("_")[1];winDialog.confirm("确实要删除此分类吗？删除后不可恢复。",{funcOk:function(){_this.list.remove(index);_this.update()}})},upHandler:function(dom){var index=dom.id.split("_")[1];if(index>0){var temp=this.list[index];this.list[index]=this.list[index-1];this.list[index-1]=temp;this.update()}},downHandler:function(dom){var index=dom.id.split("_")[1];if(index<this.list.length-1){var next=index*1+1;var temp=this.list[next];this.list[next]=this.list[index];this.list[index]=temp;this.update()}},showTips:function(code){$E("errTips").innerHTML=code},dataProvider:function(){var _this=this;App.getArticlesSort(function(data){_this.list=data.data;_this.orilen=_this.list.length;$E("datalist").innerHTML="";for(var i=0;i<_this.list.length;i++){var tpl=_this.itemTpl.join("");var item=_this.list[i];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{class\}/gi,i%2==0?"":"cline");tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,i);tpl=tpl.replace(/\{up_class\}/,i==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,i==_this.list.length-1?"down_disabled":"down");Core.Dom.addHTML($E("datalist"),tpl)}},this.uid)},update:function(){$E("datalist").innerHTML="";for(var i=0;i<this.list.length;i++){var tpl=this.itemTpl.join("");var item=this.list[i];tpl=tpl.replace(/\{cate\}/gi,item.name);tpl=tpl.replace(/\{class\}/gi,i%2==0?"":"cline");tpl=tpl.replace(/\{id\}/gi,item.id);tpl=tpl.replace(/\{index\}/gi,i);tpl=tpl.replace(/\{up_class\}/,i==0?"up_disabled":"up");tpl=tpl.replace(/\{down_class\}/,i==this.list.length-1?"down_disabled":"down");Core.Dom.addHTML($E("datalist"),tpl)}if(!this.edit){this.edit=true}},getEdit:function(){return this.edit},onSuccess:function(res){}};var QuoteSuccess=Core.Class.create();QuoteSuccess.prototype={interfaceSave:null,_isDialogInit:false,_dialog:null,memoNullText:"说点什么...",articleID:"",_cateList:[],initialize:function(){var _this=this;Lib.checkAuthor(function(){_this.interfaceSave=new Interface("http://control.blog.sina.com.cn/riaapi/article/edit_cat.php","ijax");!window.CateDialog&&(window.CateDialog=new cateDialog)},"quote_Success"+(new Date).getTime())},show:function(articleID){var _this=this;Lib.checkAuthor(function(){!_this._isDialogInit&&_this._initDialog();_this.articleID=articleID||"";_this._dialog.show();_this._dialog.setFixed(true);_this._dialog.setMiddle();_this._dialog.setAreaLocked(true)},"quote_Success"+(new Date).getTime())},save:function(){var me=this,nodes=this._dialog.nodes;this.interfaceSave.request({POST:{new_cat:nodes.selCate.value,blog_id:me.articleID,reship:nodes.txtMemo.value===me.memoNullText?"":nodes.txtMemo.value},onSuccess:function(data){me.onSuccess(data);me.close()},onError:function(err){me.onError(err)},onFail:function(){}})},close:function(){this._dialog.hidden();this.clear()},_initDialog:function(){var me=this;this._dialog=winDialog.createCustomsDialog({content:['<div class="CP_layercon6">','<div class="turnBox">','<p class="turnTxt">','<img class="SG_icon SG_icon203" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="50" height="50" align="absmiddle"/>','<span class="txt1">转载成功！</span>你还可以写评论...',"</p>","<ul>",'<li><span class="a">评论：</span><span class="b"><textarea id="#{txtMemo}" style="color:#c8c8c8;max-width:400px;" cols="" rows="3" class="SG_textarea">'+this.memoNullText+"</textarea></span></li>","<li>",'<span class="a">分类：</span>','<span class="b"><select id="#{selCate}" name=""><option value="00">默认文章分类</option></select>&nbsp;&nbsp;<a id="#{btnShowCate}" href="#" onclick="return false;">创建分类</a></span>',"</li>","</ul>",'<div class="clearit"></div>','<div class="butt">','<a href="#" id="#{btnSave}" onclick="return false;" class="SG_aBtn SG_aBtnB"><cite>保存</cite></a>&nbsp;&nbsp;<a id="#{btnCancel}" onclick="return false;" href="#" class="SG_aBtn SG_aBtnB "><cite>关闭</cite></a>','<a style="visibility:hidden" target="_blank" href="http://blog.sina.com.cn/admin/advice/advice_list.php" class="link">改进建议</a>',"</div>","</div>",'<div class="clearit"></div>',"</div>"].join("")});Core.Events.addEvent(this._dialog.nodes.btnSave,function(){if(me._dialog.nodes.txtMemo.value===me.memoNullText&&me._dialog.nodes.selCate.selectedIndex===0){me.close()}else{me.verified()&&me.save()}},"click");Core.Events.addEvent(this._dialog.nodes.btnCancel,function(){me.close()},"click");Core.Events.addEvent(this._dialog.nodes.btnShowCate,function(){window.CateDialog.onSuccess=function(res){me._dialog.nodes.selCate.length=1;var list=res||[],i,len=list.length;for(i=0;i<len;i++){me.addCate(list[i].value,list[i].label)}me.addCate("0","私密博文")};window.CateDialog.show($UID)},"click");this._dialog.addEventListener("hidden",function(){me.clear();me.onClose()});this._dialog.nodes.txtMemo.onblur=function(){if(this.value.replace(/\s/g,"")===""){this.style.color="#c8c8c8";this.value=me.memoNullText}};this._dialog.nodes.txtMemo.onfocus=function(){if(this.value===me.memoNullText){this.style.color="#000000";this.value=""}};this._initCateList();this._isDialogInit=true},verified:function(){var nodes=this._dialog.nodes;if(Core.String.byteLength(nodes.txtMemo.value)>2e3){winDialog.alert("评论内容必须是1000中文或2000字符以内，请重新输入。");return false}return true},_initCateList:function(){var nodes=this._dialog.nodes,me=this;nodes.selCate.length=1;Lib.checkAuthor(function(){App.getArticlesSort(function(){var list=x.data,i,len=list.length;for(i=0;i<len;i++){me.addCate(list[i].id,list[i].name)}me.addCate("0","私密博文")},$UID)},"quote_Success_initCateList"+(new Date).getTime())},_getFaceURL:function(uid){var n=parseInt(uid)%8+1;return"http://portrait"+n+".sinaimg.cn/"+uid+"/blog/50"},addCate:function(id,name){var sel=this._dialog.nodes.selCate;var op=$C("option");op.value=id;op.innerHTML=name;sel.appendChild(op)},clear:function(){var nodes=this._dialog.nodes;nodes.txtMemo.style.color="#c8c8c8";nodes.txtMemo.value=this.memoNullText},onSuccess:function(data){},onError:function(err){},onClose:function(){}};var Quote=Core.Class.create();Quote.prototype={quoteSuccess:null,saving:false,articleID:"",initialize:function(ele_id){this.quoteSuccess=new QuoteSuccess;this.initInterface();this.bindEvent(ele_id);this.articleID=scope.$articleid},bindEvent:function(ele_id){var me=this;if(ele_id){Core.Events.addEvent($E(ele_id),function(){me.check()})}},initInterface:function(){this._interface=new Interface("http://control.blog.sina.com.cn/admin/article/article_quote.php","ijax")},check:function(articleID,commentText,isComment,moreCallBack){this.articleID=articleID||scope.$articleid;commentText=commentText;isComment=isComment;moreCallBack=moreCallBack||function(){};var me=this;Lib.checkAuthor(function(){if(!$isLogin){v7sendLog("48_01_33");(new Lib.Login.Ui).login(function(){scope.blogOpener.showDialog(function(){me.save.bind2(me)();moreCallBack()})})}else{scope.blogOpener.showDialog(function(){me.save(commentText,isComment);moreCallBack()})}},"quote"+(new Date).getTime())},save:function(commentText,isComment){var me=this;if(this.saving){return}this.saving=true;var param={version:7,blog_id:me.articleID,comment:isComment||"",reship:commentText||""};this._interface.request({POST:param,onSuccess:function(_data){this.numAdd();this.saving=false;var aID=_data.url.split("/").pop().split("_")[1].split(".")[0];if(!commentText){this.quoteSuccess.onSuccess=function(){winDialog.alert("博文已成功转载！<br/><span style='font-weight: 100; font-size: 12px;'><a target='_blank' href='"+_data.url+"'>查看转载博文>></a></span>",{icon:"03"})};this.quoteSuccess.show(aID)}this.onSuccess(aID,_data.url||"")}.bind2(this),onError:function(_data){this.saving=false;if(_data.code=="B119007"||_data.code=="B119008"){winDialog.alert($SYSMSG[_data.code],{icon:"01",funcOk:function(){window.location.href=window.location.href.replace(/#.*$/,"")}},"alert1");Core.Events.addEvent(winDialog.getDialog("alert1").getNodes().btnClose,function(){window.location.href=window.location.href.replace(/#.*$/,"")},"click");this.onError();return}if(_data.code&&_data.code==="P00001"){winDialog.confirm($SYSMSG[_data.code],{icon:"01",funcOk:function(){window.open("https://security.sina.com.cn/account/index?entry=sina_shiming","_blank")}});return}if(_data.code=="B119002"){winDialog.alert($SYSMSG[_data.code],{icon:"01",funcOk:function(){window.location.href="http://control.blog.sina.com.cn/upgrade/upgrade_show.php?version=7"}})}else{winDialog.alert($SYSMSG[_data.code],{icon:"02",funcOk:function(){window.location.href=window.location.href.replace(/#.*$/,"")}},"alert1");Core.Events.addEvent(winDialog.getDialog("alert1").getNodes().btnClose,function(){window.location.href=window.location.href.replace(/#.*$/,"")},"click")}this.onError()}.bind2(this),onFail:function(){this.saving=false}.bind2(this)})},numAdd:function(){var ele=$E("quote_sign")||$E("quote_sign_"+this.articleID)||$E("z_"+this.articleID);if(!ele){return}var text=ele.innerHTML;var num;text.replace(/(\d+)/,function(a,b){num=b});ele.innerHTML="("+(parseInt(num)+1)+")"},onSuccess:function(aID){},onError:function(){}};var CommentQuote=Core.Class.create();CommentQuote.prototype={_isInitTip:false,_tip:null,quote:null,commentText:"",articleID:"",interfaceSave:null,initialize:function(){this.interfaceSave=new Interface("http://control.blog.sina.com.cn/riaapi/article/edit_cat.php","ijax");this._initQuote()},_initQuote:function(){var me=this;this.quote=new Quote;this.quote.onSuccess=function(aID,url){me.hideTip();winDialog.alert("博文已成功转载！<br/><span style='font-weight: 100; font-size: 12px;'><a target='_blank' href='"+url+"'>查看转载博文>></a></span>",{icon:"03"});me.onSuccess()};this.quote.onError=function(){me.hideTip()}},showTip:function(text){var tp,win=Core.System.winSize();!this._isInitTip&&this._initTip();tp=this._tip;tp.getNodes().content.innerHTML=text;tp.visibility="hidden";tp.show();tp.setPosition(win.width/2-+tp.entity.offsetWidth/2,win.height/2-+tp.entity.offsetHeight/2);tp.visibility="";tp.setFixed(true)},check:function(articleID,commentText){this.articleID=articleID;this.commentText=commentText;this.quote.check(articleID,commentText,"1")},hideTip:function(){this._tip&&this._tip.hidden()},_initTip:function(){this._tip=new Lib.Panel;this._tip.setTemplate(['<div id="#{panel}" style="z-index:512;border:1px solid #CC9933; background:#FFFFCC; padding:20px;">','<div id="#{content}"></div>',"</div>"].join(""));this._isInitTip=true},onSuccess:function(){}};scope.bindEmailPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(['<div id="#{panel}" style="z-index:512; width:200px" class="tb_layer_Y tb_layer_w5">','<div class="tb_layer_Y_main tip_layer_main">','<div class="tip_ps" style="width:auto;float:right">','<a id="closeBindEmail" title="关闭提示" class="tb_friend_inputDel" href="#" onclick="return false"></a>',"</div>",'<div style="padding:6px">为了您的账号安全，请<a id="linkBindEmail" href="#" target="_blank">绑定邮箱</a></div>',"</div>",'<div class="tb_layer_arrow tip_arrow"></div>',"</div>"].join(""))},Lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes()}});$registJob("articleCommentPostV2",function(){Lib.checkAuthor(function(){var commentQuote=new CommentQuote;commentQuote.onSuccess=function(){$E("cbCommentQuote")&&($E("cbCommentQuote").checked=false)};function showAnonymityTip(){var nickEl=$E("commentNick");if(!nickEl)return;for(var child=nickEl.firstChild;child;child=child.nextSibling){nickEl.removeChild(child)}nickEl.innerHTML='<div id="openblog-li" style="cursor:pointer;"><a href="javascript:void(0);"><span id="openblog-nickname"></span>您还未开通博客，点击一秒开通。</a></div>';scope.addBlogOpenerEvent($E("openblog-li"));var nickNameTime=setInterval(function(){if(!scope.nickname){return}$E("openblog-nickname").innerHTML=scope.nickname+"：";clearInterval(nickNameTime)},100)}if(scope.$private.cms!=1&&scope.$isCommentAllow!=1){var CommentPost=new CommentV2.Post;var showNickPlace=function(){$E("commentNick").style.display="";if(checkUserProduct.flag==true){scope.setNickTime=setInterval(function(){var vHTML=Lib.blogv.getVHTML(scope.loginUserWtype);if(typeof scope.$loginNick=="undefined"){Lib.Uic.getNickName([$UID],function(oResult){for(var key in oResult){scope.$loginNick=oResult[key];$E("commentNick").innerHTML=scope.$loginNick+"&nbsp;"+vHTML+":"}});clearInterval(scope.setNickTime)}else{$E("commentNick").innerHTML=scope.$loginNick+"&nbsp;"+vHTML+":"}},500)}else{showAnonymityTip()}};if($isLogin){if(checkUserProduct.isinit==false){setTimeout(function(){checkUserProduct.check("blog",showNickPlace)},10)}else{Lib.checkAuthor(function(){showNickPlace()},"articleCommentPostV2"+(new Date).getTime())}}else{$E("commentlogin").style.display="block";var defaultName=Utils.Cookie.getCookie("remberloginname");if(defaultName!=""&&defaultName!=""){$E("login_name").value=unescape(unescape(defaultName))}var alf=Utils.Cookie.getCookie("ALF");if(alf!=""&&$E("login_remember")){$E("login_remember").checked=true}var alf=Utils.Cookie.getCookie("LiRe");if(alf!=""&&$E("login_remember")){$E("login_remember").checked=true}if($E("anonymity_cont")){$E("anonymity")&&($E("anonymity").checked=false);$E("anonymity_cont").style.display="none"}}if($E("bb")){$E("bb").checked=false}var initSaveCaution=function(){Lib.checkAuthor(function(){var cautionCheck=$E("login_remember");if(!cautionCheck){return}cautionCheck.checked=true;if(!$isLogin){cautionCheck["onclick"]=validChecked}var cancelStatus=1;function validChecked(){if(cancelStatus){var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?ck_login=A00003&rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}});cancelStatus=null}}},"articleCommentPostV2"+(new Date).getTime())};initSaveCaution();if($E("anonymity")&&$E("anonymity").checked){CommentPost.anonyous=true;$E("commentlogin").style.display="none";$E("commentloginM").style.display=""}Core.Events.addEvent($E("comment_anonyous"),function(){if($E("anonymity")&&$E("anonymity").checked&&Core.String.trim($E("comment_anonyous").value)=="新浪网友"){$E("comment_anonyous").value=""}},"focus");Core.Events.addEvent($E("comment_anonyous"),function(){if($E("anonymity")&&$E("anonymity").checked&&Core.String.trim($E("comment_anonyous").value)==""){$E("comment_anonyous").value="新浪网友"}},"blur");var bindEmailPanel=new scope.bindEmailPanel;Core.Events.addEvent($E("login_name"),function(){bindEmailPanel.hidden()},"focus");Core.Events.addEvent($E("login_name"),function(){var name=$E("login_name").value;if(!name)return;checkUserMail(name)},"blur");function checkUserMail(name){Utils.Io.JsLoad.request("https://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent(name)+"&utf82gbk=1&callback=scope.$bindEmailTip",{noreturn:true})}scope.$bindEmailTip=function(data){if(data.ret=="y"||data.errcode=="not_verify"){var node=$E("login_name");bindEmailPanel.showWithDom(node,-150,-55);$E("linkBindEmail").href="https://login.sina.com.cn/bindmail/signin.php?entry=blog&utf82gbk=1&username="+encodeURIComponent(node.value)}else{bindEmailPanel.hidden()}};Core.Events.addEvent($E("closeBindEmail"),function(){bindEmailPanel.hidden()});Core.Events.addEvent("postcommentid",function(){try{bindEmailPanel.hidden()}catch(e){}});function swapView(type){var t=type||"check";if(t=="img"){$E("comment_check_img").style.display="inline";$E("check_show").style.display="none"}else{$E("comment_check_img").style.display="none";$E("check_show").style.display=""}}CommentPost.articleid=scope.$articleid;CommentPost.onSuccess=function(){if(scope.commEditor){scope.commEditor.clearHTML("postCommentIframe")}var cbCommentQuote=$E("cbCommentQuote");if(cbCommentQuote&&cbCommentQuote.checked){commentQuote.check($r_quote_bligid,$E("commentArea").value)}$E("commentArea").value="";if(is_mobile&&mbCmtTa){mbCmtTa.value=""}};CommentPost.onError=function(){};if($E("anonymity")){Core.Events.addEvent("anonymity",function(){Lib.checkAuthor(function(){var commentNick=$E("commentNick");v7sendLog("32_01_17");var isOpenBlog=checkUserProduct.flag&&checkUserProduct.isinit||false;isOpenBlog&&$isLogin&&commentNick&&(commentNick.style.display="");if($E("anonymity").checked){CommentPost.anonyous=true;$E("commentlogin").style.display="none";$E("commentloginM").style.display="block";$E("cbCommentQuote")&&($E("cbCommentQuote").checked=false);commentNick&&(commentNick.innerHTML="你正以匿名身份发表评论:")}else{var vHTML=Lib.blogv.getVHTML(scope.loginUserWtype);CommentPost.anonyous=false;$E("commentlogin").style.display=$isLogin?"none":"block";$E("commentloginM").style.display="none";if(isOpenBlog){commentNick&&(commentNick.innerHTML=(scope.$loginNick||scope.nickname)+"&nbsp;"+vHTML+":")}else{showAnonymityTip()}}$E("cbCommentQuote")&&($E("cbCommentQuote").disabled=$E("anonymity").checked);$E("quote_comment_p")&&($E("quote_comment_p").style.display=$E("anonymity").checked?"none":"")},"atricleCommentPost"+(new Date).getTime())})}if($E("bb")){Core.Events.addEvent($E("bb"),function(){v7sendLog("32_01_18")})}if(!$E("postCommentIframe")){}var is_mobile=/Mobile/i.test(navigator.userAgent),mbCmt=$E("mobileComment"),mbCmtTa=$E("mbCommentTa");if(is_mobile&&mbCmt){$E("commonComment").style.display="none";$E("faceWrap").style.display="none";mbCmt.style.display="";var anoc=$E("anonymity_cont");anoc&&(anoc.style.cssFloat="left")}var savefunc=function(){if(Core.Events.getEvent()){var e=Core.Events.getEvent();if(e.type=="keydown"&&e.keyCode!=13){return}else if(e.type=="keydown"&&e.keyCode==13){if(scope.commEditor){scope.commEditor.handleChange("postCommentIframe")}}Core.Events.stopEvent()}if(!$isLogin&&$E("anonymity")&&$E("anonymity").checked==false){if(Core.String.trim($E("login_name").value)==""){showError($SYSMSG.B36107);return}else if(Core.String.trim($E("login_pass").value)==""){showError($SYSMSG.B36108);return}}if(is_mobile&&mbCmtTa){$E("commentArea").value=mbCmtTa.value}if($E("anonymity")&&$E("anonymity").checked==true&&Core.String.trim($E("comment_anonyous").value)==""){showError($SYSMSG.B36003)}else{if(Core.String.trim($E("commentArea").value)==""){showError($SYSMSG.B36105)}else{var data={comment:$E("commentArea").value,login_name:$E("login_name").value,login_pass:$E("login_pass").value,comment_anonyous:$E("comment_anonyous").value,anonymity:$E("anonymity")&&$E("anonymity").checked,is_mobile:+is_mobile,is_t:0};if($E("login_remember")){data.login_remember=$E("login_remember").checked;if(data.login_remember){Utils.Cookie.setCookie("LiRe",true,2400,"/",".blog.sina.com.cn")}else{Utils.Cookie.setCookie("LiRe","",2400,"/",".blog.sina.com.cn")}}if($E("bb")){if($E("bb").checked){data.is_t=1}else{data.is_t=0}}CommentPost.post(data)}}};Core.Events.addEvent($E("commentArea"),function(){var e=Core.Events.getEvent();if(e.ctrlKey&&e.keyCode===13){savefunc()}},"keydown");Core.Events.addEvent("postcommentid",function(){if(scope.commEditor){scope.commEditor.handleChange("postCommentIframe")}savefunc()});Core.Events.addEvent($E("postcommentid").parentNode,function(){if(scope.commEditor){scope.commEditor.handleChange("postCommentIframe")}savefunc()},"keydown");if($E("smilesSortShow")==null){$E("commentArea").style.width="680px";var smile=new CommentV2.insertSmile;smile.show()}else{var arrPix=[-325,40+($IE?-2:0)],cfg;if(scope.$pageid.indexOf("articletj")!==-1){cfg={sortCount:4,recommCount:6}}if($E("postCommentIframe")){var events={normal:{focus:function(){}}};App.formInsertSmile2("commentArea","smilesSortShow","smilesRecommended",null,"smilesSortShow",arrPix,"postCommentIframe",events,cfg)}else{App.formInsertSmile("commentArea","smilesSortShow","smilesRecommended",null,"smilesSortShow",arrPix,null,null,cfg)}}}},"articleCommentPostV2"+(new Date).getTime())});Core.Dom.getChildrenByClass=function(el,clz){var rs=[];var cldr=el.childNodes||el.children;var clz=" "+clz+" ";var len=cldr.length;for(var i=0;i<len;++i){var o=cldr[i];var ecl=" "+o.className+" ";if(ecl.indexOf(clz)!=-1){rs[rs.length]=o}}return rs};Lib.pkg("util");Lib.util.hoverJq=function(conf){var _default={elm:document.body,mouseenter:function(evt,el,index){},mouseleave:function(evt,el,index){},delay:0};conf=Lib.apply(_default,conf);var enterType=$IE?"mouseenter":"mouseover",leaveType=$IE?"mouseleave":"mouseout";if(!("length"in conf.elm)){conf.elm=[conf.elm]}else{try{conf.elm=Array.prototype.slice.call(conf.elm,0)}catch(e){var tmpArr=[];for(var i=0,len=conf.elm.length;i<len;i++){tmpArr.push(conf.elm[i])}conf.elm=tmpArr}}Core.Array.foreach(conf.elm,function(one,index){Core.Events.removeEvent(one,enterType);Core.Events.removeEvent(one,leaveType);Core.Events.addEvent(one,function(el,func,i){return function(evt){evt=evt||window.event;if($IE){func.apply(el,[evt,el,i])}else{withinElement(evt,"mouseenter",el,i)}}}(one,conf[enterType],index),enterType);Core.Events.addEvent(one,function(el,func,i){return function(event){if($IE){func.apply(el,[event,el,i])}else{withinElement(event,"mouseleave",el,i)}}}(one,conf[leaveType],index),leaveType)});var withinElement=function(event,mouseType,elm,i){var parent=event.relatedTarget;try{if(parent&&parent!==document&&!parent.parentNode){return}while(parent&&parent!==elm){parent=parent.parentNode}if(parent!==elm){conf[mouseType].apply(elm,[event,elm,i])}}catch(e){}return false}};Lib.register("tray.tpl.loginMemu",function(){var tpl=['<div class="ntopbar_menu" id="#{panel}">','<div id="#{openBlog}" style="display:none;">','<span class="link"><a href="http://www.sina.com.cn" target="_blank" suda-uatrack="key=sinahome_from_blog&value=sinahome_from_blogpage"><i class="SG_bkhome"></i>新浪首页</a></span>','<span class="link" id="#{userMenu}"><a id="#{userNick}" onclick="v7sendLog(\'40_01_21\');return false;" href="###">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span id="#{msnHolder}" class="ico_msn" style="display:none"><a id="#{msnLink}" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c=" target="_blank"><img height="18" width="18" align="absmiddle" class="SG_icon SG_icon136" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif"></a></span>','<span class="line_s"></span>','<span class="link"><a onclick="v7sendLog(\'40_01_27\')" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<em id="#{newFeed}" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>','<span class="link" id="#{blogMenu}"><a target="_blank" onclick="v7sendLog(\'40_01_24\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a><a id="#{addArticle}" onclick="v7sendLog(\'40_01_25\');return false;" href="###" class="link_arrow"></a></span>','<span class="line_s"></span>','<span class="link" id="#{trayMsg}" msg-panel-show-state="0"><a onclick="v7sendLog(\'40_01_30\');return false;" href="###">消息</a><a href="javascript:return false;" class="link_arrow" title=""></a></span>','<em id="#{newTips}" onclick="v7sendLog(\'40_01_29\')" class="mtip" style="left:341px;display:none;cursor:pointer;"></em>',"</div>",'<div id="#{noOpenBlog}" style="display:none;">','<span class="link"><a id="#{ssoNick}" onclick="v7sendLog(\'40_01_40\');return false;" href="###">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a id="#{ssoLoginOut}" onclick="v7sendLog(\'40_01_41\');return false;" href="###">退出</a></span>','<div class="ntopbar_login" style="float:left;"><a id="#{openBlogBtn}" onclick="v7sendLog(\'40_01_42\')" class="login" href="###"><span>立即拥有一个新博客</span></a></div>',"</div>","</div>"].join("");return tpl});Lib.register("tray.tpl.loginOutMemu",function(){var uid=scope.$uid||"";var regLink="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+uid+"&src=";if(scope.$channel==2){regLink+="baby"}else{regLink+="blogicp"}var tpl=['<div id="#{panel}" class="ntopbar_login">','<span class="link bk_home"><a href="http://www.sina.com.cn" target="_blank" suda-uatrack="key=sinahome_from_blog&value=sinahome_from_blogpage"><i class="SG_bkhome"></i>新浪首页</a></span>','<a class="login" onclick="v7sendLog(\'40_01_38\');return false;" href="###" action-type="tray-login-btn"><span>登录</span></a>','<a class="register" onclick="v7sendLog(\'40_01_39\')" target="_blank" href="',regLink,'">注册</a></div>'].join("");return tpl});Lib.register("tray.tpl.userMenu",function(){var tpl=['<div id="#{panel}" class="mUserMenu">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle">博客</a></span>','<span class="rlink"><a target="_blank" onclick="v7sendLog(\'40_01_22\')" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a></span>',"</li>",'<li> <span class="tb_ps_nm"><a id="#{linkPhoto}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle">相册</a></span> <span class="rlink"><a target="_blank" id="#{linkPostPhoto}" onclick="v7sendLog(\'40_01_22\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{miniblog}" onclick="v7sendLog(\'40_01_22\')" href="###" target="_blank"><img class="SG_icon SG_icon110" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="17" title="微博" align="absmiddle">微博</a></span> </li>','<li style="display:none;" id="#{mail}"> <span class="tb_ps_nm"><a id="#{bindEmail}" target="_blank" href="http://mail.sina.com.cn/?s=2" onclick="v7sendLog(\'40_01_22\')"><img class="SG_icon SG_icon212" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="邮件" align="absmiddle">邮件</a></span> </li>','<li> <span class="tb_ps_nm"><a id="#{mySpace}" onclick="v7sendLog(\'40_01_22\')" href="###"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle">关于我</a></span> </li>',"</ul>",'<div class="links">','<p><a target="_blank" id="#{linkChangeFace}" onclick="v7sendLog(\'40_01_22\')" href="###">修改头像昵称&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkChangePassword}" onclick="v7sendLog(\'40_01_22\')" href="###">修改登录密码&gt;&gt;</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" onclick="v7sendLog(\'40_01_22\')" href="###">帐号安全设置&gt;&gt;</a></p>','<p><a id="#{loginOut}" onclick="v7sendLog(\'40_01_23\');return false;" href="#">退出&gt;&gt;</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.loginOut",function(lib){var ls=lib.Listener;return function(cb,reload){var _curHref=encodeURIComponent(window.location.href);var res={code:"A00006",data:""};ls.notify("global-login-out",res);cb&&cb(res);if(reload){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}}});Lib.register("tray.UserMenuPanel",function(lib){var userMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.userMenu)},lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="https://security.sina.com.cn/account/security?option=chgpwd&entry=blog";nodes["linkAccountSetup"].href="https://security.sina.com.cn/account/security";this.initLoginOut(nodes["loginOut"])},initLoginOut:function(outBtn){outBtn.onclick=function(){return false};Core.Events.addEvent(outBtn,function(){lib.tray.loginOut(null,!0)})}});return userMenu});Lib.register("tray.tpl.blogMenu",function(){var tpl=['<div id="#{panel}" class="wrtBlog_sub">','<div class="wrtBlog_sub3">','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365">写365</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<p><a target="_blank" onclick="v7sendLog(\'40_01_26\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>',"</div>","</div>"].join("");return tpl});Lib.register("tray.BlogMenuPanel",function(lib){var blogMenu=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.blogMenu)
},lib.Panel,{});return blogMenu});Lib.register("tray.tpl.searchForm",function(){var tpl=['<div class="ntopbar_input" id="#{panel}">','<form id="#{searchForm}" method="get" target="_blank" action="http://search.sina.com.cn">','<input id="#{queryTxt}" class="ntopbar_txt" type="text" name="q" autocomplete="off"/>','<input id="#{submit}" type="submit" onclick="v7sendLog(\'40_01_44\')" class="ntopbar_searchBtn" value=""/>','<input type="hidden" name="ie" value="utf-8"/>','<input type="hidden" name="e" value="utf-8"/>','<input id="#{range}" type="hidden" name="range" value="article"/>','<input id="#{t}" type="hidden" name="t" value=""/>','<input id="#{s}" type="hidden" name="s" value="sup"/>','<input id="#{by}" type="hidden" name="by" value="all"/>','<input id="#{type}" type="hidden" name="type" value=""/>','<input id="#{stype}" type="hidden" name="stype" value="1"/>','<input id="#{c}" type="hidden" name="c" value="blog"/>',"</form>","</div>"].join("");return tpl});Core.Dom.addClass=function(obj,className){var _trim=Core.String.trim;className=_trim(className);if(!className){return obj}obj=$E(obj);var oldClz=_trim(obj.className||"");var tmpOldClz=" "+oldClz+" ";if(!oldClz){obj.className=_trim(className);return obj}var uClzs=className.split(" ");var uClz,newClzs=[];for(var i=0;i<uClzs.length;i++){uClz=uClzs[i];if(uClz&&-1===tmpOldClz.indexOf(" "+uClz+" ")){newClzs.push(uClz)}}obj.className=oldClz+" "+newClzs.join(" ");return obj};Core.Dom.removeClass=function(obj,className){obj=$E(obj);obj.className=obj.className.replace(new RegExp("\\s*\\b"+className+"\\b"),"")};Lib.util.getActionData=function(evt,actionType,typeAttrName,dataAttrName){if(!actionType){throw"[Lib.util.getActionData] param actionType is undefined!"}evt=evt||window.event;var _getTarget=Core.Events.getEventTarget,tEl,delegateEl,typeStr,types,type,data,typeAttrName=typeAttrName||"action-type",dataAttrName=dataAttrName||"action-data";tEl=_getTarget(evt);delegateEl=evt.currentTarget||document.documentElement||document.body;while(tEl&&tEl!=delegateEl){typeStr=tEl.getAttribute(typeAttrName)||"";types=typeStr.split(",");for(var i=0,len=types.length;i<len;i++){type=types[i];if(actionType===type){data=tEl.getAttribute(dataAttrName);return{actionType:actionType,targetEl:tEl,data:data}}}tEl=tEl.parentNode}return null};Lib.register("tray.tpl.cateSearch",function(){var tpl=['<div id="#{panel}" class="mCatSearch">',"<ul>",'<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="article" class="current">含“<span id="#{article}"></span>”的博文</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="bloger">含“<span id="#{bloger}"></span>”的博主</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="music">含“<span id="#{music}"></span>”的音乐</li>','<li action-type="tray-search" onclick="v7sendLog(\'40_01_43\')" action-data="video">含“<span id="#{video}"></span>”的视频</li>',"</ul>","</div>"].join("");return tpl});Lib.register("tray.CateSearchPanel",function(lib){var _addEvt=Core.Events.addEvent;var leftB=Core.String.leftB;var byteLength=Core.String.byteLength;var catePanel=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.cateSearch);this.initEvt()},lib.Panel,{initEvt:function(){var nodes=this.getNodes();var $lis=$T(nodes["panel"],"li");lib.util.hoverJq({elm:$lis,mouseenter:function(evt,el,index){Core.Dom.addClass(el,"current")},mouseleave:function(evt,el,index){Core.Dom.removeClass(el,"current")},delay:50});_addEvt(nodes["panel"],function(evt){evt=evt||window.event;var searchData=lib.util.getActionData(evt,"tray-search");if(searchData){lib.Listener.notify("tray-categroy-search",searchData.data)}})},updateSearch:function(v){if(5<byteLength(v)){v=leftB(v,4)+"..."}var value=v.replace(/(<|>)/g,function($1){if("<"===$1){return"&lt;"}else{return"&gt;"}});var nodes=this.getNodes();nodes["article"].innerHTML=value;nodes["bloger"].innerHTML=value;nodes["music"].innerHTML=value;nodes["video"].innerHTML=value}});return catePanel});Lib.register("tray.SearchFormPanel",function(lib){var _addEvt=Core.Events.addEvent;var _trim=Core.String.trim;var searchForm=Core.Class.define(function(cfg){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.searchForm);this.initEvt();this.catePanel=new lib.tray.CateSearchPanel;this.catePanel.entity.style.zIndex=512;lib.Listener.on({name:"tray-categroy-search",callBack:this.search,scope:this})},lib.Panel,{initEvt:function(){var me=this;var $queryTxt=this.getNode("queryTxt");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"input");_addEvt($queryTxt,function(evt){evt=evt||window.event;if("value"!==evt.propertyName){return}var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"propertychange");_addEvt($queryTxt,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var offset=target.offsetWidth;me.showCateSearch(target,offset,target.value)},"focus");_addEvt(this.getNode("searchForm"),function(evt){evt=evt||window.event;var form=evt.target||evt.srcElement;if(!me.checkValidate(form)){Core.Events.stopEvent(evt)}else{setTimeout(function(){me.hideCateSearch();me.resetForm()},100)}},"submit");_addEvt(window,function(){if(me.catePanel.isShow){var offset=$queryTxt.offsetWidth;me.catePanel.showWithDom($queryTxt,-offset,4)}},"resize")},checkValidate:function(form){if("q"in form&&!_trim(form["q"].value))return false;else if("k"in form&&!_trim(form["k"].value))return false;else return true},setForm:function(url,cfg){var defaultValue={queryTxt:"q",ie:"utf-8",range:"",t:"",s:"",by:"",type:"",stype:"",e:"utf-8",c:""};var $searchForm=this.getNode("searchForm");$searchForm.action=url;lib.apply(defaultValue,cfg);var $queryTxt=this.getNode("queryTxt");$queryTxt.name=defaultValue["queryTxt"];delete defaultValue["queryTxt"];var attr,$query;for(var p in defaultValue){attr=defaultValue[p];if(typeof attr==="string"&&($query=this.getNode(p))){$query.value=attr}}},resetForm:function(){this.setForm("http://search.sina.com.cn",{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})},search:function(type){var $searchForm=this.getNode("searchForm");var blogSearchUrl="http://search.sina.com.cn";var videoSearchUrl="http://video.sina.com.cn/search/index.php";var musicSearchUrl="http://music.sina.com.cn/yueku/search/s.php";switch(type){case"video":this.setForm(videoSearchUrl,{queryTxt:"k",s:"sup",type:"boke",stype:"1"});break;case"bloger":this.setForm(blogSearchUrl,{queryTxt:"q",range:"author",s:"sup",by:"all",stype:"1",c:"blog"});break;case"music":this.setForm(musicSearchUrl,{queryTxt:"k",t:"song"});break;default:this.setForm(blogSearchUrl,{queryTxt:"q",range:"article",s:"sup",by:"all",stype:"1",c:"blog"})}if($IE){this.getNode("submit").click()}else{Core.Events.fireEvent(this.getNode("submit"),"click")}},showCateSearch:function($withEl,offset,v){var catePanel=this.catePanel;if(v&&catePanel.isHidden){catePanel.showWithDom($withEl,-offset,4)}else if(!v){this.hideCateSearch()}catePanel.updateSearch(v)},hideCateSearch:function(){var catePanel=this.catePanel;catePanel.hide();catePanel.updateSearch("")}});return searchForm});Lib.register("tray.loadUserInfo",function(lib){var LS=lib.util.LS;var JSON=lib.util.JSON;var sendSever=function(uid,cb){var url="http://interface.blog.sina.com.cn/riaapi/profile/getNickName.php";Utils.Io.JsLoad.request(url,{GET:{uid:uid},onComplete:function(r){if(r&&"A00006"===r.code){var n=r.data.nickname;if(!r.data.full_nickname){r.data.full_nickname="用户"+r.data.uid}if(!r.data.nickname){r.data.nickname="用户"+r.data.uid}var saveObj={time:(new Date).getTime()/1e3};lib.apply(saveObj,r.data);LS.setItem("uid"+uid,JSON.stringify(saveObj));cb(saveObj)}},onException:function(){},timeout:1e4})};return function(uid,cb,froceSever){var nickInfo=LS.getItem("uid"+uid);if(!froceSever&&nickInfo){nickInfo=JSON.parse(nickInfo);var currentTime=(new Date).getTime()/1e3;var waitTime=currentTime-nickInfo.time;if(waitTime<4*60&&nickInfo.nickname){cb(nickInfo);return}}sendSever(uid,cb)}});Lib.register("tray.MsgLoader",function(lib){var addFlash=function($flash){var $wrapper=$C("div");$wrapper.style.cssText="position:absolute;top:-1000px;left:-1000px;";document.body.appendChild($wrapper);$flash.write($wrapper)};var random="",FlaDom;if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}var msgLoader=function(cfg){lib.apply(this,cfg);if(!FlaDom){try{var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"blogMessageReminding.swf"+random,"__msgTipsPlayer","1px","1px","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.addParam("freeTime",27*1e3);if("complete"===document.readyState){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")}else{_addEvt(window,function(){addFlash(FlashPlayer);FlaDom=$E("__msgTipsPlayer")},"load")}}catch(e){}}}.$define({time:30,url:"http://comet.blog.sina.com.cn/api?maintype=notice",getFlaDom:function(){return FlaDom},play:function(){if($_GLOBAL.msgPlaySound&&FlaDom&&FlaDom.PlaySound){try{FlaDom.PlaySound()}catch(e){}}},load:function(uid,cb){var $this=this;var blogid=scope.$articleid||"";if(!uid){return}Utils.Io.JsLoad.request(this.url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){if(r&&"A00006"==r.code){var d,articleMsg;if(uid&&(d=r.data[uid])){var userMsg={};userMsg.sum=0;for(var k in d){userMsg[k]=d[k];userMsg.sum+=d[k]}userMsg.blogrecomment=userMsg.blogrecomment?userMsg.blogrecomment:0;lib.Listener.notify("tray-newmsg-loaded",userMsg)}if(blogid&&(articleMsg=r.data[blogid])){lib.Listener.notify("article-msg-loaded",articleMsg)}}},onException:function(){},timeout:1e4})}});return msgLoader});Lib.register("tray.tpl.notice",function(){var tpl=['<div id="#{panel}" class="horn">','<div id="#{tj}" class="horn_con" style="display:none;">推荐：<a id="#{noticeAd1}" target="_blank" href="#"></a><a id="#{noticeAd2}" target="_blank" href="#"></a></div>','<div id="#{announce}" class="horn_con" style="display:none;"><p id="#{announceCon}">公告：<em>请您及时更换请请请您正在使用的模版将于2周后被下线，请您及时更换</em></p></div>','<a class="close" title="关闭" id="#{close}" style="float:none;">×</a>',"</div>"].join("");return tpl});Lib.register("tray.BlogNotice",function(lib){var _addEvt=Core.Events.addEvent,setCookie=Utils.Cookie.setCookie,pageId=scope.$pageid;var notice=Core.Class.define(function(){lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(lib.tray.tpl.notice);this.initEvt()},lib.Panel,{initEvt:function(){var $this=this;_addEvt(this.getNode("close"),function(evt){evt=evt||window.event;setCookie("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn");lib.Listener.notify("tray-announce-close",{});$this.destroy()})},update:function(json){var $tj=this.getNode("tj"),$announce=this.getNode("announce");var slotres="";var sourceArr=["SLOT_58","SLOT_59","SLOT_98","SLOT_99","SLOT_100","SLOT_101","SLOT_102"];var sloturl="http://comet.blog.sina.com.cn/api?maintype=pageslot";var reqdata={id:sourceArr};if(typeof scope!="undefined"){reqdata.blogeruid=scope.$uid}if($UID){reqdata.loginuid=$UID}if($isLogin&&json.announce.result&&(pageId==="indexM"||pageId==="articleM"||pageId==="articlelistM")){$announce.innerHTML=json.announce.announce_con;$announce.style.display=""}else{var noticeAd1=this.getNode("noticeAd1");var noticeAd2=this.getNode("noticeAd2");var complete=function(res){var randomIndex=0;var adcon1=res[sourceArr[0]].res;var adcon2=res[sourceArr[1]].res;if(adcon1||adcon2){if(adcon1){randomIndex=0;if(adcon1.length>1){randomIndex=Math.floor((adcon1.length+1)*Math.random())}noticeAd1.innerHTML=adcon1[randomIndex].words;noticeAd1.href=adcon1[randomIndex].a_href;noticeAd1.title=adcon1[randomIndex].a_title;noticeAd1.setAttribute("suda-uatrack",adcon1[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon1[randomIndex].a_v_suda_key,adcon1[randomIndex].a_v_suda_value)}}if(adcon2){randomIndex=0;if(adcon2.length>1){randomIndex=Math.floor((adcon2.length+1)*Math.random())}noticeAd2.innerHTML=adcon2[randomIndex].words;noticeAd2.href=adcon2[randomIndex].a_href;noticeAd2.title=adcon2[randomIndex].a_title;noticeAd2.setAttribute("suda-uatrack",adcon2[randomIndex].a_c_suda.replace("suda-uatrack=","").replace('"',"").replace('"',""));if(typeof SUDA!=="undefined"){SUDA.uaTrack(adcon2[randomIndex].a_v_suda_key,adcon2[randomIndex].a_v_suda_value)}}$tj.style.display=""}};if(scope.__subscribeSlot==="waitting"){scope.__subscribeSlotFunc=complete}else if(typeof scope.__subscribeSlot==="object"){complete(scope.__subscribeSlot)}else{scope.__subscribeSlot="waitting";Utils.Io.JsLoad.request(sloturl,{GET:reqdata,onComplete:function(res){complete(res);scope.__subscribeSlot=res;if("function"==typeof scope.__subscribeSlotFunc){scope.__subscribeSlotFunc(res)}},onException:function(){}})}}},setTemplate:function(template){this.template=template;var tmp=new Lib.HtmlTemplate(this.template,this.uniqueID);this.tpl=tmp;Core.Dom.insertHTML($E(this.appendTo),tmp.getHtmlString(),"afterbegin");this.entity=$E("_"+this.uniqueID+"_panel");this.entity.style.display="none";tempEntity=null}});return notice});Lib.register("tray.unReadMsgPanel",function(lib){var unReadMsgPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();if(scope.$pageid=="editor"){return}this._lockstate=0;this._scrolling=0;this._srcPot=ele;var template=['<div class="cor"></div>','<div class="bd">','<a href="#" id="j-unread-msg-close" class="close" title="关闭">×</a>','<ul id="j-unre-list">',"</ul>","</div>"].join("");this.setTemplate('<div class="messageTips" id="#{panel}" style="left:850px; top:10px;">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent()},lib.Panel,{show:function(){if(this.isShow){return}v7sendLog("40_02_01");this.entity.style.display="";this._srcPot&&this._srcPot.setAttribute("unread-show-state",1);this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}lib.Listener.notify("tray-unread-panel-show",{})},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("unread-show-state",0);lib.Listener.notify("tray-unread-panel-hide",{})},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(data){var _list=[];if(data.comment+data.message+data.notice+data.gbook==0){this.hide();return}if(data.comment>0){_list.push("<li>"+data.comment+'条新评论，<a onclick="v7sendLog(\'40_02_02\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">查看评论</a></li>')}if(data.message>0){_list.push("<li>"+data.message+'条新纸条，<a onclick="v7sendLog(\'40_02_03\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">查看纸条</a></li>')}if(data.gbook>0){_list.push("<li>"+data.gbook+'条新留言，<a onclick="v7sendLog(\'40_02_04\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php">查看留言</a></li>')}if(data.notice>0){var sysurl={notice:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote",like:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",notice_favourite:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",notice_quote:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",invite:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",unreadnotices:"http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice",point:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php"};var url=sysurl.notice;for(var key in data.notices){if(data.notices[key]>0){url=sysurl[key]||url;break}}_list.push("<li>"+data.notice+'条新通知，<a onclick="v7sendLog(\'40_02_05\')" href="'+url+'">查看通知</a></li>')}$E("j-unre-list").innerHTML=_list.join("");this.show();this._setThePos()},_setThePos:function(){var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;if(pop[0]){var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){_y=pop[1]}var y=this._srcPot.clientHeight+_y+10;this.setPosition(x,y)}},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){if(_this._lockstate){return}_this._eventHandle(data);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){_this._srcPot.setAttribute("adshow",1);if(_this.isShow){_this._setThePos()}}});Core.Events.addEvent($E("j-unread-msg-close"),function(e){var evt=e||window.event;if(evt.preventDefault){evt.preventDefault()}else{evt.returnValue=false}_this.hide();_this._lockstate=1},"click");Core.Events.addEvent(window,function(){if(_this.isShow){_this._setThePos()}},"resize")},_eventHandle:function(data){var _data={};_data.comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data.notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data.notices={notice:data.notice,like:data.like,notice_favourite:data.notice_favourite,notice_quote:data.notice_quote,invite:data.invite,unreadnotices:data.unreadnotices,point:data.point};_data.message=data.message;_data.gbook=data.gbook;this._updateCont(_data)}});return unReadMsgPanel});Lib.register("tray.msgSummaryPanel",function(lib){var JSON=lib.util.JSON;var nolist=['<li><a onclick="v7sendLog(\'40_02_12\')" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1"><span class="icoms_comment"></span>查看评论</a></li>','<li><a onclick="v7sendLog(\'40_02_13\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span>查看纸条</a></li>','<li><a onclick="v7sendLog(\'40_02_14\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span>查看留言</a></li>','<li><a onclick="v7sendLog(\'40_02_15\')" href="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice"><span class="icoms_notice"></span>查看通知</a></li>'];var msgSummaryPanel=Core.Class.define(function(ele){lib.Panel.prototype.initialize();this._srcPot=ele;this._lock=1;this._scrolling=0;this._requirestate=1;this._nums={};var template=['<div class="bd">','<ul id="j-summary-list">',nolist.join(""),"</ul>","</div>"].join("");this.setTemplate('<div class="messageBox" id="#{panel}">'+template+"</div>");this.entity.style.zIndex=500;this._bindEvent();this._initNums()},lib.Panel,{show:function(){var _this=this;if(this._checkNumChange()){this._updateCont()}else{this._showAction()}},_showAction:function(){if(this.isHidden){this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",1);this.entity.style.display="";this.isHidden=!1;this.isShow=!0;if(this.backIframe){this._updateBackIframe();this.backIframe.style.display=""}this._setThePos()}else{this._setThePos()}},_checkNumChange:function(){var oldnum=this._srcPot.getAttribute("msg-count");var newnum=this._srcPot.getAttribute("old-msg-count");if(oldnum==newnum){return false}else{return true}},hide:function(){lib.Panel.prototype.hide.call(this);this._srcPot&&this._srcPot.setAttribute("msg-panel-show-state",0);lib.Listener.notify("tray-msg-panel-hide",{})},_initNums:function(){var data=JSON.parse(this._srcPot.getAttribute("msg-count"));this._formatData(data)},_setThePos:function(){if($IE6||$IE7||$IE8){this.entity.style.width="auto"}var pop=Core.Dom.getXY(this._srcPot);var sv=this._srcPot.className=="link"?-2:0;var width=$IE7||$IE6?this.entity.offsetWidth:this.entity.clientWidth;var x=pop[0]+this._srcPot.clientWidth-width+sv;var _y=0;if(this._srcPot.getAttribute("adshow")==1&&this._scrolling==0){if($IE6||$IE7||$IE8){_y=pop[1]-2}else{_y=pop[1]}}var y=this._srcPot.clientHeight+_y+1;if($IE6||$IE7||$IE8){this.entity.style.width=this.entity.clientWidth+1+"px";this.entity.style.width=this.entity.clientWidth-1+"px"}this.setPosition(x,y)},_updatePanelIframe:function(){if(this.backIframe){this._updateBackIframe()}},_updateCont:function(fun){var _list=[];var _this=this;this._lock=0;if(this._requirestate){this._getDate({},function(_data){_list.push(_this._getComment(_data));_list.push(_this._getMessage(_data));_list.push(_this._getGbook(_data));_list.push(_this._getNotice(_data));$E("j-summary-list").innerHTML=_list.join("");_this._srcPot.setAttribute("old-msg-count",_this._srcPot.getAttribute("msg-count"));if($IE6){$E("j-summary-list").style.width="270px"}_this._showAction()},function(_data){});this._requirestate=0}},_getDate:function(opt,funsuc,funerr){funsuc=funsuc||function(){};funerr=funerr||function(){};var _this=this;Lib.checkAuthor(function(){var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notelist.php","jsload");inter.request({GET:{uid:$UID},onSuccess:function(result){funsuc(result)}.bind2(_this),onError:function(result){funerr({num:0})}.bind2(_this),onFail:function(){funerr({num:0})}.bind2(_this)})},"msgSummaryPanel"+(new Date).getTime())},_getUserPicUrl:function(uid,size){var size=size||50;var n=parseInt(uid)%8+1;return"http://portrait"+n+".sinaimg.cn/"+uid+"/blog/"+size},getLen:function(a){if(!a){return 0}var b=a.match(/[^\x00-\xff]/g);return a.length+(b?b.length:0)},strTruncate:function(str,len,suffix){str=str||"";if(typeof suffix=="undefined"){suffix="..."}return this.getLen(str)>len?this.truncete(str,len)+suffix:str},truncete:function(b,c){var d=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**");b=b.slice(0,d.slice(0,c).replace(/\*\*/g," ").replace(/\*/g,"").length);this.getLen(b)>c&&c>0&&(b=b.slice(0,b.length-1));return b},getVipIcon:function(index){if(!index){return""}var vipicon={1:{icon:"SG_icon146",info:"新浪个人认证"},2:{icon:"SG_icon147",info:"新浪机构认证"}};var index=index||1;var pic='<img class="SG_icon '+vipicon[index].icon+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="13" title="'+vipicon[index].info+'" alt="'+vipicon[index].info+'" align="absmiddle" />';return pic},_setNameforIE6:function(name){if($IE6){return this.strTruncate(name,4)}else{return name}},_getComment:function(_data){var str="";if(this._nums._comment>0){var data=_data.msg.cms;if(data.length>0){var typemsg={1:"评论了你的博文",2:"评论了你的图片",6:"回复了你的评论"};var typeurl={1:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1",2:"http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=2",6:"http://i.blog.sina.com.cn/blogprofile/profilereplylist.php"};var types=[];for(var i=0,len=data.length;i<len;i++){var item=data[i];var name=item.nick_name||item.name;name=this._setNameforIE6(name);var img=this._getUserPicUrl(item.uid,30);var type=item.msg_type;types.push(type);var index=item.user_type||0;var time=item.time;str+='<li><a onclick="v7sendLog(\'40_02_06\')" href="'+typeurl[type]+'"><img src="'+img+'"><em class="nl">'+name+"</em>"+this.getVipIcon(index)+'<em class="tm">'+time+"</em>"+typemsg[type]+"</a></li>"}types.sort();if(this._nums._comment>3){str+='<li class="lcount"><a onclick="v7sendLog(\'40_02_07\')" href="'+typeurl[types[0]]+'">总共'+this._nums._comment+"条新评论</a></li>"}else{}}else{str=nolist[0]}}else{str=nolist[0]}return str},_getMessage:function(_data){var str="";if(this._nums._message>0){var data=_data.msg.note[0];var name=data.name||data.nick_name;name=this._setNameforIE6(name);var numstr=this._nums._message>1?"等"+this._nums._message+"人":"";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_08\')" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1"><span class="icoms_tips"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'发来纸条<em class="nr">查看纸条</em></a></li>'}else{str=nolist[1]}return str},_getGbook:function(_data){var str="";if(this._nums._gbook>0){var data=_data.msg.note[1];var name=data.name||data.nick_name;if(name){name=this._setNameforIE6(name);var numstr=this._nums._gbook>1?"等"+this._nums._gbook+"人":"给你";var index=data.user_type||0;str+='<li class="bgc"><a onclick="v7sendLog(\'40_02_09\')" href="http://i.blog.sina.com.cn/blogprofile/wall.php"><span class="icoms_message"></span><em class="nl">'+name+"</em>"+this.getVipIcon(index)+numstr+'留言<em class="nr">查看留言</em></a></li>'}}else{str=nolist[2]}return str},_getNotice:function(_data){var str="";var _pronotice="http://i.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilenotice";var _sysnotice="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote";var typeurl={3:"http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php",7:_pronotice,8:_pronotice,9:_pronotice,23:_pronotice,55:"http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/points_note.php",13:"http://i.blog.sina.com.cn/profilelist/profilelikelist.php",100:_sysnotice,101:_sysnotice,102:_sysnotice,103:_sysnotice,104:_sysnotice,105:_sysnotice,106:_sysnotice,107:_sysnotice,108:_sysnotice,109:_sysnotice,110:_sysnotice,111:_sysnotice,112:_sysnotice};if(this._nums._notice>0){var data=_data.msg.note[2];var type=data.msg_type||23;str+='<li class="bgc last"><a onclick="v7sendLog(\'40_02_10\')" href="'+typeurl[type]+'"><span class="icoms_notice"></span>'+this._nums._notice+'条新通知<em class="nr">查看通知</em></a></li>'}else{str=nolist[3]}return str},_bindEvent:function(){var _this=this;Lib.Listener.on({name:"tray-newmsg-loaded",callBack:function(data){_this._requirestate=1;_this._eventHandle(data)}});Lib.Listener.on({name:"tray-scrolling-nofix",callBack:function(data){_this._scrolling=0;if(_this._lockstate){return}_this.setFixed(0);_this._setThePos()}});Lib.Listener.on({name:"tray-scrolling-fix",callBack:function(data){_this._scrolling=1;if(_this._lockstate){return}_this.setFixed(1);_this._setThePos()}});Lib.Listener.on({name:"topad680-show-end",callBack:function(data){if(_this.isShow){_this._setThePos()}}})},_eventHandle:function(data){this._formatData(data);if(this.isShow){this._updateCont()}},_formatData:function(data){var _data={};_data._comment=data.blogcomment-0+(data.photocomment-0)+data.blogrecomment;_data._notice=data.notice+data.like+data.notice_favourite+data.notice_quote+data.invite+data.unreadnotices+data.point;_data._message=data.message;_data._gbook=data.gbook;this._cacheNums(data,_data)},_cacheNums:function(data,_data){for(var k in data){this._nums[k]=data[k]}for(var key in _data){this._nums[key]=_data[key]}}});return msgSummaryPanel});Lib.register("TrayPanel",function(lib){var _addEvt=Core.Events.addEvent;var _removeEvt=Core.Events.removeEvent;var _getCookie=Utils.Cookie.getCookie;var _contains=Core.Dom.contains;var JSON=lib.util.JSON;var byClass=Core.Dom.getChildrenByClass;var logoId="login_bar_logo_link_350";var _trayHolder="______noticeTrayHolder";var loadCount=0;var tray=null;var renderLogin=!1;var attr=function(el,attr,v){if(typeof v!=="string"){return el.getAttribute(attr)}else{el.setAttribute(attr,v)}};var TrayPanel=Core.Class.define(function(){var $topBaner=byClass(document.body,"nsinatopbar")[0];var $main=this.$main=byClass($topBaner,"ntopbar_main")[0];this.newTipsLog=0;lib.Panel.prototype.initialize.call(this,{appendTo:$main,isPostion:!1,noIframe:!0});lib.Listener.on({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this},{name:"tray-newmsg-loaded",callBack:this.showNewMsgTips,scope:this},{name:"global-login-out",callBack:function(){clearInterval(this._msgTimer)},scope:this},{name:"tray-announce-loaed",callBack:function(json){var args=arguments;var $this=this;if(this.notice){this.notice.update(json);return}setTimeout(function(){args.callee.call($this,json)},200)},scope:this},{name:"tray-unread-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-unread-panel-show",callBack:function(){var $tips=this.getNode("newTips");$tips.style.display="none"},scope:this},{name:"tray-msg-panel-hide",callBack:function(){var $trayMsg=this.getNode("trayMsg");var data=JSON.parse($trayMsg.getAttribute("msg-count"));this.showNewMsgTips(data,1)},scope:this},{name:"tray-announce-close",callBack:function(json){this.setTrayPosition()},scope:this},{name:"topad680-show-start",callBack:function(data){this._hideActiveSub()},scope:this});if(loadCount){loadCount++}},lib.Panel,{subPanels:[],hoverTimeout:"",hoverTime:400,load:function(loginState){if(!loadCount){var $logo=$E(logoId);if($logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){$logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}this.initSearch()}switch(loginState){case"login":if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}var start_time=new Date;var $this=this;lib.tray.loadUserInfo($UID,function(info){scope.unreadMsg=info;scope.nickname=info["full_nickname"];scope.loginUserWtype=info["login_wtype"];if(!$this._isRenderUser){$this.renderRight(lib.tray.tpl.loginMemu);$this._isRenderUser=!0}var $nick,$userInfo,$msnHolder;if(info.isbloguser){var $noOpenBlog=$this.getNode("noOpenBlog");$noOpenBlog.style.display="none";$this.initUserMenu();$this.initBlogMenu(info);$this.initNewMsgEvt();$this.initMsg();$this.initMsgLoder();$this.initHideSub();$this.initunReadMsgPanel();$nick=$this.getNode("userNick");$userInfo=$this.getNode("openBlog")}else{$nick=$this.getNode("ssoNick");$nick.href="http://control.blog.sina.com.cn/myblog/htmlsource/blog_notopen.php?uid="+$UID+"&version=7";$this.initOpenBlog();$this.initLogout();$userInfo=$this.getNode("noOpenBlog")}$nick.innerHTML="";var $nickTxt=document.createTextNode(info.nickname);$nick.appendChild($nickTxt);$userInfo.style.display="block";var isMsnLogin=Utils.Cookie.getCookie("loginFromMsn");if(isMsnLogin&&$nick){$msnHolder=$this.getNode("msnHolder");$msnHolder.style.display="block";var $msnLink=$this.getNode("msnLink");$msnLink.href+=$UID}if($msnHolder){Core.Dom.insertAfter($msnHolder,$nick.parentNode)}$this.initNotice()});break;case"logout":if(!this.trayLogin){this.trayLogin=new lib.Login.Ui;this.renderRight(lib.tray.tpl.loginOutMemu)}this.initLogin();this.initNotice();break;case"oncelogedon":break}loadCount++},initMsgLoder:function(){if(!this.msgLoader){this.msgLoader=new lib.tray.MsgLoader;this.msgLoader.load($UID);var $this=this;this._msgTimer=setInterval(function(){$this.msgLoader.load($UID)},30*1e3)}},initLogin:function(){var $this=this;var isInit=attr(this._el,"login");if(!isInit){attr(this._el,"login","1");_addEvt(this._el,function(evt){var data=lib.util.getActionData(evt,"tray-login-btn");if(!data){return}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};$this.trayLogin.login(function(){Lib.checkAuthor(function(){var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid)},"tray"+(new Date).getTime());setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click")}},initLogout:function(){var $loginOut=this.getNode("ssoLoginOut");var isInit=attr($loginOut,"loginout");if(!isInit){attr(this._el,"login","1");_addEvt($loginOut,function(){lib.tray.loginOut(null,!0)})}$loginOut=null},initHideSub:function(){var $this=this;_addEvt(document.body,function(evt){if(!$this._activeTab){return}var target=evt.target||evt.srcElement;
var panels=$this.subPanels;var item;for(var i=panels.length-1;i>=0;i--){item=panels[i];if(item.tab===target||_contains(item.tab,target)){return}if(item.panel.entity===target||_contains(item.panel.entity,target)){return}}$this._hideActiveSub()},"click");_addEvt(window,function(){var activeTab=$this._activeTab;if(!activeTab){return}var $tabEl=activeTab.tab;var panel=activeTab.panel;var offsetLeft=activeTab.left;var offsetTop=activeTab.top;var x=Core.Dom.getLeft($tabEl)+$tabEl.offsetWidth+offsetLeft;var y=Core.Dom.getTop($tabEl)+$tabEl.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},_hideActiveSub:function(){var $this=this;if($this._activeTab){var tabEl=$this._activeTab.tab;var panel=$this._activeTab.panel;$this._activeTab=null;panel.hidden();tabEl.className=tabEl.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}},initUserMenu:function(){var $bindEl=this.getNode("userMenu");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var hasEmail;var $tabEl=$this.getNode("userMenu");var userMenu=$this._findSub("userMenu");var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var panel;if(!userMenu){panel=new lib.tray.UserMenuPanel;$this.addSubPanel("userMenu",panel,$bindEl,$tabEl)}else{panel=userMenu.panel}var $userPanelNode=panel.getNode("panel");panel.initUserInfo($UID);Lib.util.hoverJq({elm:$userPanelNode,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});getEmail(function(hasEmail){if(hasEmail){panel.getNode("mail").style.display=""}})}$this._showPanel("userMenu",-160,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}});var getEmail=function(cb){if(typeof hasEmail==="boolean"){cb(hasEmail)}else{Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){hasEmail=!0}else{hasEmail=!1}cb(hasEmail)},onException:function(){}})}}}},initBlogMenu:function(info){var $bindEl=this.getNode("addArticle");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var $tabEl=$this.getNode("blogMenu");var flag=0;Lib.util.hoverJq({elm:$tabEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var blogMenu=$this._findSub("blogMenu");var panel;if(!blogMenu){panel=new lib.tray.BlogMenuPanel;$this.addSubPanel("blogMenu",panel,$bindEl,$tabEl);if(info["tbh_status"]===1){panel.getNode("tbh_status").style.display=""}}var $blogMenuPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$blogMenuPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("blogMenu",-74,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initNotice:function(){var productName=scope.$PRODUCT_NAME;var pageId=scope.$pageid;if("blog7"!==productName){this.noNotice=!0;return}if(-1===pageId.indexOf("article")&&-1===pageId.indexOf("index")){this.noNotice=!0;return}var flagUid=_getCookie("closeNotice_fzp");var $blogBody=$E("sinablogHead");var _this=this;Lib.checkAuthor(function(){if(flagUid&&flagUid===$UID||!$blogBody){_this.noNotice=!0;return}if(!_this.notice){var notice=new lib.tray.BlogNotice({appendTo:$E(logoId).parentNode,isPostion:!1,noIframe:!0});_this.notice=notice;var $this=_this;var height=$blogBody.offsetHeight+30;var logFlag;var onshow=function(){var doc=document;var scrolltop=doc.body.scrollTop+doc.documentElement.scrollTop;if(scrolltop>height){$this.hideActive();$this.setTrayFixed();if(!logFlag){logFlag=1;v7sendLog("48_01_11_"+scope.$pageid)}}else{setTimeout(function(){$this.setTrayPosition();notice.hide()})}};_addEvt(window,onshow,"scroll");lib.Listener.on({name:"tray-announce-close",callBack:function(){_removeEvt(window,onshow,"scroll")}})}},"tray1"+(new Date).getTime())},initNewMsgEvt:function(){var tpl=this.tpl;var $newTips=this.getNode("newTips");var isInit=attr($newTips,"init");if(!isInit){attr($newTips,"init","1");var $this=this;_addEvt($newTips,function(evt){evt=evt||window.event;var $target=evt.target||evt.srcElement;Core.Events.stopEvent(evt);$target.style.display="none";$target.innerHTML="";var $msgTab=$this.getNode("trayMsg");Core.Events.fireEvent($msgTab,"click")},"click");$newTips=null}},initMsg:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init");if(!isInit){attr($bindEl,"init","1");var $this=this;var flag=0;Lib.util.hoverJq({elm:$bindEl,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);if(!flag){flag=1;var ev=window.event||e;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}var $bindEl=$this.getNode("trayMsg");var msgPanel=$this._findSub("msgPanel");var panel;if(!msgPanel){panel=new Lib.tray.msgSummaryPanel($bindEl);$this.addSubPanel("msgPanel",panel,$bindEl,$bindEl)}var $msgPanel=panel.getNode("panel");Lib.util.hoverJq({elm:$msgPanel,mouseenter:function(e,el,i){clearTimeout($this.hoverTimeout);$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}$this._showPanel("msgPanel",-400,0)},mouseleave:function(e,el,i){$this.hoverTimeout=setTimeout(function(){$this._hideActiveSub()},$this.hoverTime)}})}},initunReadMsgPanel:function(){var $bindEl=this.getNode("trayMsg");var isInit=attr($bindEl,"init-unre");if(!isInit){attr($bindEl,"init-unre","1");new lib.tray.unReadMsgPanel($bindEl)}},initSearch:function(){if(!loadCount){var panel=new lib.tray.SearchFormPanel({isPostion:!1,appendTo:"traySearchBar",noIframe:!0});panel.show();_addEvt(document.body,function(evt){evt=evt||window.event;var target=evt.target||evt.srcElement;var $query=panel.getNode("queryTxt");if($query!==target&&panel.entity!==target&&!_contains(target,panel.entity)){panel.catePanel.hide()}},"click")}},initOpenBlog:function(){var $openblogcss=$E("openblogcss");if(!$openblogcss){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"});var $openBlog=this.getNode("openBlogBtn");scope.addBlogOpenerEvent($openBlog)}},notifyMsgPanel:function($msgTab){var newMsg=$msgTab.getAttribute("msg-count");if(newMsg){try{newMsg=JSON.parse(newMsg)}catch(e){newMsg={}}}else{newMsg=-1}},renderRight:function(tpl){this.setTemplate(tpl);this._el=this.entity;var $loading=byClass(this.$main,"ntopbar_loading")[0];$loading.style.display="none";this.show()},addSubPanel:function(name,panel,bindEl,tabEl){var $this=this;this.subPanels.push({name:name,tab:tabEl,bind:bindEl,panel:panel})},_showPanel:function(name,offsetLeft,offsetTop){var subBar=this._findSub(name);if(!subBar){return}var panel=subBar.panel;var $tabEl=subBar.tab;panel.entity.style.zIndex=512;if("msgPanel"===name){var $newTips=this.getNode("newTips");this.notifyMsgPanel($tabEl);$newTips.style.display="none"}var i,item,$tab;item=this._activeTab;if(item){$tab=item["tab"];if($tab===$tabEl){return}item["panel"].hide();$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"")}var className=$tabEl.className;if(!/\bcurrent\b/.test(className)){$tabEl.className+=" current"}this._activeTab={name:name,tab:$tabEl,panel:panel,left:offsetLeft,top:offsetTop};var $entity=panel.entity;if(this.isFixed&&(!$IE||$IE>6)){$entity.style.position="fixed"}else{$entity.style.position="absolute"}panel.showWithDom($tabEl,offsetLeft,offsetTop)},_findSub:function(name){var item;for(var i=this.subPanels.length-1;i>=0;i--){item=this.subPanels[i];if(name===item.name){return item}}return null},showNewMsgTips:function(data,sign){var sum=data.sum-data.feed;var $tips=this.getNode("newTips");var $trayMsg=this.getNode("trayMsg");if(sum){if($trayMsg.getAttribute("unread-show-state")==0&&$trayMsg.getAttribute("msg-panel-show-state")==0){$tips.style.display="block"}if(scope.$pageid=="editor"){$tips.style.display="block"}var offsetWidth=this.entity.offsetWidth;$tips.style.left=offsetWidth-$tips.offsetWidth-10+"px";if(sum<10){$tips.innerHTML=sum}else{$tips.innerHTML="•••"}if(!this.newTipsLog){v7sendLog("40_01_49_"+$UID);this.newTipsLog=1}$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.startTitleTips(sum)}else{$trayMsg.setAttribute("msg-count",JSON.stringify(data));this.stopTitleTips()}var feed=data.feed;if(feed){var $feed=this.getNode("newFeed");$feed.style.display="block";var offsetWidth=this.entity.offsetWidth;$feed.style.left=offsetWidth-$feed.offsetWidth-197+"px";feed=feed<10?feed:"•••";$feed.innerHTML=feed;if(!$feed.addEvt){$feed.addEvt=1;_addEvt($feed,function(){location.href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1";$feed.style.display="none";$feed.innerHTML=""})}}},stopTitleTips:function(){if(scope.$pageid=="editor"){return}var title=document.title.replace(/\(\d+\+*\)/,"");document.title=title},startTitleTips:function(sum){if(scope.$pageid=="editor"){return}var title;if(sum){sum=sum>=1e5?"99999+":sum;if(/\(\d+\+*\)/.test(document.title)){title=document.title.replace(/\(\d+\+*\)/,"("+sum+")")}else{title="("+sum+")"+document.title}}document.title=title},hideActive:function(){var item,$tab;if(item=this._activeTab){item["panel"].hide();$tab=item["tab"];$tab.className=$tab.className.replace(/(?:[ ]*)\bcurrent\b/g,"");this._activeTab=null}},setTrayFixed:function(){var $logo=$E(logoId);this.notice.show();var $this=this;setTimeout(function(){$E("traySearchBar").parentNode.style.display="none";$logo.style.display="none";var $tray=$logo.parentNode.parentNode;if(!$IE||$IE>6){lib.Listener.notify("tray-scrolling-fix",{});$tray.style.position="fixed";$tray.style.top="0px"}else if($IE===6){if(!$this.__isFixie6){_addEvt(window,function(evt){if(!$this.isFixed){return}var oldScrollTop=document.documentElement.scrollTop;setTimeout(function(){var current=document.documentElement.scrollTop;if(oldScrollTop===current){$tray.style.display="block";$this._ie6fix(evt)}else if($this.isFixed){$tray.style.display="none"}},50)},"scroll");$this.__isFixie6=!0}}$tray.style.width="100%";if(!$E(_trayHolder)){var height=$tray.offsetHeight;var $holder=$C("div");$holder.style.height=height+"px";$holder.id=_trayHolder;Core.Dom.insertAfter($holder,$tray)}$this.isFixed=!0})},_ie6fix:function(evt){if(this.isFixed){var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;$tray.style.position="absolute";$tray.style.top=document.documentElement.scrollTop+"px";var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}lib.Listener.notify("tray-scrolling-fix",{})}},setTrayPosition:function(){if($IE6){var trayMsg=this.getNode("trayMsg");if(trayMsg){trayMsg.style.display="none";trayMsg.style.display=""}}lib.Listener.notify("tray-scrolling-nofix",{});var $logo=$E(logoId);var $tray=$logo.parentNode.parentNode;if($E(_trayHolder)){$tray.parentNode.removeChild($E(_trayHolder))}$tray.style.position="";var $search=$E("traySearchBar");$search.style.position="";$search.style.top="";this.notice.hide();$tray.style.display="block";$logo.style.display="block";$E("traySearchBar").parentNode.style.display="block";this.isFixed=!1}});Lib.tray.TrayPanel=TrayPanel;return function(){if(!tray){tray=new TrayPanel}return tray}});Core.System.htmlFilter=function(content){var codeHash={"&":"&#038;","<":"&#060;",">":"&#062;"};var k;for(k in codeHash){content=content.replace(new RegExp(k,"g"),codeHash[k])}return content};Utils.Io.loadExternalCSS=function(url,callback){if(typeof url!=="string"){return}var linkObj,styleObj,head=document.getElementsByTagName("head")[0];if($FF){styleObj=$C("style");styleObj.type="text/css";styleObj.innerHTML="@import url("+url+")";head.appendChild(styleObj);!function(){try{styleObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}}()}else{linkObj=$C("link");linkObj.href=url;linkObj.type="text/css";linkObj.rel="stylesheet";linkObj.media="all";head.appendChild(linkObj);if($SAFARI||$CHROME){!function(){try{linkObj.sheet.cssRules;typeof callback==="function"&&callback()}catch(e){setTimeout(arguments.callee,50)}}()}else{linkObj.onload=function(){linkObj.onload=null;typeof callback==="function"&&callback()}}}};Core.Events.click=function(){var isMobile=/mobile/i.test(navigator.userAgent);if($IE&&$IE<9){return function(clickBtn){clickBtn.click()}}else{return function(clickBtn){var evt;if(isMobile){evt=document.createEvent("HTMLEvents")}else{evt=document.createEvent("MouseEvents")}evt.initEvent("click",true,true);clickBtn.dispatchEvent(evt)}}}();Core.Dom.removeClassName=Core.Dom.removeClass;scope.trayPlusTemplayLogout=['<div class="topbar_menu">','<span class="link"><a target="_blank" href="http://blog.sina.com.cn">博客首页</a></span>','<span class="line_s"></span>',"</div>",'<div class="topbar_login"><a id="linkTrayLogin" class="login" href="javascript:;">登录</a><a id="linkReg" target="_blank" class="register" href="">注册</a></div>','<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayLogin=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a><a href="javascript:;" class="link_arrow" title=""></a></span>','<span class="line_s"></span>','<span style="display:none;" id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" style="display:none;" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><a href="#" onclick="return false;" class="link_arrow" title=""></a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s"></span>','<span class="link" id="logOut"><a href="#">退出</a></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.trayPlusTemplayOnceLoged=['<div class="topbar_menu" id="openedBlogTray">','<span id="loginBarOptApp" class="link"><a id="loginBarAppMenuLabel" href="javascript:;">读取中...</a></span>','<span class="line_s"></span>','<span id="loginBarMail" class="link imfor blog_to_mail"><a target="_blank" href="http://mail.sina.com.cn/?s=2">邮件</a><div id="mailpiaohong" style="display:none;" class="imforbox"></div></span>','<span class="line_s" id="line"></span>','<span id="loginBarCenter" class="link"><a target="_self" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=1">个人中心</a></span>','<span class="line_s"></span>','<span id="loginBarFriend" class="link"><a target="_blank" href="http://control.blog.sina.com.cn/blogprofile/profilefriendlist.php">好友</a></span>','<span class="line_s"></span>','<span id="loginBarInbox" class="link imfor"><img id="imgNewMessage" style="display:none;" class="topbar_msg" src="http://simg.sinajs.cn/blog7style/images/common/topbar/topbar_msg.gif"/><a href="#" onclick="return false;">消息</a><div id="ccnotepiaohong" style="display:none;" class="imforbox"></div></span>',"</div>",'<div style="display:none" class="topbar_menu" id="noOpenedBlogTray">','<span class="link" style="cursor:default;"><a id="noOpenBlogName">读取中...</a></span>','<span class="line_s"></span>','<span class="link"><a href="#">退出</a></span>',"</div>",'<div class="topbar_noopen" style="display:none" id="outOfOpenBlogTray">','<a id="openBlogBtnTray" title="立即开通博客" class="nowopen" href="javascript:void(0)" onclick="return false;"></a>',"</div>",'<div id="divPopularize" class="topbar_ad"></div>','<div id="loginBarActivity" class="topbar_activity"></div>'].join("");scope.newStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="http://control.blog.sina.com.cn/blogprofile/profileremind.php?com=2"><span id="nstFavorite" style="padding:3px 2px;display:none;">你有博文被<span style="color:red">转载/收藏</span></span></a>','<img id="gbimg" class="SG_icon SG_icon83" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="17" height="15" align="absmiddle" style="display:none"/><a style="display:none" href="http://i.blog.sina.com.cn/blogprofile/index.php?com=g" id="gbmsg">官博<em>新动态</em></a>',"</div>"].join("");scope.onceLogedStatusTipTemplay=['<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main tip_ps" style="width:130px;text-align:left;padding:5px 0 2px 5px;color:#000000">','<a onclick="$E(\'newStatusTip\').style.display=\'none\';return false" href="#" class="tb_friend_inputDel" title="关闭" style="margin-top: 5px;"></a>','<a href="javascript:void(0);return false;"><span id="nstUnread" style="padding:3px 2px;display:none;">你有<span style="color:red">未读消息</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstFeed" style="padding:2px 2px;display:none;">你有<span style="color:red">新动态</span>可查看</span></a>','<a href="javascript:void(0);return false;"><span id="nstUpdate" style="padding:3px 2px;display:none;">你最近浏览的博主<span style="color:red">有更新</span></span></a>','<a href="javascript:void(0);return false;"><span id="nstUnpub" style="padding:2px 2px;display:none;">你有<span style="color:red">尚未发表</span>的博文</span></a>',"</div>"].join("");scope.nicknamePanelTemplate=['<div id="#{panel}" class="tb_layer_Y tb_layer_w2" style="z-index:512;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_ps">','<div class="tb_ps_list">',"<ul>","<li>",'<span class="tb_ps_nm"><a id="#{linkBlog}" href="javascript:;"><img class="SG_icon SG_icon15" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="博客" align="absmiddle" /><strong>博客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostBlog}" href="http://control.blog.sina.com.cn/admin/article/article_add.php">发博文</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{linkPhoto}" href="javascript:;"><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="相册" align="absmiddle" /><strong>相册</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkPostPhoto}" href="http://photo.blog.sina.com.cn/upload/upload.php">发图片</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a target="_blank" id="#{linkVBlog}" href="javascript:;"><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="播客" align="absmiddle" /><strong>播客</strong></a></span>','<span class="tb_ps_set">[<a target="_blank" id="#{linkUpload}" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a>][<a id="#{linkRecord}" href="http://vupload.you.video.sina.com.cn/r.php" target="_blank">录视频</a>]</span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{miniblog}" href="javascript:;" target="_blank"><img class="SG_icon SG_icon51" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="微博" align="absmiddle" /><strong>微博</strong></a></span>',"</li>","<li>",'<span class="tb_ps_nm"><a id="#{mySpace}" href="javascript:;"><img class="SG_icon SG_icon41" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="关于我" align="absmiddle" /><strong>关于我</strong></a></span>',"</li>","</ul>",'<div class="clearit"></div>',"</div>",'<div class="tb_ps_manage">','<p><a target="_blank" id="#{linkChangeFace}" href="javascript:;">修改头像昵称</a></p>','<p><a target="_blank" id="#{linkChangePassword}" href="javascript:;">修改登录密码</a></p>','<p><a target="_blank" id="#{linkAccountSetup}" href="javascript:;">账号安全设置</a></p>','<p><a target="_blank" id="#{bindEmail}" href="javascript:;">绑定邮箱</a></p>',"</div>","</div>","</div>","</div>"].join("");scope.NicknamePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.nicknamePanelTemplate)},Lib.Panel,{initUserInfo:function(uid){var nodes=this.getNodes();scope.$bindEmail=function(data){var node=nodes["bindEmail"];if(data.ret!="y"&&data.errcode!="not_verify"){node.parentNode.removeChild(node)}else{node.href="https://login.sina.com.cn/bindmail/bindmail.php?entry=blog"}};try{var AuthorInfo=Utils.Cookie.getCookie("SUBP");if(AuthorInfo&&AuthorInfo!=""){var arrSubp=sinaSSOEncoder.getSUBPCookie.decode(AuthorInfo);var username=arrSubp.ln;Utils.Io.JsLoad.request("https://login.sina.com.cn/bindmail/checkmailuser.php?entry=blog&name="+encodeURIComponent(username)+"&utf82bgk=1&callback=scope.$bindEmail",{noreturn:true})}}catch(e){}nodes["linkBlog"].href="http://blog.sina.com.cn/u/"+uid;nodes["linkPhoto"].href="http://photo.blog.sina.com.cn/u/"+uid;nodes["linkVBlog"].href="http://you.video.sina.com.cn/m/"+uid;nodes["miniblog"].href="http://control.blog.sina.com.cn/t_sina_blog/tb.php?uname="+uid;nodes["mySpace"].href="http://blog.sina.com.cn/s/profile_"+uid+".html";nodes["linkChangeFace"].href="http://control.blog.sina.com.cn/blogprofile/nick.php";nodes["linkChangePassword"].href="https://security.sina.com.cn/account/security?option=chgpwd&entry=blog ";nodes["linkAccountSetup"].href="https://security.sina.com.cn/account/security";var node=["linkBlog","linkPhoto","linkVBlog","miniblog","mySpace","linkChangeFace","linkChangePassword","linkAccountSetup"];for(var i=0;i<node.length;i++){nodes[node[i]].onclick=function(){v7sendLog("40_01_02_"+$UID)}}}});var st=['<div id="#{panel}" style="z-index:512;" class="tb_layerBox">',"<ul>",'<li id="#{blog}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博文</a></li>','<li id="#{bauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">博主</a></li>','<li id="#{song}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">音乐</a></li>','<li id="#{video}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">视频</a></li>','<li id="#{vauthor}"><a href="javascript:;" onclick="v7sendLog(\'40_01_19\')">播主 </a></li>',"</ul>","</div>"];scope.searchPanelTemplate=st.join("");scope.SearchPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.searchPanelTemplate)},Lib.Panel,{config:{blog:{text:"博文",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"article",by:"all"},bauthor:{text:"博主",url:"http://search.sina.com.cn/?c=blog",keyName:"q",range:"author",by:"all"},song:{text:"音乐",url:"http://music.sina.com.cn/yueku/search/s.php",keyName:"k",t:"song",s:"",ts:"",type:"",stype:""},video:{text:"视频",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"1"},vauthor:{text:"播主",url:"http://search.video.sina.com.cn/search.php",keyName:"k",t:"",s:"sup",ts:"",type:"boke",stype:"3"}}});Utils.Flash.swfView={swfList:[],Add:function(sURL,sID,sPID,nWidth,nHeight,nVersion,sBGColor,oVar,oParam){if(sURL&&sPID){this.swfList[this.swfList.length]={sURL:sURL,sID:sID,sPID:sPID,nWidth:nWidth,nHeight:nHeight,nVersion:nVersion,sBGColor:sBGColor,oVar:oVar,oParam:oParam};this.Init();return}},Init:function(){var so;var list=this.swfList;for(var i=0,len=list.length;i<len;i++){var _list=list[i];so=new Utils.Flash.swfObject(_list.sURL,_list.sPID,_list.nWidth,_list.nHeight,_list.nVersion,_list.sBGColor);if(_list.oVar){for(var key in _list.oVar){so.addVariable(key,_list.oVar[key])}}if(_list.oParam){for(var Key in _list.oParam){so.addParam(Key,_list.oParam[Key])}}so.write(_list.sID)}list=[];_list=null;so=null}};Utils.Io.loadCss=function(oCss,oTarget){if(oCss==null){return false}oTarget=oTarget||window;var _target=oTarget.document;oCss.id=oCss.id||"";var _css;if(oCss.url){_css=_target.createElement("link");_css.setAttribute("rel","stylesheet");_css.setAttribute("type","text/css");_css.setAttribute("href",oCss.url)}else if(oCss.text){_css=_target.createElement("style");_css.setAttribute("type","text/css");if($IE){_css.styleSheet.cssText=oCss.text}else{_css.innerHTML=oCss.text}}_css.setAttribute("id",oCss.id);_target.getElementsByTagName("head")[0].appendChild(_css)};var st=['<div id="#{panel}" style="z-index:512;" class="tb_layer_Y tb_layer_w6" style="left:400px; top:700px;">','<div class="tb_layer_arrow"></div>','<div class="tb_layer_Y_main">','<div class="tb_mas" id="#{newInboxList}" style="">','<div class="tb_mas_list">','<ul id="#{changebgli1}"  style="display:none" >','<li  style="display:none" >','<span id="#{ccsysgonggao}" class="tb_friend_nm">[<strong>公告</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪邀你一起共度中秋活动</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>",'<li style="display:none">','<span id="#{ccsystongzhi}" class="tb_friend_nm">[<strong>通知</strong>] <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">新浪2010邀你一起共度中秋活动...</a></span>','<span class="tb_friend_set"><a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">&gt;&gt;</a></span>',"</li>","</ul>",'<ul class="bd" id="#{changebgli2}">','<li  id="#{newInboxLoding}" style="cursor:default" ><div style="margin: 0pt; padding: 10px;text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif"><div></li>','<li  id="#{nomsgli}" style="cursor:default;" >还没有消息</li>','<li style="float:none;"><span class="mas_more"><a id="#{mas_moremsg}" href="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php">全部消息</a></span></li>',"</ul>",'<div class="clearit"></div>',"</div>",'<ul class="commentslist" id="commentdata">','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1">评论</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/profilecommlist.php?type=1" id="#{commentRelapseCount}" ></a></li>','<li><a class="conn" href="http://i.blog.sina.com.cn/blogprofile/wall.php">留言</a><a class="num" href="http://i.blog.sina.com.cn/blogprofile/wall.php" id="#{guestBookCount}">1</a></li>','<li class="lst"><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php">好友邀请</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profileinvitelist.php" id="#{inviteCount}" ></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1">纸条</a><a class="num" href="http://control.blog.sina.com.cn/blogprofile/profilepaperlist.php?type=1" id="#{messageCount}" ></a></li>','<li><a class="conn" target="_blank" href="http://mail.sina.com.cn" reject="1">邮箱</a><a class="num" href="http://mail.sina.com.cn" id="#{mailCount}" target="_blank" reject="1"></a></li>','<li><a class="conn" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">系统消息</a><a class="num" href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote" id="#{sysnoticeCount}" ></a></li>',"</ul>","</div>","</div>","</div>"];scope.newInboxPanelTemplate=st.join("");Lib.LocalDB={_this:null,isFlashReady:false,FlaDom:null,updataFun:null,loadedFun:null,regiFun:[],regiFunArgs:[],scacheReady:function(){var me=Lib.LocalDB;me.isFlashReady=true;if(me.loadedFun){me.loadedFun(me._this)}var f=me.regiFun;var a=me.regiFunArgs;for(var i=0;i<f.length;i++){f[i].apply(null,a[i])}},registerFun:function(fun,args){this.regiFun.push(fun);var a=args||[];this.regiFunArgs.push(a)},set:function(key,data){if(this.isFlashReady){try{this.FlaDom.setLazyInterface(key,data);return true}catch(e){trace("set函数出错")}}return false},get:function(key,escapeMsecond,ignore){if(this.isFlashReady){try{return this.FlaDom.getLazyInterface(key,escapeMsecond,ignore)}catch(e){trace("get函数出错")}}return false},clearCache:function(escapeMsecond,key){if(this.isFlashReady){try{$E("scache").clearCache(escapeMsecond,key)}catch(e){trace("gclearCache函数出错")}}return false},loadFlash:function(containerDiv){var random="";if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}if(!this.FlaDom){var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"scache.swf"+random,"scache","1","1","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.write(containerDiv);this.FlaDom=$E("scache")}},getServer:function(){try{return this.FlaDom.isServer()}catch(e){trace("判断是否是通信主机发生错误");return false}},login:function(uid){try{this.FlaDom.login(uid)}catch(e){trace("login函数出错");trace(uid)}},sendToClient:function(data){try{if(this.getServer()){this.FlaDom.sendToClient(data)}else{}}catch(e){trace("sendToClient函数出错")}},setClientJsFun:function(jsFun){try{if(this.getServer()){this.FlaDom.setClientJsFun(jsFun)}else{trace("非主机不可以设置接收函数")}}catch(e){trace("setClientJsFun函数出错")}},receive:function(data){this.updataFun(data)}};scope.msnTipsTemplate=['<div id="#{panel}" style="position: absolute; width: 369px; padding-top: 7px; font-size: 12px; z-index:511">',"<div  style=\"top: 0pt; left: 65px; position: absolute; width: 16px; height: 8px; background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_boxtop_01.png') no-repeat scroll 0pt 0pt transparent; z-index: 100;\"></div>","<div style=\"padding: 5px 6px 9px 14px; border: 1px solid rgb(181, 202, 214); background: url('http://simg.sinajs.cn/blog7style/images/special/move/bg_asiangames.jpg') no-repeat scroll left bottom rgb(255, 255, 255); z-index: 1;\">",'<p id="#{close}" class="close" style="float: right; margin: 0pt; cursor: pointer; width: 8px; height: 8px; font-size: 0pt;background:url(\'http://simg.sinajs.cn/blog7style/images/special/move/btn_close.gif\') no-repeat 0 0;"></p>','<div style="width: 342px; margin: 10px 0pt 0pt; padding: 0pt 0pt 3px;">','<a style="float: left; margin: 0pt 10px 0pt 0pt;" href="#"><img height="91" width="122" style="border: 0pt none;" alt="MSN" src="http://simg.sinajs.cn/blog7style/images/special/move/img_msnphoto.png"></a>','<h3 style="padding: 2px 0pt 5px; color: rgb(0, 0, 0); margin: 0pt; font-size: 12px;">各位拥有MSN帐号的同学注意啦!</h3>','<p style="width: 268px; display: inline; text-indent: 0pt; padding: 0pt; color: rgb(51, 51, 51); line-height: 19px;">新浪博客帐号与MSN帐号已经实现关联。您可以使用MSN帐号来登录博客，绑定后发博文、发图片可同步到Live，第一时间让您的MSN好友知晓。</p>',"</div>",'<p style="clear: both; height: 30px; margin: 12px 10px 4px 0pt; padding: 12px 0pt 0pt; border-top: 1px solid rgb(220, 213, 211); text-align: right;"><a style="float: right; color: rgb(176, 173, 172); margin-top: 10px; text-decoration: none;" href="javascript:void(0);" id="#{noMoreShow}">不再显示</a><a style="float: right; text-decoration: none; margin: 10px 14px 0pt 16px;color:#2d3186;" href="http://blog.sina.com.cn/s/blog_4b0f52990100lt3i.html">帮助</a><a id="#{setNow}"style="float: right;" href="http://control.blog.sina.com.cn/blogprofile/msnbind.php"><img height="32" width="105" style="border: medium none;" alt="立即设置" src="http://simg.sinajs.cn/blog7style/images/special/move/btn_receive01.jpg"></a></p>',"</div>","</div>"].join("");
scope.msnTips=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.msnTipsTemplate)},Lib.Panel,{initUserInfo:function(nick,uid){var nodes=this.getNodes();this.setFixed($E("loginBarActivity"),-230,-2);var _this=this;nodes["close"].onclick=function(){_this.hidden()};nodes["noMoreShow"].onclick=function(){_this.hidden();Utils.Cookie.setCookie("noMoreMsnTips"+$UID,1,24*100,"/",".blog.sina.com.cn")};nodes["setNow"].onclick=function(){v7sendLog("95_02_01",scope.$pageid,"")}},setFixed:function(dom,offsetLeft,offsetTop){var _this=this;setTimeout(function(){_this.showWithDom(dom,offsetLeft,offsetTop);_this.fadeIn()},2e3);Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&_this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}_this.setPosition(x,y)},"resize")},fadeIn:function(){var entity=this.entity;Core.Dom.opacity(entity,0);var i=0;!function fn(){Core.Dom.opacity(entity,i+=5);if(Core.Dom.getStyle(entity,"opacity")<1){setTimeout(fn,20)}}()}});scope.NewInboxPanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.newInboxPanelTemplate);this.nodes=this.getNodes();var me=this;var t=Lib.LocalDB;if(/Mobile/i.test(navigator.userAgent)){setTimeout(function(){me.requestDataInterface()},100)}else{if(!t.FlaDom){t._this=me;t.loadedFun=me.FlashLoaded;t.loadFlash("trayFlashConnetion")}else{me.FlashLoaded(me)}}Core.Events.addEvent($E("loginBarInbox"),function(event){v7sendLog("40_01_09_"+$UID);var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&target.tagName.toLowerCase()=="a"){v7sendLog("45_01_10_"+$UID)}me._hasOverview=true;$E("ccnotepiaohong").style.display="none";me.requestMsgDate()},"click");this.interfaceMessages=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unread.php","jsload")},Lib.Panel,{nodes:null,_connectSWF:null,_SWFChannelName:"inboxConnection",interfaceMessges:null,isMessageLoaded:false,isUICServiceLoaded:true,isHaveNewMessage:false,_listData:null,_productIDs:{blog:1,vblog:2,group:4,photo:8,cube:16},_msgIsLoad:false,_newnote:0,_hasOverview:false,interfaceUICServiceURL:"http://uic.sinajs.cn/uic?type=service&uids=#{uids}&varname=service",FlashLoaded:function(me){var t=Lib.LocalDB;var _this=me;window.$updateData=function(dataObj){_this.updateData(dataObj)};Lib.checkAuthor(function(){t.login($UID);t.setClientJsFun("$updateData");setTimeout(function(){_this.requestDataInterface()},100)},"NewInboxPanel"+(new Date).getTime())},requestMsgDate:function(){this.updateView("loading");var me=this;var clearnum=0;if(this._hasOverview){clearnum=this._newnote;this._newnote=0;this._hasOverview=false}var inter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/notetips.php?clearnum="+clearnum,"jsload");inter.request({GET:{uid:$UID},onSuccess:function(res){if(typeof res.announcement!="undefined"&&res.announcement){me.nodes["ccsysgonggao"].innerHTML='[<strong>公告</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.announcement+"</a>";me.nodes["ccsysgonggao"].parentNode.style.display=""}else{me.nodes["ccsysgonggao"].parentNode.style.display="none"}if(typeof res.sysNote!="undefined"&&res.sysNote){me.nodes["ccsystongzhi"].innerHTML='[<strong>通知</strong>]&nbsp;<a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/notelist.php?action=profilesysnote">'+res.sysNote+"</a>";me.nodes["ccsystongzhi"].parentNode.style.display=""}else{me.nodes["ccsystongzhi"].parentNode.style.display="none"}if(typeof res.sysNote=="undefined"&&typeof res.announcement=="undefined"){me.nodes["ccsystongzhi"].parentNode.parentNode.style.display="none"}else{me.nodes["ccsystongzhi"].parentNode.parentNode.style.display=""}me.nodes["nomsgli"].style.display="";if(typeof res.notice!="undefined"&&res.notice){var aNotice=res.notice;while(me.nodes["changebgli2"].childNodes.length>2){me.nodes["changebgli2"].removeChild(me.nodes["changebgli2"].childNodes[me.nodes["changebgli2"].childNodes.length-3])}for(var i=aNotice.length-1;i>=0;i--){var li=$C("li");li.innerHTML=aNotice[i].data;li._href=aNotice[i].url;me.nodes["changebgli2"].insertBefore(li,me.nodes["changebgli2"].firstChild);li.onclick=function(){v7sendLog("45_01_11_"+$UID);window.location.href=this._href};me.nodes["nomsgli"].style.display="none"}}if(parseInt($E("ccnotepiaohong").innerHTML,10)>0){var num=parseInt($E("ccnotepiaohong").innerHTML,10);var cn=me.nodes["changebgli2"].childNodes;for(var j=0;j<cn.length-2&&j<num;j++){Core.Dom.removeClassName(cn[j],"cur");cn[j].className+=" cur"}}me.updateView("loaded");me._msgIsLoad=true;me.bindliEvent()},onError:function(data){},onFail:function(){}});var mailInter=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data)||0;if(tota>99){tota="99+"}me.nodes.mailCount.innerHTML=tota||""},onError:function(){me.nodes.mailCount.innerHTML=""}})},requestDataInterface:function(){var _this=this;Lib.checkAuthor(function(){var t=Lib.LocalDB;var d=null;if(t.isFlashReady&&!_this.checkCache){_this.clearCache();d=t.get("uid_"+$UID+"unread",60*1e3*4);_this.checkCache=true}var unreadOk=function(data,isCache){if(!d&&!isCache){t.set("uid_"+$UID+"unread",data)}if(data["isBindToMsn"]==0&&Utils.Cookie.getCookie("noMoreMsnTips"+$UID)!=1){}_this.isMessageLoaded=true;_this.onMessageLoad(data["nickname"]);_this._listData=data;scope.unreadMsg=data;scope.nickname=data["full_nickname"];scope.loginUserWtype=data["login_wtype"];if(data.svr_time)scope.$svr_time=data.svr_time;if(data.nfn>=1){v7sendLog("40_01_03_"+$UID);_this.initNewStatusTip(data)}else{}_this.updateListData(data);if(_this.isMessageLoaded){_this.updateData({data:_this._listData});_this.onLoaded()}scope.hasOpenBlog=data.isbloguser==1?"open":"no";scope.bindTrayOpenTime=1;Lib.Listener.notify("tray-data-loaded",data);if(scope.hasOpenBlog=="no"&&scope.bindTrayOpenTime==1){if(!$E("openblogcss")){Utils.Io.loadCss({id:"openblogcss",url:$_GLOBAL.cssBasicURL+"module/layer/re_nowopen.css"})}$E("openedBlogTray").style.display="none";$E("noOpenedBlogTray").style.display="";$E("outOfOpenBlogTray").style.display="";scope.addBlogOpenerEvent($E("openBlogBtnTray"));$E("noOpenBlogName").href="http://blog.sina.com.cn/u/"+$UID;scope.bindTrayOpenTime=2}scope.unreadOkExecuted=true};if(d){unreadOk(d,true);trace("-------unread 使用缓存的数据!!!----")}else{trace("-----直接调用unread接口！！！");_this.interfaceMessages.request({GET:{uid:$UID,product:"blog"},onSuccess:unreadOk,onError:function(data){},onFail:function(){}})}},"NewInboxPanelrequestDataInterface"+(new Date).getTime())},clearCache:function(){var pageId={profile_notice:"notice",profile_paperlist:"message",profile_invitelist:"invite",profile_commlist:"blogcomment",profile_replylist:"blogrecomment",profile_guestBookM:"gbook",profile_commtrash:"trashcomment",profile_commphotolist:"photocomment",profile_index:"profile_index",profile_remind:"profile_remind"};var t=Lib.LocalDB;var d=t.get("uid_"+$UID+"unread",60*1e3*4);if(d&&pageId[scope.$pageid]&&typeof d[pageId[scope.$pageid]]!=undefined){trace("-----清除缓存");t.clearCache(10,"uid_"+$UID+"unread")}var ccn=$UID+"_clear_flash";var clearFlash=Utils.Cookie.getCookie(ccn);if(clearFlash==1){trace("【活动】根据cookie标记,清除Flash缓存");t.clearCache(10,"uid_"+$UID+"unread");Utils.Cookie.setCookie(ccn,"",0,"/",".sina.com.cn")}},initMsnTips:function(){Lib.checkAuthor(function(){(new scope.msnTips).initUserInfo($nick,$UID)},"NewInboxPanel"+(new Date).getTime())},initNewStatusTip:function(data){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(tip||!data){return}v7sendLog("45_01_07_"+$UID);tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.newStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";if(a.href.indexOf("?")==-1){a.href+="?type=2&from="+scope.$pageid}Core.Dom.opacity(tip,0);document.body.appendChild(tip);if(data.nfn>=1){$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("45_01_09_"+$UID);v7sendLog("40_01_04_"+$UID)}}if(data.official_blog==1){$E("gbimg").style.display="";$E("gbmsg").style.display=""}for(var i=1;i<=500;i++){!function(val){setTimeout(function(){Core.Dom.opacity(tip,val*2/10)},val*2)}(i)}if(scope.$pageid=="editor"){a.target="_blank";$E("nstFeed").parentNode.target="_blank";$E("gbmsg").style.target="_blank";Core.Events.addEvent(a,this.closeTip(a),"click")}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},closeTip:function(ele){return function(){$E("newStatusTip").style.display="none";ele.href=ele.href.split("?")[0]}},updateData:function(dataObj){var t=Lib.LocalDB;var _this=this;Lib.checkAuthor(function(){try{if($UID&&$UID==dataObj.uid||t.getServer()==true){_this.isHaveNewMessage=false;_this.isMessageLoaded=false;_this.updateListData(dataObj.data);if(_this._newnote>0){v7sendLog("45_01_08_"+$UID);v7sendLog("40_01_08_"+$UID)}if(dataObj.data.nfn>=1){_this.initNewStatusTip()}}}catch(ex){}if(t.getServer()==true){Lib.checkAuthor(function(){t.sendToClient({data:dataObj.data,uid:$UID});setTimeout(function(){_this.requestUICService();_this.requestDataInterface()},6e4*4)},"NewInboxPanel"+(new Date).getTime())}else{setTimeout(function(){if(t.getServer()){t.setClientJsFun("$updateData");_this.requestUICService();_this.requestDataInterface()}},6e4*4)}},"NewInboxPanel"+(new Date).getTime())},initializeList:function(){this.requestUICService();this.checkCache=false},updateListData:function(dataCollection){try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["invite"])||0);if(tota>500){tota="500+"}this.nodes["inviteCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["message"])||0);if(tota>500){tota="500+"}this.nodes["messageCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["unreadnotices"]||0);tota+=parseInt(dataCollection["notice"]||0);if(tota>500){tota="500+"}this.nodes["sysnoticeCount"].innerHTML=tota?tota:""}catch(e){}Lib.checkAuthor();try{var tota=0;tota+=parseInt(this._getFormatCountString(dataCollection["gbook"])||0);tota+=parseInt(this._getFormatCountString(dataCollection["trashwall"])||0);if(tota>500){tota="500+"}this.nodes["guestBookCount"].innerHTML=tota?tota:""}catch(e){}try{var tota=0;tota+=parseInt(dataCollection["blogcomment"]||0);tota+=parseInt(dataCollection["blogrecomment"]||0);tota+=parseInt(dataCollection["photocomment"]||0);tota+=parseInt(dataCollection["trashcomment"]||0);if(tota>500){tota="500+"}this.nodes["commentRelapseCount"].innerHTML=tota?tota:""}catch(e){}this._newnote=parseInt(dataCollection["newnotes"],10);if(this._newnote>0){$E("ccnotepiaohong").innerHTML=this._newnote>500?"500+":this._newnote;$E("ccnotepiaohong").style.display=""}else{$E("ccnotepiaohong").style.display="none"}var i,msgCfg=["notice","invite","message","blogcomment","blogrecomment","photocomment","trashcomment","vblogcomment","gbook"],len=msgCfg.length;for(i=0;i<len;i++){if(parseInt(dataCollection[msgCfg[i]])>0){this.isHaveNewMessage=true}var k;for(k in dataCollection){if(k!="version"&&window.parseInt(dataCollection[k])>0){if($E("left_"+k)){$E("left_"+k).innerHTML="("+dataCollection[k]+")"}}}}},requestUICService:function(){var _this=this;Lib.checkAuthor(function(){if(_this.isMessageLoaded){_this.updateData({data:_this._listData});_this.onLoaded()}},"newInboxPanel_requestUICService"+(new Date).getTime())},_getFormatCountString:function(count){var result="";if(!isNaN(parseInt(count))&&parseInt(count)!=0){if(parseInt(count)>500){result="(<strong>500+</strong>)"}else{result=count}}return result},updateView:function(loadState){this.nodes["newInboxLoding"].style.display=loadState=="loaded"?"none":"";if(loadState=="loading"){this.nodes["nomsgli"].style.display="none"}},onLoaded:function(){},onMessageLoad:function(nickname){$E("loginBarAppMenuLabel").innerHTML=Core.System.htmlFilter(nickname);$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)},bindliEvent:function(){var lis=this.nodes["changebgli1"].getElementsByTagName("li");var lis2=this.nodes["changebgli2"].getElementsByTagName("li");for(var i=0;i<lis.length;i++){lis[i].style.cursor="pointer";lis[i].onmouseover=function(){this._className=this.className;this.className="on"};lis[i].onmouseout=function(){this.className=this._className}}for(var i=0;i<lis2.length-1;i++){if(lis2[i]==this.nodes["nomsgli"]){continue}lis2[i].style.cursor="pointer";lis2[i].onmouseover=function(){this._className=this.className;this.className="on"};lis2[i].onmouseout=function(){this.className=this._className}}var commentdata=$E("commentdata");if(commentdata){Core.Events.addEvent(commentdata,function(event){logFunc(event)})}Core.Events.addEvent(this.nodes["changebgli1"],function(event){logFunc(event)});Core.Events.addEvent(this.nodes["changebgli2"],function(event){logFunc(event)});function logFunc(event){var target=event&&event.target||window.event&&window.event.srcElement;if(target&&target.tagName&&(target.tagName.toLowerCase()=="a"||target.tagName.toLowerCase()=="li")&&!target.getAttribute("reject")){v7sendLog("40_01_10_"+$UID);v7sendLog("45_01_11_"+$UID)}}}});scope.addArticleTemplate=['<div id="#{panel}" class="wrtBlog_sub" style="z-index:512;">','<div class="wrtBlog_sub2">','<p><img width="15" height="16" align="absmiddle" title="写365" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon138"><a onclick="v7sendLog(\'48_01_18\');v7sendLog(\'40_01_14\');" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365" target="_blank">写365</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon88" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="长微博" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/changWeiBo.php">长微博</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon18" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发照片" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://photo.blog.sina.com.cn/upload/upload.php">发照片</a></p>','<div class="SG_j_linedot"></div>','<p><img class="SG_icon SG_icon16" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发视频" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://vupload.you.video.sina.com.cn/u.php?m=1">发视频</a></p>','<div id="tray_tbh_ware_linedot" style="display:none;" class="SG_j_linedot"></div>','<p id="tray_tbh_ware_link" style="display:none;"><img class="SG_icon SG_icon150" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="发商品" align="absmiddle" /><a target="_blank" onclick="v7sendLog(\'40_01_14\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tbh=1">发商品</a></p>',"</div>","</div>"].join("");scope.addArticlePanel=Core.Class.define(function(){Lib.Panel.prototype.initialize.apply(this,arguments);this.setTemplate(scope.addArticleTemplate);this.hidden()},Lib.Panel,{});Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.cancelBubble=true}};if(!$IE||$IE>8){Core.Events.stopBubble=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){ev.stopPropagation()}}}Lib.PlatformTrayPlus=Core.Class.create();Lib.PlatformTrayPlus.prototype={tray:null,subPanels:[],trayLogin:null,initialize:function(){},load:function(loginState){var bar_logo=$E("login_bar_logo_link_350");if(bar_logo&&$_GLOBAL&&$_GLOBAL.platformTrayLogo){if(!$IE6&&$_GLOBAL.platformTrayLogo.imgForOtherBrs){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForOtherBrs}else if($_GLOBAL.platformTrayLogo.imgForIE6){bar_logo.children[0].src=$_GLOBAL.platformTrayLogo.imgForIE6}}switch(loginState){case"login":if($E("loginBarOptApp")==null||!$isAdmin){this.render(scope.trayPlusTemplayLogin);trace("++++js渲染 登陆后++++++")}this.initStatic();if(/ipad/i.test(navigator.userAgent)){v7sendLog("48_01_02")}this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);this.initNicknamePanel();this.initNewInboxPanel();this.initActivityPanel();var that=this;Utils.Io.JsLoad.request("http://service.mail.sina.com.cn/mailproxy/mail.php",{onComplete:function(){var email=sinamailinfo.email;if(email!=""){that.initMailRemind()}},onException:function(){}});this.initMsnLogout();if(scope&&scope.$private&&scope.$private.msnfeed){var _this=this;setTimeout(function(){_this.displayUserGuideTips()},1e3)}break;case"logout":this.trayLogin=new Lib.Login.Ui;if($E("phprender")===null){this.render(scope.trayPlusTemplayLogout);trace("-----------js渲染---------")}else{trace("-----------php渲染---------")}this.initLogin();this.initPopularize();break;case"oncelogedon":this.trayLogin=new Lib.Login.Ui;this.render(scope.trayPlusTemplayOnceLoged);this.setNodesMouseHoverStyle(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"]);var info=Lib.Login.info();var uid=info&&info.uid;$E("loginBarAppMenuLabel").innerHTML=info&&info.nick;this.initPopularize();this.initOnceLogedEvent(["loginBarOptApp","loginBarMail","loginBarCenter","loginBarFriend","loginBarInbox"],uid);this.initOnceLogedTips(uid);this.initStatic();break}this.initAddArticlePanel();this.initSearchPanel();this.initFilmSearch()},displayUserGuideTips:function(){if(!window.scope||scope.$pageid==="profile_index"){Utils.Cookie.setCookie($UID+"alreadyVisitProfileIndex","true","86400","/",".sina.com.cn");return}var _this=this;function updateTipPos(){var loginBarCenter=$E("loginBarCenter");if(loginBarCenter){var pos=Core.Dom.getXY(loginBarCenter),left=pos[0]+loginBarCenter.offsetWidth/2-_this.tipsUserGuide.offsetWidth/2+"px",top=pos[1]+loginBarCenter.offsetHeight+10+"px"}_this.tipsUserGuide.style.left=left;_this.tipsUserGuide.style.top=top}},initStatic:function(){if(!this._commetTimer){var send=function(){var uid=scope.$uid;var blogid=scope.$articleid||"";var url="http://comet.blog.sina.com.cn/api?maintype=notice";Utils.Io.JsLoad.request(url,{GET:{uid:uid||"",blogid:blogid},onComplete:function(r){}})};this._commetTimer=setInterval(send,30*1e3);setTimeout(function(){send()},15)}},initFilmSearch:function(){var ele=$E("loginBarSearchInput");ele&&(ele.value="");var tag=$E("loginBarSearchSType");tag&&(tag.value="title")},render:function(html){$E("trayContainer").innerHTML=html},initLogin:function(){var me=this;var homeNode=Core.Dom.getElementsByClass($E("trayContainer"),"span","link")[0];homeNode.onclick=function(){v7sendLog("40_01_15")};Core.Events.addEvent($E("linkTrayLogin"),function(){v7sendLog("40_01_16");if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){Lib.checkAuthor(function(){var str=$UID==scope.$uid?"02":"01";v7sendLog("87_01_"+str+"_"+$UID,scope.$pageid)},"PlatformTrayPlus"+(new Date).getTime());setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false,"referer:"+location.hostname+location.pathname+",func:0007")},"click");$E("linkReg").href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=blogicp";$E("linkReg").onclick=function(){v7sendLog("40_01_17")};if(scope.$channel){if(scope.$channel==2){$E("linkReg").href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&srcuid="+scope.$uid+"&src=baby"}}},initPopularize:function(){var popEl=$E("divPopularize");if(popEl){this.hideActiLink(popEl);this._loadPopularizeData(popEl)}},_loadPopularizeData:function(parentEl){Utils.Io.JsLoad.request("http://blog.sina.com.cn/lm/iframe/283/2012/0705/1.js",{charset:"utf-8",onComplete:function(data){var cfg=$_GLOBAL.popularizeConfig;if(!cfg||parentEl.innerHTML){return}var len=cfg.length;var cookieUtil=Utils.Cookie;var index=parseInt(cookieUtil.getCookie("blogPopularizeIndex")||0);if(len<=index){index=0}cookieUtil.setCookie("blogPopularizeIndex",1+index,24,"/",".blog.sina.com.cn");parentEl.innerHTML=cfg[index];if($E("err_i8t9c")){var txt=parentEl.innerText||parentEl.textContent||"";if(txt.length>10){parentEl.children[0].innerHTML=txt.substr(0,9)+"..."}}}})},setNodesMouseHoverStyle:function(nodeNames){var i,len=nodeNames.length;for(i=0;i<len;i++){Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current");$E(nodeNames[idx]).className+=" current"}}(i),"mouseover");Core.Events.addEvent($E(nodeNames[i]),function(idx){return function(){Core.Dom.removeClassName($E(nodeNames[idx]),"current")}}(i),"mouseout")}$E("loginBarCenter").onclick=function(){v7sendLog("40_01_05_"+$UID)};$E("loginBarFriend").onclick=function(){v7sendLog("40_01_06_"+$UID)};$E("logOut").onclick=function(){v7sendLog("40_01_11_"+$UID)}},initNicknamePanel:function(){var nicknamePanel=new scope.NicknamePanel;var _this=this;Lib.checkAuthor(function(){nicknamePanel.initUserInfo($UID);_this.addSubPanel(nicknamePanel,$E("loginBarOptApp"),-98,-9)},"PlatformTrayPlus1"+(new Date).getTime());var me=this;if(Utils.Cookie.getCookie("loginFromMsn")&&!$E("msnLoginIcon")){var holder=$C("img");holder.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";holder.style.cssFloat=holder.style.styleFloat="left";holder.width="18";holder.height="0";holder.style.padding="9px 0";holder.align="absmiddle";Core.Dom.insertAfter(holder,$E("loginBarAppMenuLabel"));trace("创建msn icon");createLinkMask(holder)}else{trace("不渲染msn icon")}function createLinkMask(holder){var mask=$C("a");var span=holder.parentNode;var container=span.parentNode;var node=$C("img");container.style.position="relative";span.style.position="relative";node.id="msnLoginIcon";node.className="SG_icon SG_icon136";node.src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";node.style.width="18px";node.style.height="18px";node.align="absmiddle";mask.appendChild(node);mask.href="http://control.blog.sina.com.cn/blogprofile/msnbind.php?c="+ +new Date;mask.target="_blank";mask.style.cssText="display:block; width:18px; height:18px; position:absolute; z-index:1024;";mask.style.paddingTop="4px";mask.title="MSN账号登录";container.insertBefore(mask,container.childNodes[0]);Core.Events.addEvent(window,relocation,"resize");trace("创建msn icon mask");relocation();function relocation(){var timer=setInterval(function(){var adminName=$E("loginBarAppMenuLabel").innerHTML;if(adminName!=="读取中..."){var strLeft=holder.offsetLeft+"px";mask.style.left=strLeft;trace("刷新msn icon mask");clearInterval(timer)}},300)}scope.$msnRelocation=relocation}},initAddArticlePanel:function(){var addArticlePanel=new scope.addArticlePanel;this.addSubPanel(addArticlePanel,$E("arrowAddArticle"),-81,0);$E("arrowAddArticle").onclick=function(){v7sendLog("40_01_13_"+($UID?$UID:""))};$E("arrowAddArticle").parentNode.children[0].onclick=function(){v7sendLog("40_01_12_"+($UID?$UID:""))}},showPublishWare:function(data){if(data["tbh_status"]&&parseInt(data["tbh_status"],10)){$E("tray_tbh_ware_linedot").style.display="";var publishBtn=$E("tray_tbh_ware_link");publishBtn.style.display="";try{var link=$T(publishBtn,"a")[0];if(scope&&"editor"==scope.$pageid){link.href="javascript:;";link.target="";link.onclick=function(){var plugin=$E("shortcut_content");var imgs=$T(plugin,"img");for(var i=0;i<imgs.length;i++){if(-1!=imgs[i].src.indexOf("element_shop")){Core.Events.click(imgs[i])}}}}link=null;publishBtn=null}catch(e){}}Lib.Listener.off({name:"tray-data-loaded",callBack:this.showPublishWare,scope:this})},initSearchPanel:function(){var searchPanel=new scope.SearchPanel;this.addSubPanel(searchPanel,$E("searchSelect"),-54,-4);Utils.Form.limitMaxLen($E("loginBarSearchInput"),50);var spNodes=searchPanel.getNodes();var cfg;for(cfg in searchPanel.config){!function(c){Core.Events.addEvent(spNodes[c],function(){_setActiveOption(c)},"click")}(cfg)}_setActiveOption("blog");$E("searchSelect").onclick=function(){v7sendLog("40_01_18")};var searchNode=Core.Dom.getElementsByClass($E("loginBarSearchForm"),"input","topbar_searchBtn")[0];searchNode.onclick=function(){v7sendLog("40_01_20")};Core.Events.addEvent($E("loginBarSearchInput"),function(e){var c=e.keyCode||e.charCode;if(c==15){v7sendLog("40_01_20")}},"keyup");function _setActiveOption(opt){var formEl=$E("loginBarSearchForm");formEl.action=searchPanel.config[opt]["url"];$E("loginBarSearchMenuLabel").innerHTML=spNodes[opt].getElementsByTagName("a")[0].innerHTML;var searchCEl=$E("loginBarSearchC"),searchTEl=$E("loginBarSearchT"),searchTypeEl=$E("loginBarSearchType"),searchSEl=$E("loginBarSearchS"),searchTSEl=$E("loginBarSearchTS"),searchTextEl=$E("loginBarSearchInput");switch(opt){case"all":case"blog":case"bauthor":if(!searchCEl){searchCEl=$C("input");searchCEl.type="hidden";searchCEl.name="c";searchCEl.id="loginBarSearchC";formEl.appendChild(searchCEl)}searchCEl.value="blog";searchTEl.value=searchPanel.config[opt]["range"];searchTEl.name="range";searchTypeEl.value=searchPanel.config[opt]["by"];searchTypeEl.name="by";searchTextEl.name=searchPanel.config[opt]["keyName"];break;case"song":case"video":case"vauthor":searchCEl&&(searchCEl.value="");searchTEl.value=searchPanel.config[opt]["t"];searchTEl.name="t";searchSEl.value=searchPanel.config[opt]["s"];searchTSEl.value=searchPanel.config[opt]["ts"];searchTypeEl.value=searchPanel.config[opt]["type"];searchTypeEl.name="type";$E("loginBarSearchSType").value=searchPanel.config[opt]["stype"];searchTextEl.name=searchPanel.config[opt]["keyName"];break}}},hideActiLink:function(el){var pageId=scope.$pageid;if("pageSetM"!==pageId&&"editor"!==pageId){el.style.display="none";el.setAttribute("shouldShow","1")}setTimeout(function(){if(typeof BLOG_AD_TIPS=="undefined"||!BLOG_AD_TIPS){el.style.display="";return}},3e3)},initActivityPanel:function(){if($_GLOBAL){var loginActLink=$E("loginBarActivity");if(loginActLink){this.hideActiLink(loginActLink);this._loadPopularizeData(loginActLink)}}if($_GLOBAL.activityBlackList&&$_GLOBAL.activityBlackList[scope.$pageid]){trace("【活动】当前页面在黑名单");return}},initMsnLogout:function(){var _tray=$E("openedBlogTray");var _a_list=_tray.getElementsByTagName("a");var _logout_a=_a_list[_a_list.length-1];_logout_a.href="#";_logout_a.onclick=function(){return false};var _tray_noIn=$E("noOpenedBlogTray");var _a_list_noIn=_tray_noIn.getElementsByTagName("a");var _logout_a_noIn=_a_list_noIn[_a_list_noIn.length-1];_logout_a_noIn.href="#";_logout_a_noIn.onclick=function(){return false};var _curHref=encodeURIComponent(window.location.href);if(_tray)Core.Events.addEvent(_logout_a,logoutMsnAndBlog);if(_tray_noIn)Core.Events.addEvent(_logout_a_noIn,logoutMsnAndBlog);function logoutMsnAndBlog(){new Interface("http://control.blog.sina.com.cn/blog_rebuild/msn/api/msnLoginOut.php","jsload").request({onSuccess:function(res){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onError:function(res){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref},onFail:function(res){window.location.href="https://login.sina.com.cn/cgi/login/logout.php?r="+_curHref}})}},addSubPanel:function(panel,dom,offsetLeft,offsetTop){var _this=this;this.subPanels.push(panel);function _showPanel(){Core.Events.stopEvent();var i,len=_this.subPanels.length;for(i=0;i<len;i++){_this.subPanels[i].hidden()}panel.showWithDom(dom,offsetLeft,offsetTop)}Core.Events.addEvent(dom,function(){if(dom===$E("loginBarOptApp")){v7sendLog("40_01_01_"+$UID)}_showPanel()},"click");Core.Events.addEvent(document.body,function(){panel.hidden()},"click");Core.Events.addEvent(panel.entity,function(){Core.Events.stopEvent()},"mousedown");Core.Events.addEvent(window,function(){var x=Core.Dom.getLeft(dom)+dom.offsetWidth+offsetLeft;var y=Core.Dom.getTop(dom)+dom.offsetHeight+offsetTop;if($IE6&&this.isFixed){x=x-document.documentElement.scrollLeft;y=y-document.documentElement.scrollTop}panel.setPosition(x,y)},"resize")},initNewInboxPanel:function(){var newInboxPanel=new scope.NewInboxPanel;this.addSubPanel(newInboxPanel,$E("loginBarInbox"),-137,-9);try{if(!$E("ccnotepiaohong")){var di=$C("div");di.className="imforbox";di.style.display="none";di.id="ccnotepiaohong";$E("loginBarInbox").appendChild(di)}$E("loginBarInbox").className="link imfor"}catch(e){}newInboxPanel.onMessageLoad=function(nickname){$E("loginBarAppMenuLabel").innerHTML=nickname;$E("noOpenBlogName").innerHTML=Core.System.htmlFilter(nickname)}},initMailRemind:function(){if($E("loginBarMail")&&$E("line")){$E("loginBarMail").style.display="";$E("line").style.display=""}function remindEmail(){var mailInter=new Interface("http://interface.blog.sina.com.cn/riaapi/profile/unreadmail.php","jsload");mailInter.request({onSuccess:function(data){var tota=parseInt(data,10);if(tota>99){tota="99+"}if(tota!==0&&$E("mailpiaohong")){var num=$E("mailpiaohong");num.style.display="";num.innerHTML=tota}else{$E("mailpiaohong").style.display="none"}},onError:function(){$E("mailpiaohong").style.display="none"}})}remindEmail();var remind=setInterval(remindEmail,5*60*1e3);Core.Events.addEvent($E("loginBarMail"),function(){v7sendLog("40_01_07_"+$UID);var redEl=$E("mailpiaohong");var isRed=!redEl.style.display;if(isRed){redEl.style.display="none"}},"click");Core.Events.addEvent($E("mailpiaohong"),function(){var redEl=$E("mailpiaohong");redEl.style.display="none";window.open("http://mail.sina.com.cn/?s=2")},"click")},initOnceLogedEvent:function(nodeNames,uid){var i,len=nodeNames.length;var me=this;for(i=0;i<len;i++){$E(nodeNames[i]).onclick=function(){switch(this.id){case"loginBarOptApp":v7sendLog("44_01_07_"+uid);break;case"loginBarMail":v7sendLog("44_01_08_"+uid);break;case"loginBarCenter":v7sendLog("44_01_09_"+uid);break;case"loginBarFriend":v7sendLog("44_01_10_"+uid);break;case"loginBarInbox":v7sendLog("44_01_11_"+uid);break}if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location=window.location.toString().replace(/#.*/,"")},100)},false);return false}}},initOnceLogedTips:function(uid){var me=this;var messageUrl="http://interface.blog.sina.com.cn/riaapi/profile/unread.php";Utils.Io.JsLoad.request(messageUrl,{GET:{uid:uid,product:"blog"},onComplete:function(res){if(scope.$pageid=="profile_index"||scope.$pageid=="pageSetM"||scope.$pageid=="editor"){return}var tip=$E("newStatusTip");if(!tip){tip=$C("div");tip.id="newStatusTip";tip.className="tb_layer_Y tb_layer_w3";tip.style.width="138px";tip.innerHTML=scope.onceLogedStatusTipTemplay;var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px";tip.style.zIndex="510";tip.style.display="none";document.body.appendChild(tip)}if(res.data.unreadnotes>=1){v7sendLog("44_01_12_"+uid);tip.style.display="block";$E("nstUnread").style.display="block";$E("nstUnread").onclick=function(){v7sendLog("44_01_13_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/profilelatestnote.php"},100)},false);return false}}else if(res.data.nfn>=1){v7sendLog("44_01_14_"+uid);tip.style.display="block";$E("nstFeed").style.display="block";$E("nstFeed").onclick=function(){v7sendLog("44_01_15_"+uid);if(typeof sinaSSOController!="undefined")sinaSSOController.loginExtraQuery={};
me.trayLogin.login(function(){setTimeout(function(){window.location="http://i.blog.sina.com.cn/blogprofile/index.php?type=3&from=newstatus&com=2"},100)},false);return false}}Core.Events.addEvent(window,function(){var a=$T($E("loginBarCenter"),"a")[0];var loc=Core.Dom.getXY(a);tip.style.left=loc[0]-(138/2-a.offsetWidth/2)+"px";tip.style.top=loc[1]+a.offsetHeight+"px"},"resize")},onException:function(data){}})}};$registJob("tray",function(){Lib.Listener.add("tray-data-loaded");var tray,isNewTray;var $logo=$E("login_bar_logo_link_350");if($logo&&"ntopbar_main"===$logo.parentNode.className){isNewTray=true}else{isNewTray=false}if(isNewTray){tray=Lib.TrayPanel()}else{tray=new Lib.PlatformTrayPlus}var userInfo=Lib.Login.info();var uid=userInfo.uid;window.$onceLog=false;var onceloggedonblog=unescape(Utils.Cookie.getCookie("onceloggedonblog"));if(onceloggedonblog&&uid){time=onceloggedonblog;var now=(new Date).getTime();if(time&&now>time){$onceLog=true}}Lib.checkAuthor(function(){if($isLogin){tray.load("login")}else{tray.load("logout")}},"tray123"+(new Date).getTime());window.$tray={};window.$tray.renderLogin=function(){Lib.checkAuthor(function(){if($isLogin){tray.load("login")}},"tray1"+(new Date).getTime())};window.$tray.renderLogout=function(){tray.load("logout")}});$registJob("login",function(){var Login=new Lib.Login.Ui;Core.Events.addEvent("loginbtn",function(){Login.login(function(){alert("做一些，登陆之后，做的事情，呵呵！")})})});Lib.insertMoban=function(){if(scope.tpl&&scope.tpl!=""&&(scope.tpl.split("_")[0]=="13"||$_GLOBAL.flashtemplate[scope.tpl])){Lib.insertMobanFunc(scope.tpl)}};Lib.insertMobanFunc=function(id){var headflash=$E("headflash");if(headflash){headflash.innerHTML="";headflash.style.display="";var swf_url="http://simg.sinajs.cn/blog7newtpl/css/"+id.split("_")[0]+"/"+id+"/top.swf";var width=950,height=266;if($_GLOBAL.flashtemplate[id].width){width=$_GLOBAL.flashtemplate[id].width}if($_GLOBAL.flashtemplate[id].height){height=$_GLOBAL.flashtemplate[id].height}trace("flash height="+height);var x=Utils.Flash.swfView.Add(swf_url,"headflash","headflash_f",width,height,"9.0.0.0","#000",{},{allowScriptAccess:"false",wmode:"transparent",allowFullScreen:"false"})}};Lib.tplFuncArr={};Lib.tplFuncCount=0;Lib.getTplNum=function(func){Lib.tplFuncArr[Lib.tplFuncCount++]=func||function(){};if($isAdmin&&scope.tpl&&scope.tpl!=""){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}return}else{if($IE){var ss=document.styleSheets;var re=/\S*(blog7tpl([^t]*))\S*/gi;var re2=/\S*(blog7newtpl\/css([^t]*))\S*/gim;for(var i=0;i<ss.length;i++){if(ss[i].id=="uid_link_css"){var res=re.exec(ss[i].cssText);var res2=re2.exec(ss[i].cssText);if(res!=null||res2!=null){if(res!=null){scope.tpl=res[2].split("/")[2]}else if(res2!=null){scope.tpl=res2[2].split("/")[2]}}break}}for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}else if(!$IE&&scope.$PRODUCT_NAME=="blog7"){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}return;Utils.Io.Ajax.request("http://blog.sina.com.cn/s/"+scope.$uid+".css?",{onComplete:function(text){text=text.replace("\n","");var re=/\S*(blog7tpl([^t]*))\S*/gim;var re2=/\S*(blog7newtpl\/css([^t]*))\S*/gim;var res=re.exec(text);var res2=re2.exec(text);if(res!=null||res2!=null){if(res!=null){scope.tpl=res[2].split("/")[2]}else if(res2!=null){scope.tpl=res2[2].split("/")[2]}}for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}.bind2(this),returnType:"txt"})}else if(!$IE&&scope.$PRODUCT_NANM!="blog7"){Utils.Io.JsLoad.request("http://blog.sina.com.cn/s/"+scope.$uid+".js",{GET:{tm:(new Date).getTime()},onComplete:function(){for(var k in Lib.tplFuncArr){Lib.tplFuncArr[k]();Lib.tplFuncArr[k]=null;delete Lib.tplFuncArr[k]}}.bind2(this)})}}};$registJob("getTplNum",function(){});!function(){var getImgStaticPath=function(pid,type){if(!pid){return""}var type=type||"orignal";try{var num=eval("0X"+pid.substring(pid.length-2))%16+1;return"http://s"+num+".sinaimg.cn/"+type+"/"+pid}catch(e){trace("图片URL计算出错！PID:"+pid);return""}};window.getImgStaticPath=getImgStaticPath}();Utils.insertTemplate=function(el,template,where){var ids=[],nodes={},idreg=/#{(\w+)}/g,rndNum="_"+(new Date).getTime().toString().slice(-5)+Math.floor(Math.random()*1e5);template=template.replace(idreg,function(match,id){ids.push(id);return id+rndNum});Core.Dom.insertHTML(el,template,where);for(var i=ids.length,id;i--;){id=ids[i];nodes[id]=$E(id+rndNum)}return nodes};$registJob("articleShare",function(){if(!$E("t_"+scope.$articleid)){trace("应该是私密博文");return}var x="javascript:void((function(s,d,e,r,l,p,t,z,c,w){var%20f='http://v.t.sina.com.cn/share/share.php?',u=z||d.location,p=['url=',e(u),'&title=',e(t||d.title),'&source=',e(r),'&sourceUrl=',e(l),'&content=',c||'gb2312','&pic=',e(p||''),'&ralateUid=',w].join('');function%20a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=440,height=430,left=',(s.width-440)/2,',top=',(s.height-430)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent))setTimeout(a,0);else%20a();})(screen,document,encodeURIComponent,'新浪-博客','http://blog.sina.com.cn','"+(scope.$album_pic?getImgStaticPath(scope.$album_pic,"bmiddle"):"")+"','分享"+scope.owenerNickName+"的博文："+$E("t_"+scope.$articleid).innerHTML.replace(/'/g,"\\'")+" 推荐给@头条博客"+"','http://blog.sina.com.cn/s/blog_"+scope.$articleid+".html','utf-8','1231759973'));";x=Core.String.decodeHTML(x);if($E("shareminiblogfromblogatarticlepage")){Lib.Uic.getNickName([scope.$uid],function(oResult){var nickname=oResult[scope.$uid]||"";nickname=Core.String.encodeHTML(nickname);scope.owenerNickName=nickname;$E("shareminiblogfromblogatarticlepage").href=x})}if($_GLOBAL.diggerOpenFlag){var sharewb=$E("sharewb"),shareqing=$E("shareqing"),sharemail=$E("sharemail");if(sharewb){sharewb.href=x;Core.Events.addEvent(sharewb,function(){v7sendLog("80_01_04")})}if(!sharemail&&sharewb){var con='<a href="javascript:;" id="sharemail"><img width="16" height="16" align="absmiddle" title="分享到新浪邮箱" alt="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon211"></a>';Utils.insertTemplate(sharewb,con,"beforebegin");sharemail=$E("sharemail")}if(sharemail){if(!scope.$rank||!scope.totalPv){var timer=setInterval(grades,300);function grades(){var s=scope.$rank;var pv=scope.totalPv;if(s&&pv){clearInterval(timer)}}}sharemail.onclick=function(){if($isLogin){var url="http://mail.sina.com.cn/share/mail.php?"+"aid="+encodeURIComponent(scope.$articleid)+"&bl="+encodeURIComponent(scope.$rank)+"&ba="+encodeURIComponent(scope.totalPv);window.open(url,"shareMail","toolbar=0,status=0,scrollbars=1,resizable=1,width=970,height=630,left="+(screen.width-970)/2+",top="+(screen.height-630)/2);return false}else{var handler=new Lib.Login.Ui;handler.login(function(){var url="http://mail.sina.com.cn/share/mail.php?"+"aid="+encodeURIComponent(scope.$articleid)+"&bl="+encodeURIComponent(scope.$rank)+"&ba="+encodeURIComponent(scope.totalPv);window.open(url,"shareMail","toolbar=0,status=0,scrollbars=1,resizable=1,width=970,height=630,left="+(screen.width-970)/2+",top="+(screen.height-630)/2);return false})}}}if($E("sharexn")){$E("sharexn").href="javascript:u='http://share.xiaonei.com/share/buttonshare.do?link='+location.href+'&title='+encodeURIComponent(document.title);window.open(u,'xiaonei','toolbar=0,resizable=1,scrollbars=yes,status=1,width=626,height=436');void(0)";Core.Events.addEvent($E("sharexn"),function(){v7sendLog("80_01_07")})}if($E("sharedb")){$E("sharedb").href="http://www.douban.com/recommend/?url="+window.location.href+"&title="+encodeURIComponent(document.title)+";window.open(u,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330');void(0)";Core.Events.addEvent($E("sharedb"),function(){v7sendLog("80_01_08")})}if($E("sharekx")){$E("sharekx").href="javascript:d=document;t=d.selection?(d.selection.type!='None'?d.selection.createRange().text:''):(d.getSelection?d.getSelection():'');void(kaixin=window.open('http://www.kaixin001.com/~repaste/repaste.php?&rurl='+escape(d.location.href)+'&rtitle='+escape('"+document.title+"')+'&rcontent='+escape('"+document.title+"'),'kaixin'));kaixin.focus();";Core.Events.addEvent($E("sharekx"),function(){v7sendLog("80_01_06")})}var sm=$E("sharemsn");if(sm){var href=[];href.push("url="+encodeURIComponent("http://blog.sina.com.cn/s/blog_"+scope.$articleid+".html"));var title=$E("t_"+scope.$articleid);if($IE){title=title.innerText}else{title=title.textContent}href.push("title="+encodeURIComponent(title));var loc=scope.$album_pic?getImgStaticPath(scope.$album_pic,"bmiddle"):"http://portrait"+(parseInt(scope.$uid)%8+1)+".sinaimg.cn/"+scope.$uid+"/blog/180";href.push("screenshot="+encodeURIComponent(loc));var ele=$E("sina_keyword_ad_area2");if(ele){if($IE){ele=ele.innerText}else{ele=ele.textContent}ele=ele.replace(/\n/gi,"");ele=ele.replace(/^\s\s*/,"");var ws=/\s/;var i=ele.length;while(ws.test(ele.charAt(--i)));href.push("description="+encodeURIComponent(ele.substring(0,101)))}sm.href="http://profile.live.com/badge/?"+href.join("&");sm.target="_blank";Core.Events.addEvent(sm,function(){v7sendLog("80_01_05")})}}if($E("moreshares")){Core.Events.addEvent($E("moreshares"),function(){if($E("sharelayer")){if($E("sharelayer").style.display=="none"){var e=Core.Events.fixEvent(Core.Events.getEvent());var xy=Core.Dom.getXY($E("moreshares"));$E("sharelayer").style.left=xy[0]-45+"px";$E("sharelayer").style.top=xy[1]+15+"px";$E("sharelayer").style.display=""}else{}}else{var html='<div id="sharelayer" style="z-index:100;width:120px;" class="tb_layer_Y tb_layer_w2">'+'<div class="tb_layer_arrow"></div>'+'<div class="tb_layer_Y_main" >'+'<div class="tb_ps_share" style="width:96px;">'+'<span class="share"><a id="sharewb" href="#" title="分享到新浪微博"><img height="16" align="absmiddle" width="16" title="微博" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon51"></a></span>'+'<span class="share"><a id="sharexn" href="#" title="分享到人人"><img height="16" align="absmiddle" width="16" title="人人" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon113"></a></span>'+'<span class="share"><a id="sharedb" target="_blank" href="#" title="分享到豆瓣"><img height="16" align="absmiddle" width="16" title="豆瓣" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon116"></a></span>'+'<span class="share"><a id="sharekx" href="#" title="分享到开心001"><img height="16" align="absmiddle" width="16" title="开心001" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon117"></a></span>'+'<div class="clearit"></div>'+"</div>"+"</div>"+"</div>";Core.Dom.insertHTML(document.body,html,"beforeend");var e=Core.Events.fixEvent(Core.Events.getEvent());var xy=Core.Dom.getXY($E("moreshares"));$E("sharelayer").style.left=xy[0]-45+"px";$E("sharelayer").style.top=xy[1]+15+"px";$E("sharewb").href=x;$E("sharexn").href="javascript:u='http://share.xiaonei.com/share/buttonshare.do?link='+location.href+'&title='+encodeURIComponent(document.title);window.open(u,'xiaonei','toolbar=0,resizable=1,scrollbars=yes,status=1,width=626,height=436');void(0)";$E("sharedb").href="http://www.douban.com/recommend/?url="+window.location.href+"&title="+encodeURIComponent(document.title)+";window.open(u,'douban','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330');void(0)";$E("sharekx").href="javascript:d=document;t=d.selection?(d.selection.type!='None'?d.selection.createRange().text:''):(d.getSelection?d.getSelection():'');void(kaixin=window.open('http://www.kaixin001.com/~repaste/repaste.php?&rurl='+escape(d.location.href)+'&rtitle='+escape('"+document.title+"')+'&rcontent='+escape('"+document.title+"'),'kaixin'));kaixin.focus();";Core.Events.addEvent($E("sharelayer"),function(){var e=Core.Events.fixEvent(Core.Events.getEvent());var xy=Core.Dom.getXY($E("sharelayer"));var scrollPos=Core.System.getScrollPos(document);var left=xy[0];var top=xy[1];var ex=scrollPos[1]+e.clientX;var ey=scrollPos[0]+e.clientY;if(ex>=left+116||ex<=left||ey>=top+42||ey<=top){$E("sharelayer").style.display="none"}},"mouseout")}},"mouseover")}var weimiShare=function(){var weimiTpl=['<div class="layer_weimi">','<a href="javascript:;" class="close" id="weimiShareClose"></a>','<div class="title">微米分享</div>','<ol class="list">','<li class="step code"><img id="weimiQRCode" alt="二维码" /></li>','<li class="step step1">','<div class="pic"><img src="http://simg.sinajs.cn/blog7style/images/common/weimilayer/1.jpg" alt="步骤一" /></div>','<div class="desc"><span class="num">1</span><span class="txt">微米扫描左侧二维码</span></div>',"</li>",'<li class="step step2">','<div class="pic"><img src="http://simg.sinajs.cn/blog7style/images/common/weimilayer/2.jpg" alt="步骤二" /></div>','<div class="desc"><span class="num">2</span><span class="txt">点击右上角的分享按钮</span></div>',"</li>",'<li class="step step3">','<div class="pic"><img src="http://simg.sinajs.cn/blog7style/images/common/weimilayer/3.jpg" alt="步骤三" /></div>','<div class="desc"><span class="num">3</span><span class="txt">选择分享给朋友</span></div>',"</li>","</ol>","</div>"].join("");var _this={},that={};var weimiShareLayer,closeBtn,shareBtn,qrImg="http://comet.blog.sina.com.cn/qr?"+location.href.replace(/[#?](.*)/,"");that.init=function(){shareBtn=$E("shareweimi");if(!shareBtn){_this.createShareNode()}Core.Events.addEvent(shareBtn,_this.showLayer,"click");Core.Events.addEvent(window,_this.resizeLayer,"resize")};_this.createShareNode=function(btn){if(!$E("shareqing")){return}var pNode=$E("shareqing").parentNode,posNode=$E("shareqing"),newNode;newNode=$C("a");newNode.id="shareweimi";newNode.innerHTML='<img width="51" height="16" align="absmiddle" title="分享到微米" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon213">';pNode.insertBefore(newNode,posNode);shareBtn=$E("shareweimi")};_this.createShareLayer=function(){var node=$C("div");node.id="weimiShareLayer";node.innerHTML=weimiTpl;document.body.appendChild(node);$E("weimiQRCode").src=qrImg;weimiShareLayer=$E("weimiShareLayer");closeBtn=$E("weimiShareClose");Core.Events.addEvent(closeBtn,_this.hideLayer,"click")};_this.showLayer=function(){weimiShareLayer=$E("weimiShareLayer");if(!weimiShareLayer){_this.createShareLayer()}_this.setPos();weimiShareLayer.style.display="";return false};_this.hideLayer=function(){weimiShareLayer&&(weimiShareLayer.style.display="none");return false};_this.resizeLayer=function(){if(!weimiShareLayer){return}if(weimiShareLayer.style.display=="none"){return}_this.setPos()};_this.setPos=function(){var clientHeight=document.documentElement.clientHeight||document.body.clientHeight;var clientWidth=document.documentElement.clientWidth||document.body.clientWidth;var layerWidth=586;weimiShareLayer.style.position=$IE6?"absolute":"fixed";weimiShareLayer.style.left=Math.abs(clientWidth-layerWidth)/2+"px";weimiShareLayer.style.zIndex="1025";if($IE6){weimiShareLayer.style.top=document.documentElement.scrollTop+50+"px"}else{weimiShareLayer.style.top=50+"px"}};return that};var weimi=weimiShare();weimi.init()});$registJob("recordVisitor",function(){Lib.checkAuthor(function(){if($isLogin&&!$isAdmin){!function(){if(scope.unreadMsg){if(!scope.unreadMsg.foot){scope.unreadMsg.foot=0}if(!(scope.unreadMsg.foot*1)){var param={pid:1,uid:scope.$uid};if(typeof scope.$articleid!="undefined"){param.subid=scope.$articleid}Utils.Io.JsLoad.request("http://footprint.cws.api.sina.com.cn/add.php",{GET:param})}}else{setTimeout(arguments.callee,200)}}()}},"recordVisitor"+(new Date).getTime())});Utils.text2Copy=function(text2copy){var checkFlashVer=function(){var plugin=navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]?navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin:0;if(plugin){var words=navigator.plugins["Shockwave Flash"].description.split(" ");for(var i=0;i<words.length;++i){if(isNaN(parseInt(words[i],10))){continue}var MM_PluginVersion=words[i]}return MM_PluginVersion>=10}else if($IE){try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash.10");return true}catch(e){return false}}};if(window.clipboardData&&$IE6){window.clipboardData.clearData();return window.clipboardData.setData("Text",text2copy)}else{if(checkFlashVer()){if($IE){try{window.clipboardData.clearData();return window.clipboardData.setData("Text",text2copy)}catch(e){return false}}try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var clip=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!clip){return}var trans=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!trans){return}trans.addDataFlavor("text/unicode");var str={};var len={};str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);var copytext=text2copy;str.data=copytext;trans.setTransferData("text/unicode",str,copytext.length*2);var clipid=Components.interfaces.nsIClipboard;if(!clip){return false}clip.setData(trans,null,clipid.kGlobalClipboard);return true}catch(e){return false}}else{var flashcopier="flashcopier";if(!$E(flashcopier)){var divholder=$C("div");divholder.id=flashcopier;document.body.appendChild(divholder)}text2copy=text2copy.replace(/%/g,escape("%")).replace(/&/g,escape("&"));var divinfo='<embed src="http://simg.sinajs.cn/blog7common/clipboard.swf" FlashVars="clipboard='+text2copy+'" width="0" height="0" type="application/x-shockwave-flash"></embed>';$E(flashcopier).innerHTML=divinfo;return true}}};Lib.subscribe=Core.Class.create();Lib.subscribe.prototype={initialize:function(){this.createDlg()},createDlg:function(){var basicRssXML="http://blog.sina.com.cn/rss/"+scope.$uid+".xml";var content=['<div id="rssDy"></div>'];content.push('<div class="clearit"></div></div><table><tr><th scope="row">订阅地址：</th><td><input type="text" id="subscribeText" class="SG_input" value="" /><a class="SG_aBtn SG_aBtnB" href="javascript:;" onclick="return false;"><cite id="subscribeCopy">复制</cite></a></td></tr><tr><th scope="row"></th><td>如果还没有RSS阅读器，请<strong><a href="http://down.tech.sina.com.cn/content/3034.html" target="_blank">立即下载</a></strong>。 </td></tr></table>');content=content.join("");var tpl=['<table id="#{entity}" class="CP_w">','<thead id="#{titleBar}">',"<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid">','<div class="bLyTop">','<strong id="#{titleName}"></strong>','<cite style="width:100px;"><a href="http://www.sina.com.cn/ddt/rsshelp.html" target="_blank">什么是RSS?</a><a title="关闭" class="CP_w_shut" id="#{btnClose}" href="javascript:;">关闭</a></cite>',"</div>","</th>",'<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon2 rssLayer" id="#{content}">',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join("");this._dialog=winDialog.createCustomsDialog({tpl:tpl,title:"RSS订阅",content:content,width:415,height:104},"tips");$E("subscribeText").value=basicRssXML;this.bindEvent()},bindEvent:function(){var _this=this;Core.Events.addEvent($E("subscribeCopy"),function(){v7sendLog("11_01_02");var flag=Utils.text2Copy($E("subscribeText").value);if(flag==true)winDialog.alert("复制成功",{funcOk:function(){_this._dialog.hidden()},icon:"03"})})},show:function(){var addIconFuc=function(){if($_GLOBAL.rssIcons){var name=scope.$uid;if($_GLOBAL.rssMethod){name=scope[$_GLOBAL.rssMethod]}var basicRssXML="http://blog.sina.com.cn/rss/"+name+".xml";var content=['<div class="rss_title"><strong>在线阅读器直接订阅：</strong></div><div class="rss_list" style="display:inline-block;">'];for(var i=0;$_GLOBAL.rssIcons[i];i++){var rs=$_GLOBAL.rssIcons[i];if(rs.cls==="rss_shiye"){basicRssXML=name+"&sub=1"}content.push('<span><a target="_blank" href="');content.push(rs.href);if(rs.encode){content.push(encodeURIComponent(basicRssXML))}else{content.push(basicRssXML)}content.push('" class="');content.push(rs.cls);content.push('" title="');content.push(rs.title);content.push('"></a></span>')}$E("rssDy").innerHTML=content.join("");var shiyeNode=Core.Dom.getElementsByClass($E("rssDy"),"a","rss_shiye");if(shiyeNode[0]){Core.Events.addEvent(shiyeNode[0],function(){v7sendLog("11_01_01")})}}};this._dialog.show();this._dialog.setAreaLocked(true);this._dialog.setMiddle();if($_GLOBAL.rssIcons){addIconFuc()}else{Utils.Io.JsLoad.request("http://sjs.sinajs.cn/blog7common/conf/rss_conf.js",{onComplete:function(){addIconFuc()},noreturn:true,isRemove:false})}},hidden:function(){this._dialog.hidden()}};$registJob("subscribe",function(){Core.Events.addEvent($E("SubscribeNewRss"),function(){if(!window.mySubscribe)window.mySubscribe=new Lib.subscribe;window.mySubscribe.show()})});$registJob("updownurl",function(){var new_cont=$E("new_nextprev_"+scope.$articleid);if(!new_cont){Lib.checkAuthor(function(){if(scope.$pn_x_rank=="1"&&!$isAdmin){return false}var cont=$E("nextprev_"+scope.$articleid);var inter=new Interface("http://blogtj.sinajs.cn/api/get_prevnext_article.php","jsload");var node=$E("t_"+scope.$articleid).parentNode;var time=Core.Dom.getChildrenByClass(node,"time")[0].innerHTML;time=time.replace("(","").replace(")","");inter.request({GET:{uid:scope.$uid,blog_id:scope.$articleid,varname:"prevnext",blog_pubdate:time,pn_x_rank:scope.$pn_x_rank},onSuccess:function(result){var html="";if(result.prev!=null){html+='<div><span class="SG_txtb">前一篇：</span><a href="'+result.prev.blog_url+'">'+result.prev.blog_title+"</a></div>"}if(result.next!=null){html+='<div><span class="SG_txtb">后一篇：</span><a href="'+result.next.blog_url+'">'+result.next.blog_title+"</a></div>"}cont.innerHTML=html},onError:function(){}})},"updownurl"+(new Date).getTime())}});$registJob("audioCheck",function(){if(!$E("article_comment_list")){return}if(scope.$private.cms!=1&&scope.$isCommentAllow!=1){var dom=$E("comment_get_vcode");var cont=Core.Dom.wrap(dom,"span");if(cont){Lib.AudioCheck.render(cont,Lib.AudioCheck.soundUrl+"?"+(new Date).getTime())}}});Lib.RandomStroll=Core.Class.create();Lib.RandomStroll.prototype={link_url:null,swf_url:$_GLOBAL.flashBasicURL+"lookViewSpring.swf?2",initialize:function(urllist){this.link_url=urllist&&urllist[Math.floor(Math.random()*urllist.length)];var div=SinaEx.createNode('<div id="ramdomVisitDiv" style="position:absolute;width:140px;z-index:101;"></div>');div.style.top=scope._AD_HEIGHT?scope._AD_HEIGHT+30+"px":"30px";document.body.appendChild(div);this.div=div;this.lock();Core.Events.addEvent(window,function(){this.lock()}.bind2(this),"resize");Core.Events.addEvent(window,function(){this.lock()}.bind2(this),"scroll")},load:function(option){Utils.Flash.swfView.Add(this.swf_url,"ramdomVisitDiv","map","140","87","8.0.0.0","#000",{url:this.link_url},{scale:"noscale",allowScriptAccess:"always",wmode:"transparent"})},lock:function(){this.div.style.right="0px"},show:function(){$E("ramdomVisitDiv").style.display=""},hide:function(){$E("ramdomVisitDiv").style.display="none"}};function clickSendRandomLog(){v7sendLog("79_01_14",scope.$pageid,"")}function mouseoverSendRandomLog(){v7sendLog("79_01_13",scope.$pageid,"")}$registJob("randomScroll",function(){Utils.Io.JsLoad.request("http://blog.sina.com.cn/lm/rndurllist.js",{onComplete:function(){if(typeof RND_URL_LIST==="undefined"||!RND_URL_LIST||!RND_URL_LIST.length){return}var rand=new Lib.RandomStroll(RND_URL_LIST);rand.load({target:"_self",URL:""})}})});if(typeof sina!="object"){var sina={}}sina.$=function(i){if(!i){return null}return document.getElementById(i)};var sinaFlash=function(V,x,X,Z,v,z,i,c,I,l,o){var w=this;if(!document.createElement||!document.getElementById){return}w.id=x?x:"";var O=function(I,i){for(var l=0;l<I.length;l++){if(I[l]==i){return l}}return-1},C="8.0.42.0";if(O(["eladies.sina.com.cn","ent.sina.com.cn"],document.domain)>-1){w.ver=C}else{w.ver=v?v:C}w.ver=w.ver.replace(/\./g,",");w.__classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";w.__codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version="+w.ver;w.width=X;w.height=Z;w.movie=V;w.src=w.movie;w.bgcolor=z?z:"";w.quality=c?c:"high";w.__pluginspage="http://www.macromedia.com/go/getflashplayer";w.__type="application/x-shockwave-flash";w.useExpressInstall=typeof i=="boolean"?i:false;w.xir=I?I:window.location;w.redirectUrl=l?l:window.location;w.detectKey=typeof o=="boolean"?o:true;w.escapeIs=false;w.__objAttrs={};w.__params={};w.__embedAttrs={};w.__flashVars=[];w.__flashVarsStr="";w.__forSetAttribute("id",w.id);w.__objAttrs["classid"]=w.__classid;w.__forSetAttribute("codebase",w.__codebase);w.__forSetAttribute("width",w.width);w.__forSetAttribute("height",w.height);w.__forSetAttribute("movie",w.movie);w.__forSetAttribute("quality",w.quality);w.__forSetAttribute("pluginspage",w.__pluginspage);w.__forSetAttribute("type",w.__type);w.__forSetAttribute("bgcolor",w.bgcolor)};sinaFlash.prototype={getFlashHtml:function(){var I=this,i="<object ";for(var l in I.__objAttrs){i+=l+'="'+I.__objAttrs[l]+'"'+" "}i+=">\n";for(var l in I.__params){i+='	<param name="'+l+'" value="'+I.__params[l]+'" />\n'}if(I.__flashVarsStr!=""){i+='	<param name="flashvars" value="'+I.__flashVarsStr+'" />\n'}i+="	<embed ";for(var l in I.__embedAttrs){i+=l+'="'+I.__embedAttrs[l]+'"'+" "}i+="></embed>\n</object>";return i},__forSetAttribute:function(I,i){var l=this;if(typeof I=="undefined"||I==""||typeof i=="undefined"||i==""){return}I=I.toLowerCase();switch(I){case"classid":break;case"pluginspage":l.__embedAttrs[I]=i;break;case"onafterupdate":case"onbeforeupdate":case"onblur":case"oncellchange":case"onclick":case"ondblClick":case"ondrag":case"ondragend":case"ondragenter":case"ondragleave":case"ondragover":case"ondrop":case"onfinish":case"onfocus":case"onhelp":case"onmousedown":case"onmouseup":case"onmouseover":case"onmousemove":case"onmouseout":case"onkeypress":case"onkeydown":case"onkeyup":case"onload":case"onlosecapture":case"onpropertychange":case"onreadystatechange":case"onrowsdelete":case"onrowenter":case"onrowexit":case"onrowsinserted":case"onstart":case"onscroll":case"onbeforeeditfocus":case"onactivate":case"onbeforedeactivate":case"ondeactivate":case"codebase":l.__objAttrs[I]=i;break;case"src":case"movie":l.__embedAttrs["src"]=i;l.__params["movie"]=i;break;case"width":case"height":case"align":case"vspace":case"hspace":case"title":case"class":case"name":case"id":case"accesskey":case"tabindex":case"type":l.__objAttrs[I]=l.__embedAttrs[I]=i;break;default:l.__params[I]=l.__embedAttrs[I]=i}},__forGetAttribute:function(i){var I=this;i=i.toLowerCase();if(typeof I.__objAttrs[i]!="undefined"){return I.__objAttrs[i]}else if(typeof I.__params[i]!="undefined"){return I.__params[i]}else if(typeof I.__embedAttrs[i]!="undefined"){return I.__embedAttrs[i]}else{return null}},setAttribute:function(I,i){this.__forSetAttribute(I,i)},getAttribute:function(i){return this.__forGetAttribute(i)},addVariable:function(I,i){var l=this;if(l.escapeIs){I=escape(I);i=escape(i)}if(l.__flashVarsStr==""){l.__flashVarsStr=I+"="+i}else{l.__flashVarsStr+="&"+I+"="+i}l.__embedAttrs["FlashVars"]=l.__flashVarsStr},getVariable:function(I){var o=this,i=o.__flashVarsStr;if(o.escapeIs){I=escape(I)}var l=new RegExp(I+"=([^\\&]*)(\\&?)","i").exec(i);if(o.escapeIs){return unescape(RegExp.$1)}return RegExp.$1},addParam:function(I,i){this.__forSetAttribute(I,i)},getParam:function(i){return this.__forGetAttribute(i)},write:function(i){var I=this;if(typeof i=="string"){document.getElementById(i).innerHTML=I.getFlashHtml()}else if(typeof i=="object"){i.innerHTML=I.getFlashHtml()}}};addAdvertise=function(){var adDiv=$E("blogads");if(scope.$pageid.indexOf("article")>-1){if(adDiv!=null){var div2=$C("div");div2.id="blogads2";div2.className="blogads2 borderc";div2.innerHTML='<p><a href="javascript:;" id="adversite_bottom"></a></p><p class="SG_txtc">新浪广告共享计划</p>'+($isAdmin?'<div class="manage SinaAd_mg2">'+'<a href="http://share.sass.sina.com.cn/widget_ad/index_out.php?done" class="SinaAd_linkcolor SinaAd_link" target="_blank">[管理]</a></div>':"");div2.style.display="none";if(scope.$pn_x_rank&&window.parseInt(scope.$pn_x_rank)==0){if($E("nextprev_"+scope.$articleid)){Core.Dom.insertAfter(div2,$E("nextprev_"+scope.$articleid))}else if($E("new_nextprev_"+scope.$articleid)){Core.Dom.insertAfter(div2,$E("new_nextprev_"+scope.$articleid))}}}}Utils.Io.JsLoad.request("http://sjs.sinajs.cn/blog7/adwidget.js?v1",{onComplete:function(){if(typeof adShare!="undefined"){adShare.init(scope.$uid,"sinablog","SINABLOG")}},noreturn:true,isRemove:false})};$registJob("renderAd",function(){scope.$private.ad=scope.$private.ad||0;if(scope.$private.ad>0){Lib.checkAuthor(function(){addAdvertise()},"Advertise"+(new Date).getTime())}});$TEMPLATECLONE_MSG={A00001:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00002:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00003:"操作失败，可能系统繁忙或系统遇到未知错误，请稍后再试。也可联系新浪客服：致电4006900000。",A00004:"未登录",A00005:"抱歉，你暂时不能复制该模板",A00006:"操作成功",A11007:'你还未开通新浪博客，请先 <a href="https://login.sina.com.cn/hd/reg_sec.php?entry=blog"  id="cloneTemplateButNoReg">开通博客</a>'};Lib.TemplateClone=Core.Class.create();Lib.TemplateClone.prototype={type:"1",version:"7",interfaceClone:null,btnClone:null,initialize:function(btnClone,callBack){var _this=this;this.interfaceClone=new Interface("http://control.blog.sina.com.cn/riaapi/conf/template_clone.php","jsload");this.btnClone=btnClone;if(this.btnClone){Core.Events.addEvent(this.btnClone,function(){_this.clone(callBack)},"click")}},clone:function(callBack,tplNum){var _this=this;var a315="<a style='color:red' href='http://finance.sina.com.cn/333/2010-02-05/guest920.shtml' target='_blank'>315十大行业满意度调查</a>";var tipText=tplNum?a315:"";Lib.checkAuthor(function(){if($isLogin){winDialog.confirm("确定使用此模板吗?",{subText:tipText,funcOk:function(){scope.blogOpener.showDialog(function(){_this.request(callBack)})}})}else{var templateCloneLogin=new Lib.Login.Ui;templateCloneLogin.login(function(){winDialog.confirm("确定使用此模板吗?",{subText:tipText,funcOk:function(){scope.blogOpener.showDialog(function(){_this.request(callBack)})},funcCancel:function(){location.reload()}})})}},"templateClone"+(new Date).getTime())},request:function(callBack){var _this=this;this.interfaceClone.request({GET:{uid_cloned:scope.$uid,type:_this.type,version:_this.version},onSuccess:function(data){if(callBack){callBack()}},onError:function(data){if(data["code"]=="A11007"){Lib.checkAuthor();var tempAlertDialog=winDialog.alert($TEMPLATECLONE_MSG[data["code"]].replace(/#\{linkNewBlog\}/g,"http://control.blog.sina.com.cn/reg/reg_blog.php?version=7"),{icon:"01"});$E("cloneTemplateButNoReg").onclick=function(){tempAlertDialog.hidden().destroy()}}else{winDialog.alert($TEMPLATECLONE_MSG[data["code"]],{icon:"02"})}},onFail:function(){}})}};$registJob("templateClone",function(){Lib.checkAuthor(function(){if($isAdmin){trace("博主。不执行代码");return}Lib.getTplNum(function(){var tmpCloneFuc=function(){function formatPv(num){var tmp=new Ui.Template($_GLOBAL.cloneTemplateConfig[scope["tpl"]].count_text);var cnf={};cnf.template_pv=num;$E("template_clone_link").innerHTML=tmp.evaluate(cnf)}if(scope["tpl"]){var tc;var tcInfo=$_GLOBAL.cloneTemplateConfig[scope["tpl"]];if(tcInfo&&tcInfo["template_clone_pic"].replace(/\s/g,"")!=""){if(scope["tpl"]=="8_52"){$E("template_clone_pic").parentNode.parentNode.style.top="0px";if(window.screen.width<1280){$E("template_clone_pic").parentNode.parentNode.style.right="88px"}$E("template_clone_pic").parentNode.parentNode.style.zIndex=201}$E("template_clone_pic").innerHTML=tcInfo["template_clone_pic"];$E("template_clone_link").innerHTML=tcInfo["template_clone_link"];$E("template_clone_other").innerHTML=tcInfo["template_clone_other"];if(tcInfo["count_id"]){var url="http://comet.blog.sina.com.cn/api?maintype=hits&act=3&uid="+tcInfo["count_id"]+"&varname=templatecc";
Utils.Io.JsLoad.request(url,{onComplete:function(){if(typeof templatecc!="undefined"){formatPv(templatecc.pv)}else{$E("template_clone_link").style.display="none"}}})}tc=new Lib.TemplateClone($E("template_clone_pic"),function(){winDialog.alert("克隆模板成功!",{icon:"03",funcOk:function(){Lib.checkAuthor(function(){window.location.href="http://blog.sina.com.cn/u/"+$UID},"templateClonefuncOk"+(new Date).getTime())}})})}var gwinfo=$_GLOBAL.GUANWANG[scope["tpl"]];if(gwinfo&&gwinfo["template_clone_pic"].replace(/\s/g,"")!=""){$E("template_clone_pic").innerHTML=gwinfo["template_clone_pic"];$E("template_clone_other").innerHTML=gwinfo["template_clone_other"];if($E("template_clone_pic")){if($E("template_clone_pic").parentNode.tagName.toLowerCase()=="a"){$E("template_clone_pic").parentNode.href=gwinfo["template_clone_link"];$E("template_clone_pic").parentNode.target="_blank"}}}var fmInfo=$_GLOBAL.famous_conf[scope["tpl"]];if(fmInfo&&fmInfo["template_clone_pic"].replace(/\s/g,"")!=""){$E("template_clone_pic").innerHTML=fmInfo["template_clone_pic"];$E("template_clone_link").innerHTML=fmInfo["template_clone_link"];$E("template_clone_other").innerHTML=fmInfo["template_clone_other"];if($E("template_clone_pic")){if($E("template_clone_pic").parentNode.tagName.toLowerCase()=="a"){$E("template_clone_pic").parentNode.href="http://ba.sass.sina.com.cn/front/tp/deliver?blogId="+scope.$uid+"&tp="+scope.tpl}}}}};if($_GLOBAL.cloneTemplateConfig){tmpCloneFuc()}else{Utils.Io.JsLoad.request("http://sjs.sinajs.cn/blog7common/conf/tmp_clone.js",{onComplete:function(){tmpCloneFuc()},noreturn:true,isRemove:false})}})},"templateClone"+(new Date).getTime())});if(typeof Lib.flashComponent=="undefined"){Lib.flashComponent={}}Lib.FlashDetector=function(ver){this.version=ver}.$define({version:"",detect:function(){var nav=window.navigator,i,l,isFlashed,clientVersion="0.0.0";if(nav.plugins&&nav.plugins.length){for(i=0,l=nav.plugins.length;i<l;i++){if(nav.plugins[i].name.toLowerCase().indexOf("shockwave flash")!=-1){clientVersion=nav.plugins[i].description.toLowerCase().replace(/shockwave flash\s?/,"").split(" ")[0];isFlashed=true;break}}}else if(window.ActiveXObject){for(i=11;i>=1;i--){try{if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i)){clientVersion=i+".0";isFlashed=true;break}}catch(ex){}}}if(isFlashed){this._detectVersion(clientVersion)}else{this.onUninstalled&&this.onUninstalled.call(this)}},_detectVersion:function(clientVersion){var cvs=this._getFormatVersion(clientVersion).split("."),vs=this._getFormatVersion(this.version).split("."),i,l=vs.length;for(i=0;i<l;i++){if(+cvs[i]>+vs[i]){this.onSuccess&&this.onSuccess.call(this);return}else{if(+cvs[i]<+vs[i]){this.onVersionLower&&this.onVersionLower.call(this,clientVersion);return}}}this.onSuccess&&this.onSuccess.call(this)},_getFormatVersion:function(ver){var v=ver+"";v.indexOf(".")==-1&&(v+=".0.0");v.split(".").length<3&&(v+=".0");return v},onVersionLower:function(clientVersion){},onUninstalled:function(){},onSuccess:function(){}});Lib.flashComponent.FlashContianer=function(cfg){this._initCfg(cfg);this._flashDetector=new Lib.FlashDetector(this.flashCfg.version);this._detect()}.$define({flashCfg:{url:"",width:0,height:0,containerID:"divContainer",flashID:"flashID",flashVar:"",version:"9",wmode:"transparent",allowScriptAccess:"always"},rerender:function(){this._initFlash()},_renderText:["#{reason}，为了能够正常显示，请您 ",'<a target="_blank" href="http://get.adobe.com/cn/flashplayer/">','<img src="http://simg.sinajs.cn/blog7style/images/common/baby/flash.png">',"下载最新版本","</a>","。"].join(""),_flash:null,_falshEntity:null,_flashDetector:null,_initFlash:function(){this._addFlash();this._initFlashEntity()},_detect:function(){var fd=this._flashDetector,me=this;fd.onSuccess=function(){me._initFlash()};fd.onUninstalled=function(){me._renderUninstalled()};fd.onVersionLower=function(clientVersion){me._renderVersionLower()};fd.detect()},_renderVersionLower:function(){$E(this.flashCfg.containerID).innerHTML=this._renderText.replace(/\#\{reason\}/g,"您的Flash播放器版本过低")},_renderUninstalled:function(){$E(this.flashCfg.containerID).innerHTML=this._renderText.replace(/\#\{reason\}/g,"您的浏览器未安装Flash播放器")},_initCfg:function(cfg){var k;for(k in this.flashCfg){typeof cfg[k]!="undefined"&&(this.flashCfg[k]=cfg[k])}},_addFlash:function(){var fc=this.flashCfg,me=this;this._flash=new Utils.Flash.swfObject(fc.url,fc.flashID,fc.width,fc.height,fc.version,"#ffffff");this._flash.addParam("allowScriptAccess",fc.allowScriptAccess);this._flash.addParam("wmode",fc.wmode);this._flash.addParam("flashVars",fc.flashVar);this._flash.write(fc.containerID)},_initFlashEntity:function(){this._flashEntity=$IE?window[this.flashCfg.flashID]:document[this.flashCfg.flashID]}});Lib.flashComponent.HeadPhoto=function(cfg){}.$extends(Lib.flashComponent.FlashContianer).$define({setMaskPosition:function(x,y){x=isNaN(x)?0:x;y=isNaN(y)?0:y;this._flashEntity.setMaskPosition&&this._flashEntity.setMaskPosition(x,y)},setPhotoURL:function(url){this._flashEntity.setPhotoURL&&this._flashEntity.setPhotoURL(url)},getPhotoURL:function(url){if(this._flashEntity.getPhotoURL){return this._flashEntity.getPhotoURL()}},setPhotoPosition:function(x,y){x=isNaN(x)?0:x;y=isNaN(y)?0:y;this._flashEntity.setPhotoPosition&&this._flashEntity.setPhotoPosition(x,y)},setPhotoZoom:function(zoom){zoom=isNaN(zoom)?1:zoom;this._flashEntity.setPhotoZoom&&this._flashEntity.setPhotoZoom(zoom)},setPhotoAngle:function(angle){angle=isNaN(angle)?0:angle;this._flashEntity.setPhotoAngle&&this._flashEntity.setPhotoAngle(angle)}});Lib.flashComponent.HeadPhotoEditorConfig={t3_34:{middlePointX:350,middlePointY:100,maskX:108,maskY:0,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_34.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_34.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"},t3_35:{middlePointX:200,middlePointY:100,maskX:6,maskY:0,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_35.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_35.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"},t3_36:{middlePointX:300,middlePointY:120,maskX:131,maskY:23,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_36.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_36.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"},t3_37:{middlePointX:230,middlePointY:100,maskX:71,maskY:0,maskURL:"http://simg.sinajs.cn/blog7swf/baby/mask3_37.swf",frameURL:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/frame3_37.png",defaultPhoto:"http://simg.sinajs.cn/blog7style/images/bring/baby_flashResource/babyPhoto.png"}};$registJob("baby_headPhoto",function(){var headPhotoInfo=scope.UserBabyPic||{},headFlash=$E("headflash"),babyTpls=scope.babyTpl_conf||["3_34","3_35","3_36","3_37"];scope.renderHeadPhoto=function(tpl){if(!headFlash){return}headFlash.style.display="";var cfg=Lib.flashComponent.HeadPhotoEditorConfig["t"+tpl]||Lib.flashComponent.HeadPhotoEditorConfig["t3_34"];scope.headPhoto=new Lib.flashComponent.HeadPhoto({url:$_GLOBAL.flashBasicURL+"baby/headPhoto.swf",width:540,height:285,containerID:"headflash",flashID:"flashHeadPhoto",flashVar:["maskURL=",cfg.maskURL,"&maskX=",cfg.maskX,"&maskY=",cfg.maskY,"&middlePointX=",cfg.middlePointX,"&middlePointY=",cfg.middlePointY,"&photoURL=",headPhotoInfo.photoURL||cfg.defaultPhoto,"&photoX=",headPhotoInfo.photoX||0,"&photoY=",headPhotoInfo.photoY||0,"&photoZoom=",headPhotoInfo.zoom||1,"&photoAngle=",headPhotoInfo.angle||0].join("")})};for(var i=0,l=babyTpls.length;i<l;i++){if(babyTpls[i]==scope.tpl){scope.renderHeadPhoto(scope.tpl);break}}});$registJob("baby_babyBarFlashDetect",function(){var divBabyBayFlash=$E("divBabyBarFlash"),fd=new Lib.FlashDetector("9.0.0"),text=["#{reason}，为了能够正常显示，请您 ",'<a target="_blank" href="http://get.adobe.com/cn/flashplayer/">','<img src="http://simg.sinajs.cn/blog7style/images/common/baby/flash.png">',"下载最新版本","</a>","。"].join("");fd.onUninstalled=function(){divBabyBayFlash&&(divBabyBayFlash.innerHTML=text.replace(/\#\{reason\}/g,"您的浏览器未安装Flash播放器"))};fd.onVersionLower=function(clientVersion){divBabyBayFlash&&(divBabyBayFlash.innerHTML=text.replace(/\#\{reason\}/g,"您的Flash播放器版本过低"))};fd.detect()});$registJob("quote",function(){$E("quote_set_sign")&&(scope.article_quote=new Quote("quote_set_sign"));$E("quote_set_sign2")&&(scope.article_quote=new Quote("quote_set_sign2"));if(!$E("quote_set_sign")&&!$E("quote_set_sign2")){!scope.article_quote&&(scope.article_quote=new Quote);scope.articel_quote_alert=function(articleID){scope.article_quote.check(articleID)}}});var QuoteList=Core.Class.create();QuoteList.prototype={saving:false,articleID:"",pageCount:0,initialize:function(target_id,container_id){this.container_id=container_id;this.articleID=scope.$articleid||"";this.initInterface();this.bindEvent(target_id);$E(this.container_id)&&this.initHtml()},bindEvent:function(ele_id){var me=this;if($E(ele_id)){Core.Events.addEvent($E(ele_id),function(){me.show()})}},initInterface:function(){this.addInterface=new Interface("http://control.blog.sina.com.cn/myblog/htmlsource/quotelist.php","jsload");this.delInterface=new Interface("http://control.blog.sina.com.cn/admin/article/article_quote_del.php","jsload")},show:function(articleID,container_id,pageCount){this.pageCount=pageCount||scope.$x_quote_c||0;container_id&&(this.container_id=container_id);if(!this.container_id){return}this.articleID=articleID||scope.$articleid;container_id&&(this.container_id=container_id);if($E(this.container_id)&&$E(this.container_id).innerHTML.replace(/\s/g,"")===""){this.initHtml()}if(this.isShow){this.hidden();return}$E(this.container_id).style.display="block";this.loadData();this.isShow=true},hidden:function(){$E(this.container_id).style.display="none";this.isShow=false},initHtml:function(){var ele=$E(this.container_id);if(ele){var aID=this.articleID||"";var html='<h3><a href="#" onclick="return false" title="关闭" id="ql_close'+aID+'" class="blogzz_closepic SG_floatR"></a>转载列表：</h3>                <ul class="ul_zzlist" id="ql_content'+aID+'">                </ul>				<ul style="display:none"><li id="ql_tip'+aID+'"></li></ul>                <div class="SG_clearB"></div>                <div class="blogzz_btn">					<a id="btnArticleQuote'+aID+'" href="#" onclick="scope.article_quote && scope.article_quote.check(\''+aID+'\');return false;" class="SG_aBtn SG_aBtn_ico SG_turn"><cite><img class="SG_icon SG_icon111" id="quoteList_quote'+aID+'" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" align="absmiddle" />转载</cite></a>					<p id="quoteDescription'+aID+'" class="SG_turntxt">转载是分享博文的一种常用方式...</p>				</div>				<div id="ql_page'+aID+'" class="blogzz_paged"></div>				<div class="clearit"></div>';ele.innerHTML=html;var _this=this;Lib.checkAuthor(function(){$E("btnArticleQuote"+aID)&&($E("btnArticleQuote"+aID).style.display=$isAdmin?"none":"");$E("quoteDescription"+aID)&&($E("quoteDescription"+aID).style.display=$isAdmin?"":"none");Core.Events.addEvent($E("ql_close"+aID),_this.hidden.bind2(_this))},"quote_list"+(new Date).getTime())}},setTip:function(type){var aID=this.articleID||"";var ele=$E("ql_tip"+aID);var ele_lst=$E("ql_content"+aID);if(type!="ok"){ele.innerHTML="暂无转载。";ele_lst.style.display="none";ele.parentNode.style.display="block"}else{ele.parentNode.style.display="none";ele_lst.style.display="block"}},loadData:function(page){var me=this;var page=page||1;var param={blogid:me.articleID,version:7,page:page};this.addInterface.request({GET:param,onSuccess:function(_data){if(_data.length>0){this.setTip("ok");this.parseData(_data);this.page(page)}else{this.setTip()}}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},parseData:function(data){var aID=this.articleID||"";var html="";var len=data.length;for(var i=0;i<len;i++){html+=this.buildListHtml(data[i])}$E("ql_content"+aID).innerHTML=html;scope.quoteList_quote=new Quote("quoteList_quote"+aID)},page:function(pageNum){var aID=this.articleID||"";var count=this.pageCount;var maxPage=Math.ceil(count/10,10);if(maxPage>1){Ui.Pagination.init({pageNode:"ql_page"+aID,nodeClassNamePrefix:"SG",curPage:pageNum,maxPage:maxPage,pageTpl:this.loadData.bind2(this),type:3}).show()}else{$E("ql_page"+aID).innerHTML=""}},buildListHtml:function(data){if($isAdmin){data.isShow=""}else{data.isShow="none"}var html=['<li id="pl_#{rp_blogid}">','<p class="blogzz_pinfo SG_txtb SG_floatL">','<a target="_blank" href="http://blog.sina.com.cn/u/#{rp_bloguid}">#{rp_bloguname}</a>','<span class="zzlist_mleft zzlist_mright">等级<em class="SG_txtc">(#{rp_ugrade})</em></span>','<span class="zzlist_mleft">转载了此文：</span><a target="_blank" href="http://blog.sina.com.cn/s/blog_#{rp_blogid}.html">#{rp_blogtitle}</a>',"</p>",'<p class="SG_floatR">','<em class="SG_txtc">#{rp_blogpubdate}</em>','<a href="#" style="display:#{isShow}" class="CP_a_fuc" onclick="scope.article_quoteList.del(\'#{rp_blogid}\',\''+this.articleID+'\');return false;">[<cite id="pl_del_#{rp_bloguid}">删除</cite>]</a>',"</p>","</li>"].join("");data.rp_ugrade=data.rp_ugrade.toString();return new Ui.Template(html).evaluate(data)},del:function(blogid,articleID){var me=this;var param={sblog_id:scope.$articleid||articleID,version:7,blog_id:blogid},me=this;$E("quote_sign_count")&&($E("quote_sign_count").innerHTML=+$E("quote_sign_count").innerHTML-1);Core.Dom.removeNode($E("pl_"+blogid));var aID=me.articleID||"";if($E("ql_content"+aID)&&$E("ql_content"+aID).getElementsByTagName("li").length==0){me.setTip()}this.delInterface.request({GET:param,onSuccess:function(_data){me.onDeleted()}.bind2(this),onError:function(_data){showError(_data.code)},onFail:function(){}})},onDeleted:function(){}};$registJob("quote_list",function(){var node=$E("z_"+scope.$articleid);if($E("quote_sign")){scope.article_quoteList=new QuoteList("quote_sign","blog_quote")}else if(node){scope.article_quoteList=new QuoteList("z_"+scope.$articleid,"blog_quote");node.innerHTML=="(0)"&&(node.style.display="none")}});Core.String.StringBuffer=function(){this.buffer=[]};Core.String.StringBuffer.prototype.append=function(str){this.buffer.push(str);return this};Core.String.StringBuffer.prototype.toString=function(){return this.buffer.join("")};$SYSMSG.extend({B00901:"投票不存在。",B00902:"投票已截止。",B00903:"超出允许投票个数。",B00904:"你已投过票了!<br/>重复投票是没有意义的。",B00905:"投票主题过短<br/>至少要5个汉字或10个字符！",B00906:"投票选项至少要填写2项",B00907:"投票的截止时间不能小于当前时间，请重新选择 ",B00908:"投票选项最多可填写7项",B00909:"投票主题不能为空"});if(typeof infosoftglobal=="undefined")var infosoftglobal=new Object;if(typeof infosoftglobal.FusionChartsUtil=="undefined")infosoftglobal.FusionChartsUtil=new Object;infosoftglobal.FusionCharts=function(swf,id,w,h,debugMode,registerWithJS,c,scaleMode,lang,detectFlashVersion,autoInstallRedirect){if(!document.getElementById){return}this.initialDataSet=false;this.params=new Object;this.variables=new Object;this.attributes=new Array;if(swf){this.setAttribute("swf",swf)}if(id){this.setAttribute("id",id)}debugMode=debugMode?debugMode:0;this.addVariable("debugMode",debugMode);w=w.toString().replace(/\%$/,"%25");if(w){this.setAttribute("width",w)}h=h.toString().replace(/\%$/,"%25");if(h){this.setAttribute("height",h)}if(c){this.addParam("bgcolor",c)}this.addParam("quality","high");this.addParam("allowScriptAccess","always");this.addVariable("chartWidth",w);this.addVariable("chartHeight",h);this.addVariable("DOMId",id);registerWithJS=registerWithJS?registerWithJS:0;this.addVariable("registerWithJS",registerWithJS);scaleMode=scaleMode?scaleMode:"noScale";this.addVariable("scaleMode",scaleMode);lang=lang?lang:"EN";this.addVariable("lang",lang);this.detectFlashVersion=detectFlashVersion?detectFlashVersion:1;this.autoInstallRedirect=autoInstallRedirect?autoInstallRedirect:1;this.installedVer=infosoftglobal.FusionChartsUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){infosoftglobal.FusionCharts.doPrepUnload=true}};infosoftglobal.FusionCharts.prototype={setAttribute:function(name,value){this.attributes[name]=value},getAttribute:function(name){return this.attributes[name]},addParam:function(name,value){this.params[name]=value},getParams:function(){return this.params},addVariable:function(name,value){this.variables[name]=value},getVariable:function(name){return this.variables[name]},getVariables:function(){return this.variables},getVariablePairs:function(){var variablePairs=new Array;var key;var variables=this.getVariables();for(key in variables){variablePairs.push(key+"="+variables[key])}return variablePairs},getSWFHTML:function(){var swfNode="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){swfNode='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'"  ';swfNode+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var params=this.getParams();for(var key in params){swfNode+=[key]+'="'+params[key]+'" '}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='flashvars="'+pairs+'"'}swfNode+="/>"}else{swfNode='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'">';swfNode+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var params=this.getParams();for(var key in params){swfNode+='<param name="'+key+'" value="'+params[key]+'" />'}var pairs=this.getVariablePairs().join("&");if(pairs.length>0){swfNode+='<param name="flashvars" value="'+pairs+'" />'}swfNode+="</object>"}return swfNode},setDataURL:function(strDataURL){if(this.initialDataSet==false){this.addVariable("dataURL",strDataURL);this.initialDataSet=true}else{var chartObj=infosoftglobal.FusionChartsUtil.getChartObject(this.getAttribute("id"));if(!chartObj.setDataURL){__flash__addCallback(chartObj,"setDataURL")}chartObj.setDataURL(strDataURL)}},encodeDataXML:function(strDataXML){var regExpReservedCharacters=["\\$","\\+"];var arrDQAtt=strDataXML.match(/=\s*\".*?\"/g);if(arrDQAtt){for(var i=0;i<arrDQAtt.length;i++){var repStr=arrDQAtt[i].replace(/^=\s*\"|\"$/g,"");repStr=repStr.replace(/\'/g,"%26apos;");var strTo=strDataXML.indexOf(arrDQAtt[i]);var repStrr="='"+repStr+"'";var strStart=strDataXML.substring(0,strTo);var strEnd=strDataXML.substring(strTo+arrDQAtt[i].length);var strDataXML=strStart+repStrr+strEnd}}strDataXML=strDataXML.replace(/\"/g,"%26quot;");strDataXML=strDataXML.replace(/%(?![\da-f]{2}|[\da-f]{4})/gi,"%25");strDataXML=strDataXML.replace(/\&/g,"%26");return strDataXML},setDataXML:function(strDataXML){if(this.initialDataSet==false){this.addVariable("dataXML",this.encodeDataXML(strDataXML));this.initialDataSet=true}else{var chartObj=infosoftglobal.FusionChartsUtil.getChartObject(this.getAttribute("id"));chartObj.setDataXML(strDataXML)}},setTransparent:function(isTransparent){if(typeof isTransparent=="undefined"){isTransparent=true}if(isTransparent)this.addParam("WMode","transparent");else this.addParam("WMode","Opaque")},render:function(elementId){if(this.detectFlashVersion==1&&this.installedVer.major<8){if(this.autoInstallRedirect==1){var installationConfirm=window.confirm("You need Adobe Flash Player 8 (or above) to view the charts. It is a free and lightweight installation from Adobe.com. Please click on Ok to install the same.");if(installationConfirm){window.location="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash"}else{return false}}else{return false}}else{var n=typeof elementId=="string"?document.getElementById(elementId):elementId;if(this.getVariable("scaleMode").search(/noscale/i)>=0&&(this.getAttribute("width").search("%")>0||this.getAttribute("height").search("%")>0)){var obj=this;if(window.addEventListener){window.addEventListener("load",function(){n.innerHTML=obj.getSWFHTML()},false)}else if(window.attachEvent){window.attachEvent("onload",function(){n.innerHTML=obj.getSWFHTML()})}else{n.innerHTML=this.getSWFHTML()}}else{n.innerHTML=this.getSWFHTML()}if(!document.embeds[this.getAttribute("id")]&&!window[this.getAttribute("id")])window[this.getAttribute("id")]=document.getElementById(this.getAttribute("id"));return true}}};infosoftglobal.FusionChartsUtil.getPlayerVersion=function(){var PlayerVersion=new infosoftglobal.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){PlayerVersion=new infosoftglobal.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);PlayerVersion=new infosoftglobal.PlayerVersion([counter,0,0])}catch(e){axo=null}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");PlayerVersion=new infosoftglobal.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always"}catch(e){if(PlayerVersion.major==6){return PlayerVersion}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(axo!=null){PlayerVersion=new infosoftglobal.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","))}}return PlayerVersion};infosoftglobal.PlayerVersion=function(arrVersion){this.major=arrVersion[0]!=null?parseInt(arrVersion[0]):0;this.minor=arrVersion[1]!=null?parseInt(arrVersion[1]):0;this.rev=arrVersion[2]!=null?parseInt(arrVersion[2]):0};infosoftglobal.FusionChartsUtil.cleanupSWFs=function(){var objects=document.getElementsByTagName("OBJECT");for(var i=objects.length-1;i>=0;i--){objects[i].style.display="none";for(var x in objects[i]){if(typeof objects[i][x]=="function"){objects[i][x]=function(){}}}}};if(infosoftglobal.FusionCharts.doPrepUnload){if(!infosoftglobal.unloadSet){infosoftglobal.FusionChartsUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",infosoftglobal.FusionChartsUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",infosoftglobal.FusionChartsUtil.prepUnload);infosoftglobal.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id]}}if(Array.prototype.push==null){Array.prototype.push=function(item){this[this.length]=item;return this.length}}infosoftglobal.FusionChartsUtil.getChartObject=function(id){var chartRef=null;if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[id])chartRef=document.embeds[id];else chartRef=window.document[id]}else{chartRef=window[id]}if(!chartRef)chartRef=document.getElementById(id);return chartRef};var getChartFromId=infosoftglobal.FusionChartsUtil.getChartObject;var FusionCharts=infosoftglobal.FusionCharts;var voteValues=[];RenderFlash=Core.Class.create();RenderFlash.prototype={flashId:null,data:null,current:null,eventDom:null,_labels:null,selected:[],initialize:function(){this.eventDom={tab:$E("tabDiv")?$E("tabDiv"):null,line:$E("lineView")?$E("lineView"):null,pie:$E("pieView")?$E("pieView"):null,column:$E("columnView")?$E("columnView"):null,content:$E("voteViewContent")?$E("voteViewContent"):null};this._refreshFlashId();this._addClickEvent(this.eventDom.line);this._addClickEvent(this.eventDom.pie);this._addClickEvent(this.eventDom.column);this.combineData()},showTab:function(flashType,flashId,parentId){if(this.current==flashType)return;var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}window.clearAllInterval();if(flashType=="line"){this.current="line";$E("voteViewContent").innerHTML=window.vote_cache_content_html;window.renderVoteNum();var items=document.getElementsByName("chb1");for(var j=0;j<items.length;j++){items[j].disabled="true";try{items[j].parentNode.childNodes[3].style.cursor="default"}catch(error){}}}else if(flashType=="Pie3D.swf"){this.current="Pie3D.swf";var html=this._tabTemplate.chooses.join("");var uls="";for(var i=0;i<this._labels.length;i++){var itemTpl=this._tabTemplate.item.join("");itemTpl=itemTpl.replace("#{type}",window.vote_rc_type+"");itemTpl=itemTpl.replace(/([#][{]index[}])/gi,i+1);itemTpl=itemTpl.replace("#{text}",this._labels[i]);uls+=itemTpl}html=html.replace("#{uls}",uls);html+=this._tabTemplate.flash.join("");this.eventDom["content"].innerHTML=html;var height=this._labels.length*30;if(height<150)height=150;var xml="<chart baseFontSize='12' baseFontColor='888888' numberSuffix='%25' showAboutMenuItem='0' decimals='2' chartTopMargin='0' chartBottomMargin='0' caption='' showValues='0' formatNumberScale='0' bgColor='99CCFF,FFFFFF' bgAlpha='0,0' startingAngle='60'>";for(var i=0;i<this.data.length;i++){var item=this.data[i];if(this.selected[i]!=null){xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' displayValue='"+Core.String.shorten(this._labels[i],7,"…")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' isSliced='1' />"}else{xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' displayValue='"+Core.String.shorten(this._labels[i],7,"…")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' />"}}xml+="</chart>";var chart=new FusionCharts($_GLOBAL.flashBasicURL+"Pie3D.swf",flashId,"360",height,"0","0");chart.setDataXML(xml);chart.setTransparent(true);chart.render(parentId)}else if(flashType=="Column3D.swf"){this.current="Column3D.swf";var html=this._tabTemplate.chooses.join("");var uls="";for(var i=0;i<this._labels.length;i++){var itemTpl=this._tabTemplate.item.join("");itemTpl=itemTpl.replace("#{type}",window.vote_rc_type+"");itemTpl=itemTpl.replace(/([#][{]index[}])/gi,i+1);itemTpl=itemTpl.replace("#{text}",this._labels[i]);uls+=itemTpl}html=html.replace("#{uls}",uls);html+=this._tabTemplate.flash.join("");this.eventDom["content"].innerHTML=html;var height=this._labels.length*30;if(height<150)height=150;var xml="<chart baseFontSize='12' baseFontColor='888888' showValues='1' outCnvBaseFontColor='999999' outCnvBaseFontSize='12' numberSuffix='%25' showAboutMenuItem='0' decimals='2' yAxisMaxValue='100' palette='2' enableRotation='1' canvasBgColor='ffffff' canvasBgAlpha='0' canvasBgDepth='3' canvasBaseColor='ffffff' divLineColor='d8d8d8' numDivLines='4' bgAlpha='0' divLineColor='d8d8d8' canvasPadding='8' chartLeftMargin='0' chartRightMargin='5' chartTopMargin='5' chartBottomMargin='0' maxColWidth='70' showValues='0'><styles><definition><style name='myToolTip' type='font' size='12' color='666666' /></definition><application><apply toObject='ToolTip' styles='myToolTip' /></application></styles>";for(var i=0;i<this.data.length;i++){var item=this.data[i];xml+="<set label='"+(i+1)+"' value='"+voteValues[i].replace("%","")+"' toolText='"+this._labels[i]+"("+voteValues[i]+")' />"}xml+="</chart>";var chart=new FusionCharts($_GLOBAL.flashBasicURL+"Column3D.swf",flashId,"360",height,"0","0");chart.setDataXML(xml);chart.setTransparent(true);chart.render(parentId)}if($E("flashContent"))$E("flashContent").style.padding="13px 0 0 "},_refreshFlashId:function(){this.flashId=Core.Math.getUniqueId()},_addClickEvent:function(dom){var _this=this;if(dom){dom.onclick=function(){_this._onClickHandler(this)}}},_onClickHandler:function(dom){var _this=this;function updateTabStatus(type){_this.eventDom["line"].parentNode.className="";_this.eventDom["pie"].parentNode.className="";_this.eventDom["column"].parentNode.className="";_this.eventDom[type].parentNode.className="cur SG_txtb"}if(dom!=null){var id=dom.id;if(id=="lineView"){this.showTab("line","lineId","voteViewContent");updateTabStatus("line")}else if(id=="pieView"){this.showTab("Pie3D.swf","Pie3D_"+this.flashId,"flashContent");updateTabStatus("pie")}else if(id=="columnView"){this.showTab("Column3D.swf","Column3D_"+this.flashId,"flashContent");updateTabStatus("column")}}},combineData:function(changeData){this.data=[];var labels=this._getLabel();for(var i=0;i<labels.length;i++){this.data[this.data.length]={label:labels[i],num:window.vote_count.detail[i]}}},_getLabel:function(){var labels=[];var spans=Core.Dom.getElementsByClass($E("voteViewContent"),"span","");var length=spans.length;for(var i=0;i<length;i++){labels[labels.length]=spans[i].innerHTML}this._labels=labels;return labels},_tabTemplate:{chooses:['<div class="vContentRe">',"<ul>","#{uls}","</ul>","</div>"],item:['<li class="clearfix">','<div class="choosed">','<input type="#{type}" disabled="disabled" id="chb#{index}"/><label for="chb#{index}" style="cursor:default"><em>#{index}.</em><span>#{text}</span></label>',"</div>","</li>"],flash:['<div id="flashContent" class="vContentPic">',"</div>"]}};!function(_){_.rf=null;_.changeType=function(flag){$E("mutiple").style.display=flag?"":"none";$E("voteType").value=flag?$E("mutiple").value:1};_.checkNum=function(self,mutipleNum){var chks=document.getElementsByName("chb1");var chkedNum=0;for(var i=0;i<chks.length;i++){var chk=chks[i];if(chk.checked){chkedNum++}}if(chkedNum>mutipleNum){winDialog.alert("最多只能选"+mutipleNum+"项！",{icon:"01"});self.checked=false}};_.isExpired=function(sDate){return sDate.replace(/(-)|\s/g,"")<getTimestamp("yyyy-MM-dd hh").replace(/(-)|\s/g,"")};_.getTimestamp=function(format){var currentTime=new Date;var thisYear=currentTime.getFullYear();var thisMonth=currentTime.getMonth()+1;thisMonth=thisMonth>9?thisMonth:"0"+thisMonth;var today=currentTime.getDate()>9?currentTime.getDate():"0"+currentTime.getDate();var hh=currentTime.getHours();var mm=currentTime.getMinutes()>9?currentTime.getMinutes():"0"+currentTime.getMinutes();var ss=currentTime.getSeconds()>9?currentTime.getSeconds():"0"+currentTime.getSeconds();return format.replace(/(y{2,4})/,thisYear).replace("MM",thisMonth).replace("dd",today).replace("hh",hh).replace("mm",mm).replace("ss",ss)};_.readyFun=function(){var uid;var isVoted=false;var _this=this;Lib.checkAuthor(function(){if($isLogin)uid=$UID;else uid="0";var mycookie=swfAPI.getC(uid);if(mycookie){var cookielist=mycookie.split("|");for(var i=0;i<cookielist.length;i++){var onecookie=cookielist[i];if(onecookie==scope.$articleid){isVoted=true;break}}}if(!isVoted){Core.Events.addEvent("voteBtn",function(){var items=$T($E("voteViewContent"),"input");var selectedItems=[];for(var i=0;i<items.length;i++){var item=items[i];if(item.checked&&item.name&&item.name=="chb1"){selectedItems.push(i+1)}}if(selectedItems.length<1){winDialog.alert("请选择要投票的项！",{icon:"01"});return false}Lib.checkAuthor(function(){if($isLogin)uid=$UID;else uid="0";function setFlashCookie(){try{var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}if(mycookie){if(cookielist.length>99){swfAPI.clearK(uid)}else mycookie=scope.$articleid+"|"+mycookie}else{mycookie=scope.$articleid}swfAPI.setC(uid,mycookie.toString())}catch(e){Debug.error("投票种flash cookie失败！错误原因："+e)}}_this.flag=true;var selectedLen=selectedItems.length;new Interface("http://control.blog.sina.com.cn/admin/vote/shot_vote.php?version=7","ijax").request({POST:{blog_id:scope.$articleid,vote_checklist:selectedItems.join(",")},onSuccess:function(res){setFlashCookie();try{var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';clearAllInterval()}catch(error){}window.vote_count.total+=1;var spans=Core.Dom.getElementsByClass($E("voteViewContent"),"span","");var tempArr=[];for(var m=0;m<selectedLen;m++){var item=selectedItems[m];window.vote_count.detail[item-1]+=1;tempArr.push(spans[item-1].innerHTML)}var newItem={};newItem.uid=$UID;var time=(new Date).getTime();time/=1e3;time=Math.ceil(time);newItem.time=time;newItem.vote=tempArr;var tempResult=window.vote_interface_result;var tempRArr=[];for(var i=0;i<tempResult.length;i++){tempRArr[i+1]=tempResult[i]
}tempRArr[0]=newItem;window.vote_interface_result=tempRArr;renderVoteNum();initLoginBar()},onError:function(res){try{winDialog.alert($SYSMSG[res.code]);if(res.code=="B00902"){var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">投票已截止</span>';var voteItems=$N("chb1");for(var i=0;i<voteItems.length;i++){voteItems[i].disabled=true;try{voteItems[i].parentNode.childNodes[3].style.cursor="default"}catch(error){}}var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}}else if(res.code=="B00904"){if(!isVoted){setFlashCookie()}var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';var voteItems=$N("chb1");for(var i=0;i<voteItems.length;i++){voteItems[i].disabled=true;try{voteItems[i].parentNode.childNodes[3].style.cursor="default"}catch(error){}}}}catch(error){}}})},"domEventreadyFun"+(new Date).getTime())},"click",false)}else{var btn=Core.Dom.getElementsByClass(document,"div","vBtn")[0];Core.Dom.removeParentNode($E("voteBtn"));btn.innerHTML='<span class="voteState">已投票</span>';var items=document.getElementsByName("chb1");for(var j=0;j<items.length;j++){items[j].disabled="true";try{if($IE){items[j].parentNode.childNodes[2].style.cursor="default"}else{items[j].parentNode.childNodes[3].style.cursor="default"}}catch(error){}}var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display=""}}},"domEventreadyFun"+(new Date).getTime())};_.swfAPI={setC:function(key,value){$E("swfId").setC(key,value)},getC:function(key){return $E("swfId").getC(key)},clearK:function(key){$E("swfId").clearK(key)},clearC:function(){$E("swfId").clearC()}};_.insertList=function(oResult){function getLocTime(nS){var date=new Date(nS*1e3);return date.getFullYear()+"-"+(date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+(date.getMinutes()<10?"0"+date.getMinutes():date.getMinutes())}var tpl='<li><span class="SG_dot"></span><span class="txt"><a target="_blank" href="#{url}">#{nick}</a>#{userV}&nbsp;<span class="SG_txtb">投票给 #{vote}</span><em class="SG_txtc">#{time}</em></span></li>';var list="";var getVHTML=Lib.blogv.getVHTML;if(this.vote_interface_result){for(var i=0;i<vote_interface_result.length;i++){var item=vote_interface_result[i];var html=tpl;html=html.replace("#{url}","http://blog.sina.com.cn/u/"+item["uid"]);html=html.replace("#{nick}",oResult[item["uid"]]);html=html.replace("#{userV}",getVHTML(item["wtype"]));html=html.replace("#{time}",getLocTime(item["time"]));var con="";for(var j=0;j<item["vote"].length;j++){con+='"'+item["vote"][j]+'" '}html=html.replace("#{vote}",con);list+=html;if(i==10){break}}if($E("voterlist")){$E("voterlist").innerHTML=list}}};_.initLoginBar=function(){Lib.checkAuthor(function(){if($E("vote_login_txt")){if($isLogin){$E("vote_login_txt").style.display="none"}else{$E("vote_login_txt").style.display="";$E("vote_login").onclick=function(){var trayLogin=new Lib.Login.Ui;trayLogin.login()}}}},"domEvent"+(new Date).getTime())};_.initNewVote=function(){Lib.checkAuthor();if($E("voteAD")){$E("voteAD").innerHTML='<a class="SG_linka"><img height="15" align="top" width="15" class="SG_icon SG_icon33" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" title="投票"></a>&nbsp;<a target="_blank" href="http://control.blog.sina.com.cn/admin/article/article_add.php#voteadd">发起新投票</a>&nbsp;&nbsp;&nbsp;<a class="SG_linka"><img height="18" align="top" width="18" title="" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon110"></a>&nbsp;<a href="#" id="shareVote">分享此投票</a>';$E("shareVote").onclick=function(){var title=encodeURIComponent("分享投票："+$T($E("voter"),"span")[0].innerHTML+"——来自"+scope.owenerNickName+"的博文："+Core.Dom.byClz(document.body,"h2","titName")[0].innerHTML||""),r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";window.open(u,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);return false}}var morevotediv=$E("cc_morevote");if(!morevotediv){morevotediv=$C("div");morevotediv.id="cc_morevote";morevotediv.className="voteapp_btnMore";morevotediv.innerHTML='<a href="http://control.blog.sina.com.cn/blogprofile/profilevote.php?type=1" target="blank" title="查看更多投票">查看更多投票&gt;&gt;</a><img class="SG_icon SG_icon11" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="新" align="absmiddle" />';$E("voterlist").parentNode.parentNode.appendChild(morevotediv)}};_.renderVoteNum=function(){var uidList=[];var result=window.vote_interface_result;for(var i=0;i<result.length;i++){var item=result[i];uidList[uidList.length]=item["uid"]}Lib.Uic.getNickName(uidList,insertList);this.initNewVote();var temp=$E("chb1");if(temp!=null&&temp.type=="radio"){window.vote_rc_type="radio"}else{window.vote_rc_type="checkbox"}this.valueContents=Core.Dom.getElementsByClass($E("voter"),"div","num");var total=0;voteValues=[];var k;var counts=window.vote_count.detail;var total=window.vote_count.total;$E("total").innerHTML=total+"人";var totalTickets=0;for(var j=0;j<counts.length;j++){totalTickets+=counts[j]}for(k=0;k<valueContents.length;k++){var itemVote=counts[k];if(totalTickets==0){var percent="0%"}else{if(Math.round(itemVote/totalTickets*100)>100){var percent="100%"}else{var percent=Math.round(itemVote/totalTickets*100)+"%"}}voteValues.push(percent);valueContents[k].innerHTML=itemVote+'<span class="SG_txtc">('+percent+")</span>"}renderProgress(voteValues)};_.renderProgress=function(voteValues){window.itvIds=[];var i;var valueBars=Core.Dom.getElementsByAttr($E("voter"),"name","voteResult");var valueContents=Core.Dom.getElementsByClass($E("voter"),"div","num");var percentW=[];for(i=0;i<valueContents.length;i++){/\((.*)\)/.test(valueContents[i].innerHTML);percentW[i]=RegExp.$1}for(i=0;i<valueBars.length;i++){valueBars[i].className="color c"+(i+1);valueBars[i].style.fontSize="8px";valueBars[i].style.width="0px";window.itvIds[i]=window.setInterval(function(idx){return function(){if(parseInt(valueBars[idx].style.width)<parseInt(percentW[idx])){valueBars[idx].style.width=parseInt(valueBars[idx].style.width,10)+1+"%"}else{window.clearInterval(itvIds[idx])}}}(i),10)}if(!this.rf)_.rf=new RenderFlash};_.clearAllInterval=function(){if(window.itvIds){for(var i=0;i<window.itvIds.length;i++){window.clearInterval(itvIds[i])}}}}(window);$registJob("dynamicVoteView",function(){var optList=$E("voter");window.vote_progress_css=["1px solid #8d458e","1px solid #578425","1px solid #89ba00","1px solid #008d8e","1px solid #7da4cf","1px solid #d54545","1px solid #ff8d46","1px solid #f6bd0e","1px solid #008dd5","1px solid #b2aa01"];if($E("voterlist")){Lib.checkAuthor(function(){var isEscape="";try{isEscape=Core.Dom.getElementsByClass($E("voter"),"span","voteState")[0].innerHTML}catch(error){}Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/blog_rebuild/riaapi/blog/get_user_vote.php",{GET:{blog_id:scope.$articleid},onComplete:function(res){try{if(res.code=="A00006"){window.vote_cache_content_html=$E("voteViewContent")?$E("voteViewContent").innerHTML:"";window.vote_interface_result=res.data&&res.data.newten;window.vote_count=res.data&&res.data.count;renderVoteNum()}else{winDialog.alert(res.code,{icon:"02"});if($E("voterlist")&&$isLogin&&isEscape!="投票已截止"){$E("voterlist").innerHTML="还没有博主投票呢，赶紧抢个沙发吧。"}else if(isEscape=="投票已截止"){try{var flashBar=Core.Dom.getElementsByClass($E("voter"),"div","vShape")[0];if(flashBar){flashBar.style.display="none"}Core.Dom.getElementsByClass($E("module_920"),"div","newVoteList SG_j_linedot1")[0].style.display="none"}catch(error){}}else{if(!$isLogin)$E("voterlist").innerHTML="还没有博主投票呢，赶紧抢个沙发吧。";else $E("voterlist").innerHTML="加载中…"}}}catch(e){trace("vote error")}},noencode:true,onError:function(res){if($E("voterlist")){$E("voterlist").innerHTML="加载中…"}if(isEscape=="投票已截止"){try{Core.Dom.getElementsByClass($E("module_920"),"div","newVoteList SG_j_linedot1")[0].style.display="none"}catch(error){}}}})},"dynamicVoteView"+(new Date).getTime())}});!function(){var readyFunS="readyFun";function swfCookie(container,url,readyFun,swfID){var showFlash=function(){var FlashPlayer=new Utils.Flash.swfObject(url,swfID,"1","1","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.addVariable("readyFun",readyFun);FlashPlayer.write(container)};showFlash()}var random="";if(window.$Maxthon||window.$360||window.$TT){random="?uid="+Core.Math.getUniqueId(1,10)}swfCookie("swfbox",$_GLOBAL.flashBasicURL+"voteCookie.swf"+random,readyFunS,"swfId")}();$SYSMSG.extend({B03020:"博文已收藏成功！",B03002:"已达收藏数2000条上限，不能继续收藏。",B03004:"已收藏过此博文，不能重复收藏。",B03005:"确实要取消此收藏吗？",B03006:"确实要删除此博文吗？删除后可在“回收站”恢复。",B03007:"确实要删除此草稿吗？删除后不可恢复。",B03008:"确实要彻底删除此博文吗？删除后不可恢复。",B03010:"确实要替换已置顶的博文吗？",B03011:"确实要取消置顶吗？取消后可在“博文”页恢复。",B03014:"博文已成功置顶到首页！",B03015:"抱歉，您的博客尚未升级，请<a href='http://blog.sina.com.cn/u/#UID' target='_blank'>升级</a>后再“收藏” 。",S01107:"已收藏过此博文，不能重复收藏。",B03016:"是否要彻底删除此博文？博文删除后不可恢复，博文内图片如被其他博文引用也将无法显示。",B03017:"私密博文不能被收藏。",B119000:"对不起，您短时间点击收藏过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！"});$SYSMSG.extend({B00007:"跳转到自动开通页",B00008:"自动开通用户(跳转到假页)",B00009:"跳转到自动开通页",B00010:"无权限。 ",B00011:"抱歉，Blog ID 错误，操作无法完成。",B00012:"抱歉，可能因为重复操作而无法执行，请刷新本页再试。",B00013:"用户ID被封杀",B00014:"很抱歉，您输入的验证码不正确。",B04101:"请输入您的昵称！",B04102:"请正确输入您的邮件地址！",B04103:"请选择您举报信息的位置！",B04104:"请选择您举报的不良信息的类型！",B04105:"简单描述最多只能输入500个字符！",B04106:"再次感谢您帮助我们进行不良信息的验证工作，我们将认真仔细地处理您提交的内容。",B07006:"您已发的博文正在审查中，请稍后再发文"});App.ArticleMange=Core.Class.create();Core.Class.extend(App.ArticleMange.prototype,{initialize:function(sArticleId,oOption){for(var key in oOption){this[key]=oOption[key]}this.articleId=sArticleId;this.pretreat()},pretreat:function(){if(this.articleId==null){Debug.error("ArticleManage need the article id.");return}else{this.checkLogin();return this}},checkLogin:function(){var _this=this;Lib.checkAuthor(function(){_this.needLogin=_this.needLogin();Debug.log("checkLogin : "+_this.needLogin);var $login=function(callback){(new Lib.Login.Ui).login(callback)};var actionConfirm=Core.Function.bind2(_this.confirm,_this);if(_this.needLogin||!$isLogin){$login(actionConfirm)}else{actionConfirm()}},"ArticleManage"+(new Date).getTime())},confirm:function(){var _self=this;Lib.checkAuthor(function(){if(!$isLogin){$tray.renderLogin()}_self.needLogin=false;var tok=_self.textOk||"确定";var tca=_self.textCancel||"取消";if(_self.confirmMSG){winDialog.confirm(_self.confirmMSG,{funcOk:Core.Function.bind2(_self.doAction,_self),textOk:tok,textCancel:tca})}else{_self.doAction()}},"ArticleManage2"+(new Date).getTime())},doAction:function(){if($IE&&Core.Events.getEvent()){Core.Events.stopEvent()}var param={};for(var key in this.param){if(typeof this.param[key]=="function"){param[key]=Core.Function.bind2(this.param[key],this)()}else{param[key]=this.param[key]}}if(param.getType=="POST"){if(param.getType){delete param.getType}this.Interface.request({POST:param,onSuccess:this.callback||this.requestOk||function(){window.location.reload()},onError:this.requestError||function(oData){showError(oData.code)},onFail:function(){showError("A00001")}})}else{if(param.getType){delete param.getType}this.Interface.request({GET:param,onSuccess:this.callback||this.requestOk||function(){window.location.reload()},onError:this.requestError||function(oData){showError(oData.code)},onFail:function(){showError("A00001")}})}}});Lib.IframeDialog=Core.Class.create();Lib.IframeDialog.prototype={dialog:null,initialize:function(option){this.id=Core.Math.getUniqueId();this.option=option},initDialog:function(){var _this=this,this_option=this.option;var obj={ad:false,drag:true,tpl:this_option.tpl||_this.tpl,title:this_option.title,content:'<iframe frameborder="0" id="ifrDialog_'+_this.id+'" scrolling="no"></iframe>',renderer:Ui.SimpleRenderer,width:this_option.width,height:this_option.height};this.dialog=winDialog.createCustomsDialog(obj);this.dialog.setAreaLocked(true);var iframe=$E("ifrDialog_"+this.id);iframe.src=this_option.url;iframe.style.width=this_option.width+"px";iframe.style.height=this_option.height+"px";this_option.funcClose&&this.bindColseFunc()},tpl:'<table id="#{entity}" class="CP_w">'+'<thead id="#{titleBar}">'+"<tr>"+'<th class="tLeft"><span></span></th>'+'<th class="tMid">'+'<div class="bLyTop">'+'<strong id="#{titleName}">提示</strong>'+'<cite><a id="#{btnClose}" href="javascript:;" class="CP_w_shut" title="关闭">关闭</a></cite>'+"</div>"+"</th>"+'<th class="tRight"><span></span></th>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid"><span></span></td>'+'<td class="tRight"><span></span></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid" id="#{content}">'+"</td>"+'<td class="tRight"><span></span></td>'+"</tr>"+"</tbody>"+"</table>",reset:function(){if(this.dialog){this.hidden();var dialogParentNode=this.dialog.nodes.panel||this.dialog.nodes.entity;dialogParentNode.parentNode.removeChild(dialogParentNode);this.dialog=null}},bindColseFunc:function(){Core.Events.addEvent(this.dialog.nodes.btnClose,this.option.funcClose)},setSize:function(nWidth,nHeight){var ele=this.dialog.nodes.content.firstChild;this.dialog.setSize(nWidth,nHeight);ele.style.width=nWidth+"px";ele.style.height=nHeight+"px"},show:function(){this.reset();this.initDialog();this.dialog.show();this.dialog.setMiddle()},close:function(){this.dialog.hidden()}};Lib.AccountChecker=Core.Class.create();Lib.AccountChecker.prototype={initialize:function(ssoUrl){if(ssoUrl.indexOf("vt=1")>0||ssoUrl.indexOf("vt=2")>0){this.showDialog(ssoUrl)}else{window.location.href=ssoUrl}},showDialog:function(ssoUrl){document.domain="sina.com.cn";if(!window.accDialog){window.accDialog=new Lib.IframeDialog({url:ssoUrl,title:"账号安全",width:300,height:165});scope.accCallback=function(){window.accDialog.close()}}window.accDialog.show();var nodes=window.accDialog.dialog.nodes;var content=nodes.content;content.firstChild.style.marginLeft="25px";nodes.btnClose.style.display="none";var p=document.createElement("p");p.style.lineHeight="70px";p.innerHTML="　　为了您的账号安全，请输入验证码后再进行操作";content.insertBefore(p,content.firstChild)},hideDialog:function(){window.accDialog&&window.accDialog.hidden()}};App.deleteArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_del_recycle.php","ijax"),needLogin:function(){trace("检查用户");return!$isAdmin},confirmMSG:$SYSMSG.B03006,param:{getType:"POST","blog_id[]":function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()},requestError:function(oData){if(oData&&oData.code==="B30001"){new Lib.AccountChecker(oData.data.ssoUseUrl)}else{showError(oData.code)}}});App.deleteDraftArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_draft_del.php","jsload"),needLogin:function(){return!$isAdmin},confirmMSG:$SYSMSG.B03016,textOk:"是",textCancel:"否",param:{"blog_id[]":function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.clearRecycleBinArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_recycle_del.php","jsload"),needLogin:function(){return!$isAdmin},confirmMSG:$SYSMSG.B03016,textOk:"是",textCancel:"否",param:{"blog_id[]":function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.restoreRecycleBinArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_recycle_resume.php","jsload"),needLogin:function(){return!$isAdmin},param:{blog_id:function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.addFavoriteArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/favourites_save.php","jsload"),needLogin:function(){return!$isLogin},param:{blog_id:function(){return this.articleId},uid:scope.$uid},requestOk:function(){if($E("f_"+scope.$articleid)){$E("f_"+scope.$articleid).innerHTML=$E("f_"+scope.$articleid).innerHTML.replace(/\((\d*)\)/gi,function(a,b){return"("+(window.parseInt(b)+1)+")"})}winDialog.alert($SYSMSG.B03020,{icon:"03"})}});App.deleteFavoriteArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/favourites_del.php","jsload"),needLogin:function(){return!$isAdmin},confirmMSG:$SYSMSG.B03005,param:{resourceids:function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.setTopArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_top.php","jsload"),needLogin:function(){return!$isAdmin},param:{blog_id:function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.replaceTopArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_top.php","jsload"),needLogin:function(){return!$isAdmin},confirmMSG:$SYSMSG.B03010,param:{blog_id:function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.unsetTopArticle=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_top_del.php","jsload"),needLogin:function(){return!$isAdmin},confirmMSG:$SYSMSG.B03011,param:{blog_id:function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()}});App.moreLayer=function(sAid,evt){var beHidLayer="";var beVisLayer="";var beVisMore="";if(!scope.moreLayerId)scope.moreLayerId=[0,0];scope.moreLayerId.push(sAid);scope.moreLayerId.shift();beHidLayer=$E("a_layer_"+scope.moreLayerId[0]);beVisMore=$E("a_more_"+scope.moreLayerId[1]);beVisLayer=$E("a_layer_"+scope.moreLayerId[1]);beVisLayer.style.left=Core.Dom.getLeft(beVisMore)-30+"px";beVisLayer.style.top=Core.Dom.getTop(beVisMore)+beVisMore.offsetHeight+"px";if(beHidLayer)beHidLayer.style.display="none";beVisLayer.style.height="80px";beVisLayer.style.display="";beVisLayer.onmouseout=function(ele){return function(e){e=e||window.event;var src=e.relatedTarget||e.toElement;if($FF){if(!isChildNodes(ele,src)){ele.style.display="none"}}else{if(!ele.contains(src)){ele.style.display="none"}}}}(beVisLayer);function isChildNodes(ele,src){if(ele.hasChildNodes()){var children=ele.childNodes;for(var i=0;children[i];i++){if(isChildNodes(children[i],src)){return true}}}return ele==src}};App.modifyCategory=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/riaapi/article/edit_cat.php","jsload"),param:{},requestOk:function(){window.location.reload()},requestError:function(sCode){},needLogin:function(){trace("检查用户");return!$isAdmin},confirmMSG:['<div id="#{content}" class="CP_layercon1">','<div class="CP_prompt" style="padding:0;">','<table class="CP_w_ttl"><tr><td id="#{text}">','<p style="font-size:13px; font-weight:normal; padding-left:30px;">文章分类：','<select id="#{cateSel}" style="width:130px;">{0}</select>',"</p>","</td></tr></table>",'<div id="#{subText}" class="CP_w_cnt SG_txtb"></div>','<p class="CP_w_btns" style="padding-left:60px;">','<a id="#{linkOk}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnOk}"><span id="#{ok}">确认</span></cite></a>','<a style="margin-left:5px;" id="#{linkCancel}" class="SG_aBtn SG_aBtnB" href="#" onclick="return false;"><cite id="#{btnCancel}"><span id="#{cancel}">取消</span></cite></a>',"</p>","</div>","</div>"].join(""),confirm:function(){var _this=this;Lib.checkAuthor(function(){if(!$isLogin){_articleFunc();$tray.renderLogin()}else{_articleFunc()}},"article_modifyCate"+(new Date).getTime());_this.needLogin=false;function _articleFunc(){if(_this.confirmMSG){if(!App.cacheSort){App.getArticlesSort(function(data){App.cacheSort=data.data;_this.showLayer()})}else{_this.showLayer()}}else{_this.doAction()}if(_this.confirmMSG){if(!App.cacheSort){App.getArticlesSort(function(data){App.cacheSort=data.data;_this.showLayer()})}else{_this.showLayer()}}else{_this.doAction()}}},showLayer:function(){var _this=this;var modiDial,cateSel,datai,curid=+this.cateId,curIndex=0;var opt="<option value='{1}'>{0}</option>";var opts="<option value='00'>选择分类</option>";for(var i=0;i<App.cacheSort.length;i++){datai=App.cacheSort[i];opts+=opt.format(datai.name,datai.id);if(datai.id===curid){curIndex=i+1}}opts+="<option value='0'>私密博文</option>";this.confirmMSG=this.confirmMSG.format(opts);modiDial=winDialog.createCustomsDialog({title:"修改博文分类",content:this.confirmMSG});modiDial.setFixed(true);modiDial.setMiddle();modiDial.show();cateSel=modiDial.nodes.cateSel;cateSel.selectedIndex=curIndex;modiDial.nodes.linkCancel.onclick=function(){modiDial.close();return false};modiDial.nodes.btnClose.onclick=function(){modiDial.close();return false};modiDial.nodes.linkOk.onclick=function(){_this.param={old_cat:_this.cateId,new_cat:cateSel.options[cateSel.selectedIndex].value,blog_id:_this.articleId};if(_this.param.new_cat==="0"){_this.privacyArticleCheck(Core.Function.bind2(_this.doAction,_this));modiDial.close();return}Core.Function.bind2(_this.doAction,_this)();modiDial.close();return false}},privacyArticleCheck:function(cb){var itf=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/check_vip.php","ijax");var privacyArticleTips=function(cb){var interfacePrivacy=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/points_redeem.php","ijax");var sucdlg=winDialog.alert("你尚未开通私密博文功能!",{funcOk:function(){interfacePrivacy.request({POST:{user:scope.$uid||$UID,type:4,auto:1},onSuccess:function(data){cb()},onError:function(result){if(result&&result.code=="A00003"){winDialog.alert(result.data,{subText:'<a href="http://blog.sina.com.cn/huodong/lottery.html?f=1">马上获得1888积分! </a>'})}else{winDialog.alert(result&&result.data)}},onFail:function(){}})},textOk:"兑换并修改",subText:"私密博文一个月(30天)功能仅需30积分"},"privacyArticleDialog")};itf.request({POST:{type:4},onSuccess:function(data){cb()},onError:function(result){if(result&&result.code=="A00001"){privacyArticleTips(cb)}},onFail:function(){}})},requestOk:function(){winDialog.alert("修改分类成功",{icon:"03",funcOk:function(){window.location.reload()}})}});App.deleteClockpub=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/admin/article/article_clockpub_del.php","jsload"),needLogin:function(){return!$isAdmin},confirmMSG:"博文删除后将无法恢复，确定要删除吗？",textOk:"是",textCancel:"否",param:{"blog_id[]":function(){return this.articleId},uid:scope.$uid},requestOk:function(){window.location.reload()},requestError:function(oData){if(oData.code==="B00011"){winDialog.alert("博文已不在定时列表中",{funcOk:function(){window.location.reload()},icon:"01"})}else{showError(oData.code)}}});App.sendClockpub=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/blog/clockPubImmediate.php","jsload"),needLogin:function(){return!$isAdmin},param:{blog_id:function(){return this.articleId}},requestOk:function(data){winDialog.alert("博文已发布成功",{funcOk:function(){setTimeout(function(){window.location.href="http://blog.sina.com.cn/s/blog_"+data+".html"},1)},icon:"03"})},requestError:function(oData){if(oData.code==="B40003"||oData.code==="B36101"){winDialog.alert("博文已不在定时列表中",{funcOk:function(){window.location.reload()},icon:"01"})}else{showError(oData.code)}}});App.articleHide=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/riaapi/article/edit_cat.php?old_cat=0&new_cat=0","jsload"),param:{blog_id:function(){return this.articleId}},confirmMSG:"是否要隐藏此博文",needLogin:function(){trace("检查用户");return!$isAdmin},requestOk:function(){winDialog.alert("隐藏成功",{icon:"03",funcOk:function(){window.location.reload()}})},requestError:function(sCode){winDialog.alert("失败，请重试")}});App.articleRestore=Core.Class.define(null,App.ArticleMange,{Interface:new Interface("http://control.blog.sina.com.cn/riaapi/article/edit_cat.php?old_cat=0&new_cat=00","jsload"),param:{blog_id:function(){return this.articleId}},confirmMSG:"是否恢复此博文",needLogin:function(){return!$isAdmin},requestOk:function(){winDialog.alert("恢复成功",{icon:"03",funcOk:function(){window.location.reload()}})},requestError:function(sCode){winDialog.alert("恢复失败，请重试")}});$articleManage=function(sArticleId,nAction,oOption){if($IE){try{Core.Events.stopEvent();$E("a_layer_"+scope.moreLayerId[1]).style.display="none";$E("a_layer_"+scope.moreLayerId[0]).style.display="none"}catch(e){}}oOption=oOption||{};switch(nAction){case 1:new App.deleteArticle(sArticleId,oOption);break;case 2:new App.deleteDraftArticle(sArticleId,oOption);break;case 3:new App.clearRecycleBinArticle(sArticleId,oOption);break;case 4:new App.restoreRecycleBinArticle(sArticleId,oOption);break;case 5:var testFunc=function(){scope.blogOpener.showDialog(function(){new App.addFavoriteArticle(sArticleId,oOption)})};Lib.checkAuthor(function(){if(!$isLogin){v7sendLog("48_01_35");(new Lib.Login.Ui).login(testFunc)}else{testFunc()}},"articleManageFactory"+(new Date).getTime());break;case 6:new App.deleteFavoriteArticle(sArticleId,oOption);break;case 7:new App.setTopArticle(sArticleId,oOption);break;case 8:new App.replaceTopArticle(sArticleId,oOption);break;case 9:new App.unsetTopArticle(sArticleId,oOption);break;case 10:App.moreLayer(sArticleId,Core.Events.getEvent());break;case 11:new App.modifyCategory(sArticleId,oOption);break;case 12:new App.articleHide(sArticleId,oOption);break;case 13:new App.articleRestore(sArticleId,oOption);break;case 14:new App.deleteClockpub(sArticleId,oOption);break;case 15:new App.sendClockpub(sArticleId,oOption);break}};function changeFontSize(e){var fontClass,str="字体大小：";var template="<strong>#</strong>&nbsp;",i=3,choice=["小","中","大"];str+=new Array(4).join(template);switch(e){case 2:fontClass="fontSize_L";break;case 0:fontClass="fontSize_S";break;case 1:default:fontClass="fontSize_M";break}str=str.replace(/(<strong>)(#)(<\/strong>)/g,function(a,b,c,d){i--;if(i!=e){return'<a href="#" onclick="changeFontSize('+i+');return false;">'+choice[i]+"</a>"}else{return b+choice[e]+d}});$E("articleFontManage").innerHTML=str.substring(0,str.length-6);if(typeof attentionWorldCup!="undefined"){$E("articlebody").className="worldcup_article "+fontClass}else{$E("articlebody").className="artical "+fontClass}if(typeof SUDA!="undefined"){SUDA.uaTrack("blog_article","h_article16")}}$registJob("report_bodyArticle",function(){var BR=new Lib.BlogReport,nickName="";window.report=function(bodyID){var reportUID=scope.$uid,userNameInfo1,userNameInfo2="",titleInfo='<a target="_blank" href="http://blog.sina.com.cn/s/blog_'+bodyID+'.html">'+$E("t_"+bodyID).innerHTML+"</a>",contentInfo=$E("t_"+bodyID).innerHTML;if(nickName===""){Lib.Uic.getNickName([reportUID],function(result){if(result&&result[reportUID]){var nick=result[reportUID];BR.start("blog",nick,bodyID,reportUID,'<a target="_blank" href="http://blog.sina.com.cn/u/'+scope.$uid+'">'+nick+"</a>",userNameInfo2,titleInfo,contentInfo)}else{BR.start("blog","新浪网友",bodyID,reportUID,"新浪网友",userNameInfo2,titleInfo,contentInfo)}})}else{userNameInfo1='<a target="_blank" href="http://blog.sina.com.cn/u/'+scope.$uid+'">'+nickName+"</a>";BR.start("blog",nickName,bodyID,reportUID,userNameInfo1,userNameInfo2,titleInfo,contentInfo)}};window.article_report=function(bodyID){var reportUID=scope.$uid,userNameInfo1,userNameInfo2="",titleInfo='<a target="_blank" href="http://blog.sina.com.cn/s/blog_'+bodyID+'.html">'+$E("t_"+bodyID).innerHTML+"</a>",contentInfo=$E("t_"+bodyID).innerHTML;if(nickName===""){Lib.Uic.getNickName([reportUID],function(result){if(result&&result[reportUID]){var nick=result[reportUID];BR.start("blog",nick,bodyID,reportUID,'<a target="_blank" href="http://blog.sina.com.cn/u/'+scope.$uid+'">'+nick+"</a>",userNameInfo2,titleInfo,contentInfo)}else{BR.start("blog","新浪网友",bodyID,reportUID,"新浪网友",userNameInfo2,titleInfo,contentInfo)}})}else{userNameInfo1='<a target="_blank" href="http://blog.sina.com.cn/u/'+scope.$uid+'">'+nickName+"</a>";BR.start("blog",nickName,bodyID,reportUID,userNameInfo1,userNameInfo2,titleInfo,contentInfo)}}});$registJob("flashtemplate",function(){Lib.checkAuthor(function(){Lib.getTplNum(function(){if(scope["tpl"]){Lib.insertMoban()}})},"flashtemplate"+(new Date).getTime())});$registJob("imageLazyLoad",function(){var imgs=document.getElementsByTagName("IMG");var list=[];for(var i=0,len=imgs.length;i<len;i++){if(imgs[i].getAttribute("real_src")!=null){list.push(imgs[i])}}if(list.length>0){Lib.LazyLoad(list,{callback:function(o){scope.sharePhoto&&scope.sharePhoto.bindFn&&scope.sharePhoto.bindFn(o,"real_src");var src=o.getAttribute("real_src");if(scope.showPicSlide){scope.showPicSlide(o,src)}o.src=src;if(scope.$pageid==="articletjTech"){if(o.complete&&o.width>550){o.width=550}else{o.onload=function(){if(o.width>550){o.width=550}}}}}})}});scope.$worldCupInfos={teams:{1:{name:"南非",group:"A",URL:"http://2010.sina.com.cn/teams/southafrica.shtml"},2:{name:"墨西哥",group:"A",URL:"http://2010.sina.com.cn/teams/mexico.shtml"},3:{name:"乌拉圭",group:"A",URL:"http://2010.sina.com.cn/teams/uruguay.shtml"},4:{name:"法国",group:"A",URL:"http://2010.sina.com.cn/teams/france.shtml"},5:{name:"阿根廷",group:"B",URL:"http://2010.sina.com.cn/teams/argentina.shtml"},6:{name:"尼日利亚",group:"B",URL:"http://2010.sina.com.cn/teams/nigeria.shtml"},7:{name:"韩国",group:"B",URL:"http://2010.sina.com.cn/teams/korearepublic.shtml"},8:{name:"希腊",group:"B",URL:"http://2010.sina.com.cn/teams/greece.shtml"},9:{name:"英格兰",group:"C",URL:"http://2010.sina.com.cn/teams/england.shtml"},10:{name:"美国",group:"C",URL:"http://2010.sina.com.cn/teams/usa.shtml"},11:{name:"阿尔及利亚",group:"C",URL:"http://2010.sina.com.cn/teams/algeria.shtml"},12:{name:"斯洛文尼亚",group:"C",URL:"http://2010.sina.com.cn/teams/slovenia.shtml"},13:{name:"德国",group:"D",URL:"http://2010.sina.com.cn/teams/germany.shtml"},14:{name:"澳大利亚",group:"D",URL:"http://2010.sina.com.cn/teams/australia.shtml"},15:{name:"塞尔维亚",group:"D",URL:"http://2010.sina.com.cn/teams/serbia.shtml"},16:{name:"加纳",group:"D",URL:"http://2010.sina.com.cn/teams/ghana.shtml"},17:{name:"荷兰",group:"E",URL:"http://2010.sina.com.cn/teams/netherlands.shtml"},18:{name:"丹麦",group:"E",URL:"http://2010.sina.com.cn/teams/denmark.shtml"},19:{name:"日本",group:"E",URL:"http://2010.sina.com.cn/teams/japan.shtml"},20:{name:"喀麦隆",group:"E",URL:"http://2010.sina.com.cn/teams/cameroon.shtml"},21:{name:"意大利",group:"F",URL:"http://2010.sina.com.cn/teams/italy.shtml"},22:{name:"巴拉圭",group:"F",URL:"http://2010.sina.com.cn/teams/paraguay.shtml"},23:{name:"新西兰",group:"F",URL:"http://2010.sina.com.cn/teams/newzealand.shtml"},24:{name:"斯洛伐克",group:"F",URL:"http://2010.sina.com.cn/teams/slovakia.shtml"},25:{name:"巴西",group:"G",URL:"http://2010.sina.com.cn/teams/brazil.shtml"},26:{name:"朝鲜",group:"G",URL:"http://2010.sina.com.cn/teams/koreadpr.shtml"},27:{name:"科特迪瓦",group:"G",URL:"http://2010.sina.com.cn/teams/cotedivoire.shtml"},28:{name:"葡萄牙",group:"G",URL:"http://2010.sina.com.cn/teams/portugal.shtml"},29:{name:"西班牙",group:"H",URL:"http://2010.sina.com.cn/teams/spain.shtml"},30:{name:"瑞士",group:"H",URL:"http://2010.sina.com.cn/teams/switzerland.shtml"},31:{name:"洪都拉斯",group:"H",URL:"http://2010.sina.com.cn/teams/honduras.shtml"},32:{name:"智利",group:"H",URL:"http://2010.sina.com.cn/teams/chile.shtml"}},games:{1:{teams:["1","2"],time:"2010-06-11 22:00:00",score:"",group:"A"},2:{teams:["3","4"],time:"2010-06-12 02:30:00",score:"",group:"A"},3:{teams:["5","6"],time:"2010-06-12 22:00:00",score:"",group:"B"},4:{teams:["7","8"],time:"2010-06-12 19:30:00",score:"",group:"B"},5:{teams:["9","10"],time:"2010-06-13 02:00:00",score:"",group:"C"},6:{teams:["11","12"],time:"2010-06-13 19:30:00",score:"",group:"C"},7:{teams:["13","14"],time:"2010-06-14 02:30:00",score:"",group:"D"},8:{teams:["15","16"],time:"2010-06-13 22:00:00",score:"",group:"D"},9:{teams:["17","18"],time:"2010-06-14 19:30:00",score:"",group:"E"},10:{teams:["19","20"],time:"2010-06-14 22:00:00",score:"",group:"E"},11:{teams:["21","22"],time:"2010-06-15 02:30:00",score:"",group:"F"},12:{teams:["23","24"],time:"2010-06-15 19:30:00",score:"",group:"F"},13:{teams:["27","28"],time:"2010-06-15 22:00:00",score:"",group:"G"},14:{teams:["25","26"],time:"2010-06-16 02:30:00",score:"",group:"G"},15:{teams:["31","32"],time:"2010-06-16 19:30:00",score:"",group:"H"},16:{teams:["29","30"],time:"2010-06-16 22:00:00",score:"",group:"H"},17:{teams:["1","3"],time:"2010-06-17 02:30:00",score:"",group:"A"},18:{teams:["2","4"],time:"2010-06-18 02:30:00",score:"",group:"A"},19:{teams:["6","8"],time:"2010-06-17 22:00:00",score:"",group:"B"},20:{teams:["5","7"],time:"2010-06-17 19:30:00",score:"",group:"B"},21:{teams:["13","15"],time:"2010-06-18 22:00:00",score:"",group:"D"},22:{teams:["12","10"],time:"2010-06-18 22:00:00",score:"",group:"C"},23:{teams:["9","11"],time:"2010-06-19 02:30:00",score:"",group:"C"},24:{teams:["16","14"],time:"2010-06-19 02:30:00",score:"",group:"D"},25:{teams:["17","19"],time:"2010-06-19 19:30:00",score:"",group:"E"},26:{teams:["18","20"],time:"2010-06-20 02:30:00",score:"",group:"E"},27:{teams:["22","24"],time:"2010-06-20 19:30:00",score:"",group:"F"},28:{teams:["21","23"],time:"2010-06-20 22:00:00",score:"",group:"F"},29:{teams:["25","27"],time:"2010-06-21 02:00:00",score:"",group:"G"},30:{teams:["26","28"],time:"2010-06-21 19:30:00",score:"",group:"G"},31:{teams:["30","32"],time:"2010-06-21 22:00:00",score:"",group:"H"},32:{teams:["29","31"],time:"2010-06-22 02:00:00",score:"",group:"H"},33:{teams:["2","3"],time:"2010-06-22 22:00:00",score:"",group:"A"},34:{teams:["1","4"],time:"2010-06-22 22:00:00",score:"",group:"A"},35:{teams:["6","7"],time:"2010-06-23 02:30:00",score:"",group:"B"},36:{teams:["5","8"],time:"2010-06-23 02:30:00",score:"",group:"B"},37:{teams:["9","12"],time:"2010-06-23 22:00:00",score:"",group:"C"},38:{teams:["10","11"],time:"2010-06-23 22:00:00",score:"",group:"C"},39:{teams:["13","16"],time:"2010-06-24 02:30:00",score:"",group:"D"},40:{teams:["15","14"],time:"2010-06-24 02:30:00",score:"",group:"D"},41:{teams:["21","24"],time:"2010-06-24 22:00:00",score:"",group:"F"},42:{teams:["22","23"],time:"2010-06-24 22:00:00",score:"",group:"F"},43:{teams:["18","19"],time:"2010-06-25 02:30:00",score:"",group:"E"},44:{teams:["17","20"],time:"2010-06-25 02:30:00",score:"",group:"E"},45:{teams:["25","28"],time:"2010-06-25 22:00:00",score:"",group:"G"},46:{teams:["26","27"],time:"2010-06-25 22:00:00",score:"",group:"G"},47:{teams:["29","32"],time:"2010-06-26 02:30:00",score:"",group:"H"},48:{teams:["30","31"],time:"2010-06-26 02:30:00",score:"",group:"H"},49:{},50:{},51:{},52:{},53:{},54:{},55:{},56:{},57:{},58:{},59:{},60:{},61:{},62:{},63:{},64:{}},teammatches:{1:["1","17","34"],2:["1","18","33"],3:["2","17","33"],4:["2","18","34"],5:["3","20","36"],6:["3","19","35"],7:["4","20","35"],8:["4","19","36"],9:["5","23","37"],10:["5","22","38"],11:["6","23","38"],12:["6","22","37"],13:["7","21","39"],14:["7","24","40"],15:["8","21","40"],16:["8","24","39"],17:["9","25","44"],18:["9","26","43"],19:["10","25","43"],20:["10","26","44"],21:["11","28","41"],22:["11","27","42"],23:["12","28","42"],24:["12","27","41"],25:["14","29","45"],26:["14","30","46"],27:["13","29","46"],28:["13","30","45"],29:["16","32","47"],30:["16","31","48"],31:["15","32","48"],32:["15","31","47"]}};
$registJob("favGames",function(){if(typeof attentionWorldCup=="undefined")return;if(!attentionWorldCup.show_attentiongame.length)return;if(scope.wc_match_info){init()}else{Utils.Io.JsLoad.request("http://blog.sina.com.cn/2010worldcup/worldcup.js",{onComplete:function(){scope.wc_match_info=wc_match_info;scope.wc_teams_info=wc_team_info;init()}})}function init(){var gameHash=scope.wc_match_info;var teamHash=scope.wc_teams_info;var gameInfo=attentionWorldCup.show_attentiongame;var teamInfo=attentionWorldCup.show_attentionteam;var showQuali=6;var gameExcel=['<table border="0" cellpadding="0" cellspacing="1">',"<tr>",'<th scope="col" class="w1">日期</th>','<th scope="col" class="w2">时间</th>','<th scope="col">对阵</th>',"</tr>#{itemLines}","</table>"].join("");var gameItem=["<tr>","<td>#{date}</td>",'<td class="wdc_ta">#{time}</td>','<td class="wdc_te"><span class="matchL">#{army1}</span><span class="vs wdc_ta"> VS </span><span class="matchR">#{army2}</span></td>',"</tr>"].join("");var gameExcelBox=$E("favGames");var temp="";var week=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];var i,k;var seqTime=[];var tempTime=[];var idxTime=[];var userGameHash=[];for(i=0;i<gameInfo.length;i++){trace("userGameHash "+gameHash[gameInfo[i]].score+"////"+i);userGameHash.push(gameHash[gameInfo[i]])}var userLastMatch=getElemIfHasProp(userGameHash,"score",showQuali,true);trace("length: "+userLastMatch.length);for(i=0;i<userLastMatch.length;i++){trace(i);var preDate=userLastMatch[i].time.split(" ")[0].split("-");var preTime=userLastMatch[i].time.split(" ")[1].split(":")[0];var d=new Date;d.setMonth(preDate[1]-1);d.setDate(preDate[2]);d.setHours(preTime);seqTime[i]=d.getTime()}tempTime=tempTime.concat(seqTime);var tt;var ttid;var arraged=[];for(k=0;k<seqTime.length;k++){tt=seqTime[0];ttid=0;for(i=1;i<seqTime.length;i++){if(seqTime[i]<tt){tt=seqTime[i];ttid=i}}arraged.push(ttid);seqTime[ttid]=Infinity}for(i=0;i<seqTime.length;i++){var preDate=userLastMatch[arraged[i]].time.split(" ")[0].split("-");var d=new Date;d.setMonth(preDate[1]-1);d.setDate(preDate[2]);var w=d.getDay();d=d.getMonth()+1+"月"+d.getDate()+"日";temp+=new Ui.Template(gameItem).evaluate({army1:teamHash[userLastMatch[arraged[i]].teams[0]].name,army2:teamHash[userLastMatch[arraged[i]].teams[1]].name,date:d+" "+week[w],time:userLastMatch[arraged[i]].time.split(" ")[1].slice(0,-3)})}gameExcelBox.innerHTML=new Ui.Template(gameExcel).evaluate({itemLines:temp})}function getElemIfHasProp(arr,pName,num,reverse){var i;var pureArr=[];var result=[];for(i=0;i<arr.length;i++){if(reverse?!arr[i][pName]:arr[i][pName]){pureArr.push(arr[i])}}for(i=0;i<num;i++){if(!pureArr[i]){trace("src not enough");break}result.push(pureArr[i])}return result}});$registJob("teams_wc",function(){if(typeof attentionWorldCup=="undefined")return;new FavTeamsInfo;var url="http://comet.blog.sina.com.cn/api?maintype=hits&act=3&uid=00000300&tm"+(new Date).getTime();Utils.Io.JsLoad.request(url,{onComplete:function(){}})});var FavTeamsInfo=function(){this.entity=$E("favTeams");if(!this.entity)return;this.allTeams=$T(this.entity,"li");this.isTweenIn=[];this.isTweenOut=[];this.initialize()};FavTeamsInfo.prototype={initialize:function(){if(!this.entity)return;var _this=this;var zIndex=64;Core.Array.foreach(this.allTeams,function(team,i){var tar=$T(team,"p")[1];tar.style.zIndex=512;team.style.zIndex=zIndex--;Core.Events.addEvent(team,function(){if(!$IE)if(!_this.justIn(Core.Events.getEvent(),team))return;_this.tweenIn(team,tar,i)},$IE?"mouseenter":"mouseover");Core.Events.addEvent(team,function(){if(!$IE)if(!_this.justIn(Core.Events.getEvent(),team))return;_this.tweenOut(team,tar,i)},$IE?"mouseleave":"mouseout")})},justIn:function(evt,bNode){var reltarg=evt.relatedTarget;while(reltarg&&reltarg!=bNode)reltarg=reltarg.parentNode;return reltarg!=bNode},tweenIn:function(team,tar,i){try{Ui.tween.stop(tar)}catch(e){}var _this=this;team.className="hover";Core.Dom.setStyle(tar,"opacity",1);tar.style.display=""},tweenOut:function(team,tar,i){var _this=this;new Ui.tween(tar,["opacity"],[0],.3,"simple",{end:function(){tar.style.display="none";team.className=""}})}};var CalendarWc=function(){this.entity=$E("wdc_calender");this.closeBtn=$E("wcc_close");this.fakeImg=$C("div");this.switchOn=false;this.isTween=false;this.posRelDom=null;this.lockPosX;this.lockPosY;this.initialize()};CalendarWc.prototype={initialize:function(){if(!this.entity)return;var _this=this;this.fakeImg.style.cssText="z-index:612; position:absolute; border:2px solid #d2d9e6; background-color:white;";document.body.insertBefore(this.fakeImg,document.body.firstChild);this.renderNew();this.renderToday();Core.Events.addEvent(this.closeBtn,function(){_this.resetCalendar()});Core.Events.addEvent(window,function(){_this.justiPos()},"resize")},resetCalendar:function(){try{Ui.tween.stop(this.fakeImg)}catch(e){}Core.Dom.setStyle(this.entity,"display","none");Core.Dom.setStyle(this.entity,"visibility","hidden");Core.Dom.setStyle(this.fakeImg,"display","none");this.switchOn=false;this.isTween=false},justiPos:function(){if(!this.switchOn)return;Core.Dom.setStyle(this.entity,"left",Core.Dom.getLeft(this.posRelDom)-this.lockPosX+"px");Core.Dom.setStyle(this.entity,"top",Core.Dom.getTop(this.posRelDom)-this.lockPosY+"px")},renderNew:function(){var _this=this;var attDate=attentionWorldCup.show_attentiondate;if(!attDate&&!attDate.length)return;for(var i=0;i<attDate.length;i++){var curLi;var month_day=attDate[i].split("_");curLi=$E("wcc_"+month_day[0]+"_"+month_day[1]);if(!curLi)break;$T(curLi,"a")[0].title="有关注的赛事";this.addClass(curLi,"new");Core.Events.addEvent(curLi,function(i){return function(){_this.resetCalendar();window.location.href="#"+attDate[i]}}(i))}},renderToday:function(){var month=(new Date).getMonth()+1;var day=(new Date).getDate();this.addClass($E("wcc_"+month+"_"+day),"cur")},setPos:function(withDom,offsetLeft,offsetTop){this.posRelDom=withDom;var left=Core.Dom.getLeft(withDom)+(offsetLeft?offsetLeft:0);var top=Core.Dom.getTop(withDom)+(offsetTop?offsetTop:0);if($IE6&&$IE7){left+=document.documentElement.scrollLeft;top+=document.documentElement.scrollTop}this.fakeImg.style.left=left+"px";this.fakeImg.style.top=top+"px"},arcFunc:function(a,b,c){return function(x){return a*x*x+b*x+c}},tweenPlay:function(){this.resetCalendar();var _this=this;Core.Dom.setStyle(this.entity,"display","");Core.Dom.setStyle(this.fakeImg,"display","");Core.Dom.setStyle(this.fakeImg,"opacity",.6);Core.Dom.setStyle(this.fakeImg,"width","48px");Core.Dom.setStyle(this.fakeImg,"height","15px");this.isTween=true;new Ui.tween(this.fakeImg,["opacity","height","width","left"],[1,this.entity.offsetHeight-4,this.entity.offsetWidth-4,Core.Dom.getLeft(this.posRelDom)-217],.3,"strongEaseIn",{end:function(){new Ui.tween(_this.fakeImg,["opacity"],[1],.1,"simple",{end:function(){_this.entity.style.left=Core.Dom.getLeft(_this.fakeImg)+"px";_this.entity.style.top=Core.Dom.getTop(_this.fakeImg)+"px";_this.fakeImg.style.display="none";_this.entity.style.visibility="visible";_this.switchOn=true;_this.lockPosX=Core.Dom.getLeft(_this.posRelDom)-Core.Dom.getLeft(_this.entity);_this.lockPosY=Core.Dom.getTop(_this.posRelDom)-Core.Dom.getTop(_this.entity)}})}})},addClass:function(dom,clz){if(!dom)return false;if(!this.hasClass(dom,clz)){dom.className=Core.String.trim(dom.className.concat(" "+clz))}},delClass:function(dom,clz){if(!dom)return false;var reg=new RegExp("(?: +|^)"+clz+"(?=( |$))","ig");dom.className=Core.String.trim(dom.className.replace(reg,""))},hasClass:function(dom,clz){if(!dom)return false;var reg=new RegExp("(?: +|^)"+clz+"(?=( |$))","ig");return reg.test(dom.className)}};$registJob("calendar_wc",function(){if(typeof attentionWorldCup=="undefined")return;var wcc=new CalendarWc;$E("calendar_wc").onmouseover=function(){if(wcc.isTween)return;wcc.setPos(this,0,0);wcc.tweenPlay();return false}});$SYSMSG.extend({B00802:"抱歉，此篇图片已经被删除",B00803:"抱歉，此篇专辑已经被删除",B00804:"抱歉，此篇文章已经被删除"});$registJob("digger",function(){var diggerCite=$E("d1_digg_"+scope.$articleid);if(!scope.digger){scope.digger={}}scope.digger.flashReady=function(){};scope.digger.diggerPer=function(){};scope.digger.diggerNums=function(){};scope.digger.setData=function(){};scope.digger.diggerPost=function(){};scope.digger.bindEvent=function(){};scope.digger.showLast10=function(){};scope.digger.hiddenLast10=function(){};if(!$E("diggerFla")){trace("no diggerFla");return}if(!$_GLOBAL.diggerOpenFlag){trace("close...");return}Lib.checkAuthor(function(){var currentUser="";if($isLogin){currentUser=$UID;trace("当前用户:"+$UID)}var flashReady=false;var failed=false;scope.digger.flashReady=function(){trace("--------顶踩加载完毕....");flashReady=true};trace("--------顶踩开始加载完毕....");var random="";if(window.$Maxthon||window.$360||window.$TT){random="?t="+Core.Math.getUniqueId()}var FlashPlayer=new Utils.Flash.swfObject($_GLOBAL.flashBasicURL+"digger.swf"+random,"digger","1","1","9","#00ff00");FlashPlayer.addParam("quality","high");FlashPlayer.addParam("wmode","transparent");FlashPlayer.addParam("allowScriptAccess","always");FlashPlayer.write("diggerFla");var digger=$E("digger");scope.digger.diggerPer=function(opt){if(!opt.params){opt.params={res_id:opt.res_id,res_uid:opt.res_uid||scope.$uid}}opt.url="http://control.blog.sina.com.cn/riaapi/digg/get_digg.php";makeReq(opt)};scope.digger.diggerNums=function(opt){if(!opt.params){opt.params={res_id:opt.res_id,res_uid:opt.res_uid||scope.$uid}}opt.url="http://blogtj.sinajs.cn/api/get_digg_num.php";makeReq(opt)};function delaySet(_opt){var timmer=0;var inter=setInterval(function(){timmer+=500;if(timmer>=$_GLOBAL.diggerFlashTimeout){trace("已超时，不再尝试放进flash cookie:"+_opt.res_id+"_"+(_opt.res_uid||scope.$uid)+"_"+currentUser+"_"+_opt.res_type);clearInterval(inter);failed=true}if(flashReady){clearInterval(inter);waitToSet(_opt)}},500)}function waitToSet(_opt){if(failed){trace("不等待,flash已经是不可靠的，顶没有放入flash cookie");return}if(!flashReady){delaySet(_opt)}else{digger.setData(_opt.res_id+"_"+(_opt.res_uid||scope.$uid)+"_"+currentUser+"_"+_opt.res_type);trace(_opt.res_id+"_"+(_opt.res_uid||scope.$uid)+"_"+currentUser+"_"+_opt.res_type+"放入成功!")}}scope.digger.setData=function(rss_id,uid,type){waitToSet({res_id:rss_id,res_uid:uid,res_type:type})};scope.digger.diggerPost=function(opt){Lib.checkAuthor(function(){if(!$isLogin){var Login=new Lib.Login.Ui;Login.login(function(){scope.blogOpener.showDialog(function(){pageInfo._uid=$UID;popup.show()})},false,"referer:"+location.hostname+location.pathname+",func:diggerPost");return}if(!opt.params){opt.params={res_id:opt.res_id,res_uid:opt.res_uid||scope.$uid,action:opt.action||"0",res_type:opt.res_type}}opt.url="http://control.blog.sina.com.cn/admin/digg/post_digg.php";if(!opt.onSuccess){opt.onSuccess=function(data){waitToSet(opt)}}else{var temp=opt.onSuccess;opt.onSuccess=function(data){temp(data);waitToSet(opt)}}makeReq(opt)},"article_digger")};function waitOrExecute(_opt){var timmer=0;var inter=setInterval(function(){timmer+=500;trace("waitOrExecute:等待flash加载..."+timmer);if(flashReady){clearInterval(inter);scope.digger.bindEvent(_opt)}if(timmer>=$_GLOBAL.diggerFlashTimeout){trace("响应超时，直接执行代码");clearInterval(inter);whenFailed(_opt);failed=true;return}},500)}function whenFailed(_opt){for(var event in _opt.events){_opt.targetEle["on"+event]=_opt.events[event](_opt)}}scope.digger.bindEvent=function(opt){if(failed){trace("不等待,flash已经是不可靠的，直接执行代码");whenFailed(opt);return}if(!flashReady){trace("falsh还没有加载完毕");waitOrExecute(opt)}else{trace("读取"+opt.res_id+"_"+(opt.res_uid||scope.$uid)+"_"+currentUser+"_"+opt.res_type+":"+digger.getData(opt.res_id+"_"+(opt.res_uid||scope.$uid)+"_"+currentUser+"_"+opt.res_type));if(digger.getData(opt.res_id+"_"+(opt.res_uid||scope.$uid)+"_"+currentUser+"_"+opt.res_type)){trace(opt.res_id+"_"+(opt.res_uid||scope.$uid)+"_"+currentUser+"_"+opt.res_type+": 找到，不绑定事件");opt.whenFind&&opt.whenFind(opt)}else{trace(opt.res_id+"_"+(opt.res_uid||scope.$uid)+"_"+currentUser+"_"+opt.res_type+": 未找到，绑定事件");whenFailed(opt)}}};var posting=false;function makeReq(opt){if(posting){return}posting=true;new Interface(opt.url,"jsload").request({GET:opt.params,onSuccess:function(_data){opt.onSuccess&&opt.onSuccess(_data);posting=false},onError:function(_data){opt.onError&&opt.onError(_data);posting=false},onFail:function(){opt.onFail&&opt.onFail();posting=false}})}var div=document.createElement("div");div.className="tb_layer_Y tb_layer_w3";div.style.cssText="z-index: 511;position:absolute;display:none;width:160px";var arrDiv=document.createElement("div");arrDiv.className="tb_layer_arrow";var content=document.createElement("div");content.className="tb_layer_Y_main tip_ps";content.style.cssText="width:auto;";if(diggerCite&&diggerCite.innerHTML==="顶"){content.innerHTML='<a style="margin-top: 5px;" title="关闭" class="tb_friend_inputDel" href="javascript:void(0)"></a>							<div style="text-align:left;color:#999999">最近顶了的博主：</div>							<div></div>'}else{content.innerHTML='<a style="margin-top: 5px;" title="关闭" class="tb_friend_inputDel" href="javascript:void(0)"></a>							<div style="text-align:left;color:#999999">最近喜欢了的博主：</div>							<div></div>'}div.appendChild(arrDiv);div.appendChild(content);document.body.appendChild(div);var close=content.getElementsByTagName("a")[0];var con=content.getElementsByTagName("div")[1];con.style.whiteSpace="nowrap";function changeToLoadind(){con.innerHTML='<div style="text-align:center;"><img src="http://simg.sinajs.cn/blog7style/images/common/loading.gif" />加载中…</div>'}changeToLoadind();close.onclick=function(){scope.digger.hiddenLast10()};scope.digger.showLast10=function(opt){changeToLoadind();scope.digger.diggerPer(opt);var loc=Core.Dom.getXY(opt.ele);opt.onError=function(data){con.innerHTML='<div style="text-align:center;color:#999999;font-weight:bolder;">数据请求失败，请稍后重试</div>'};opt.onFail=opt.onError;opt.onSuccess=function(data){if(div.style.display){trace("已经被关闭，不再往里面写入信息");return}var pers=[];var getVHTML=Lib.blogv.getVHTML;for(var i=0;data[i];i++){var per=data[i];var sName=per["action_uname"];pers.push("<div>",'<a target="_blank" title="到',per["action_uname"],'的博客去看看" href="http://blog.sina.com.cn/u/',per["action_uid"],'">',sName,"</a>",getVHTML(parseInt(per.wtype||-1)),"</div>")}if(!pers.length){if(diggerCite&&diggerCite.innerHTML==="顶"){con.innerHTML='<div style="text-align:center;color:#999999;font-weight:bolder;">暂无登录用户顶过</div>'}else{con.innerHTML='<div style="text-align:center;color:#999999;font-weight:bolder;">暂无登录用户喜欢过</div>'}}else{con.innerHTML=pers.join("")}};var opa=0;var ddy=50;var dx=(opt.dx||-76)+loc[0];var dy=(opt.dy||10)+loc[1];if($IE){dx-=1;dy-=2}if($SAFARI){dx+=1}if($CHROME){dx+=1;dy+=2}div.style.display="";div.style.left=dx+"px";div.style.top=dy+"px";Core.Dom.opacity(div,opa);new Ui.tween(div,["opacity"],[1],.3,"strongEaseIn");window.onresize=function(){var nLoc=Core.Dom.getXY(opt.ele);div.style.left=nLoc[0]-76+"px";div.style.top=nLoc[1]+10+"px"}};scope.digger.hiddenLast10=function(){var opa=1;new Ui.tween(div,["opacity"],[0],.3,"strongEaseOut")}},"digger"+(new Date).getTime())});$registJob("stylefix",function(){if($IE6&&scope.UserPic&&scope.UserPic[1]&&scope.UserPic[1].apply=="1"){$E("blognavBg").style.filter="none"}var body=$E("sina_keyword_ad_area2");if(body){var embeds=body.getElementsByTagName("embed");var objects=body.getElementsByTagName("object");if(embeds||objects){if(deconcept.SWFObjectUtil.getPlayerVersion().major===0){var htmlmsg='我们的产品需要安装flashplayer 10或更高版本，请 <a href="http://get.adobe.com/flashplayer">点击此处</a> 免费下载';var msg="我们的产品需要安装flashplayer 10或更高版本，请前往 http://get.adobe.com/flashplayer 免费下载";if(winDialog){winDialog.alert(htmlmsg)}else{alert(msg)}}}}var style=document.createElement("style");style.type="text/css";style.id="stylefix";var css="#bsPanelHolder,#sinaads_pdps54771{display:none;}";try{style.appendChild(document.createTextNode(css))}catch(ex){style.styleSheet.cssText=css}document.getElementsByTagName("head")[0].appendChild(style)});$registJob("articleDigger",function(){if(!$E("diggerFla")){return}if(!$_GLOBAL.diggerOpenFlag){return}var aid=scope.$articleid;function newGetNum(){var num=0;var timmer=setInterval(function(){if(scope.useNewInterfaceToGetNum){trace("通过别的借口进行装载");scope.useNewInterfaceToGetNum.onSuccess=function(data){scope.useNewInterfaceToGetNum=null;diggerCallBack(data)};scope.useNewInterfaceToGetNum.onError=function(data){scope.useNewInterfaceToGetNum=null;diggerCallBack(null)};scope.useNewInterfaceToGetNum.onFail=function(data){scope.useNewInterfaceToGetNum=null;diggerCallBack(null)};trace("装载完毕");clearInterval(timmer)}},50)}newGetNum();function setLikedStatusTjTech(_opt){_opt.ele.parentNode.className="SG_aBtn SG_aBtn_ico SG_turn SG_click";_opt.ele.children[1].innerHTML="已喜欢"}function setLikedStatus(_opt){var states;if("articletj"!==scope.$pageid){_opt.ele.className="upBox upBox_dis";_opt.ele.style.cursor="default";states=_opt.ele.getElementsByTagName("p")[1];var cons=states.innerHTML;var div=SinaEx.createNode("<div>"+cons+"</div>");var firstP=SinaEx.findNode(div,"nextSibling","firstChild");div.removeChild(firstP);var con=div.innerHTML;if(con==="顶"){states.innerHTML='<img width="15" height="15" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon34">已顶'}else{states.innerHTML="已喜欢"}}else{var spanEls=_opt.ele.getElementsByTagName("span");states=spanEls[0];var likeBtn=states.parentNode;var likeDiv=likeBtn.parentNode.parentNode;likeDiv.className="upBox upBox_dis";states.style.cursor="default";likeBtn.style.cursor="default";spanEls[1].style.cursor="default";spanEls[2].style.cursor="default";states.innerHTML="已喜欢"}}function setHoverLikeStatus(_opt){if("articletj"!==scope.$pageid){_opt.ele.className="upBox upBox_click";_opt.ele.getElementsByTagName("p")[0].innerHTML="+1"}else{var spanEls=_opt.ele.getElementsByTagName("span");states=spanEls[0];var likeBtn=states.parentNode;var likeDiv=likeBtn.parentNode.parentNode;likeDiv.className="upBox upBox_click";states.innerHTML='<span class="up1">+1</span>喜欢'}}function setLikeStatus(_opt){if("articletj"!==scope.$pageid){_opt.ele.className="upBox";var ele=_opt.ele.getElementsByTagName("p")[0];ele.innerHTML=ele.getAttribute("mnum")}else{var spanEls=_opt.ele.getElementsByTagName("span");states=spanEls[0];var likeBtn=states.parentNode;var likeDiv=likeBtn.parentNode.parentNode;likeDiv.className="upBox";states.innerHTML='<img class="SG_icon SG_icon34" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="15" height="15" title="推荐" align="absmiddle">喜欢'}}function diggerCallBack(data){var tjTechFlag=scope.$pageid==="articletjTech";var mNum=data?data["digg_m_"+aid]:0;var countEle=$E("dbox2_"+aid);if(!countEle){trace("没有找到计数模块，认为这是不需要顶踩功能的");return}if(mNum){countEle.innerHTML=mNum}else{countEle.innerHTML="0"}var res_id=aid;countEle.setAttribute("mnum",mNum);var parent=countEle.parentNode;parent.style.cursor="pointer";scope.digger.bindEvent({ele:parent,targetEle:parent,ti_title:encodeURIComponent(countEle.getAttribute("ti_title")||""),disClass:"upBox upBox_dis",res_id:res_id,uid:scope.$uid,res_type:"1",whenFind:function(_opt){if(tjTechFlag){setLikedStatusTjTech(_opt)}else{setLikedStatus(_opt)}},events:{mouseover:function(_opt){return function(){if(!tjTechFlag){setHoverLikeStatus(_opt)}}},mouseout:function(_opt){return function(){if(!tjTechFlag){setLikeStatus(_opt)}}},click:function(_opt){return function(){scope.digger.diggerPost({params:{res_id:_opt.res_id,res_uid:_opt.res_uid||scope.$uid,action:"0",res_type:"1",ti_title:_opt.ti_title},res_id:_opt.res_id,res_uid:_opt.res_uid||scope.$uid,action:"0",res_type:"1",onSuccess:function(data){_opt.targetEle.onmouseover=function(){};_opt.targetEle.onmouseout=function(){};_opt.targetEle.onclick=function(){};if(tjTechFlag){setLikedStatusTjTech(_opt)}else{setLikedStatus(_opt)}var ele=$E("dbox2_"+_opt.res_id);var curr=parseInt(ele.getAttribute("mnum"))+1;ele.innerHTML=curr;Lib.Listener.notify("article_like_success")},onError:function(data){if(data.code=="B00801"){winDialog.alert("这篇博文您已经喜欢过啦!",{icon:"01"});_opt.targetEle.onmouseover=function(){};_opt.targetEle.onmouseout=function(){};_opt.targetEle.onclick=function(){};if(tjTechFlag){setLikedStatusTjTech(_opt)}else{setLikedStatus(_opt)}scope.digger.setData(_opt.res_id,scope.$uid,1);var ele=$E("dbox2_"+_opt.res_id);var curr=ele.getAttribute("mnum");ele.innerHTML=curr}else{showError(data.code)}}});return false}}}});var ele=$E("d1_digg_"+aid);if(!ele){return}$E("d1_digg_"+aid).onclick=function(tar){return function(e){scope.digger.showLast10(tar);return false}}({ele:$E("d1_digg_down_"+aid),res_id:aid,res_uid:scope.$uid});$E("d1_digg_down_"+aid).onclick=function(tar){return function(e){scope.digger.showLast10(tar);return false}}({ele:$E("d1_digg_down_"+aid),res_id:aid,res_uid:scope.$uid})}});$registJob("miniBlogAttention",function(){var itfcAttention=new Interface("http://weibo.com/attention/aj_addfollow.php","jsload");scope.attMiniBlog=function(){Lib.checkAuthor(function(){if($UID){Utils.Io.JsLoad.request("http://weibo.com/attention/aj_addfollow.php?jsdomain=1&uid=1231759973&fromuid="+$UID,{onComplete:function(){}})}},"miniBlogAttention"+(new Date).getTime())}});Lib.register("util.loadScript",function(){var TRUE=!0,FALSE=!1,cache={};var loadScript=function(url,item){Utils.Io.JsLoad.request(url,{isRemove:FALSE,noreturn:TRUE,onComplete:function(data){cache[url].isLoading=FALSE;var cb=cache[url].cb;for(var i=0,len=cb.length;i<len;i++){cb[i](data)}cache[url].cb=null}})};return function(url,fun){var item=cache[url];var cb=item&&item["cb"];if(!item){cb=[fun];item={isLoading:TRUE,cb:cb};cache[url]=item;loadScript(url,item)}else if(item.isLoading){cb.push(fun)}else{fun()}}});Lib.register("sendSuda",function(lib){var url="http://www.sinaimg.cn/unipro/pub/suda_s_v851c.js";return function(fun){lib.util.loadScript(url,fun)}});$registJob("suda",function(){var pageId=scope&&scope.$pageid;var wlh=window.location.href;var isTj=wlh.indexOf("tj=1")>-1;var suda_flag=pageId&&(pageId==="articletj"||pageId==="index"||pageId==="indexM"||pageId==="editor"||isTj);function addSudaPage(pageId,parm1,parm2,parm3,parm4){if(isTj){v7sendLog(parm4)}switch(pageId){case"index":case"indexM":v7sendLog(parm1);break;case"editor":v7sendLog(parm2);break;case"articletj":v7sendLog(parm3);break}}if(suda_flag){var url=encodeURIComponent(wlh);var refer=encodeURIComponent(document.referrer)}if(typeof _S_pSt=="function"){if(suda_flag){v7sendLog("42_01_03_"+(new Date).getTime()+"_"+url+"_"+refer)}return}Lib.checkAuthor(function(){if(suda_flag){if(!$isLogin){var tj="42_01_01_"+(new Date).getTime()+"_"+url+"_"+refer}else{var tj="42_01_01_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_08","42_01_14",tj,"42_01_05")}Lib.sendSuda(function(){try{_S_pSt("")}catch(e){}if(suda_flag){if(!$isLogin){var succTj="42_01_02_"+(new Date).getTime()+"_"+url+"_"+refer}else{var succTj="42_01_02_"+$UID+"_"+(new Date).getTime()+"_"+url+"_"+refer}addSudaPage(pageId,"42_01_09","42_01_15",succTj,"42_01_06")}});var ele=$E("blognamespan");if(!ele){return}Lib.Uic.getNickName([scope.$uid],function(oResult){var nickName=oResult[scope.$uid];nickName=nickName.replace(/\u7684\u535a\u5ba2$/,"");nickName=Core.String.leftB(nickName,30);nickName=nickName+"的博客";ele.innerHTML=nickName})},"suda_blognamespan"+(new Date).getTime());!function(d,s,id){var n=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;s=d.createElement(s);s.id=id;s.setAttribute("charset","utf-8");s.src="//d"+Math.floor(0+Math.random()*(8-0+1))+".sina.com.cn/litong/zhitou/sinaads/src/spec/sinaads_ck.js";n.parentNode.insertBefore(s,n)}(document,"script","sinaads-ck-script")});Lib.register("execZhitou",function(lib){var url="http://d5.sina.com.cn/litong/zhitou/sinaads/release/sinaads.js";document.createElement("inc");return function(fun){lib.util.loadScript(url,fun)}});var blogAd={};blogAd.getInitPermission=function(oParam){var __root;if(oParam&&oParam.ads&&oParam.ads[0]){__root=oParam&&oParam.ads&&oParam.ads[0];return __root.type=="mixed"||__root.ref}else{return false}};blogAd.insertIns=function(pdps,relateEl,inc,style){inc=inc||"beforeend",style=style||"display:block;";var html='<ins class="sinaads" data-ad-pdps="'+pdps+'" style="'+(style||"")+'"></ins>';relateEl=relateEl||document.body;return Core.Dom.insertHTML(relateEl,html,inc)};Core.System.getParam=function(name){var arr=window.location.search.match(new RegExp("(\\?|&)"+name+"=([^&]*)(&|$)"));if(arr!=null)return unescape(arr[2]);return null};$registJob("scrollAd",function(){if(scope.$pageid=="articleM"||scope.$pageid=="article"||scope.$pageid=="articleM_new"||scope.$pageid=="article_new"){blogAd.insertIns("PDPS000000054727");Lib.execZhitou(function(data){(window.sinaads||[]).push({params:{sinaads_follow_top:30,sinaads_follow_mini_top:200}})})}});$registJob("SinglesDay",function(){scope.addFriendForSinglesDay=function(){Lib.checkAuthor(function(){if($UID){new Interface("http://control.blog.sina.com.cn/riaapi/profile/attention_add.php","ijax").request({POST:{uid:$UID,aid:1259295385}})}},"SinglesDay"+(new Date).getTime())}});Core.Events.stopDefaultEvent=function(el){var ev=el?el:Core.Events.getEvent();if(ev!=null){if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}}};Utils.excBeforeCloseWin=function(tips1,tips2,func,args){closeVar={};closeVar.func=func;closeVar.tips1=tips1;closeVar.tips2=tips2;closeVar.args=args;closeVar.length=arguments.length;window.beforeunloadfunc=function(){if(closeVar.length==1){return closeVar.tips1;Core.Events.stopEvent()}else{if($IE){var e=Core.Events.fixEvent(Core.Events.getEvent());if(e.clientY<0||e.altKey){if(confirm(closeVar.tips2)){if(closeVar.args)Core.Function.bind3(closeVar.func,closeVar.func,[closeVar.args])();else closeVar.func()}else{}}}else{function func(value){if(value==true){if(closeVar.args)Core.Function.bind3(closeVar.func,closeVar.func,[closeVar.args])();else closeVar.func()}else{}}return func.call(this,confirm(closeVar.tips2))}}};Core.Events.addEvent(window,beforeunloadfunc,"beforeunload")};var StaticUser=Core.Class.create();StaticUser.prototype={container_id:null,is_init:false,localDB:null,initialize:function(cnt_id){this.container_id=cnt_id;if(!Lib.LocalDB.FlaDom){trace("first 加载");var _this=this;Lib.LocalDB.registerFun(function(){setTimeout(function(){_this.loaded()},10)});Lib.LocalDB.loadFlash("trayFlashConnetion")}else{this.loaded()}},loaded:function(){var _this=this;if(Lib.LocalDB.get("SUKeya",31536e6)){window.staticunload=function(){if($IE){var e=Core.Events.fixEvent(Core.Events.getEvent());this.record()}else{this.record()}};Core.Events.addEvent(window,Core.Function.bind2(window.staticunload,_this),"beforeunload")}else{Lib.LocalDB.set("SUKeya",window.staticTime+parseInt(Math.random()*1e5).toString());this.record();this.send()}var info=Lib.LocalDB.get("SUInfo",31536e6);if(Lib.LocalDB.get("SULastTime",31536e6)){var lasttime=Lib.LocalDB.get("SULastTime",31536e6);if((new Date).getTime()-lasttime>36e5){this.send()}}else{Lib.LocalDB.set("SULastTime",(new Date).getTime())}},record:function(){var tmp=decodeURIComponent(Lib.LocalDB.get("SUInfo",31536e6));var logininfo="";var refer=document.referrer;if((ts=Utils.Cookie.getCookie("SUBP"))!=""){ts=sinaSSOEncoder.getSUBPCookie.decode(ts);if(ts!="")logininfo+="|lu:"+ts.uid.replace(/(^\s*)|(\s*$)/g,"");if(scope.unreadMsg&&scope.unreadMsg.isbloguser){logininfo+="|ib:"+scope.unreadMsg.isbloguser}if(!Lib.LocalDB.get("SULoginFlag")){logininfo+="|al:1|at:"+(new Date).getTime()}else{if(refer==""){logininfo+="|al:4"}else if(refer.indexOf("blog.sina.com.cn")>-1){logininfo+="|al:2"}else{logininfo+="|al:3"}}if(Utils.Cookie.getCookie("ALF")!=""){logininfo+="|pu:1"}Lib.LocalDB.set("SULoginFlag",true)}else{Lib.LocalDB.set("SULoginFlag",false)}var string="et:"+window.staticTime+"|r:"+refer+"|u:"+window.location.href+"|lt:"+(new Date).getTime().toString()+"|vu:"+scope.$uid+logininfo+";";Lib.LocalDB.set("SUInfo",encodeURIComponent(tmp+string))},send:function(){var k=Lib.LocalDB.get("SUKeya",31536e6);var t=decodeURIComponent(Lib.LocalDB.get("SUInfo",31536e6));var ts=t.split(";");if(ts.length>5){var tinfo="";for(var i=0;i<ts.length;i++){if((i+1)%5==0){v7sendLog("StaticUser","",encodeURIComponent("k:"+k+";"+tinfo));tinfo=""}else{tinfo+=ts[i]+";"}}if(tinfo!=""){v7sendLog("StaticUser","",encodeURIComponent("k:"+k+";"+tinfo))}}else{v7sendLog("StaticUser","",encodeURIComponent("k:"+k+";"+t))}Lib.LocalDB.set("SUInfo","");Lib.LocalDB.set("SULastTime",(new Date).getTime())}};$registJob("static",function(){window.staticClass=new StaticUser;var dowAndroidTipDiscover=function(){var node_dis=document.createElement("div");node_dis.className="dowAndroidTip";node_dis.id="dow_AndroidTip";node_dis.innerHTML=""+'<div class="dowAndroidTipInner">'+'<p style="cursor:pointer;" id="save2mobile">将此博客<span>保存到手机</span></p>'+'<p style="cursor:pointer;" id="save2mobile2">阅读随时随地</p>'+'<span class="arrowMod"><span class="arrowModInner"></span></span>'+'<a id="close_discover" class="close" href="javascript:;" title="关闭">关闭</a>'+"</div>";$E("headarea").appendChild(node_dis);var inputXY=Core.Dom.getXY(document.body);var inputBtnXY=Core.Dom.getXY($E("blogtopoption"));node_dis.style.position="absolute";node_dis.style.left=inputXY[0]+728+"px";node_dis.style.top=inputBtnXY[1]-45+"px";$E("close_discover").onclick=function(){v7sendLog("70_01_05_"+($UID||0));$E("dow_AndroidTip").style.visibility="hidden";return false};$E("save2mobile").onclick=$E("save2mobile2").onclick=function(e){Core.Events.stopEvent(e);v7sendLog("70_01_06_"+($UID||0));window.open("http://appmaster.hudee.com/sina/download.jsp?uid="+scope.$uid);$E("dow_AndroidTip").style.visibility="hidden"}};var androidBtn=Core.Dom.byClz($E("blogtopoption"),"a","dwnAndroid");if(androidBtn.length){androidBtn=androidBtn[0];if(Core.String.trim(androidBtn.innerText||androidBtn.textContent||"")==="下载应用"){dowAndroidTipDiscover()}Core.Events.addEvent(androidBtn,function(){var txt=Core.String.trim(androidBtn.innerText||androidBtn.textContent||""),code;switch(txt){case"下载应用":code="70_01_01_"+($UID||0);break;case"制作应用":code="70_01_02_"+$UID;break;case"管理应用":code="70_01_04_"+$UID;break;case"制作中":code="70_01_03_"+$UID}code&&v7sendLog(code)})}});$registJob("sharePhoto",function(){var foreach=Core.Array.foreach,pageid=scope.$pageid,isArt=pageid=="article"||pageid=="articleM"||pageid=="article_new"||pageid=="articleM_new",uid=scope.$uid,nickName,nowImgSrc,nowImg,wrap=$E("sina_keyword_ad_area2")||document.body,wrapLeft,image,minHeight=62,fixAutoHover=1;var sharewrap=SinaEx.createNode('<div id="sharePhoto" style="display:none;width:120px;position:absolute;">'+'<div class="picShareFlt"><div class="share SG_txtb" style="margin-top:5px;"><span>分享到新浪微博</span></div></div>'+"</div>");var div2=sharewrap.children[0];document.body.appendChild(sharewrap);setTimeout(function(){Lib.Uic.getNickName([uid],function(oResult){nickName=oResult[uid]})},500);function fnover(){if(this.width<165||this.height<minHeight){return false}var left=Core.Dom.getXY(this)[0]+this.width-124;left=Math.min(left,wrapLeft-134);shareConStyle.left=left+"px";shareConStyle.top=Core.Dom.getXY(this)[1]+this.height-minHeight+27+"px";if(fixAutoHover){shareConStyle.display=""}nowImgSrc=encodeURIComponent(this.getAttribute("real_src")||this.src);nowImg=this}function fnout(){var e=Core.Events.getEvent(),et=e.relatedTarget||e.toElement;if(!et||!Core.Dom.contains(sharewrap,et)){shareConStyle.display="none"}}var shareCon=sharewrap,shareConStyle=shareCon.style;Core.Events.addEvent(div2,function(){var f="http://v.t.sina.com.cn/share/share.php?",title=encodeURIComponent("分享"+nickName+"的博文图片："+(isArt?Core.Dom.byClz(document.body,"h2","titName")[0].innerHTML:"")),r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+encodeURIComponent(findLink(nowImg)||document.location)+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124&pic="+nowImgSrc;window.open(u,"mb","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);
v7sendLog("80_01_09");if(typeof SUDA!="undefined"){SUDA.uaTrack("blog_article","h_article21")}Core.Events.stopEvent()});function bindFn(img,attr){if(!(img.getAttribute(attr)||"").indexOf("http://www.sinaimg.cn/uc/myshow/blog/misc/gif/E___")||!Core.Dom.contains(wrap,img)){return}getWrapLeft();image=new Image;Core.Events.addEvent(image,function(){if(this.width>165&&this.height>35){Core.Events.addEvent(img,fnover.bind2(img),"mouseover");Core.Events.addEvent(img,fnout.bind2(img),"mouseout")}}.bind2(image),"load");image.src=img.getAttribute(attr)}function getWrapLeft(){wrapLeft=Core.Dom.getXY(wrap)[0]+wrap.clientWidth}Core.Events.addEvent(window,getWrapLeft,"resize");if(pageid=="index"||pageid=="indexM"||pageid=="article"||pageid=="articleM"||pageid=="article_new"||pageid=="articleM_new"){foreach([$E("module_10001"),$E("module_10002"),$E("module_10003"),$E("module_920")],function(comp){if(comp&&comp.clientWidth>500){wrap=comp;bindWrapFn()}})}function findLink(node){if(isArt){return}var tagMore;while(node=node.parentNode){if(node.className=="content"&&node.nodeName=="DIV"&&(tagMore=node.nextElementSibling||node.nextSibling).className=="tagMore"){return($T(tagMore,"a")[0]||{}).href||""}}}function bindWrapFn(){fixAutoHover=1;foreach($T(wrap,"img"),function(img){bindFn(img,"src")})}if(Lib&&Lib.Component["Comp_10001"]){var _afterLoadList=Lib.Component["Comp_10001"].prototype.afterLoadList;Lib.Component["Comp_10001"].prototype.afterLoadList=function(){fixAutoHover=0;shareConStyle.display="none";_afterLoadList.apply(this,arguments);setTimeout(bindWrapFn,100)}}scope.sharePhoto={bindFn:bindFn}});$registJob("selectionShare",function(){if(!$E("sina_keyword_ad_area2")){return}var tipsNode=$C("div");tipsNode.innerHTML='<img src="http://simg.sinajs.cn/blog7style/images/common/share.gif" title="将选中内容分享到新浪微博"/>';tipsNode.id="selectionShare";tipsNode.style.display="none";tipsNode.style.position="absolute";tipsNode.style.cursor="pointer";document.body.appendChild(tipsNode);Core.Events.addEvent(document.body,function(){hideTips()});Core.Events.addEvent(tipsNode,function(){shareToT();Core.Events.stopEvent()});var nickName=null;Lib.Uic.getNickName([scope.$uid],function(oResult){nickName=oResult[scope.$uid]});var mx=0,my=0;var sx=0,sy=0;var shareWord,shareImg;Core.Events.addEvent($E("sina_keyword_ad_area2"),function(e){var e=Core.Events.getEvent();e=Core.Events.fixEvent(e);setTimeout(function(){var isExist=getSelectContent();if(isExist){setTimeout(function(){showTips()},100);setMousePosition(e)}else{hideTips()}})},"mouseup");Core.Events.addEvent($E("sina_keyword_ad_area2"),function(e){var e=Core.Events.getEvent();e=Core.Events.fixEvent(e);sx=e.pageX;sy=e.pageY},"mousedown");function getSelectContent(){shareWord=null;shareImg=null;var _trim=Core.String.trim;if(document.selection){var sel=document.selection.createRange();var w=sel.text;if(w.length>=10){shareWord=w}var html=sel.htmlText;var s=/<img[\s\S]+src="(\S+)"[\s\S]+>/gim;if(s.test(html)){shareImg=RegExp.$1}}else{try{var sel=window.getSelection().getRangeAt(0);if(!Core.Dom.contains($E("sina_keyword_ad_area2"),sel.commonAncestorContainer)){return}var w=sel.toString();if(w.length>=10){shareWord=w}var div=$C("div");div.appendChild(sel.cloneContents());var img=$T(div,"img");if(img.length>0){shareImg=img[0].src||img[0].real_src}}catch(e){}}if(shareWord){shareWord=_trim(shareWord).replace(/\r|\n/g,"")}return shareWord}function shareToT(){if(shareWord&&shareWord.length>80){shareWord=shareWord.substr(0,80)+"……"}var blogTitleEl=Core.Dom.byClz(document.body,"h2","titName")[0];var blogTitle=blogTitleEl.textContent||blogTitleEl.innerHTML;if(shareWord){var title=encodeURIComponent(shareWord+"——博文片段来自"+nickName+"："+blogTitle)}else{var title=encodeURIComponent("分享"+nickName+"的博文图片："+blogTitle)}var f="http://v.t.sina.com.cn/share/share.php?",r="新浪-博客",l="http://blog.sina.com.cn",u="http://v.t.sina.com.cn/share/share.php?searchPic=false&title="+title+"&url="+document.location+"&source="+r+"&sourceUrl="+encodeURIComponent(l)+"&content=utf-8&appkey=1617465124";if(shareImg){u=u+"&pic="+shareImg}window.open(u,"selectionshare","toolbar=0,status=0,resizable=1,width=440,height=430,left="+(screen.width-440)/2+",top="+(screen.height-430)/2);hideTips()}function showTips(){tipsNode.style.left=mx+"px";tipsNode.style.top=my+"px";tipsNode.style.display=""}function hideTips(){tipsNode.style.display="none"}function setMousePosition(e){if(!$IE){_setLoc();return}var sel=document.selection.createRange();var sel2=sel.duplicate();sel2.collapse(false);sel2.moveStart("word",-1);while(sel2.text.length==0){sel2.moveStart("word",-1)}var isFront=false;if(e.pageY-sy<=-sel2.boundingHeight){isFront=true;trace(11111)}if(Math.abs(e.pageY-sy)<sel2.boundingHeight){if(e.pageX-sx<0){isFront=true;trace(11111)}else{isFront=false;trace(22222)}}sel.collapse(isFront);if(!isFront){sel.moveStart("word",-1);while(sel.text.length==0){sel.moveStart("word",-1);sel.moveEnd("word",-1)}}var tHtml=sel.htmlText;var id="temp_"+parseInt(Math.random()*1e3);var width=sel.boundingWidth,height=sel.boundingHeight;sel.pasteHTML('<a id="'+id+'" >$</a>'+tHtml);var ele=$E(id);if(isFront){mx=Core.Dom.getLeft(ele)+10;my=Core.Dom.getTop(ele)-26-7}else{mx=Core.Dom.getLeft(ele)+width-36;my=Core.Dom.getTop(ele)+height}ele.parentNode.removeChild(ele)}function _setLoc(){var sel=window.getSelection();var index=sel.rangeCount-1;var range=sel.getRangeAt(index);var testSpan=$C("span");var clone=range.cloneRange();var beforeToEnd=false;var refElem;var fontSize;var pos;refElem=range.startContainer;if(range.startContainer!=range.endContainer){if(sel.focusNode!=range.startContainer){beforeToEnd=true;refElem=range.endContainer}}else{if(sel.focusOffset>sel.anchorOffset){beforeToEnd=true}}clone.collapse(!beforeToEnd);clone.insertNode(testSpan);pos=Core.Dom.getXY(testSpan);if(refElem.nodeType==3){refElem=refElem.parentNode}if(refElem.tagName.toUpperCase()=="IMG"){fontSize=refElem.offsetWidth}else{fontSize=Core.Dom.getStyle(refElem,"fontSize");fontSize=parseInt(fontSize.substring(0,fontSize.length-2))}if(beforeToEnd){mx=pos[0]-33;my=pos[1]+10;if(!$FF){my+=fontSize}}else{mx=pos[0]+7;my=pos[1]-36;if($FF){my-=fontSize}}testSpan.parentNode.removeChild(testSpan);sel.removeAllRanges();sel.addRange(range)}});$registJob("toZoneStatic",function(){if(scope.$uid=="1513474044"||scope.$uid=="1632440911"||scope.$uid=="1311747503"||scope.$uid=="1374847633"||scope.$uid=="1265252974"||scope.$uid=="1218670734"||scope.$uid=="1156966391"){Utils.Io.JsLoad.request("http://sjs.sinajs.cn/blog7activity/zoneStatic.js",{isRemove:false,onComplete:function(){if(typeof zoneStatic=="function"){zoneStatic()}if(typeof traceFunction=="function"){traceFunction()}},noreturn:true})}});$registJob("userResidenceTime",function(){function random3m(len,prefix){var lists=["1","2","3","4","5","6","7","8","9","0","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ret=[],total=lists.length;if(prefix)lists=lists.concat(prefix);for(var i=0;i<len;i++){ret.push(lists[Math.floor(Math.random()*total)])}return ret.join("")}function getClientUUid(){var t=(new Date).valueOf();return random3m(15,t.toString().slice(-5).split(""))}var uuid=getClientUUid();function startTest(){v7sendLog("24_01_01_"+scope.$pageid+"_"+uuid,null,null);setInterval(function(){v7sendLog("24_01_01_"+scope.$pageid+"_"+uuid,null,null)},3e3)}Math.floor(Math.random()*100)<1&&startTest()});Lib.templateUtils=function(){};Lib.templateUtils.prototype.getTemplateNodes=function(template){var box=document.createElement("div");var nodes={};var ids_without_rndNum=[];var rndNum=(new Date).getTime().toString().slice(-5)+Math.floor(Math.random()*1e5);var testReg=/#{([a-z0-9_]+)}/gi;template=template.replace(testReg,function(match,f1){ids_without_rndNum.push(f1);return f1+"_"+rndNum});box.innerHTML=template;var i;var len=ids_without_rndNum.length;var key;for(i=0;i<len;i++){key=ids_without_rndNum[i];nodes[key]=this.findById(key+"_"+rndNum,box)}return nodes};Lib.templateUtils.prototype.getIdNodes=function(template){var i,j,len,tagsLen,idName,idNode;var nodes={};var ids=[];var idTags=[];var tags=[];var box=document.createElement("div");box.innerHTML=template;tags=box.getElementsByTagName("*");template.replace(/id *= *"([^{ ]+?)"/gi,function(match,f1){ids[ids.length]=f1});len=tags.length;for(i=0;i<len;i++){if(tags[i].id)idTags[idTags.length]=tags[i]}len=ids.length;for(i=0;i<len;i++){idName=ids[i];j=0;tagsLen=idTags.length;while(j<tagsLen){idNode=idTags[j];if(idName==idNode.id){nodes[idName]=idNode;idTags.splice(j,1)}j++}}return nodes};Lib.templateUtils.prototype.findById=function(id,context,tag){var i;var context=context||document;var tags=context.getElementsByTagName(tag||"*");var len=tags.length;for(i=0;i<len;i++){if(tags[i].getAttribute("id")==id){return tags[i]}}};Lib.templateUtils.prototype.formatTemplate=function(curStr,oParam){var curStr;var formatReg=new RegExp("#{([a-z0-9]+)}","ig");curStr=curStr.replace(formatReg,function(match,f1,index,srcStr){return oParam[f1]});return curStr};!function(){Function.prototype.$defineProto=function(def){var k;for(k in def){this.prototype[k]=def[k]}if(this.__interface__){for(k in this.prototype){if(this.prototype[k]==="NI"){throw new Error("类定义错误，接口方法["+k+"]未实现")}}}this.prototype.constructor=this;this.$extendClass=this.$defineProto=this.$implements=function(){throw new Error("$defineProto 语句定义后面不能再作其它定义")};return this};Function.prototype.$extendClass=function(){var me=this;var i=arguments.length;var sup;var fn;if(i===0){throw new Error("$extendClass 语句错误：未指定父类")}sup=arguments[0];fn=function(){var _this=this;this.$super={};for(var fName in sup.prototype){if(!sup.prototype[fName])continue;this.$super[fName]=function(f){return function(){sup.prototype[f].apply(_this,arguments)}}(fName)}sup.apply(this,arguments);me.apply(this,arguments)};fn.prototype=object(sup.prototype);fn.prototype.constructor=fn;return fn};Function.prototype.$implements=function(){var arg=Array.prototype.slice.call(arguments,0);var fn;var i=arg.length;var k;while(i--){if(typeof arg[i]!=="object"){throw new Error("$implements 语句错误：参数必须为 object 类型")}for(k in arg[i]){typeof this.prototype[k]==="undefined"&&(this.prototype[k]="NI")}}this.__interface__=true;this.$extendClass=function(){throw new Error("$extendClass 语句错误：$extendClass 语句不能出现在 $implements 定义之后")};return this};Function.prototype.$mixProto=function(){this.$extendClass=this.$defineProto=function(){throw new Error("$mixProto 必须放在最后使用")};var srcCls=arguments[0];var srcClsProto=srcCls.prototype;for(var fn in srcClsProto){if(this[fn])throw new Error("目标类有同名方法");if(!srcClsProto[fn])continue;this.prototype[fn]=srcClsProto[fn]}return this};function object(o){function F(){}F.prototype=o;return new F}}();function commonLog(url){var image=window.clog_img=new Image;image.onload=image.onerror=function(){window.clog_img=null};image.src=url+(url.indexOf("?")>0?"&__rnd=":"?")+Math.random();image=null}blogAd.CommAd=function(oParam){var _this=this;var articleBody,__tempNodes,i;var box1=$E("commAd_1");var box2=$E("commAd_2");if(!box1){trace("no id");articleBody=$E("articlebody");__tempNodes=articlebody.getElementsByTagName("strong");for(i=0;i<__tempNodes.length;i++){if(__tempNodes[i].innerHTML=="评论"){box1=__tempNodes[i].parentNode.getElementsByTagName("span")[0]}else if(__tempNodes[i].innerHTML=="发评论"){box2=__tempNodes[i].parentNode.getElementsByTagName("span")[0]}}}this.MARK_ID=2;this.LIMITED=24;var sinaTemp=['<span style="margin-left:15px; width:220px; display:inline-block;">','<a target="_blank" href="http://blog.sina.com.cn/lm/8/2009/0325/105340.html">重要提示：警惕虚假中奖信息</a>',"</span>"].join("");var adTemp='<span style="display:inline-block;width:220px;white-space:nowrap;">#{link}</span>';var interTemp='<span style="margin:0 60px 0 20px; display:inline-block;">|</span>';var ad1="";var ad2="";var ad3="",hasAd=false;Lib.checkAuthor(function(){if(!$isAdmin&&oParam&&!+oParam.code&&oParam.ads){if(oParam.ads[0]&&oParam.ads[0].link){hasAd=true;ad1=_this.formatTemplate(adTemp,{link:oParam.ads[0].link});if(oParam.ads[0].status&&oParam.ads[0].status.adstart)(new Image).src=oParam.ads[0].status.adstart}if(oParam.ads[1]&&oParam.ads[1].link){hasAd=true;ad2=_this.formatTemplate(adTemp,{link:oParam.ads[1].link});if(oParam.ads[1].status&&oParam.ads[1].status.adstart)(new Image).src=oParam.ads[1].status.adstart}if(oParam.ads[2]&&oParam.ads[2].link){hasAd=true;ad3=_this.formatTemplate(adTemp,{link:oParam.ads[2].link});if(oParam.ads[2].status&&oParam.ads[2].status.adstart)(new Image).src=oParam.ads[2].status.adstart}}if(box1){box1.style.display="inline-block"}if(box2){box2.style.display="inline-block"}hasAd&&commonLog("http://1092.adsina.allyes.com/main/adfshow?user=AFP6_for_SINA|2012_add|2012_blog_tjbw_plq_wzl&db=sina&border=0&local=yes&js=ie")},"CommAd"+(new Date).getTime())}.$defineProto({}).$mixProto(Lib.templateUtils);blogAd.insertIns=function(pdps,relateEl,inc,style){inc=inc||"beforeend",style=style||"display:block;";var html='<ins class="sinaads" data-ad-pdps="'+pdps+'" style="'+(style||"")+'"></ins>';relateEl=relateEl||document.body;return Core.Dom.insertHTML(relateEl,html,inc)};var Article={};Article.getSearchReferrer=function(){var o={};var docURL=document.URL;if(docURL.indexOf("blog.sina.com.cn")!=-1&&docURL.indexOf("k=")!=-1){var u=new Utils.Url(docURL);o.key=u.getParam("k");o.type=u.getParam("t");return o}var refer=document.referrer;if(!refer||refer===""){return false}var searchParam={"www.google.co.jp":{param:"q",type:"utf-8"},"www.google.com.hk":{param:"q",type:"utf-8"},"www.baidu.com":{param:"wd",type:"GBK",needTrans:true},"www.soso.com":{param:"query",type:"GBK",needTrans:true},"search.yahoo.com":{param:"p",type:"utf-8"},"cn.bing.com":{param:"q",type:"utf-8"},"www.youdao.com":{param:"q",type:"utf-8"},"www.sogou.com":{param:"query",type:"GBK",needTrans:true},"www.so.com":{param:"q",type:"utf-8"}};for(var k in searchParam){var url=new Utils.Url(refer);if(refer.indexOf(k)!=-1){o.key=url.getParam(searchParam[k]["param"]);o.type=searchParam[k]["type"];o.needTrans=searchParam[k]["needTrans"];break}}if(!o.key||o.key===""){return false}else{return o}};window.sendLogToQing=function(log,uid){if(typeof scope==="undefined"){window.scope={};scope.$uid=scope.$pageid=""}var _log=log||"",_uid=uid||scope.$uid,_pageId=scope.$pageid,timestamp=(new Date).getTime(),value=_log+"|"+timestamp+"|"+_pageId+"|"+_uid;var image=window["actlog_img"]=new Image;image.onLoad=image.onError=function(){window["actlog_img"]=null};image.src=$_GLOBAL.qingURL+"blog/api/actlog.php?msg="+encodeURIComponent(value);image=null};$registJob("searchToQing",function(){var searchData=scope.isFromSearchEngine||Article.getSearchReferrer();if(!searchData){return}var docEle=document.documentElement,docBody=document.body;showQingDiv();function showKwAd(data){var decode=decodeURIComponent,html="",wrap=$C("div"),wrapHeight;wrap.className="blog_skeywords";wrap.style.overflow="hidden";wrap.style.position=$IE6?"absolute":"fixed";wrap.style.right="0px";wrap.style.zIndex=10;html=""+'<dl class="clearfix">'+'<dt><a href="'+decode(data.ad_pic_url)+'" target="_blank" title="'+decode(data.ad_title)+'">'+'<img width="208" height="48" src="'+decode(data.ad_pic_address)+'" alt="'+decode(data.ad_title)+'" />'+"</a></dt>"+"<dd>"+(data.ad_word1?'<p><a href="'+decode(data.ad_word1_url)+'" target="_blank">'+decode(data.ad_word1)+"</a></p>":"")+(data.ad_word2?'<p><a href="'+decode(data.ad_word2_url)+'" target="_blank">'+decode(data.ad_word2)+"</a></p>":"")+"</dd>"+"</dl>"+'<a onclick="this.parentNode.style.display=\'none\';return false;" href="javascript:;" class="close"></a>';wrap.innerHTML=html;docBody.appendChild(wrap);wrapHeight=wrap.offsetHeight;wrap.style.top=(docEle.clientHeight||docBody.clientHeight)-wrapHeight+"px";$IE6&&Core.Events.addEvent(window,function(e){var scrollTop=docEle.scrollTop||docBody.scrollTop,clientHeight=docEle.clientHeight||docBody.clientHeight;wrap.style.top=Math.abs(clientHeight+scrollTop-wrapHeight)+"px"},"scroll");Core.Events.addEvent(window,function(){setTimeout(function(){var scrollTop=docEle.scrollTop||docBody.scrollTop,clientHeight=docEle.clientHeight||docBody.clientHeight;var height=Math.abs(clientHeight-wrapHeight);if($IE6){height=Math.abs(clientHeight+scrollTop-wrapHeight)}wrap.style.top=height+"px"},30)},"resize")}function showQingDiv(){var iframe,div;var divHeight=130,clientHeight=docEle.clientHeight||docBody.clientHeight;var iframeSRC="http://blog.sina.com.cn/lm/iframe/article/searchqing.html?t="+ +new Date;iframe=$C("iframe");iframe.src=iframeSRC;iframe.width="100%";iframe.scrolling="no";iframe.style.border="0px";iframe.frameBorder="no";closeBtn=$C("a");closeBtn.className="nblog_searchBtmBtn";closeBtn.href="javascript:void(0);";closeBtn.title="关闭";closeBtn.innerHTML="关闭";closeBtn.id="serachToQingCloseBtn";closeBtn.onClick="return false";div=$C("div");div.id="searchToQing";div.style.width="100%";div.style.height="100px";div.style.left="0px";div.style.top=clientHeight-divHeight+"px";div.style.position="fixed";div.style.zIndex=201;div.appendChild(closeBtn);div.appendChild(iframe);Core.Events.addEvent(closeBtn,function(){trace("add events to closeBtn");$E("searchToQing").parentNode.removeChild($E("searchToQing"))},"click");if($IE6){div.style.position="absolute";div.style.overflow="hidden";Core.Events.addEvent(window,function(){var scrollTop=docEle.scrollTop||docBody.scrollTop,clientHeight=docEle.clientHeight||docBody.clientHeight;var height=Math.abs(clientHeight-divHeight);if($IE6){height=Math.abs(clientHeight+scrollTop-divHeight)}$E("searchToQing").style.top=height+"px"},"scroll");iframe.style.left=div.style.left;iframe.style.top=div.style.top}docBody.appendChild(div);Core.Events.addEvent(window,function(e){setTimeout(function(){var scrollTop=docEle.scrollTop||docBody.scrollTop,clientHeight=docEle.clientHeight||docBody.clientHeight;var height=Math.abs(clientHeight-divHeight);if($IE6){height=Math.abs(clientHeight+scrollTop-divHeight)}$E("searchToQing").style.top=height+"px"},20)},"resize");Core.Events.addEvent($E("serachToQingCloseBtn"),function(e){sendLogToQing("79_01_12|blog7",$UID||"")},"click");div=null;iframe=null;if($E("searchToQing")&&SUDA){SUDA.uaTrack("blog_sflow","v_sflow")}}});Lib.BlogRecommendDialog=Core.Class.create();Lib.BlogRecommendDialog.prototype={template:['<div class="blogreco" id="#{panel}">','<div id="#{frame}">','<div class="TB" id="#{titleBar}">','<a id="blogNorAd_Cls" class="btnClose" style="position:absolute;left:240px;" href="javascript:">&nbsp;</a>','<a class="btnMin" style="position:absolute;left:220px;" id="#{btnMin}" href="javascript:">&nbsp;</a>',"</div>",'<div id="#{content}"></div>',"</div>","</div>"].join(""),contentUrl:'<iframe frameborder="0" scrolling="no" class="IF" src="http://blog.sina.com.cn/lm/mini/01.html"></iframe>',name:"blogRecoDialog",_slide:null,_dialog:null,_cookie:"dlg680",_mode:null,_timePoints:null,_toolbarHeight:0,width:260,height:210,isMin:false,displayState:"max",closedADLayer:null,closedFlashTemplate:"",_evt:null,initialize:function(mode,timePoints,oParam){var me=this;var nodes;this._mode=mode;this._timePoints=timePoints;this.oParam=oParam;this.isShowClosedAD=!+oParam.code;if(!this._dialog){this._dialog=new Ui.Panel;this._dialog.setTemplate(this.template);nodes=this._dialog.nodes;nodes.btnClose=$E("blogNorAd_Cls");this._dialog.entity.style.zIndex="100";this._dialog.ifm&&(this._dialog.ifm.style.zIndex="100");this._dialog.setContent(this.contentUrl);this._dialog.setFixed(true);this.setPos();if(scope.isFromSearchEngine){this._searchToQing()}}this._evt=new Core.Events.EventDispatcher(this);Core.Events.addEvent(nodes.btnClose,this.close.bind2(this));Core.Events.addEvent(nodes.btnMin,this.toggle.bind2(this));Core.Events.addEvent(window,function(){if(me._dialog&&me._dialog.entity){var clientWidth=document.documentElement.clientWidth||document.body.clientWidth;var clientHeight=document.documentElement.clientHeight||document.body.clientHeight;var _x=Math.max(clientWidth)-me.width,_y=Math.max(clientHeight)-me.height-me._toolbarHeight;if(scope.isFromSearchEngine){_y-=100}me._dialog.setPosition({x:_x,y:_y})}},"resize")},setPos:function(){var w=document.documentElement.clientWidth||document.body.clientWidth;var h=document.documentElement.clientHeight||document.body.clientHeight;var _x=w-this.width;var _y=h-this.height-this._toolbarHeight;if(scope.isFromSearchEngine){_y-=100}this._dialog.setPosition({x:_x,y:_y})},show:function(){var me=this;this._dialog.show();this._evt.dispatchEvent("show");this.uiStatus="2";this._slide=new Ui.Slide($E(this._dialog.entity.id));var cs=this._slide.container.style;if($IE6){cs.overflow="visible";cs.height=0}else{cs.position="absolute"}this._slide.onSlideMax=function(){me._evt.dispatchEvent("max")};this._slide.slideMax=function(){this.node.style.marginTop=this.offset+"px";new Ui.tween(this.node,"marginTop",0,this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideMax})}.bind2(this._slide);this._slide.onSlideMin=function(){me._evt.dispatchEvent("min")};this._slide.slideMin=function(){new Ui.tween(this.node,"marginTop",this.offset-28,this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideMin})}.bind2(this._slide);this._slide.slideIn=function(){new Ui.tween(this.node,"marginTop",this.offset,5*this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideIn})}.bind2(this._slide);this._slide.onSlideIn=function(){Core.Dom.removeNode(this._dialog.entity);this._dialog.entity=null;me._evt.dispatchEvent("close");setTimeout(function(){var rightADWrap=$E("rightADWrap");if(rightADWrap){Core.Dom.setStyle(rightADWrap,"right","0")}},1e3)}.bind2(this);this._slide.slideMax();if(!blogAd.getInitPermission(this.oParam))return;this.oParam=this.oParam.ads[0];var rightADWrap=$E("rightADWrap");var rightWidth=this.width;if(rightADWrap){Core.Dom.setStyle(rightADWrap,"right",rightWidth+"px")}},toggle:function(){if(this._dialog.nodes.btnMin){var clazz=this._dialog.nodes.btnMin.className;if(clazz=="btnMin"){clazz="btnMax";this.uiStatus="1";this._slide.slideMin()}else{clazz="btnMin";this.uiStatus="2";this._slide.slideMax()}this._dialog.nodes.btnMin.className=clazz;clazz=null;this.onToggle()}},close:function(){Utils.Cookie.setCookie(this._cookie,(new Date).getHours(),24,"/");var me=this;me.uiStatus="0";Lib.execZhitou(function(res){var ad=new sinaadToolkit.Box({position:"right bottom",width:300,height:250,follow:1});ad.getMain().innerHTML='<ins class="sinaads" id="PDPS000000060681" data-ad-status="async" data-ad-pdps="PDPS000000060681"></ins>';setTimeout(function(){(sinaads=window.sinaads||[]).push({element:$E("PDPS000000060681"),params:{sinaads_success_handler:function(){ad.show();setTimeout(function(){ad.hide()},5e3)}}})},1e3)});this._slide.slideIn()},createNode:function(txt){var _box=$C("div");_box.innerHTML=txt;return _box.childNodes[0]},_initClosedAD:function(){this.closedFlashTemplate=['<div id="#{panel}">','<div id="#{content}">','<div id="blogVideoAd" width="'+this.oParam.width+'" height="'+this.oParam.height+'"></div>',"</div>","</div>"].join("");this.closedADLayer=new Ui.Panel;this.closedADLayer.setTemplate(this.closedFlashTemplate);this.closedADLayer.entity.style.zIndex="100";this.closedADLayer.__iframe&&(this.closedADLayer.__iframe.style.zIndex="100");var pageSize=Core.System.pageSize();var _x=Math.min(pageSize[2],document.documentElement.clientWidth)-this.oParam.width;var _y=Math.min(pageSize[3],document.documentElement.clientHeight)-this.oParam.height;if(scope.isFromSearchEngine){_y-=100}this.closedADLayer.setFixed(true).setPosition({x:_x,y:_y});var obj=this.oParam;var nodes=this.closedADLayer.nodes;var ctx=$E("blogVideoAd");if(!ctx)return;switch(obj.type){case"mixed":ctx.innerHTML=obj.content;trace(obj.content);break;case"pic":ctx.innerHTML='<img src="'+obj.ref+'" style="width:'+obj.width+"px; height:"+obj.height+'px;" />';if(obj.click){ctx.style.position="relative";nodes.cantSeeMe=this.createNode('<a href="#" target="_blank"></a>');nodes.cantSeeMe.href=obj.click;nodes.cantSeeMe.style.cssText=($IE?"filter:alpha(opacity=0);":"opacity:0")+"; height:"+obj.height+"px; width:"+obj.width+"px; background:#F00; display:block;"+"z-index:1020; position:absolute; left:0; top:0;";ctx.appendChild(nodes.cantSeeMe)}break;case"swf":this.appendSwf(obj.ref,"",obj.width,obj.height,ctx.id);if(obj.click){ctx.style.position="relative";nodes.cantSeeMe=this.createNode('<a href="#" target="_blank"></a>');nodes.cantSeeMe.href=obj.click;nodes.cantSeeMe.style.cssText=($IE?"filter:alpha(opacity=0);":"opacity:0")+"; height:"+obj.height+"px; width:"+obj.width+"px; background:#F00; display:block;"+"z-index:1020; position:absolute; left:0; top:0;";ctx.appendChild(nodes.cantSeeMe)}break}},appendSwf:function(url,ObjId,width,height,targetId){if(typeof sinaFlash=="undefined")return;var swfAdder=new sinaFlash(url,ObjId,width+"",height+"","9","#FFFFFF",false,"High","http://www.sina.com.cn/","http://www.sina.com.cn/",false);swfAdder.addParam("allowScriptAccess","always");swfAdder.addParam("wmode","transparent");swfAdder.write(targetId)},onToggle:function(){},addEventListener:function(type,fun){this._evt.addEventListener(type,fun)},getHeight:function(){var flashAd=this.closedADLayer;var height=0;if(this._dialog.entity){trace("dialog height");height=this._dialog.entity.clientHeight-parseInt(this._slide.node.style.marginTop);height>0?height:0;trace("dialog height"+height)}if(flashAd){trace("flash height====");height=flashAd.clientHeight;trace("flash height===="+height)}return height},_searchToQing:function(){var me=this;Core.Events.addEvent($E("serachToQingCloseBtn"),function(){if(scope.isFromSearchEngine){scope.isFromSearchEngine=!1;if(me._dialog&&me._dialog.entity){var y=Math.max(document.documentElement.clientHeight)-me.height-me._toolbarHeight,x=Math.max(document.documentElement.clientWidth)-me.width;me._dialog.setPosition({x:x,y:y})}if(me.closedADLayer&&me.closedADLayer.entity){var closeADLayer=me.closedADLayer.entity;var top=closeADLayer.style.top;closeADLayer.style.top=parseInt(top)+100+"px"}}},"click")}};Lib.ADBlogRecommendDialog=Core.Class.create();Lib.ADBlogRecommendDialog.prototype={template:['<div id="#{panel}" class="popBox">','<div id="#{frame}" class="popBox_bg">','<div id="#{popFlashContent}" class="popFlash" style="z-index:10;">','<a target="_blank" id="#{clickURL}" style="display:none;position:absolute;"></a>',"</div>",'<div id="#{popMain_bg}" class="popMain_bg" style="z-index:11;"></div>','<div class="popMain" style="z-index:12">','<div id="#{content}">',"</div>","</div>",'<div id="#{titleBar}" class="popBox_btn" style="z-index:12;">','<a id="#{btnMin}" href="#" onclick="return false;" title="" class="mini"></a>','<a id="blogNorAd_Cls" href="#" onclick="return false;" title="" class="close"></a>',"</div>","</div>","</div>"].join(""),contentUrl:'<iframe style="width:100%;height:185px;" allowtransparency="yes" frameborder="0" scrolling="no" src="http://blog.sina.com.cn/lm/mini/noborder/01.html"></iframe>',name:"blogRecoDialog",_slide:null,_dialog:null,_cookie:"ad680",_mode:null,_timePoints:null,flashURL:"",picURL:"",flashWidth:0,flashHeight:0,tjURL:"",btnURL:"",clickURL:"",_toolbarHeight:0,width:262,height:255,isMin:false,displayState:"max",closedADLayer:null,closedFlashTemplate:"",_evt:null,initialize:function(mode,timePoints,picURL,flashURL,flashWidth,flashHeight,tjURL,btnURL,clickURL,oParam){var me=this;var nodes;this._mode=mode;this.flashURL=flashURL;this.picURL=picURL;this.flashWidth=flashWidth;this.flashHeight=flashHeight;this.tjURL=tjURL;this.btnURL=btnURL;this.clickURL=clickURL;this._timePoints=timePoints;this.oParam=oParam;if(!+oParam.code){this.isShowClosedAD=true}if(!this._dialog){this._dialog=new Ui.Panel;this._dialog.setTemplate(this.template);nodes=this._dialog.nodes;nodes.btnClose=$E("blogNorAd_Cls");this._dialog.entity.style.zIndex="1000";this._dialog.ifm&&(this._dialog.ifm.style.zIndex="100");this._dialog.setContent(this.contentUrl);this._dialog.setFixed(true);this.setPos();if(scope.isFromSearchEngine){this._searchToQing()}}this._evt=new Core.Events.EventDispatcher(this);Core.Events.addEvent(nodes.btnClose,this.close.bind2(this));Core.Events.addEvent(nodes.btnMin,this.toggle.bind2(this));Core.Events.addEvent(window,function(){if(me._dialog&&me._dialog.entity){var y=Math.max(document.documentElement.clientHeight)-me.height-me._toolbarHeight,x=Math.max(document.documentElement.clientWidth)-me.width;if(scope.isFromSearchEngine){y-=100}me._dialog.setPosition({x:x,y:y})}},"resize");!this.clickURL&&this.initFlashAD(nodes.popFlashContent.id)},setPos:function(){var w=document.documentElement.clientWidth||document.body.clientWidth;var h=document.documentElement.clientHeight||document.body.clientHeight;var _x=w-this.width;var _y=h-this.height-this._toolbarHeight;if(scope.isFromSearchEngine){_y-=100}this._dialog.setPosition({x:_x,y:_y})},initFlashAD:function(nodeID){var sinaFlash2=new sinaFlash(this.flashURL,"popSmallFlash",this.flashWidth,this.flashHeight,"8","#FFFFFF",false,"High","http://www.sina.com.cn/","http://www.sina.com.cn/",false);sinaFlash2.addParam("allowScriptAccess","always");sinaFlash2.addParam("wmode","transparent");sinaFlash2.write(nodeID)},show:function(){var nodes=this._dialog.nodes;nodes.frame.style.backgroundImage="url("+this.picURL+")";nodes.btnClose.style.backgroundImage="url("+this.btnURL+")";nodes.btnMin.style.backgroundImage="url("+this.btnURL+")";nodes.popMain_bg.style.backgroundImage="url("+this.tjURL+")";if(this.clickURL){nodes.clickURL.style.display="";nodes.clickURL.style.width=(this.flashWidth||260)+"px";nodes.clickURL.style.height=(this.flashHeight||50)+"px";nodes.clickURL.href=this.clickURL}var me=this;this._dialog.show();this._evt.dispatchEvent("show");this.uiStatus="2";this._slide=new Ui.Slide($E(this._dialog.entity.id));var cs=this._slide.container.style;cs.top="0px";if($IE6){cs.overflow="visible";cs.height=0}else{cs.position="absolute"}this._slide.onSlideMax=function(){me._evt.dispatchEvent("max")};this._slide.slideMax=function(){this.node.style.marginTop=this.offset+"px";new Ui.tween(this.node,"marginTop",0,this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideMax})}.bind2(this._slide);this._slide.onSlideMin=function(){me._evt.dispatchEvent("min")};this._slide.slideMin=function(){new Ui.tween(this.node,"marginTop",this.offset-55,this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideMin})}.bind2(this._slide);this._slide.slideIn=function(){new Ui.tween(this.node,"marginTop",this.offset,5*this.duration,this.animation,{tween:function(x){}.bind2(this),end:this.onSlideIn})}.bind2(this._slide);this._slide.onSlideIn=function(){Core.Dom.removeNode(this._dialog.entity);this._dialog.entity=null;me._evt.dispatchEvent("close")}.bind2(this);this._slide.slideMax();if(!blogAd.getInitPermission(this.oParam))return;this.oParam=this.oParam.ads[0];commonLog("http://1088.adsina.allyes.com/main/adfshow?user=AFP6_for_SINA|2012_add|2012_blog_fdtc_bk&db=sina&border=0&local=yes&js=ie");var rightADWrap=$E("rightADWrap");if(rightADWrap){Core.Dom.setStyle(rightADWrap,"right","260px")}},toggle:function(){if(this._dialog.nodes.btnMin){if(this.displayState=="max"){this.uiStatus="1";this._slide.slideMin();this.displayState="min"}else{this.uiStatus="2";this._slide.slideMax();this.displayState="max"}this.onToggle()}},close:function(){Utils.Cookie.setCookie(this._cookie,(new Date).getHours(),24,"/");var me=this;me.uiStatus="0";Lib.execZhitou(function(res){var ad=new sinaadToolkit.Box({position:"right bottom",width:300,height:250,follow:1});ad.getMain().innerHTML='<ins class="sinaads" id="PDPS000000058147" data-ad-status="async" data-ad-pdps="PDPS000000058147"></ins>';setTimeout(function(){(sinaads=window.sinaads||[]).push({element:$E("PDPS000000058147"),params:{sinaads_success_handler:function(){ad.show();setTimeout(function(){ad.hide()},5e3)}}})},1e3)});this._slide.slideIn()},createNode:function(txt){var _box=$C("div");_box.innerHTML=txt;return _box.childNodes[0]
},appendSwf:function(url,ObjId,width,height,targetId){if(typeof sinaFlash=="undefined")return;var swfAdder=new sinaFlash(url,ObjId,width+"",height+"","9","#FFFFFF",false,"High","http://www.sina.com.cn/","http://www.sina.com.cn/",false);swfAdder.addParam("allowScriptAccess","always");swfAdder.addParam("wmode","transparent");swfAdder.write(targetId)},onToggle:function(){},addEventListener:function(type,fun){this._evt.addEventListener(type,fun)},getHeight:function(){var flashAd=this.closedADLayer;var height=0;if(this._dialog.entity){trace("dialog height");height=this._dialog.entity.clientHeight-parseInt(this._slide.node.style.marginTop);height>0?height:0;trace("dialog height"+height)}if(flashAd&&flashAd.entity.style.display!="none"){trace("flash height====");height=this.oParam.height;trace("flash height===="+height)}return height},_searchToQing:function(){var me=this;Core.Events.addEvent($E("serachToQingCloseBtn"),function(){if(scope.isFromSearchEngine){scope.isFromSearchEngine=!1;if(me._dialog&&me._dialog.entity){var y=Math.max(document.documentElement.clientHeight)-me.height-me._toolbarHeight,x=Math.max(document.documentElement.clientWidth)-me.width;me._dialog.setPosition({x:x,y:y})}if(me.closedADLayer&&me.closedADLayer.entity){var closeADLayer=me.closedADLayer.entity;var top=closeADLayer.style.top;closeADLayer.style.top=parseInt(top)+100+"px"}}},"click")}};scope.searchEngineList={"www.google.com":{param:"q",encode:"utf-8"},"www.google.com.hk":{param:"q",encode:"utf-8"},"www.baidu.com":{param:"wd",encode:"gbk"},"www.soso.com":{param:"w",encode:"gbk"},"cn.yahoo.com":{param:"p",encode:"utf-8"},"search.yahoo.com":{param:"p",encode:"utf-8"},"web.gougou.com":{param:"search",encode:"utf-8"},"cn.bing.com":{param:"q",encode:"utf-8"},"www.youdao.com":{param:"q",encode:"utf-8"},"www.sogou.com":{param:"query",encode:"gbk"},"uni.sina.com.cn":{param:"k",encode:"gbk"},"search.sina.com.cn":{param:"q",encode:"utf-8"}};scope.searchFloatingLayerTemplate=['<div id="statBottomforniangs" class="blog_sfout">','<div class="blog_srhflt">','<div id="searchFloatingLayer_LeftContentArea" class="blog_sfL">','<div class="blog_sfTit"><a href="#" onclick="v7sendLog && v7sendLog(\'85_01_01\');return false;" id="searchFloatingLayer_RelatedArticle" target="_blank">相关博文</a></div>','<div class="blog_sflist">','<ul id="searchFloatingLayer_RelatedArticleList"></ul>','<span class="SG_more"><a href="#" onclick="v7sendLog && v7sendLog(\'85_01_04\');return false;" id="searchFloatingLayer_More" target="_blank">更多&gt;&gt;</a></span>',"</div>","</div>",'<div class="blog_sM" id="searchFloatingLayer_ad"></div>','<div class="blog_sfR">','<div class="mren">',"<strong>看看名嘴们都在说什么</strong>",'<ul class="mren_list" id="searchFloatingLayer_CelebrityList"></ul>','<div class="clear"></div>',"</div>","</div>",'<div class="clear"></div>',"</div>",'<div class="blog_sfClo"><a id="searchFloatingLayer_CloseBtn" href="#" onclick="return false;"></a></div>',"</div>"].join("");scope.searchFloatingLayer={dataURL:"http://control.blog.sina.com.cn/riaapi/article/search_recommend.php",isDisplay:function(){var anchorObj=new Utils.Url(window.location.href).anchor||{};var keyword=anchorObj.sFLKeyword;var refer=document.referrer;if(window.location.host==="blog.sina.com.cn"&&keyword){this.keyword=keyword;this.encode=anchorObj.sFLEncode||"utf-8";return true}if(!refer)return;var sList=scope.searchEngineList;var urlObj=new Utils.Url(refer);for(var searchEngine in sList){if(urlObj.url.indexOf(searchEngine)>-1){this.keyword=urlObj.getParam(sList[searchEngine]["param"]);if((searchEngine==="search.sina.com.cn"||searchEngine==="www.baidu.com")&&urlObj.getParam("ie")){this.encode=urlObj.getParam("ie")}else{this.encode=sList[searchEngine]["encode"]}return true}}},displayFloatingLayer:function(oParam){var _this=this;if(!blogAd.getInitPermission(oParam))return;oParam=oParam.ads[0];Utils.Io.JsLoad.request(this.dataURL,{charset:"utf-8",noencode:true,GET:{encode:this.encode,keyword:this.keyword},onComplete:function(result){if(result&&result.code==="A00006"){_this.createFloatingLayerWithData(result.data,oParam)}else{}}})},createFloatingLayerWithData:function(data,oParam){if(data.relatedArticle&&data.relatedArticle.length===0)return;var searchPanel=new Ui.Panel;searchPanel.setTemplate('<div id="#{panel}">'+scope.searchFloatingLayerTemplate+"</div>").setFixed(true);searchPanel.show();searchPanel.entity.style.zIndex="9999";updatemsnFeedFloatLayerPos($IE6?"":"first");Core.Events.addEvent($E("searchFloatingLayer_CloseBtn"),function(){searchPanel.destroy()});Core.Events.addEvent(window,function(){updatemsnFeedFloatLayerPos()},"resize",false);this.updateContent(data,oParam);!$IE6&&this.playDisplayEffect(searchPanel);function updatemsnFeedFloatLayerPos(first){var winWidth=document.documentElement.clientWidth;var winHeight=document.documentElement.clientHeight;searchPanel.setPosition({x:0,y:winHeight-(first?0:searchPanel.entity.offsetHeight)});$E("statBottomforniangs").style.width=winWidth+"px"}},updateContent:function(data,oParam){var aArr=data.relatedArticle;var cArr=data.celebrity;var i;var aHTML=[];var cHTML=[];var url="http://search.sina.com.cn/?c=blog&by=title&range=all&q="+this.keyword+"&ie="+this.encode;var __adNode=$E("searchFloatingLayer_ad");var __cantSeeMe;for(i=0;i<aArr.length&&i<2;i++){aHTML[aHTML.length]="<li>";if(aArr[i].isRecommend){aHTML[aHTML.length]='<img class="SG_icon SG_icon107" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" width="18" height="18" title="推荐" align="absmiddle" />'}aHTML[aHTML.length]="<a onclick=\"v7sendLog && v7sendLog('85_01_0"+(2+i)+'\');" href="'+aArr[i].url.replace(/\?.*/,"")+"#sFLKeyword="+this.keyword+"&sFLEncode="+this.encode+'" target="_blank">'+aArr[i].title.replace(data.keyword,'<span class="blog_sfNm">'+data.keyword+"</span>")+"</a>";aHTML[aHTML.length]="</li>"}if(aArr.length===1){$E("searchFloatingLayer_LeftContentArea").className="blog_sfL blog_onlyone"}if(data.type===1){$E("searchFloatingLayer_RelatedArticle").parentNode.className="blog_sfTit blog_nofTit"}$E("searchFloatingLayer_RelatedArticleList").innerHTML=aHTML.join("");for(i=0;i<cArr.length&&i<5;i++){cHTML[cHTML.length]="<li>";cHTML[cHTML.length]="<a onclick='v7sendLog && v7sendLog(\"85_01_0"+(5+i)+"\");' href='http://blog.sina.com.cn/u/"+cArr[i].uid+"#sFLKeyword="+encodeURIComponent(cArr[i].uname)+"&sFLEncode=utf-8' target='_blank'>"+cArr[i].uname+"</a>";cHTML[cHTML.length]="</li>"}$E("searchFloatingLayer_CelebrityList").innerHTML=cHTML.join("");$E("searchFloatingLayer_RelatedArticle").href=url;$E("searchFloatingLayer_More").href=url+"&s=2";if(!oParam||!__adNode)return;if(oParam.type=="swf"){this.appendSwf(oParam.ref,"",oParam.width,oParam.height,__adNode)}else{__adNode.style.cssText="height:"+oParam.height+"px; width:"+oParam.width+"px;";__adNode.innerHTML="<img src='"+oParam.ref+"' alt=''/>"}if(oParam.click){__adNode.style.position="relative";__cantSeeMe=this.createNode('<a href="#" target="_blank"></a>');__cantSeeMe.href=oParam.click;__cantSeeMe.style.cssText=($IE?"filter:alpha(opacity=0);":"opacity:0")+"; height:"+oParam.height+"px; width:"+oParam.width+"px; background:#F00; display:block;"+"z-index:1020; position:absolute; left:0; top:0;";__adNode.appendChild(__cantSeeMe)}__adNode.style.marginTop=parseInt((70-oParam.height)/2)+"px"},createNode:function(txt){var _box=$C("div");_box.innerHTML=txt;return _box.childNodes[0]},playDisplayEffect:function(panel){var domElement=panel.entity;var top=parseInt(domElement.style.top);var tweenObj=new Ui.TweenStrategy(top,top-domElement.offsetHeight,.5);tweenObj.onTween=function(v){domElement.style.top=v+"px"};tweenObj.onEnd=function(){panel.setPosition({x:0,y:document.documentElement.clientHeight-domElement.offsetHeight})};tweenObj.start()},appendSwf:function(url,id,width,height,targetId){if(typeof sinaFlash=="undefined")return;var sinaFlash2=new sinaFlash(url,id,width+"",height+"","9","#FFFFFF",false,"High","http://www.sina.com.cn/","http://www.sina.com.cn/",false);sinaFlash2.addParam("allowScriptAccess","always");sinaFlash2.addParam("wmode","transparent");sinaFlash2.write(targetId)}};$registJob("outSearch",function(){(typeof BlogAd=="undefined"?loadJsAd:loadAd)();function loadJsAd(){Utils.Io.JsLoad.request("http://pfp.sina.com.cn/blog/js/blogad.js",{charset:"gb2312",onComplete:function(){if(typeof BlogAd=="undefined")return;loadAd()},isRemove:false})}function loadAd(){new BlogAd({pos:"jumpin"}).getAd(function(res){if(!+res.code)Utils.Io.loadExternalCSS($_GLOBAL.cssBasicURL+"module/layer/re_seach.css",function(){var sObj=scope.searchFloatingLayer;if(sObj.isDisplay()){sObj.displayFloatingLayer(res)}})})}});blogAd.popAd=function(){var nextDisplayTime=1;var blogreco;var isToggle=false;var oParam={code:"2101",ads:{0:{type:"mixed"}}};var that={};setTimeout(function(){Lib.Listener.notify("blogRecommendAfter")},4e3);if(scope.handler_680!=null){return}scope.handler_680=null;that.renderPopAd=function(data){if(checkAd()==false){$callJob("outSearch");return}var isAD=data&&data.isAD;if(isAD){var t="?"+(new Date).getTime();data.flashURL&&(data.flashURL+=t);data.picURL&&(data.picURL+=t);data.borderImg&&(data.borderImg+=t);data.btnImg&&(data.btnImg+=t);blogreco=new Lib.ADBlogRecommendDialog("once",nextDisplayTime,data.picURL,data.flashURL,data.flashWidth,data.flashHeight,data.borderImg,data.btnImg,data.clickUrl,oParam);blogreco.onToggle=function(){isToggle=true};var img=new Image;img.onload=function(){scope.handler_680=blogreco;scope.Bind680EventHandler&&scope.Bind680EventHandler();blogreco.show();tryCallOutSearch();setTimeout(function(){if(!isToggle&&blogreco._slide&&blogreco.displayState=="max"){blogreco.toggle()}},6e4);img=null};img.src=data.picURL;var isBindFun=false;if(data.logurls){blogreco.addEventListener("show",function(){if(!isBindFun){isBindFun=true;Core.Events.addEvent(blogreco._dialog.nodes.popFlashContent,Core.Function.bind3(adClickCounts,this,[data.logurls]),"click")}})}}else{blogreco=new Lib.BlogRecommendDialog("once",nextDisplayTime,oParam);blogreco.onToggle=function(){isToggle=true};scope.handler_680=blogreco;scope.Bind680EventHandler&&scope.Bind680EventHandler();blogreco.show();tryCallOutSearch();setTimeout(function(){if(!isToggle&&blogreco._slide&&blogreco._dialog.nodes.btnMin.className=="btnMin"){blogreco.toggle()}},6e4)}};function checkAd(){var match=document.cookie.match(/(?:ad|dlg)680=(\d+)/);return match?classHour(match[1])!==classHour((new Date).getHours()):true}function classHour(hour){if(hour>21){return 1}else if(hour>14){return 3}else if(hour>7){return 2}else{return 1}}function tryCallOutSearch(){if(!blogreco._dialog.entity){$callJob("outSearch")}else{if(blogreco._dialog.entity.style.display=="none"){$callJob("outSearch")}}}function adClickCounts(logurls){for(var i=0;i<logurls.length;i++){commonLog&&commonLog(logurls[i])}}return that};$registJob("tjAd",function(){scope.isFromSearchEngine=Article.getSearchReferrer();var isTj=window.location.href.indexOf("tj=1")>-1;var isMid=scope.$pageid.indexOf("articletj")>-1;new blogAd.CommAd;var cdn=~~(Math.random()*100)%10;var adJsDomain="http://d"+cdn+".sina.com.cn";Lib.util.loadScript(adJsDomain+"/litong/zhitou/sinaads/release/spec/getSinaadsExParamsForBlog.js",function(){});!function(){if(!isMid){Lib.execZhitou(function(res){var styleStr="width:1000px; display:block; margin:0 auto";var listener=Lib.Listener;var $adEl=blogAd.insertIns("PDPS000000049439",$E("trayFlashConnetion").parentNode,"beforebegin",styleStr);listener.notify("topad680-show-start",{});function end(){var $blogbody=$E("sinabloga");if($blogbody){var $rndv=$E("ramdomVisitDiv");$rndv&&($rndv.style.top=$blogbody.offsetTop+"px")}}(window.sinaads||[]).push({element:$adEl,params:{sinaads_ad_width:1e3,sinaads_success_handler:function(){end();listener.notify("topad680-show-end",{show:!0})},sinaads_fail_handler:function(){end();listener.notify("topad680-show-end",{show:!1})}}})})}else{var m904=$E("module_904");var m904TopAd=$E("module_904_top_ad");var tj2Tpl='<div class="right_fixed_area"  id="rightFixedArea"></div>';if(m904TopAd){Utils.insertTemplate(m904TopAd,tj2Tpl,"beforebegin")}else{Utils.insertTemplate(m904,tj2Tpl,"beforebegin")}var tj2Style=document.createElement("style");var cssText=[".right_fixed_area{margin-bottom:10px;}",".right_fixed{position: fixed;top: 0;width: 300px;}"].join("\n");tj2Style.setAttribute("type","text/css");if(tj2Style.styleSheet){tj2Style.styleSheet.cssText=tj2Style.innerHTML+cssText}else{tj2Style.appendChild(document.createTextNode(cssText))}$T(document,"head")[0].appendChild(tj2Style);Lib.execZhitou(function(res){var $adEl=blogAd.insertIns("PDPS000000055753",$E("rightFixedArea"),"afterbegin");(window.sinaads||[]).push({element:$adEl,params:{sinaads_success_handler:function(){var reIE=/MSIE\s([^;]*)/;var browser={ie:0,loaded:false};!function(browser){function toNumber(str){var count=0;return parseFloat(str.replace(/\./g,function(){count++;return count===1?".":""}))}var ua=navigator&&navigator.userAgent||"";var temp=ua.match(reIE);if(temp&&temp[1]){browser.ie=toNumber(temp[1])}}(browser);!function(){var utils={byId:function(id){if(typeof id!=="string"){return id}else{return document.getElementById(id)}},getByClassName:function(str,root,tag){if(root){root=typeof root=="string"?document.getElementById(root):root}else{root=document.body}tag=tag||"*";var els=root.getElementsByTagName(tag),arr=[];for(var i=0,n=els.length;i<n;i++){for(var j=0,k=els[i].className.split(" "),l=k.length;j<l;j++){if(k[j]==str){arr.push(els[i]);break}}}return arr},hasClass:function(elem,cls){var reg=new RegExp("(^|\\s)"+cls+"($|\\s)");return reg.test(elem.className)},removeClass:function(elem,cls){var reg=new RegExp("(^|\\s)"+cls+"($|\\s)","g");elem.className=elem.className.replace(reg," ")},addClass:function(elem,cls){if(!utils.hasClass(elem,cls)){elem.className+=" "+cls}},viewData:function(){var e=0,l=0,i=0,g=0,f=0,m=0;var j=window,h=document,k=h.documentElement;e=k.clientWidth||h.body.clientWidth||0;l=j.innerHeight||k.clientHeight||h.body.clientHeight||0;g=h.body.scrollTop||k.scrollTop||j.pageYOffset||0;i=h.body.scrollLeft||k.scrollLeft||j.pageXOffset||0;f=Math.max(h.body.scrollWidth,k.scrollWidth||0);m=Math.max(h.body.scrollHeight,k.scrollHeight||0,l);return{scrollTop:g,scrollLeft:i,documentWidth:f,documentHeight:m,viewWidth:e,viewHeight:l}}};function getPosition(a){for(var b={x:0,y:0};a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop,a=a.offsetParent;return b}function addEvent(obj,eventType,func){if(obj.attachEvent){obj.attachEvent("on"+eventType,func)}else{obj.addEventListener(eventType,func,false)}}if(browser.ie!=6){var container=utils.byId("rightFixedArea");var sidebar=utils.byId("column_2");var theY=getPosition(sidebar).y+sidebar.offsetHeight;setTimeout(function(){theY=getPosition(sidebar).y+sidebar.offsetHeight},1e3);function adjustADPosition(bottomHeight){var adY=getPosition(sidebar).y+sidebar.offsetHeight;if(adY!=0){if(utils.hasClass("container","right_fixed")){theY=adY+container.offsetHeight}else{theY=adY}}var adH=container.offsetHeight;var vD=utils.viewData();if(vD.documentHeight-bottomHeight-vD.scrollTop>=adH){if(vD.scrollTop>=theY){utils.addClass(container,"right_fixed")}else{utils.removeClass(container,"right_fixed")}}else{utils.removeClass(container,"right_fixed")}}var scrollTimeout=null;var scrollCallback=function(){adjustADPosition(160)};var resizeTimeout=null;addEvent(window,"scroll",function(){if(scrollTimeout)window.clearTimeout(scrollTimeout);scrollTimeout=window.setTimeout(scrollCallback,10)});addEvent(window,"resize",function(){if(resizeTimeout)window.clearTimeout(resizeTimeout);resizeTimeout=window.setTimeout(scrollCallback,10)})}}()}}})})}Lib.execZhitou(function(res){var $adEl=blogAd.insertIns("PDPS000000051781");$adEl.style.display="none";var popAd=blogAd.popAd();(window.sinaads||[]).push({element:$adEl,params:{sinaads_success_handler:function(elem,data){elem.style.display="none";var result;function sinaadsAdapter(saxData){var result={};if(data.content[0].src[0].replace(/(^\s*)|(\s*$)/g,"").length===0){result.isAD=false}else{result={isAD:true,flashURL:adJsDomain+"/litong/kuaijieweibo/yafeng/boke/sc/bk.swf",flashWidth:293,flashHeight:60,picURL:saxData.content[0].src[0],clickUrl:saxData.content[0].link[0],borderImg:adJsDomain+"/litong/kuaijieweibo/yafeng/boke/images/imgbgnn.gif",btnImg:adJsDomain+"/201007/09/237719_btn.gif",logurls:saxData.content[0].monitor}}return result}result=sinaadsAdapter(data);popAd.renderPopAd(result)},sinaads_fail_handler:function(elem,data){elem.style.display="none";popAd.renderPopAd({isAD:false})}}})});if(!isMid){Lib.checkAuthor(function(){var isShow=!$isAdmin;if(!isShow)return;Lib.execZhitou(function(res){var beforeNode;if(!beforeNode){var n=$E("module_904")||$E("module_903");var c=n.parentNode.children;if(3>c.length){beforeNode=n.parentNode.lastChild}else{beforeNode=c[2]}}var newEl=blogAd.insertIns("PDPS000000055124",beforeNode,"afterend");(window.sinaads||[]).push({element:newEl,params:{sinaads_success_handler:function(){newEl.style.marginBottom="10px"}}})})},"tjAd"+(new Date).getTime())}}();!function(){Lib.Listener.on({name:"blogRecommendAfter",callBack:function(isHidden){Lib.execZhitou(function(res){var url=adJsDomain+"/litong/zhitou/sinaads/demo/changwy/link/blog_bottom_float.js";Lib.util.loadScript(url,function(){(sinaads=window.sinaads||[]).push({element:adEl,params:{}})});var adEl=blogAd.insertIns("PDPS000000052950",document.body)})}})}();!function(){function articleWrapperAd(data){if(!data.shareAdBloger||!data.shareAdBloger.result){return}var main=$E("sina_keyword_ad_area2");var reblog=Core.Dom.byClz(main,"div","blogzz_acon")[0];if(reblog){main=reblog}var child,adnode,offset=0,size=0,afterNode,txt,specOffset=280;function text(node){return"textContent"in node?node.textContent:node.innerText}function isImg(img){var src=img.getAttribute("real_src")||"";if(src.indexOf("http://www.sinaimg.cn/uc/")===0){return false}else if(0==src.indexOf("http://simg.sinajs.cn/blog7style/")){return false}return true}function containsImg(node){var imgs=node.getElementsByTagName("img");for(var i=0,len=imgs.length;i<len;i++){if(isImg(imgs[i])){return true}}return false}for(var i=main.children.length-1;i>=0;i--){child=main.children[i];if(!containsImg(child)){txt=text(child);size+=txt.length;offset+=child.offsetHeight}else{offset=0;size=0}if(i>1&&offset>specOffset){afterNode=child;break}}adnode=$C("div");adnode.style.cssText="display: none; width: 200px; height: 300px; margin: 10px 20px 10px 0px; float: left; overflow: hidden; clear: both; padding: 4px; border: 1px solid rgb(205, 205, 205);";if(!afterNode){main.appendChild(adnode)}else{main.insertBefore(adnode,afterNode)}Lib.execZhitou(function(res){var adEl=blogAd.insertIns("PDPS000000053083",adnode);(sinaads=window.sinaads||[]).push({element:adEl,params:{sinaads_success_handler:function(){adnode.style.display="block"},sinaads_fail_handler:function(){}}})})}}()});Utils.Io.TimeoutJsLoad=function(url,opts){this._opts={url:"",charset:"utf-8",noreturn:false,noencode:false,timeout:-1,GET:{},onComplete:null,onException:null,type:"blogScript",jsonpParamName:"callback"};if(!url||typeof url!=="string"){throw new Error("url参数不能为空!")}this._opts.url=url;this.isAborted=false;this.scriptIdentifier="";this.varname="";this.loadComplete=false;this.timeObj;Core.System.parseParam(this._opts,opts);this.loadScript()};Utils.Io.TimeoutJsLoad.prototype={constructor:Utils.Io.TimeoutJsLoad,__jsonpCounter:(new Date).getTime(),loadScript:function(){var opts=this._opts,scriptObj=$C("script"),head=$T(document,"head")[0],_this=this,jsonp=this._processUrl();scriptObj.async=true;scriptObj.src=opts.url;scriptObj.charset=opts.charset;scriptObj.id="script"+this.scriptIdentifier;if(opts.type==="jsonp"){window[jsonp]=originalCallback}else if(opts.type==="blogScript"){scriptObj.onload=scriptObj.onerror=scriptObj.onreadystatechange=originalCallback}function originalCallback(result){var type=opts.type;if(type==="blogScript"&&scriptObj&&scriptObj.readyState&&scriptObj.readyState!="loaded"&&scriptObj.readyState!="complete"){return}_this.loadComplete=true;if(type==="jsonp"){window[jsonp]=undefined;try{delete window[jsonp]}catch(jsonpError){}}else if(type==="blogScript"){scriptObj.onload=scriptObj.onreadystatechange=scriptObj.onerror=null}head.removeChild(scriptObj);if(!_this.isAborted&&typeof opts.onComplete==="function"){_this.timeObj&&clearTimeout(_this.timeObj);opts.onComplete(type==="blogScript"?window[_this.varname]:result)}}head.insertBefore(scriptObj,head.firstChild);if(opts.timeout>0){this.timeObj=setTimeout(function(){_this.abortRequest()},opts.timeout)}},abortRequest:function(){if(this.loadComplete){return}this.isAborted=true;if(/opera/i.test(navigator.userAgent)&&$E("script"+this.scriptIdentifier)){$E("script"+this.scriptIdentifier).src=""}typeof this._opts.onException==="function"&&this._opts.onException()},_processUrl:function(){var opts=this._opts,url=opts.url,queryString=opts.GET,key,rnd=window.parseInt(Math.random()*1e8),url_cls=new Utils.Url(url);for(key in queryString){url_cls.setParam(key,opts.noencode===true?queryString[key]:Core.String.encodeDoubleByte(queryString[key]))}this.scriptIdentifier=rnd;if(opts.type==="blogScript"){this.varname=url_cls.getParam("varname")||"requestId_"+rnd;opts.noreturn!==true&&url_cls.setParam("varname",this.varname)}else if(opts.type==="jsonp"){var jsonp="jsonp"+this.constructor.prototype.__jsonpCounter++;url_cls.setParam(opts.jsonpParamName,jsonp)}opts.url=url_cls.toString();return jsonp}};$registJob("tranVideo",function(){function detectBrowserType(){var ua=navigator.userAgent.toLowerCase();return{isIpad:ua.match(/ipad/i)!=null,isIphone:ua.match(/iphone/i)!=null,isIpod:ua.match(/ipod/i)!=null}}var isMac=detectBrowserType();if(!(isMac.isIpad||isMac.isIphone||isMac.isIpod))return;var __loadURL=Utils.Io.JsLoad.request;var __newTOJ=Utils.Io.TimeoutJsLoad;var __insertHTML=Core.Dom.insertHTML;var __toObj=Core.String.j2o;var tranVideo={getVid:function(src){var rep=new RegExp("vid=([^&]*)?&","i");var res=src.match(rep);if(res){return res[1]||""}else{return""}},createVideoTag:function(obj){var src="http://video.sina.com.cn/api/getIpadUrl.php?url="+encodeURIComponent(obj.src.replace(".swf",""));new __newTOJ(src,{type:"blogScript",GET:{rmd:Math.random()},onComplete:function(result){if(result.ipad_url=="")return;obj.style.display="none";var vTag=$C("video");vTag.className="video";vTag.setAttribute("width","482px");vTag.setAttribute("height","388px");vTag.setAttribute("controls","controls");vTag.setAttribute("src",result.ipad_url);obj.parentNode.insertBefore(vTag,obj)},onException:Function()})}};allEmbed=document.getElementsByTagName("embed");for(var i=0;i<allEmbed.length;i++){if(allEmbed[i].src.indexOf("http://p.you.video.sina.com.cn")!=-1||allEmbed[i].src.indexOf("http://you.video.sina.com.cn")!=-1){tranVideo.createVideoTag(allEmbed[i])}}});$registJob("errorTips",function(){function createNode(html){var elem=$C("div");elem.innerHTML=html;return elem.firstChild}Lib.checkAuthor(function(){if($isLogin){Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/riaapi/warning.php",{GET:{uid:$UID},onComplete:function(result){var errorTips,target;if(result&&result.iswarning==1){var isShow=Utils.Cookie.getCookie("i8t9c"+$UID)!==result.date?"block":"none";var html='<div id="err_i8t9c" class="tb_layer_Y tb_layer_w6" style="display:'+isShow+';z-index:500;position:absolute;top:-300px;">'+'<div class="tb_layer_arrow" style="margin:0 0;left:219px"></div>'+'<div class="tb_layer_Y_main">'+'<div class="tb_mas">'+'<span style="float:right;"><a class="conn" href="javascript:;" onclick="scope.i8t9c()">×</a></span>'+"</div>"+'<div class="tb_mas">'+result.msg+'<p style="text-align:center;padding:6px;"><input type="button" value="知道了" onclick="scope.i8t9c()" /></p></div>'+"</div>"+"</div>"+"</div>";scope.i8t9c=function(){$E("err_i8t9c").style.display="none";Utils.Cookie.setCookie("i8t9c"+$UID,result.date,8760,"/");Utils.Cookie.setCookie("i8t9c"+$UID,result.date,8760,"/","blog.sina.com.cn")};scope.i8t9c.show=function(){$E("err_i8t9c").style.display="";updatePos()};errorTips=createNode(html);document.body.appendChild(errorTips);var act=$E("loginBarActivity"),txt;target=createNode('<div class="topbar_activity"><a href="javascript:;" onclick="scope.i8t9c&&scope.i8t9c.show();">[公告]</a></div>');act.parentNode.insertBefore(target,act);setTimeout(updatePos,10);Core.Events.addEvent(window,function(){updatePos()},"resize");var listener=Lib.Listener;listener.on({name:"topad680-show-end",callBack:updatePos,scope:this});var oldSrcollTop=document.documentElement.scrollTop+document.body.scrollTop}function updatePos(){var pos=Core.Dom.getXY(target);var width=errorTips.offsetWidth;errorTips.style.visibility="inherit";errorTips.style.top=pos[1]+23+"px";errorTips.style.left=pos[0]-width+41+"px"}}})}},"errorTips"+(new Date).getTime())});var ReblogToQing=Core.Class.create();ReblogToQing.prototype={saving:false,blogId:"",initialize:function(){},reblog:function(blogId){this.blogId=blogId;if(!this.blogId){throw new Error("转载博文ID未定义")}this.checkUser(this.blogId)},checkUser:function(blogId){this.blogId=blogId||scope.$blogId;var me=this;Lib.checkAuthor(function(){if(!$isLogin){v7sendLog("48_01_32");(new Lib.Login.Ui).login(function(){scope.blogOpener.showDialog(function(){me.save.bind2(me)()})})}else{scope.blogOpener.showDialog(function(){me.save()})}},"ReblogToQing"+(new Date).getTime())},save:function(){var me=this;if(this.saving){return}this.saving=true;var param={version:7,blogId:me.blogId,rnd:+new Date};var showUnkownError=function(){winDialog.alert("对不起，系统繁忙请稍后！",{icon:"01",funcOk:function(){}})};var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/blog/share2qing.php?rnd="+ +new Date;Utils.Io.Ijax.request(url,{POST:param,returnType:"json",onComplete:function(result){this.saving=false;if(!result){showUnkownError();return}try{result=new Function("return "+result)()}catch(e){showUnkownError()}if("A00006"==result.code){winDialog.alert(["已成功转载到Qing博客！<br/><span style='font-weight: 100; font-size: 12px;'>",result.data.qingId?"<a target='_blank' href='"+$_GLOBAL.qingURL+result.data.userId+"/"+result.data.qingId+".html'>去查看已转载的文章>></a>":"","</span>"].join(""),{icon:"03"});me.onSuccess(result,param)}else if("A00420"==result.code){me.showOpenQingWnd()}else if("A00421"==result.code){me.showShareToQingFailure()}else{showUnkownError()}}.bind2(this),onException:function(data){this.saving=false;if(!data){showUnkownError();return}}.bind2(this)})},showOpenQingWnd:function(){var dialog=winDialog.createCustomsDialog({content:['<div class="CP_layercon2 unilayer">','<div class="CP_prompt toQing">','<table class="CP_w_ttl"><tbody><tr><td>您的新浪博客账号未开通Qing。开通后可转载到Qing中。</td></tr></tbody></table>','<p class="CP_w_btns_Mid"><a id="#{openQing}" class="SG_aBtn SG_aBtnB" href="'+$_GLOBAL.qingURL+'home" target="_blank"><cite>开通Qing</cite></a>','&nbsp;&nbsp;<a id="#{cancel}" class="SG_aBtn SG_aBtnB" href="javascript:void(0);"><cite>取消</cite></a></p>',"</div>","</div>"].join(""),shadow:1},"openQing");dialog.setMiddle();dialog.show();dialog.nodes["openQing"].onclick=function(){setTimeout(function(){dialog.close();dialog.onclick=null;dialog=null},200)};dialog.nodes["cancel"].onclick=function(){setTimeout(function(){dialog.close();dialog.onclick=null;dialog=null},200)}},showShareToQingFailure:function(){var msg="对不起，转载至Qing博客失败。";winDialog.alert(msg,{icon:"01",funcOk:function(){}})},onSuccess:function(aId){},onError:function(){}};$registJob("renderReblogDiv",function(){var _addEvent=Core.Events.addEvent,_getEventTarget=Core.Events.getEventTarget,_getXY=Core.Dom.getXY,delegateEl,delegateElId,cls="",isNew=scope.$pageid=="article_new"||scope.$pageid=="articleM_new",reblogDivId="reblog_"+ +new Date;if(isNew){cls="oper_list"}var reblogDivInnerHTML='<ul class="'+cls+'">'+"<li>"+'<a suda-uatrack="key=blog_article&value=h_article17" action-type="click_reblog" action-data="{action:\'toBlog\'}" href="javascript:void(0);" title="转载到博客">'+(isNew?"":'<img width="18" height="18" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon141"/>')+"博客"+"</a>"+"</li>"+'<li style="display:none;">'+'<a suda-uatrack="key=blog_article&value=h_article17" action-type="click_reblog" action-data="{action:\'toBlog\'}" href="javascript:void(0);" title="转载原文">'+(isNew?"":'<img width="18" height="18" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon141"/>')+"转载原文"+"</a>"+"</li>"+"<li>"+'<a suda-uatrack="key=blog_article&value=h_article17" action-type="click_reblog" action-data="{action:\'cwb\'}" href="javascript:;" title="发布长微博">'+(isNew?"":'<img width="18" height="18" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon143"/>')+"长微博"+"</a>"+"</li>"+"</ul>";var reblogDiv=SinaEx.createNode('<div id="'+reblogDivId+'" class="turnList" style="display:none;position:absolute;z-index:20;">'+reblogDivInnerHTML+"</div>");document.body.appendChild(reblogDiv);var getActionData=Lib.util.getActionData;var sinablogbody=$E("sinablogbody");var idCard,reblogBtn;var isIdCard=false;var isValidateIdentity=0;var onMouseOverReblogBtn=function(e){var srcEl=$E(this.id),tEl=_getEventTarget(e);var eventData=getActionData(e,"reblog");if(!eventData){return}$E("sinablogbody").setAttribute("ismouseover","1");var data=eval("("+eventData.data+")");reblogBtn=eventData.targetEl.parentNode.parentNode;setTimeout(function(){var isMouseHover=$E("sinablogbody").getAttribute("ismouseover")||0;isMouseHover=parseInt(isMouseHover)||parseInt($E(reblogDivId).getAttribute("ismouseover")||0);if(!isMouseHover){return}if(isNew){eventData.targetEl.className="lk_a lka_last lka_hover"}var reblogDiv=$E(reblogDivId),pos=_getXY(eventData.targetEl);reblogDiv.style.display="";reblogDiv.style.top=pos[1]+23+"px";if($IE6||$IE7){reblogDiv.style.left=pos[0]-2+"px"}else{reblogDiv.style.left=pos[0]+"px"}reblogDiv.setAttribute("blogId",data.blogId);var sameVariable=reblogDiv.children[0];Lib.checkAuthor(function(){setTimeout(function(){if(data.srcBlog){sameVariable.children[1].style.display="none"}else{sameVariable.children[0].style.display="none";if($isAdmin){sameVariable.children[1].style.display="none"}else{sameVariable.children[1].style.display=""}}if(isIdCard&&reblogBtn.getAttribute("isshow")){return}if(data.srcBlog=="1"&&$isLogin){if(isValidateIdentity){return}Utils.Io.Ijax.request("http://control.blog.sina.com.cn/blog_rebuild/riaapi/blog/qingEditing.php",{onComplete:function(data){var result=Core.String.j2o(data);if(result.code==="A00006"){idCard=result.data.message;if(idCard){sameVariable.children[3].style.display=""}}isIdCard=true;reblogBtn.setAttribute("isshow","1")}})}},2)},"renderReblogDiv"+(new Date).getTime())},400)};var onMouseOutReblogBtn=function(e){var srcEl=$E(this.id),tEl=_getEventTarget(e);var eventData=getActionData(e,"reblog");if(!eventData){return}$E("sinablogbody").setAttribute("ismouseover","0");var timer=$E("sinablogbody").getAttribute("timer");if(timer){return}var timer=setInterval(function(){var isMouseHover=$E("sinablogbody").getAttribute("ismouseover")||0;var isReblogDivMouseHover=$E(reblogDivId).getAttribute("ismouseover")||0;isMouseHover=parseInt(isMouseHover)||parseInt(isReblogDivMouseHover);if(!isMouseHover){$E(reblogDivId).style.display="none";$E("sinablogbody").removeAttribute("timer");if(isNew){eventData.targetEl.className="lk_a lka_last"}clearInterval(timer)}},1e3)};var MOUSEOVER="mouseover";var MOUSEOUT="mouseout";var addModuleMouseEvent=function(moduleId){if(!$E(moduleId)){trace("没有组件："+moduleId);return}try{if(scope.$pageid==="articletjTech"||scope.$pageid=="article_new"||scope.$pageid=="articleM_new"){moduleBody=$E(moduleId);_addEvent(moduleBody,Core.Function.bind2(onMouseOverReblogBtn,moduleBody),MOUSEOVER);_addEvent(moduleBody,Core.Function.bind2(onMouseOutReblogBtn,moduleBody),MOUSEOUT)}var moduleBody=$E(moduleId).children[1];if(moduleBody&&"SG_connBody"==moduleBody.className){moduleBody.id=moduleId+"_SG_connBody";
_addEvent(moduleBody,Core.Function.bind2(onMouseOverReblogBtn,moduleBody),MOUSEOVER);_addEvent(moduleBody,Core.Function.bind2(onMouseOutReblogBtn,moduleBody),MOUSEOUT)}}catch(e){trace("注册转载博问按钮事件代理出错，组件ID："+moduleId)}};addModuleMouseEvent("module_10001");addModuleMouseEvent("module_10002");addModuleMouseEvent("module_10003");addModuleMouseEvent("module_920");addModuleMouseEvent("module_921");addModuleMouseEvent("module_3001_SG_connBody");addModuleMouseEvent("module_920_SG_connBody");var onMouseOverReblogDiv=function(e){$E(reblogDivId).setAttribute("ismouseover",1)};var onMouseOutReblogDiv=function(e){$E(reblogDivId).setAttribute("ismouseover",0)};_addEvent(reblogDiv,onMouseOverReblogDiv,MOUSEOVER);_addEvent(reblogDiv,onMouseOutReblogDiv,MOUSEOUT);!scope.article_quote&&(scope.article_quote=new Quote);scope.articel_quote_alert=function(articleID){scope.article_quote.check(articleID)};function showError(icon,ico){if(icon.message){var msg=icon.message}winDialog.alert(msg,{icon:ico||"01"})}var reblogToQing=new ReblogToQing;var reblog=function(e){var srcEl=$E(reblogDivId),tEl=_getEventTarget(e);var eventData=getActionData(e,"click_reblog");if(!eventData){return}if(reblogBtn.getAttribute("isreblog")==="1"){return}var blogId=$E(reblogDivId).getAttribute("blogId"),data=eval("("+eventData.data+")");if("cwb"===data.action){window.open("http://control.blog.sina.com.cn/admin/article/changWeiBo.php?url="+encodeURIComponent("http://blog.sina.com.cn/s/blog_"+blogId+".html"))}else{scope.articel_quote_alert(blogId)}v7sendLog&&v7sendLog("79_01_22",scope.$pageid,"qingLink")};_addEvent(reblogDiv,reblog,"click");reblogDiv=null;delegateEl=null});Core.Dom.findNode=function(element,direction,start){for(var node=element[start];node;node=node[direction]){if(node.nodeType==1){return node}}return null};Core.Dom.nextNode=function(srcEl){return Core.Dom.findNode(srcEl,"nextSibling","nextSibling")};blogAd.shareToWeibo=function(oParam){var url=new Utils.Url("http://v.t.sina.com.cn/share/share.php"),encode=encodeURIComponent;if(oParam.clickCode){(new Image).src=oParam.clickCode}for(var p in oParam){if(oParam.hasOwnProperty(p)){url.setParam(p,encode(oParam[p]))}}if(!oParam.title){url.setParam("title",encode(oParam.title||document.title))}url.setParam("content","utf-8");var openWnd=function(){url=url.toString();if(!window.open(url,"mb",["toolbar=0,status=0,resizable=1,width=440,height=430,left=",(screen.width-440)/2,",top=",(screen.height-430)/2].join("")))location.href=url};if(/Firefox/.test(navigator.userAgent)){setTimeout(openWnd,0)}else{openWnd()}};blogAd.nickTrayAd=function(oParam,relativeNode){relativeNode.innerHTML=oParam["adLink"];var __this=this,__template=['<div id="#{entity}" class="tips_layer1 tips_bg_a" style="z-index:150;position:absolute;top:23px;left:0px;display:none;">','<div id="#{body}" class="tips_bd">','<a id="#{imageLink}" href="" class="link" title="" target="_blank"></a>','<div class="tips_detail"> <span id="#{closeBtn}" class="close" title="关闭">×</span>','<p id="#{userNick}" class="tips_nickname"></p>','<p id="#{tipsTitle}" class="tips_txt"></p>','<p id="#{tipsTxtLink}" class="tips_ad"></p>','<p id="#{tipsBtn}" class="tips_btn"></p>',"</div>","</div>","</div>"].join("");this.relativeNodeId=relativeNode.id;this.MARK_ID=1;this.LIMITED=24;var nodes=this.nodes=this.getTemplateNodes(__template);Core.Dom.insertAfter(nodes.entity,document.body.lastChild);if($IE6&&oParam.ie6BackgroundPic){nodes.entity.style.backgroundImage="url("+oParam.ie6BackgroundPic+")"}else if(oParam.backgroundPic){try{nodes.entity.style.backgroundImage="url("+oParam.backgroundPic+")"}catch(e){}}nodes.imageLink.href=oParam.imageLinkHref;var nick=typeof $nick;if("undefined"==nick){nick="亲爱的网友"}else{nick=$nick}nodes.userNick.innerHTML="HI，"+nick.replace(/</g,"&lt;");nodes.tipsTitle.innerHTML=oParam.tipsTitle;if(oParam.tipsTxtLink){nodes.tipsTxtLink.innerHTML=oParam.tipsTxtLink}var link=nodes.tipsTxtLink.children[0],linkStyle=link.style;if(!$IE6&&oParam.tipsTxtLinkBgPic){linkStyle.backgroundImage="url("+oParam.tipsTxtLinkBgPic+")";linkStyle.backgroundRepeat="no-repeat"}else if($IE6&&oParam.ie6TipsTxtLinkBgPic){linkStyle.backgroundImage="url("+oParam.ie6TipsTxtLinkBgPic+")";linkStyle.backgroundRepeat="no-repeat"}nodes.tipsBtn.innerHTML=oParam.tipsBtn;Core.Events.addEvent(nodes.closeBtn,function(){__this.hide();scope.$channel=null;var closeLog=oParam.status.adclose;if(closeLog){(new Image).src=closeLog}},"click");setTimeout(function(){__this.setPos();__this.show();__this.initResizeEvent()},15);var adclose=oParam.status&&oParam.status.adclose;Core.Events.addEvent(nodes.entity,function(e){var target=e.target||e.srcElement,entity=nodes.entity;do{if("A"===target.nodeName.toUpperCase()&&-1!=target.href.indexOf("http")){__this.hide();scope.$channel=null;var closeLog=oParam.status.adclose;if(closeLog){(new Image).src=closeLog}break}}while(target&&target==entity)},"click");if(oParam.status.adstart){(new Image).src=oParam.status.adstart}if(!oParam.blogTip){commonLog("http://1090.adsina.allyes.com/main/adfshow?user=AFP6_for_SINA|2012_add|2012_blog_tip&db=sina&border=0&local=yes&js=ie")}else{v7sendLog(oParam.logCode)}}.$defineProto({setMark:function(){var hours=(new Date).getHours();var nextShowHours=24-hours;Utils.Cookie.setCookie("blogTipsAd",1,nextShowHours,"/",".blog.sina.com.cn")},setPos:function(){var relativeNode=$E(this.relativeNodeId);var xy=Core.Dom.getXY(relativeNode);var linkWidth=relativeNode.offsetWidth,nodeStyle=this.nodes.entity.style;nodeStyle.left=parseInt(xy[0])+(linkWidth-100)+"px";nodeStyle.top=parseInt(xy[1])+23+"px"},show:function(){this.isHidden=false;var tipsEl=this.nodes.entity,_setStyle=Core.Dom.setStyle;var tween=new Ui.TweenStrategy(0,1,.5,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(tipsEl,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(tipsEl,"opacity","none")}else{tipsEl.style.filter="none"}};_setStyle(tipsEl,"opacity",0);tipsEl.style.display="block";tween.start()},hide:function(){this.setMark();this.isHidden=true;var tipsEl=this.nodes.entity,_setStyle=Core.Dom.setStyle;var tween=new Ui.TweenStrategy(1,0,.5,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(tipsEl,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(tipsEl,"opacity","none")}else{tipsEl.style.filter="none"}tipsEl.style.display="none"};tween.start()},initResizeEvent:function(){var me=this;Core.Events.addEvent(window,function(){if(!me.isHidden){me.setPos()}},"resize")}}).$mixProto(Lib.templateUtils);blogAd.loadNickTrayAd=function(data){var listener=Lib.Listener;var actBtn=$E("loginBarActivity")||$E("divPopularize");var isShow=actBtn.getAttribute("shouldShow"),day=(new Date).getDay(),isClosed=Utils.Cookie.getCookie("blogTipsAd");actBtn.style.display="";var isShowTime=day==1||day==3||day==5;if(!isShowTime){return}if(isClosed){return}var cssUrl="http://simg.sinajs.cn/blog7style/css/module/layer/layer20.css";Utils.Io.loadExternalCSS(cssUrl,function(){if(data){if(!data||!data["isShow"]){return}if(data.logCode){data.logCode=data.logCode+"|"+$UID}blogAd.trayAdHandle=new blogAd.nickTrayAd(data,actBtn);actBtn=null}})};$registJob("trayTipsAd",function(){var listener=Lib.Listener;var topbarAdLoaded,trayLoaded,adData;var showAdCondition=function(data){data=data&&data.weicaopan&&data.weicaopan.weicaopan_con;Lib.execZhitou(function(){function showOrHideChild(isShow){var node=actBtn.firstChild,style=isShow?"":"none";while(node){if("a"===node.nodeName.toLowerCase()){node.style.display=style}node=node.nextSibling}}var actBtn=$E("loginBarActivity")||$E("divPopularize");actBtn.style.display="";var $bar=actBtn.parentNode;var top=$bar.parentNode.offsetHeight,left,actBtnXY;showOrHideChild(false);if("none"===$bar.style.display){$bar.style.position="absolute";$bar.style.top="-40px";$bar.style.display="";actBtnXY=Core.Dom.getXY(actBtn);var $logo=$E("login_bar_logo_link_350");$logo.style.display="";var offset=$logo.children[0].offsetWidth;left=offset+actBtnXY[0];if(topbarAdLoaded){top+=90}$bar.style.position="";$bar.style.top="";$bar.style.display="none";$logo.style.display="none"}else{actBtnXY=Core.Dom.getXY(actBtn);top+=actBtnXY[1];left=actBtnXY[0]}var $adEl=blogAd.insertIns("PDPS000000033238",actBtn);(window.sinaads||[]).push({element:$adEl,params:{sinaads_tip_top:top,sinaads_tip_left:left,sinaads_success_handler:function(){showOrHideChild(false);window.BLOG_AD_TIPS=1},sinaads_fail_handler:function(){showOrHideChild(true);blogAd.loadNickTrayAd(data)},sinaads_ad_zindex:590}})});listener.off({name:"ad_show_hide_conditions",callBack:showAdCondition});showAdCondition=null};listener.on({name:"ad_show_hide_conditions",callBack:function(data){if("undefined"!==typeof topbarAdLoaded){showAdCondition(data)}else{adData=data}trayLoaded=!0}});listener.on({name:"topad680-show-end",callBack:function(data){topbarAdLoaded=data.show;if(trayLoaded){showAdCondition(adData)}}})});$registJob("adNoticeChannel",function(){var __addEvent=Core.Events.addEvent;var listener=Lib.Listener,pageId=scope.$pageid;var istj=window.location.href.indexOf("tj=1")>-1;var refer=document.referrer;if(refer){var host=refer.match(/(\:\/\/)(.*?)(\/)/g);refer=host&&host[0].replace(/(\:\/\/){0,}(\/){0,}/g,"")}else{refer=""}Lib.checkAuthor(function(){var url="http://comet.blog.sina.com.cn/api?maintype=load_channel";Utils.Io.JsLoad.request(url,{GET:{uid:$UID,bloguid:scope.$uid,refer:refer},onComplete:function(result){if(result&&result.code==="A00006"){scope.$channel=result.data;if(pageId=="article_new"||pageId=="articleM_new"||pageId==="article"||pageId==="articleM"||pageId==="index"||pageId==="indexM"||pageId==="articlelist"||pageId==="articlelistM"||pageId==="wanwan_index"||pageId==="articlepreview_new"){listener.notify("notice_ad_layer",scope.$channel||{})}listener.notify("ad_show_hide_conditions",scope.$channel||{})}}})},"adNoticeChannel"+(new Date).getTime())});!function(){var toStyleAttribute=function(styleName){var arr=styleName.split("-");var cc=arr[0];for(var i=1;i<arr.length;i++){cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1)}return cc};Core.Dom.setStyle2=function(elem,style){if(typeof elem=="string"){elem=$E(elem)}for(var name in style){styleAttr=toStyleAttribute(name);Core.Dom.setStyle(elem,styleAttr,style[name])}}}();$registJob("blogNotice",function(){var $logo=$E("login_bar_logo_link_350");var __addEvent=Core.Events.addEvent,__removeEvent=Core.Events.removeEvent,__setCookie=Utils.Cookie.setCookie,__getCookie=Utils.Cookie.getCookie,_setStyle=Core.Dom.setStyle,listener=Lib.Listener,logFlag,showFlag;var flagUid=__getCookie("closeNotice_fzp");Lib.checkAuthor(function(){if(flagUid&&flagUid===$UID){return}var pageid=scope.$pageid,uid=scope.$uid,isTj=window.location.href.indexOf("tj=1")>-1;if($logo&&"ntopbar_main"===$logo.parentNode.className){listener.on({name:"notice_ad_layer",callBack:function(json){listener.notify("tray-announce-loaed",json)}});return}else{var _guide;var dd=document.documentElement;var template={guideLayer:'<div class="l_hornbg" id="#{guideLayer}" style="display:none;">'+'<div class="l_horn">'+'<span class="close" title="关闭" id="#{close}">&times;</span>'+'<div class="horn1" id="#{noticeLayer}" style="display:none;">'+'<div class="horn_left">'+'<span class="horn_icon" id="#{noticeIcon}"></span>'+"</div>"+'<div class="horn_right" id="#{noticeAdLayer}">推荐：'+'<a href="" target="blank" id="#{noticeAdCon1}" onclick="v7sendLog(\'48_01_12\');"></a>'+'<a href="" target="blank" id="#{noticeAdCon2}" onclick="v7sendLog(\'48_01_13\');"></a>'+"</div>"+"</div>"+'<div class="horn2" id="#{adLayer}">推荐：'+'<a href="" target="blank" id="#{adContent1}" onclick="v7sendLog(\'48_01_12\');"></a>'+'<a href="" target="blank" id="#{adContent2}" onclick="v7sendLog(\'48_01_13\');"></a>'+"</div>"+"</div>"+"</div>"};var option={mid:{"z-index":"500",position:$IE6?"absolute":"fixed"}};var noticeCSSUrl=$_GLOBAL.cssBasicURL+"module/layer/layer24.css";Utils.Io.loadExternalCSS(noticeCSSUrl);var loadNoticeLayer=function(json){_guide=Utils.insertTemplate($E("sinabloga"),template.guideLayer,"BeforeBegin");setMiddle(_guide.guideLayer);if($IE6){_guide.guideLayer.style.position="absolute";dd.style.backgroundImage="url(ablout:blank)";dd.style.backgroundAttachment="fixed";__addEvent(window,ie6Fixed,"scroll")}__addEvent(window,funcShowNotice,"scroll");showNoticeTpl(json)};listener.on({name:"notice_ad_layer",callBack:loadNoticeLayer});function showNoticeTpl(result){if($isLogin&&result.announce.result&&(pageid==="indexM"||pageid==="articleM"||pageid==="articlelistM")){_guide.noticeLayer.style.display="";_guide.adLayer.style.display="none";var info=result.announce;Core.Dom.insertHTML(_guide.noticeIcon,info.announce_con,"AfterEnd")}else{_guide.adLayer.style.display=""}if(result.advertise){var adInfo=result.advertise;var adCon1=decodeURIComponent(adInfo.advertise_con1.content),adCon2=decodeURIComponent(adInfo.advertise_con2.content),adHref1=decodeURIComponent(adInfo.advertise_con1.link),adHref2=decodeURIComponent(adInfo.advertise_con2.link);_guide.noticeAdCon1.innerHTML=adCon1;_guide.noticeAdCon1.href=adHref1;_guide.noticeAdCon2.innerHTML=adCon2;_guide.noticeAdCon2.href=adHref2;_guide.adContent1.innerHTML=adCon1;_guide.adContent1.href=adHref1;_guide.adContent2.innerHTML=adCon2;_guide.adContent2.href=adHref2;if(_guide.close){__addEvent(_guide.close,function(){__setCookie("closeNotice_fzp",$UID,24,"/",".blog.sina.com.cn");delNoticeLayer()})}}}function funcShowNotice(){var scrolltop=document.body.scrollTop+document.documentElement.scrollTop;if(scrolltop>height){showNoticeLayer(_guide.guideLayer);if(!$IE6){_guide.guideLayer.style.top="0"}if(!logFlag){logFlag=1;v7sendLog("48_01_11_"+scope.$pageid)}}else{hideNoticeLayer(_guide.guideLayer)}}function delNoticeLayer(){Core.Dom.removeNode(_guide.guideLayer);__removeEvent(window,funcShowNotice,"scroll");__removeEvent(window,ie6Fixed,"scroll");scope.$channel=null}function setMiddle(obj){Core.Dom.setStyle2(obj,option.mid)}function ie6Fixed(){_guide.guideLayer.style.top=document.documentElement.scrollTop+"px";_guide.guideLayer.style.left=0+"px"}function showNoticeLayer(el){if(!showFlag){showFlag=1;var tween=new Ui.TweenStrategy(0,1,.6,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(el,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(el,"opacity","none")}else{el.style.filter="none"}};_setStyle(el,"opacity",0);el.style.display="block";tween.start()}}function hideNoticeLayer(el){if(showFlag){showFlag=0;var tween=new Ui.TweenStrategy(1,0,.6,function(t,b,c,d){return-c*(t/=d)*(t-2)+b});tween.onTween=function(val){_setStyle(el,"opacity",val)};tween.onEnd=function(){if(!$IE){_setStyle(el,"opacity","none")}else{el.style.filter="none"}el.style.display="none"};tween.start()}}}},"blogNotice"+(new Date).getTime())});$registJob("trashPv",function(){});Ui.LayerCount=function(){var zIndex=500;var modeIndex=1024;return function(type){if("mode"===type){return modeIndex}else{zIndex+=24}return zIndex>modeIndex?modeIndex-50:zIndex}}();Lib.OnlyShadow=function(opacity,parent,id,cfg){this.entity=null;this.parent=parent||document.body;cfg=Lib.apply({zIndex:1024,backgroundColor:"black"},cfg);this._ie6Fixed=function(){if(_this.entity){_this.entity.style.top=document.documentElement.scrollTop+"px";var left=document.documentElement.scrollLeft-_this._ie6EntityXY[0];var wholeWidth=left+_this.entity.offsetWidth;var scrollWidth=document.documentElement.scrollWidth||document.body.scrollWidth;if(wholeWidth<=scrollWidth){_this.entity.style.left=left+"px"}if(_this.ifm){_this.ifm.style.top=_this.entity.style.top;if(wholeWidth<=scrollWidth){_this.ifm.style.left=_this.entity.style.left}}}};var _this=this;this.resetShadowDiv=Core.Function.bind3(function(){if(_this.entity){setTimeout(function(){_this.updateSize();if($IE6&&_this.isShow()){_this.entity.style.left="0px";var xy=Core.Dom.getXY(_this.entity);_this._ie6EntityXY=xy;_this._ie6Fixed()}},1)}},this);this._create=function(){_this.entity=$C("div");if(id){_this.entity.id=id}_this.entity.style.position="absolute";_this.entity.style.width=_this.getAreaWidth()+"px";_this.entity.style.height=_this.getAreaHeight()+"px";_this.entity.style.left="0px";_this.entity.style.top="0px";_this.entity.style.zIndex=cfg.zIndex;_this.entity.style.backgroundColor=cfg.backgroundColor;_this.parent.appendChild(_this.entity);_this._setOpacity(_this.entity,isNaN(opacity)?.5:opacity);if($IE6){var xy=Core.Dom.getXY(_this.entity);_this._ie6EntityXY=xy;var left=document.documentElement.scrollLeft-_this._ie6EntityXY[0];_this.entity.style.left=left+"px"}_this.addIframe();Core.Events.addEvent(window,_this.resetShadowDiv,"resize");_this.setFixed(true);_this.hidden()};!function initialize(){if(id&&$E(id)){_this.entity=$E(id)}else{_this._create()}}()};Lib.OnlyShadow.prototype={isShow:function(){return this.entity.offsetHeight>0?true:false},show:function(){this.entity.style.display="";if(this.ifm){this.ifm.style.display=""}if($IE6){this.updateSize();this.entity.style.left="0px";var xy=Core.Dom.getXY(this.entity);this._ie6EntityXY=xy;this._ie6Fixed()}this.onShow()},hidden:function(){this.entity.style.display="none";if(this.ifm){this.ifm.style.display="none"}this.onHidden()},close:function(){this.hidden();this.destroy()},destroy:function(){Core.Events.removeEvent(window,this._ie6Fixed,"scroll");Core.Events.removeEvent(window,this.resetShadowDiv,"resize");this.entity.parentNode.removeChild(this.entity);this.entity=null;if(this.ifm){this.ifm.parentNode.removeChild(this.ifm);this.ifm=null}},addIframe:function(){this.ifm=$C("iframe");this._setOpacity(this.ifm,0);this.ifm.style.position="absolute";this.ifm.style.zIndex=this.entity.style.zIndex;this.ifm.style.left=this.entity.style.left;this.ifm.style.top=this.entity.style.top;this.ifm.style.width=this.entity.style.width;this.ifm.style.height=this.entity.style.height;this.entity.parentNode.insertBefore(this.ifm,this.entity)},insertBefore:function(obj){obj.parentNode.insertBefore(this.entity,obj);if(this.ifm){this.entity.parentNode.insertBefore(this.ifm,this.entity)}},updateSize:function(){var width=this.getAreaWidth();var height=this.getAreaHeight();this.entity.style.width=width+"px";this.entity.style.height=height+"px";if(this.ifm){this.ifm.style.width=width+"px";this.ifm.style.height=height+"px"}},getAreaHeight:function(){var height=Math.max(document.documentElement.clientHeight,document.body.clientHeight);return height},getAreaWidth:function(){var width=document.documentElement.clientWidth||document.body.clientWidth;return width},setFixed:function(state){if($IE6){var _this=this;if(state){_this._ie6Fixed();Core.Events.addEvent(window,_this._ie6Fixed,"scroll")}else{Core.Events.removeEvent(window,_this._ie6Fixed,"scroll")}}else{this.entity.style.position=state?"fixed":"absolute"}},_setOpacity:function(obj,v){if($IE){obj.style.filter="alpha(opacity="+v*100+")"}else{obj.style.opacity=v}},onShow:function(){},onHidden:function(){}};Article.SlideTJCover=function(cfg){var args=arguments;var o=args.callee._instance;this.cfg=cfg=Lib.apply(this.cfg||{},cfg);if(o){return o}var __this=this;args.callee._instance=this;var addImg=function(id,src,blogId){var img=new Image;img.src=src;$E(id).setAttribute("blogId",blogId);var setImg=function(id,src){var cid=$E(id).getAttribute("blogId");if(cid===blogId){$E(id).src=src}};if(img.complete){$E(id).src=src}else{$E(id).src=pixPic;img.onload=function(){setImg(id,src)};img.onerror=function(){$E(id).src="http://s4.sinaimg.cn/image/default_cover.gif#4"}}};var setTitle=function(el,title,blogId){el=$E(el);title=title||"查看原文";if(el.textContent){el.textContent=title}else{el.innerText=title}var href;if(blogId){href="http://blog.sina.com.cn/s/blog_"+blogId+".html"}else{href="javascript:;"}el.href=href};var fixLayerPos=function(containerEl,el){var top=(containerEl.offsetHeight-el.offsetHeight)/2;var left=(containerEl.offsetWidth-el.offsetWidth)/2;if(top<0){top=0}el.style.top=top+"px";if(left<0){left=0}el.style.left=left+"px"};var nextSlide=function(e){var datas=Lib.util.getActionData(e,"show-next-slide");if(!datas){return}var data=decodeURIComponent(datas.data).split("###");var blogId=data[0];var layer=new Article.MultipleImgLayer;layer.showNextSlide(blogId)};var nextTJ=function(e){var datas=Lib.util.getActionData(e,"show-next-tj");if(!datas){return}var data=decodeURIComponent(datas.data).split("###");var blogId=data[0];var time=data[1]||"";var action=data[2]||"next";var layer=new Article.MultipleImgLayer;layer.setDirection("next");layer.getNextSlideData(blogId,time,function(data){if(data.pre.blogId||data.next.blogId){showPageBtn();__this.show(data)}else{hidePageBtn(action)}},action);return false};var setActionData=function(id,data,time,action){if(data){$E(id).setAttribute("action-data",encodeURIComponent(data+"###"+time+"###"+action))}};var hidePageBtn=function(direction){$E(nodeIds[direction+"Btn"]).style.visibility="hidden"};var showPageBtn=function(){$E(nodeIds["nextBtn"]).style.visibility="";$E(nodeIds["preBtn"]).style.visibility=""};var hideNextArea=function(direction){setTitle(nodeIds[direction+"Title"],"");addImg(nodeIds[direction+"Img"],"http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif");setActionData(nodeIds[direction+"Btn"],"");$E(nodeIds[direction+"Img"]).style.visibility="hidden";$E(nodeIds[direction+"Title"]).style.visibility="hidden";hidePageBtn(direction)};var convertUrl=function(url){var urlReg=/(?:(?:ww\d+|s\d+).sinaimg.cn|photo\.sina\.com\.cn)\/(mw690|mw600|middle|bmiddle)/;var groups=url.match(urlReg);if(groups){switch(groups[1]){case"bmiddle":return url.replace(/\/bmiddle\//,"/cover/");case"mw690":return url.replace(/\/mw690\//,"/cover/");case"middle":return url.replace(/\/middle\//,"/cover/");case"mw600":return url.replace(/\/mw600\//,"/cover/");default:return url}}else{return url}};var pixPic="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif";var _tplStr='<div id="#{entity}" class="showEnd" style="position:absolute;visibility:hidden;">'+'<div class="tit">'+"<strong>该篇博文浏览结束</strong>"+'<a id="#{review}" href="javascript:;" class="replay" title="重新浏览" hidefocus="true"></a></div>'+'<div class="pages">'+'<a id="#{preBtn}" href="javascript:void(0);" class="preview" action-type="show-next-tj" hidefocus="true">&lt;&lt;上一篇</a>'+'<a id="#{nextBtn}" href="javascript:void(0);" class="next" action-type="show-next-tj" hidefocus="true">下一篇&gt;&gt;</a></div>'+'<div class="content"><ul><li>'+'<a id="#{preImgBtn}" action-type="show-next-slide" href="javascript:;" hidefocus="true"><img id="#{preImg}" src="'+pixPic+'" /></a>'+'<a id="#{preTitle}" href="javascript:;" target="_blank" hidefocus="true">标题</a></li>'+'<li class="nomgr">'+'<a id="#{nextImgBtn}" action-type="show-next-slide" href="javascript:;" hidefocus="true">'+'<img id="#{nextImg}" src="'+pixPic+'" /></a>'+'<a id="#{nextTitle}" href="javascript:;" target="_blank" hidefocus="true">标题</a>'+"</li>"+"</ul>"+"</div>"+"</div>";var doc=document,mask=null,tpl=new Lib.HtmlTemplate(_tplStr);Core.Dom.addHTML(cfg.renderTo,tpl.getHtmlString());var nodeIds=tpl.getNodeIds();var _addEvent=Core.Events.addEvent;_addEvent($E(nodeIds["review"]),function(){v7sendLog("49_01_06");this.cfg.review(this)}.bind2(this));_addEvent($E(nodeIds["preBtn"]),function(){v7sendLog("49_01_07")});_addEvent($E(nodeIds["nextBtn"]),function(){v7sendLog("49_01_08")});_addEvent($E(nodeIds["preImgBtn"]),function(){v7sendLog("49_01_09")});_addEvent($E(nodeIds["nextImgBtn"]),function(){v7sendLog("49_01_10")});_addEvent($E(nodeIds["entity"]),nextSlide);_addEvent($E(nodeIds["entity"]),nextTJ);var _that={isHidden:true,getEntity:function(){return $E(nodeIds["entity"])},fixPos:function(){if(!this.isHidden){fixLayerPos(this.cfg.renderTo,this.getEntity())}},show:function(data){var coEl=$E(nodeIds["preImgBtn"]).parentNode.parentNode.parentNode;var btnEl=$E(nodeIds["preBtn"]).parentNode;if(!data){coEl.style.display="none";btnEl.style.display="none";data={}}else{coEl.style.display="";btnEl.style.display=""}var cfg=this.cfg,containerEl=cfg.renderTo,el=this.getEntity();if(el.offsetHeight==0||el.offsetWidth==0){return false}fixLayerPos(containerEl,el);this.isHidden=false;el.style.visibility="inherit";var preTitleEl=$E(nodeIds["preTitle"]),nextTitleEl=$E(nodeIds["nextTitle"]);var isHiddenBg=false;if(data.pre&&data.pre.images&&data.pre.images.length>0){var preBlogId=data.pre.blogId;var prePubTime=data.pre.publishTime;$E(nodeIds["preTitle"]).style.visibility="inherit";setTitle(preTitleEl,data.pre.title,preBlogId);addImg(nodeIds["preImg"],convertUrl(data.pre.images[0]),preBlogId);$E(nodeIds["preImg"]).style.visibility="inherit";setActionData(nodeIds["preBtn"],preBlogId,prePubTime,"pre");$E(nodeIds["preBtn"]).style.visibility="inherit";setActionData(nodeIds["preImgBtn"],preBlogId)}else{isHiddenBg=true;hideNextArea("pre")}if(data.next&&data.next.images&&data.next.images.length>0){var nextBlogId=data.next.blogId;var nextPubTime=data.next.publishTime;$E(nodeIds["nextTitle"]).style.visibility="inherit";setTitle(nextTitleEl,data.next.title,nextBlogId);addImg(nodeIds["nextImg"],convertUrl(data.next.images[0]),nextBlogId);$E(nodeIds["nextImg"]).style.visibility="inherit";setActionData(nodeIds["nextBtn"],nextBlogId,nextPubTime,"next");$E(nodeIds["nextBtn"]).style.visibility="inherit";setActionData(nodeIds["nextImgBtn"],nextBlogId)}else{isHiddenBg=true;hideNextArea("next")}if(isHiddenBg){coEl.style.backgroundImage="none"}else{if(!$IE6){coEl.style.background="url("+orURL+") 235px 100px no-repeat"}else{coEl.style.backgroundImage="url("+orURL+")"}}this.cfg.data=data;return true},hide:function(){var entity=this.getEntity();entity.style.visibility="hidden";this.isHidden=true;return true}};var orURL="http://simg.sinajs.cn/blog7style/images/common/multishow_or."+($IE==6?"gif":"png");Lib.apply(this,_that)};Lib.register("diYuanXinLog",function(){var isLoadScript=!1;var isLoading;var cache=[];var jsver=typeof $_GLOBAL!="undefined"&&$_GLOBAL.ver!=null?$_GLOBAL.ver["di_yuan_xin"]||"-1":"-1";var url="http://sjs.sinajs.cn/xblogtheme/js/di_yuan_xin.js?ver="+jsver+".js";var isLoadScript=function(){Utils.Io.JsLoad.request(url,{isRemove:!1,noreturn:true,onComplete:function(){isLoading=!1;isLoadScript=!0;for(var i=0,len=cache.length;i<len;i++){cache[i]()}cache=[]}})};return function(fun){if(!0===isLoadScript){fun()}else if(!0===isLoading){cache.push(fun)}else{cache.push(fun);isLoadScript()}}});Article.MultipleImgLayer=function(cfg){var args=arguments;var o=args.callee._instance;if(o){return o}args.callee._instance=this;var me=this;var hideScroller=function(){if($FF){me.scrollTop=document.documentElement.scrollTop}if($IE6){document.body.setAttribute("scroll","no")}else{document.documentElement.style.overflow="hidden";!$IE8&&(document.body.style.overflow="hidden")}};var showScroller=function(){if($IE6){document.body.removeAttribute("scroll")}else{document.documentElement.style.overflow="auto";!$IE8&&(document.body.style.overflow="auto")}if($FF){document.documentElement.scrollTop=me.scrollTop}};var getWinSize=function(){var clientSize=function(name){var doc=document,docElemProp=doc.documentElement["client"+name],body=doc.body;return doc.compatMode==="CSS1Compat"&&docElemProp||body&&body["client"+name]||docElemProp};return{height:clientSize("Height"),width:clientSize("Width")}};var showLoading=function(winSize){var loadingEl=$E(layerNodesId["multiPicLoading"]),height=Math.max(winSize.height,500),width=Math.max(winSize.width,500);loadingEl.style.top=(height-181)/2+"px";loadingEl.style.left=(width-141)/2+"px";removeCurrentPic()};var hideLoading=function(){$E(layerNodesId["multiPicLoading"]).style.top="-1000px"};var updateWinPosAndSize=function(entity){var winSize=getWinSize(),height=Math.max(winSize.height,500),width=Math.max(winSize.width,500),doc=document,scrollHeight=doc.documentElement.scrollTop+doc.body.scrollTop;entity.style.height=height+"px";entity.style.width=width+"px";entity.style.top=scrollHeight+"px";var contentEl=$E(layerNodesId["multiPicContent"]);contentEl.style.height=height-88+"px"};var getCurrentPic=function(){var contentEl=$E(layerNodesId["multiPicContent"]);var pics=contentEl.getElementsByTagName("IMG"),img,attr;for(var i=0,l=pics.length;i<l;i++){img=pics[i];attr=img.getAttribute("origin-size");if(attr){return img}}return null};var removeCurrentPic=function(){var curentPic=getCurrentPic();if(curentPic){curentPic.parentNode.removeChild(curentPic)}};var setCurrentPicSize=function(winSize,imageEl){var maxHeight=Math.max(winSize.height-88,412);var maxWidth=Math.max(winSize.width,500);var imgHeight=imageEl.height;var imgWidth=imageEl.width;imageEl.setAttribute("origin-size",imgWidth+"*"+imgHeight);var hPercent=(winSize.height-88)/imgHeight;var wPercent=winSize.width/imgWidth;if(!isFinite(hPercent)||!isFinite(wPercent)){return}var rate=1,width,height;if(1>hPercent&&hPercent<wPercent){height=Math.min(imgHeight,maxHeight);rate=height/imgHeight;width=rate*imgWidth;imageEl.height=height;imageEl.width=width}else if(1>wPercent){width=Math.min(imgWidth,maxWidth);rate=width/imgWidth;height=rate*imgHeight;imageEl.width=width;imageEl.height=height}if($IE&&$IE<8){imageEl.style.zoom=1}};var setCurrentPicPos=function(containerEl,el){if(el.offsetHeight==0||el.offsetWidth==0){return}var top=(containerEl.offsetHeight-el.offsetHeight)/2;var left=(containerEl.offsetWidth-el.offsetWidth)/2;if(top<0){top=0}el.style.top=top+"px";if(left<0){left=0}el.style.left=left+"px";trace("left: "+left+" top:"+top);var oPicEl=$E(layerNodesId["orignalPic"]);oPicEl.style.top=top+10+"px";oPicEl.style.left=left+10+"px"};var showOrignalLink=function(){var oPicEl=$E(layerNodesId["orignalPic"]);oPicEl.style.visibility="inherit"};var hideOrignalLink=function(){var oPicEl=$E(layerNodesId["orignalPic"]);oPicEl.style.visibility="hidden"};var sendStaticCode=function(src){var gImg="___$image"+(new Date).getTime();var img=window[gImg]=new Image;blogId=$E(layerNodesId["multiPicLike"]).getAttribute("blog-id");img.src="http://control.blog.sina.com.cn/riaapi/article/filmslide.php?"+gImg+"&blogId="+blogId+"&img="+src;img.onload=img.onerror=function(){img=null;window[gImg]=null}};var tipsShow=false;var showError=function(msg,okCb,closeCb){if(tipsShow){return}tipsShow=true;winDialog.alert(msg,{icon:"01",textOk:"知道了",funcOk:function(){errorCount=0;tipsShow=false;goToNextPic();okCb&&okCb()},funcClose:function(){errorCount=0;tipsShow=false;goToNextPic();closeCb&&closeCb()}},"slide-box-tips")};var showTooSmall=function(msg){if(isHidden){return}smallCount=0;showError(msg||"图片太小啦，无法展示！")};var setOrignalPicUrl=function(src){var urlReg=/(?:(?:ww\d+|s\d+).sinaimg.cn|photo\.sina\.com\.cn)\/large/;var groups=src.match(urlReg);$E(layerNodesId["orignalLink"]).href=src};var currentSrc="";var showPic=function(imgUrl,len,index,img){if(isHidden){return}var src=convertUrl(imgUrl.url);if(!img){var img=new Image;img.src=src}currentSrc=src;var indexHtml="<em>"+(currentPicIndex+1)+"</em>/<span>"+len+"</span>";$E(layerNodesId["multiPicIndex"]).innerHTML=indexHtml;removeCurrentPic();var winSize=getWinSize();img.style.top="-10000px";img.style.position="absolute";imgContainer.appendChild(img);var isRightSize=img.width>200||img.height>200;if(!$IE6&&isRightSize||img.complete&&isRightSize){_setStyle(img,"opacity",.5);hideLoading();setTimeout(function(image){var pn=$E(layerNodesId["multiPicContent"]);return function(){if(image.src!==currentSrc){imgContainer.removeChild(image);return}sendStaticCode(image.src);image.setAttribute("action-type","show-large-layer");image.setAttribute("action-data",encodeURIComponent(image.src));pn.appendChild(image);setTimeout(function(){setCurrentPicSize(getWinSize(),image);setCurrentPicPos(pn,image);var tween=new Ui.TweenStrategy(.5,1,.5);tween.onTween=function(v){if(img.src!==currentSrc){if(image.parentNode){image.parentNode.removeChild(image)}tween.stop();image=null;return}_setStyle(image,"opacity",v)};tween.start();setOrignalPicUrl(image.src)})}}(img))}else{args=arguments;showLoading(winSize);var count=0,delay=15;var t=setInterval(function(image,i){return function(){if(!_images){clearInterval(t);
return}var isRightSize=image.offsetWidth>200||image.offsetHeight>200;var time=count*delay/1e3;count++;var isSmall=image.complete&&image.width>0&&image.height>0&&image.width<200&&image.height<200;if(isSmall&&!_images[i].recordSmall){smallCount++;_images[i].recordSmall=1}if(_images&&_images.length==smallCount+errorCount){clearInterval(t);if(errorCount==0){showTooSmall()}return}if(time>5||isSmall){clearInterval(t);errorCount++;if(i===currentPicIndex){removeCurrentPic();goToNextPic()}return}if(image.complete&&isRightSize){clearInterval(t);var params=[];for(var l=0,len=args.length;l<len;l++){params.push(args[l])}params.push(image);args.callee.apply(null,params);return}}}(img,index),delay);img.onerror=function(i){return function(e){if(!_images[i].recordError){errorCount++;_images[i].recordError=1}if(errorCount+smallCount>=len){clearInterval(t);showError("抱歉，图片读取失败。");return}img.onerror=null;removeCurrentPic();goToNextPic()}}(index)}};var goToNextPic=function(){if("pre"===$E(layerNodesId["multiPicEntity"]).getAttribute("direction")){prePic()}else{nextPic()}};var convertUrl=function(url){var urlReg=/(?:(?:ww\d+|s\d+).sinaimg.cn|photo\.sina\.com\.cn)\/(mw690|mw600|middle|bmiddle)/;var groups=url.match(urlReg);if(groups){switch(groups[1]){case"bmiddle":return url.replace(/\/bmiddle\//,"/large/");case"mw690":return url.replace(/\/mw690\//,"/large/");case"middle":return url.replace(/\/middle\//,"/large/");case"mw600":return url.replace(/\/mw600\//,"/large/");default:return url}}else{return url}};var loadingNextPic=function(imgUrls,sum){var imgUrl=null,count=Math.abs(sum),len=imgUrls.length;for(var i=1;i<count;i++){var index=sum>0?currentPicIndex+i:currentPicIndex-i;imgUrl=imgUrls[index];if(imgUrl&&imgUrl.loaded===0){!function(src,pos){setTimeout(function(){var img=new Image;img.onload=img.onerror=function(){img=null};img.src=src;_images[pos].loaded=1},40)}(convertUrl(imgUrl.url),index)}}};var isFacePic=function(src){if(-1!==src.indexOf("sinaimg.cn/uc/myshow")){return true}if(-1!==src.indexOf("img.t.sinajs.cn")){return true}if(-1!==src.indexOf("simg.sinajs.cn")){return true}if(-1!==src.indexOf("sinaimg.cn/small")){return true}if(-1!==src.indexOf("sinaimg.cn/square")){return true}return false};var initShow=function(pics,blogId){var i,len=pics.length,winSize=getWinSize();_images=pics;if(0<len){showLoading(winSize);showBorder();var hasPos=false;for(i=0;i<len;i++){if(_images[i].click){currentPicIndex=i;showPic(_images[i],len,i);hasPos=true;break}}if(!hasPos){currentPicIndex=0;showPic(_images[0],len,0)}loadingNextPic(_images,3);loadingNextPic(_images,-3)}else{hideLayer()}};var hideLayer=function(evt){if(evt){var targetEl=Core.Events.getEventTarget(evt);if("IMG"===targetEl.nodeName.toUpperCase()){return}}if(tjCover){tjCover.hide()}if(imgContainer){imgContainer.innerHTML="";document.body.removeChild(imgContainer);imgContainer=null}isHidden=true;var winSize=getWinSize();showScroller();var entityId=layerNodesId["multiPicEntity"];var entityEl=$E(entityId);entityEl.style.display="none";mask.hidden();_images=[];currentPicIndex=0;errorCount=0;smallCount=0;nextSildeData=null;__this.data=null;if(loginUi&&loginUi.dialog){loginUi.dialog.hidden()}};var isTJShow=false;var setHidden=function(id){$E(id).style.visibility="hidden"};var setVisible=function(id){$E(id).style.visibility="inherit"};var hideBorder=function(direction){setHidden(layerNodesId["multiPicLike"]);setHidden(layerNodesId["multiPicTitle"]);setHidden(layerNodesId["multiPicIndex"]);if("next"===direction){setHidden(layerNodesId["multiPicNext"])}else{setHidden(layerNodesId["multiPicPre"])}};var showBorder=function(){setVisible(layerNodesId["multiPicLike"]);setVisible(layerNodesId["multiPicTitle"]);setVisible(layerNodesId["multiPicIndex"]);setVisible(layerNodesId["multiPicNext"]);setVisible(layerNodesId["multiPicPre"])};var hideTJCover=function(){if(tjCover){tjCover.hide()}};var showTJCover=function(direction){isTJShow=true;var currentImg=getCurrentPic();if(currentImg){currentImg.style.visibility="hidden";currentImg=null}hideBorder(direction);hideOrignalLink();if(!tjCover){tjCover=new Article.SlideTJCover({renderTo:$E(layerNodesId["multiPicContent"]),review:function(){showBorder();currentPicIndex=-1;nextPic();tjCover.hide()}})}var blogId=$E(layerNodesId["multiPicEntity"]).getAttribute("blog-id");var blogLink=$E(layerNodesId["multiPicTitle"]);var time=decodeURIComponent(blogLink.getAttribute("publish-time")||"");__this.getNextSlideData(blogId,time,function(data){tjCover.show(data)},"")};var prePic=function(evt){if(evt){Core.Events.stopEvent(evt)}Lib.sendSuda(function(){try{SUDA.log("","blog_slide_page")}catch(e){}});Lib.diYuanXinLog(function(){try{vjEventTrack("")}catch(e){}});var len=_images.length;if(currentPicIndex<=0){showTJCover("pre");currentPicIndex=-1;return}else{currentPicIndex--}isTJShow&&hideTJCover();isTJShow&&showBorder();isTJShow=false;var img=_images[currentPicIndex];showPic(img,len,currentPicIndex);$E(layerNodesId["multiPicEntity"]).setAttribute("direction","pre");loadingNextPic(_images,-3)};var nextPic=function(evt){Lib.sendSuda(function(){try{SUDA.log("","blog_slide_page")}catch(e){}});Lib.diYuanXinLog(function(){try{vjEventTrack("")}catch(e){}});if(evt){Core.Events.stopEvent(evt)}var len=_images.length;if(currentPicIndex>=len-1){showTJCover("next");currentPicIndex=len;return}else{currentPicIndex++}isTJShow&&hideTJCover();isTJShow&&showBorder();isTJShow=false;var img=_images[currentPicIndex];showPic(img,len,currentPicIndex);$E(layerNodesId["multiPicEntity"]).setAttribute("direction","next");loadingNextPic(_images,3)};var like=function(evt){Core.Events.stopEvent(evt);var likeBtn=$E(layerNodesId["multiPicLike"]),blogId=likeBtn.getAttribute("blog-id"),url="http://control.blog.sina.com.cn/admin/digg/post_digg.php";var isBlocked=likeBtn.getAttribute("block");if(isBlocked==="1"){return}var titleEl=$E(layerNodesId["multiPicTitle"]);var title=titleEl.innerText||titleEl.textContent;likeBtn.setAttribute("block","1");Utils.Io.JsLoad.request(url,{onComplete:function(result){likeBtn.setAttribute("block","0");var code=result.code;if(code==="A00006"||code==="B00801"){likeBtn.className="ico_unlike ico_liked";likeBtn.innerHTML="已喜欢";if(scope.digger){scope.digger.setData(blogId,scope.$uid,1)}var diggerEl=$E("dbox_"+blogId);diggerEl.onmouseover=function(){};diggerEl.onmouseout=function(){};diggerEl.onclick=function(){};var ele=$E("dbox2_"+blogId);diggerEl.style.cursor="default";var states=diggerEl.getElementsByTagName("p")[1];if(states){diggerEl.className="upBox upBox_dis";var cons=states.innerHTML;var div=SinaEx.createNode("<div>"+cons+"</div>");var firstP=SinaEx.findNode(div,"nextSibling","firstChild");if(firstP)div.removeChild(firstP);var con=div.innerHTML;if(con==="顶"){states.innerHTML='<img width="15" height="15" align="absmiddle" src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" class="SG_icon SG_icon34">已顶'}else{states.innerHTML="已喜欢"}var curr=parseInt(ele.getAttribute("mnum"))+1;ele.innerHTML=curr}else{var curr=parseInt(ele.getAttribute("mnum"))+1;diggerEl.getElementsByTagName("span")[0].innerHTML=curr}}else if("A00800"===code){showError("对不起，您短时间点击喜欢过多，请多休息，注意身体！感谢您对新浪博客的支持和关注！",function(){},function(){})}else{showError(result.message||"发生错误，请稍候再试",function(){},function(){})}},GET:{res_id:blogId,res_uid:scope.$uid,action:"0",res_type:"1",ti_title:encodeURIComponent(title)},onException:function(){aObj.setAttribute("block","false");showError(result.message||"发生错误，请稍候再试",function(){},function(){})}})};var fixSildeBox=function(){updateWinPosAndSize($E(layerNodesId["multiPicEntity"]));setTimeout(function(){var winSize=getWinSize(),el=null;if(!isTJShow){el=getCurrentPic();el&&setCurrentPicSize(winSize,el);el&&setCurrentPicPos($E(layerNodesId["multiPicContent"]),el)}else{if(tjCover&&!tjCover.isHidden){tjCover.fixPos()}}},25)};var onRisize=function(evt){if(isHidden){return}var winSize=getWinSize(),body=document.body,args=arguments,_this=this;setTimeout(function(){var currentSize=getWinSize();if(currentSize.height===winSize.height&&currentSize.width===winSize.width){fixSildeBox()}},80)};var BaseZ=99999;var zIndex=BaseZ+parseInt(Ui.LayerCount()||0,10);var _tplStr='<div id="#{multiPicEntity}" class="dialogMultiShow"                 style="display:none;z-index:'+(zIndex+1)+';">              <a id="#{multiPicClose}" href="javascript:void(0);" title="关闭" class="close" style="z-index:'+(zIndex+2)+'" hidefocus="true">关闭</a>              <a id="#{multiPicPre}" href="javascript:void(0);" class="btn_preview" style="z-index:'+(zIndex+2)+'" hidefocus="true"></a>              <a id="#{multiPicNext}" href="javascript:void(0);" class="btn_next" style="z-index:'+(zIndex+2)+'" hidefocus="true"></a>              <a id="#{multiPicLike}" href="javascript:void(0);" class="ico_unlike" style="z-index:'+(zIndex+2)+';display:none;" hidefocus="true">喜欢</a>              <div class="bd">                <div id="#{multiPicIndex}" class="count"><em>5</em>/<span>20</span></div>                <div id="#{multiPicContent}" class="pic" style="position:relative;">                    <div class="con" id="#{orignalPic}" style="position:absolute;z-index:1025;">                        <a id="#{orignalLink}" target="_blank" href="#" class="opic" title="查看原图"  hidefocus="true">查看原图</a>                    </div>                    <div id="#{multiPicLoading}" class="loadding" style="top:-10000px;">图片加载中......</div>                </div>                <div class="title"><a id="#{multiPicTitle}" target="_blank" href="javascript:void(0);"  hidefocus="true">标题</a></div>              </div>            </div>';var doc=document,mask=null,__this=this,tpl=new Lib.HtmlTemplate(_tplStr),layerNodesId=tpl.getNodeIds(),layerHtml=tpl.getHtmlString(),errorCount=0,smallCount=0,_images=[],_addEvent=Core.Events.addEvent,_setStyle=Core.Dom.setStyle,isHidden=true,currentPicIndex=0,cssURL="http://simg.sinajs.cn/blog7style/css/common/multishow.css",tjCover=null,nextSildeData=null;Utils.Io.loadExternalCSS(cssURL,function(){});Core.Dom.addHTML(document.body,layerHtml);_addEvent($E(layerNodesId["multiPicClose"]),hideLayer);_addEvent($E(layerNodesId["multiPicPre"]),prePic);_addEvent($E(layerNodesId["multiPicNext"]),nextPic);_addEvent(document,function(e){if(isHidden){return}var direction=$E(layerNodesId["multiPicEntity"]).getAttribute("direction");if(37===e.keyCode&&!(isTJShow&&direction==="pre")){prePic()}else if(39===e.keyCode&&!(isTJShow&&direction==="next")){nextPic()}},"keydown");_addEvent($E(layerNodesId["multiPicTitle"]),function(e){Core.Events.stopBubble(e)});_addEvent($E(layerNodesId["multiPicContent"]),function(e){var datas=Lib.util.getActionData(e,"show-large-layer");if(!datas){return}showOrignalLink()},"mouseover");_addEvent($E(layerNodesId["multiPicContent"]),function(e){var datas=Lib.util.getActionData(e,"show-large-layer");if(!datas){return}var toEl=e.toElement||e.relatedTarget;var fromEl=e.srcElement||e.target;if(toEl&&"A"===toEl.nodeName.toUpperCase()&&"IMG"===fromEl.nodeName.toUpperCase()){return}hideOrignalLink()},"mouseout");_addEvent(window,onRisize,"resize");var imgContainer=null;var loginUi=null;Lib.checkAuthor(function(){if(!$isLogin){loginUi=new Lib.Login.Ui}},"MultipleImgLayer"+(new Date).getTime());var _that={scrollTop:0,show:function(pics,link,title,isLiked,blogId,publishTime){var entityId=layerNodesId["multiPicEntity"];var entityEl=$E(entityId);if(!entityEl||!pics.length){return}Lib.checkAuthor();isTJShow=false;if(!imgContainer){imgContainer=document.createElement("DIV");imgContainer.id="_sile-img-box"+(new Date).getTime();imgContainer.style.position="absolute";imgContainer.style.top="-10000px";this.imgContainer=imgContainer;document.body.appendChild(imgContainer)}hideOrignalLink();errorCount=0;smallCount=0;title=title||"";isHidden=false;var winSize=getWinSize();hideScroller();blogId=blogId||scope.$articleid;$E(layerNodesId["multiPicEntity"]).setAttribute("blog-id",blogId);setTimeout(function(){if(!mask){mask=new Lib.OnlyShadow(.9,doc.body,"mask_mutiplepic",{zIndex:zIndex});mask.entity.style.zIndex=zIndex;mask.entity.style.backgroundColor="black"}var currentSize=getWinSize();mask.entity.style.width=currentSize.width+"px";mask.show();entityEl.style.display="";updateWinPosAndSize(entityEl);var tmpPics=[];for(var i=0,len=pics.length;i<len;i++){o=pics[i];if(!isFacePic(o.url)){tmpPics.push(o)}}if(0<tmpPics.length){initShow(tmpPics,blogId)}else{showTooSmall()}if(link){var blogHref=typeof link!=="string"?link.href:link;var blogLink=$E(layerNodesId["multiPicTitle"]);blogLink.href=blogHref;blogLink.innerHTML="";blogLink.setAttribute("publish-time",encodeURIComponent(publishTime));var text=document.createTextNode(Core.String.trim(title)||"查看原文");blogLink.appendChild(text);var likeBtn=$E(layerNodesId["multiPicLike"]);likeBtn.setAttribute("blog-id",blogId);if(isLiked){likeBtn.className="ico_unlike ico_liked";likeBtn.innerHTML="已喜欢"}else{likeBtn.className="ico_unlike";likeBtn.innerHTML="喜欢"}}},25);var _this=this},getNextSlideData:function(blogId,publishTime,callBack,action){var me=this;Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/riaapi/article/getArticlePrevNextPic.php?rnd="+Math.random(),{GET:{blog_id:blogId,blog_pubdate:publishTime,uid:$UID||"",action:action||""},onComplete:function(data){if("A00006"===data.code){me.data=data.data}else{me.data={pre:{},next:{}}}callBack&&callBack(me.data)},onException:function(){}})},setDirection:function(direction){$E(layerNodesId["multiPicEntity"]).setAttribute("direction",direction)},showNextSlide:function(blogId){var data=this.data;if(data){this.recordPV(blogId);var blogInfo;for(var p in data){blogInfo=data[p];if(blogInfo&&blogId===blogInfo.blogId){break}}if(blogInfo){var link="http://blog.sina.com.cn/s/blog_"+blogInfo.blogId+".html",url,pics=[],images=blogInfo.images;for(var i=images.length-1;i>=0;i--){url=blogInfo.images[i];pics.unshift({url:url,loaded:0,click:0})}this.show(pics,link,blogInfo.title,blogInfo.isLiked,blogInfo.blogId,blogInfo.publishTime);if(tjCover){tjCover.hide()}}}},recordPV:function(blogId){if(blogId!==scope.$articleid){var img=new Image;var rnd=parseInt(Math.random()*1e3);var imgSrc="http://comet.blog.sina.com.cn/api?maintype=hits&act=4&aid="+blogId+"&ref="+encodeURIComponent(location.href)+"&rnd="+rnd;img.src=imgSrc;window["log_pv"+rnd]=img;img.onload=img.onerror=function(){window["log_pv"+rnd]=null;img=null}}},hide:function(){hideLayer()},destroy:function(){hideLayer();showScroller();document.body.removeChild($E(layerNodesId["multiPicEntity"]));layerHtml=null;_images=null;layerNodesId=null;if(tjCover){tjCover.destroy();tjCover=null}}};Lib.apply(this,_that)};$registJob("showSlideBox",function(sandBox){var __getActionData=Lib.util.getActionData,__addEvent=Core.Events.addEvent,regex=/([^\/]+)$/;var showSlideBox=function(imgUrls,blogLinkEl,title,isLiked,articleid,publishTime){Lib.sendSuda(function(){try{SUDA.log("","blog_slide_page")}catch(e){}});Lib.diYuanXinLog(function(){try{vjEventTrack("")}catch(e){}});var layer=new Article.MultipleImgLayer;layer.show(imgUrls,blogLinkEl,title,isLiked,articleid,publishTime)};var isFacePic=function(src){if(-1!==src.indexOf("sinaimg.cn/uc/myshow")){return true}if(-1!==src.indexOf("img.t.sinajs.cn")){return true}if(-1!==src.indexOf("simg.sinajs.cn")){return true}if(-1!==src.indexOf("sinaimg.cn/small")){return true}if(-1!==src.indexOf("sinaimg.cn/square")){return true}return false};var getImgObj=function(src,currentHref,picName){var isBlank=src===currentHref,obj=null;var isFace=isFacePic(src);if(-1===src.indexOf("/blog7style")&&-1===src.indexOf("sg_trans.gif")&&!isBlank&&!isFace){obj={url:src,loaded:0,click:picName===src.match(regex)[1].replace(/\&amp;690/,"&690")}}return obj};__addEvent(document.body,function(e){var datas=__getActionData(e,"show-slide");if(!datas){return}Core.Events.stopDefaultEvent(e);var articleid=scope.$articleid,currentHref=location.protocol+"//"+location.host+location.pathname,imgUrls=[],realSrc,src,img,blogLinkEl,title,isLiked,articleid,publishTime,picName,pageId=scope.$pageid;if(typeof SUDA!="undefined"){SUDA.uaTrack("blog_article","h_article19")}if("article"===pageId||"articleM"===pageId||"article_new"==pageId||"articleM_new"==pageId){var likeEl=$E("dbox_"+articleid);var blogLinkEl=location.href;var titleEl=$E("t_"+articleid),title=titleEl.innerText||titleEl.textContent;var isLiked=/\bupBox_dis\b/.test(likeEl.className);var wrap=$E("sina_keyword_ad_area2");var imgs=$T(wrap,"img");var clickPicSrc=decodeURIComponent(datas.data);picName=clickPicSrc.match(regex)[1];for(i=0,l=imgs.length;i<l;i++){img=imgs[i];realSrc=img.getAttribute("real_src");src=img.getAttribute("src");var isLoaded=realSrc===src;if(isLoaded){var badWidth=img.width>1&&img.width<200;var badHeight=img.height>1&&img.height<200;if(badWidth&&badHeight){continue}}src=realSrc||src;var obj=getImgObj(src,currentHref,picName);if(obj){imgUrls.push(obj)}}var spanEls=$T(document.body,"span"),timeEl,publishTime=scope.$publishTime;if(!publishTime){for(var i=spanEls.length-1;i>=0;i--){timeEl=spanEls[i];if("time SG_txtc"===timeEl.className){publishTime=timeEl.innerText||timeEl.textContent;break}}publishTime=publishTime.replace("(","").replace(")","")}showSlideBox(imgUrls,blogLinkEl,title,isLiked,scope.$articleid,publishTime)}else{var params=datas.data.split("&");var src=decodeURIComponent(params[0]),blogId=decodeURIComponent(params[1]),link=decodeURIComponent(params[2]),title=decodeURIComponent(params[3]),publishTime=decodeURIComponent(params[4]);Utils.Io.JsLoad.request("http://control.blog.sina.com.cn/riaapi/article/getArticlePic.php?rnd="+Math.random(),{GET:{blog_id:blogId,blog_pubdate:publishTime,uid:$UID||""},onComplete:function(result){if("A00006"===result.code){var data=result.data;var imgs=data.images;picName=src.match(regex)[1];for(i=0,l=imgs.length;i<l;i++){src=imgs[i];var obj=getImgObj(src,currentHref,picName);if(obj){imgUrls.push(obj)}}showSlideBox(imgUrls,link,title,data.isLiked,blogId,data.publishTime)}},onException:function(){}})}})});$registJob("showSlideBtn",function(sandBox){var foreach=Core.Array.foreach,pageid=scope.$pageid,isArt=pageid=="article"||pageid=="articleM"||pageid=="article_new"||pageid=="articleM_new",uid=scope.$uid,nickName,wrap=$E("sina_keyword_ad_area2")||document.body,wrapLeft,image,minHeight=62,fixAutoHover=1,__addEvent=Core.Events.addEvent;var slideWrapper=SinaEx.createNode('<div style="left: -1000px; top: -1000px;position:absolute;" class="picSlideBtn" action-type="show-slide" action-data="http%3A%2F%2Fww4.sinaimg.cn%2Flarge%2F697db644jw1dw1s1zljvaj.jpg"><a href="javascript:void(0);">幻灯播放</a></div>');document.body.appendChild(slideWrapper);function fnover(){if(this.width<200&&this.height<200){return false}var src=this.getAttribute("real_src")||this.getAttribute("src");this.setAttribute("action-data",encodeURIComponent(src));this.setAttribute("action-type","show-slide");var left=Core.Dom.getXY(this)[0]+10;left=Math.min(left,wrapLeft-134);slideWrapper.style.left=left+"px";slideWrapper.style.top=Core.Dom.getXY(this)[1]+10+"px";if(fixAutoHover){slideWrapper.style.display="";slideWrapper.setAttribute("action-data",encodeURIComponent(this.src))}}function fnout(){if(this.width<200&&this.height<200){return false}var e=Core.Events.getEvent(),et=e.relatedTarget||e.toElement;if(!et||!Core.Dom.contains(slideWrapper,et)){slideWrapper.style.display="none"}}function isFacePic(img){var src=img.getAttribute("real_src")||img.getAttribute("src")||"";if(-1!==src.indexOf("sinaimg.cn/uc/myshow")){return true}if(-1!==src.indexOf("img.t.sinajs.cn")){return true}if(-1!==src.indexOf("simg.sinajs.cn")){return true}if(-1!==src.indexOf("sinaimg.cn/small")){return true}if(-1!==src.indexOf("sinaimg.cn/square")){return true}return false}function findParentLink(node){while(node=node.parentNode){if("A"===node.nodeName.toUpperCase()){return node}}return null}function bindEvent(img){__addEvent(img,fnover.bind2(img),"mouseover");__addEvent(img,fnout.bind2(img),"mouseout")}function bindFn(img){if(isFacePic(img)||!Core.Dom.contains(wrap,img)){return}getWrapLeft();var pnLink=findLink(img);if(pnLink&&-1===pnLink.href.indexOf("photo.blog.sina.com.cn")){return}var currentSrc=img.getAttribute("src");var isDefault=-1!==currentSrc.indexOf("sg_trans.gif");if(img.complete&&!isDefault){bindEvent(img)}else{img.onload=function(){bindEvent(this);var src=this.getAttribute("real_src");var currentSrc=this.getAttribute("src");if(!src&&src===currentSrc){img.onload=null}}.bind2(img)}}function getWrapLeft(){wrapLeft=Core.Dom.getXY(wrap)[0]+wrap.clientWidth}Core.Events.addEvent(window,getWrapLeft,"resize");function findLink(node){if(!isArt){return null}var tagMore;while(node=node.parentNode){if(node.nodeName.toUpperCase()=="A"){return node}}return null}function bindWrapFn(){fixAutoHover=1;foreach($T(wrap,"img"),function(img){bindFn(img,"src")})}bindWrapFn();scope.showPicSlide=function(img,src){bindFn(img)}});Core.Dom.byClass=function(className,tagName,elem){elem=elem||document;if(elem.getElementsByClassName){return elem.getElementsByClassName(className)}var rcn=new RegExp("\\b"+className+"\\b"),ret=[],els=elem.getElementsByTagName(tagName),i,len=els.length;for(i=0;i<len;i++){elem=els[i];if(elem.nodeType===1&&elem.className&&rcn.test(elem.className)){ret.push(elem)}}return ret};$registJob("xingqu",function(){var cateIdHash={171:"娱乐博客",172:"财经博客",173:"股票博客",174:"体育博客",175:"IT博客",176:"博客首页",177:"文化博客",178:"教育博客",179:"军事博客",180:"女性博客",181:"育儿博客",182:"健康博客",183:"星座博客",184:"游戏博客",185:"美食博客",186:"旅游博客",187:"杂谈博客",191:"汽车博客",192:"房产博客",193:"佛学博客",194:"宠物博客"};var sendCateId=function(id){window._cateIdForThisPage_=id;Utils.Io.JsLoad.request("http://news.sina.com.cn/js/694/2013/0220/guess.boot.blog.js",{charset:"gb2312",isRemove:false,onComplete:function(){}})};var cateId;var href=window.location.href;if(href.indexOf("tj=")!==-1){var jian=Core.Dom.byClass("SG_icon107","img",$E("articlebody")),txt,k;if(jian){txt=jian[0].title}if(txt){for(k in cateIdHash){if(txt.indexOf(cateIdHash[k])>-1){cateId=k;break}}}sendCateId(cateId)}else if(cateId=scope.$cate_id){sendCateId(cateId)}Utils.Io.JsLoad.request("http://ent.sina.com.cn/js/470/2013/0506/collect.js",{charset:"gb2312",isRemove:false,onComplete:function(){}})});Lib.countOSLink=function(linkInfo){var __addEvent=Core.Events.addEvent;var rBlogLink=/^http:\/\/[\w\.]*?blog.sina.com.cn/i,i=linkInfo.length,j,blogid,uid,clinks,href;while(i--){blogid=linkInfo[i].blogid;uid=linkInfo[i].uid;clinks=linkInfo[i].container?$T(linkInfo[i].container,"a"):document.links;j=clinks.length;while(j--){href=clinks[j].href;if(!href||href.match(rBlogLink)||href.indexOf("javascript:")>-1){continue}!function(bid,a,url,uid){if(bid){__addEvent(a,function(){commonLog("http://interface.blog.sina.com.cn/riaapi/article/click_url.php?blogid="+bid+"&url="+encodeURIComponent(url))})}else{__addEvent(a,function(){commonLog("http://interface.blog.sina.com.cn/riaapi/article/click_url.php?uid="+uid+"&url="+encodeURIComponent(url))})}a=null}(blogid,clinks[j],href,uid)}}clinks=null;__addEvent=null};$registJob("osl_article",function(){Lib.countOSLink([{blogid:scope.$articleid||"",container:$E("sina_keyword_ad_area2")}])});slideBox=Core.Class.create();slideBox.prototype={assertNull:function(obj,msg){if(null==obj){throw Error(msg)}},initialize:function(boxBody,slideBody,previousBtn,nextBtn,cfg){this.assertNull(boxBody,"boxBody不能为null");this.assertNull(slideBody,"slideBody不能为null");this.assertNull(previousBtn,"previousBtn不能为null");this.assertNull(nextBtn,"nextBtn不能为null");this.boxBody=boxBody;this.slideBody=slideBody;this.previousBtn=previousBtn;this.nextBtn=nextBtn;this.isFirst=true;this.isLast=false;this.currentPage=1;this.cfg=cfg;var __bind2=Core.Function.bind2,defaultCfg={direction:"leftToRight",motion:Ui.Transition.simple,duration:.5,slideChildCount:1,onTweenBegin:function(){},onTweenEnd:function(){}};Core.Events.addEvent(previousBtn,__bind2(function(){this.cfg.onTweenBegin("",this.currentPage,"previous");this.previousPage()},this));Core.Events.addEvent(nextBtn,__bind2(function(){this.cfg.onTweenBegin("",this.currentPage,"next");this.nextPage()},this));var apply=function(thisObj,cfg){var p;for(p in cfg){thisObj[p]=cfg[p]}return thisObj};this.cfg=apply(defaultCfg,cfg||{});this.startTweenStyle=parseInt(this._getSlideBeginValue()||0);slideBody.style[this._getTweenStyle()]=this.startTweenStyle+"px"},getCurrentSlideLength:function(){var currentSlideLength=0,slideBodyStyle=this.slideBody.style;switch(this.cfg.direction){case"leftToRight":currentSlideLength=slideBodyStyle.left;break;case"bottomToTop":currentSlideLength=slideBodyStyle.bottom;break;case"topToBottom":currentSlideLength=slideBodyStyle.left;break}return parseInt(currentSlideLength||0)},hasNextPage:function(){return this.slideBody.children.length>this.currentPage*this.cfg.slideChildCount},hasPreviousePage:function(){return this.currentPage>1},getSlideLegnth:function(){var slideLength=this.cfg.slideLength||0;if(slideLength){return slideLength}var slideBody=this.slideBody,children=slideBody.children,childCounts=children.length;if(childCounts<1){return 0}var el=children[0],computeStyle=computeStyle||(window.getComputedStyle?window.getComputedStyle(el,""):el.currentStyle);var rectLength=0,marginRight,marginLeft,marginTop,marginBottom;switch(this.cfg.direction){case"leftToRight":var offsetWidth=el.offsetWidth;marginRight=this._getCurrentStyle(el,"margin-right",computeStyle)||0;marginLeft=this._getCurrentStyle(el,"margin-left",computeStyle)||0;rectLength=offsetWidth+parseInt(marginRight)+parseInt(marginLeft);break;case"bottomToTop":case"topToBottom":var offsetHeight=el.offsetHeight,collapsedHeight=0;marginTop=parseInt(this._getCurrentStyle(el,"margin-top",computeStyle)||0,10);marginBottom=parseInt(this._getCurrentStyle(el,"margin-bottom",computeStyle)||0,10);collapsedHeight=Math.max(marginTop,marginBottom);rectLength=offsetHeight+(childCounts-1)*collapsedHeight+marginTop+marginBottom;break}var totalLength=rectLength*this.cfg.slideChildCount;this.cfg.slideLength=totalLength;return totalLength},previousPage:function(){var isFirstPage=!this.hasPreviousePage();if(isFirstPage||this.onTweening){isFirstPage&&this.cfg.onTweenEnd("begin",this.currentPage,"previous");return}var _boxBody=this.boxBody,_slideBody=this.slideBody,computeStyle=window.getComputedStyle?window.getComputedStyle(_slideBody,""):_slideBody.currentStyle,beginValue=this.getCurrentSlideLength(computeStyle),endValue,slideLength=this.getSlideLegnth();this.currentPage--;endValue=beginValue+slideLength;this._tween(beginValue,endValue)},nextPage:function(){var isLastPage=!this.hasNextPage();if(isLastPage||this.onTweening){isLastPage&&this.cfg.onTweenEnd("end",this.currentPage,"next");return}var _boxBody=this.boxBody,_slideBody=this.slideBody,computeStyle=window.getComputedStyle?window.getComputedStyle(_slideBody,""):_slideBody.currentStyle,beginValue=this.getCurrentSlideLength(computeStyle),endValue,slideLength=this.getSlideLegnth();this.currentPage++;endValue=beginValue-slideLength;this._tween(beginValue,endValue)},_getCurrentStyle:function(el,property,computedStyle){var style,computedStyle=computedStyle||(window.getComputedStyle?window.getComputedStyle(el,""):el.currentStyle);try{style=computedStyle.getPropertyValue(property)}catch(e){property=property.replace(/^(-)/,"").replace(/-(\S)/g,function(a,b){return b.toUpperCase()});style=computedStyle[property]}return style},_getSlideBeginValue:function(computeStyle){var el=this.slideBody,beginValue=0;switch(this.cfg.direction){case"leftToRight":beginValue=this._getCurrentStyle(el,"left",computeStyle)||0;break;case"bottomToTop":beginValue=this._getCurrentStyle(el,"top",computeStyle)||0;break;case"topToBottom":beginValue=this._getCurrentStyle(el,"bottom",computeStyle)||0;break}return parseInt(beginValue)},_getTweenStyle:function(){switch(this.cfg.direction){case"leftToRight":return"left";case"bottomToTop":return"bottom";case"topToBottom":return"top"}return"left"},_tween:function(start,end){var style=this.slideBody.style,tweenStyle=this._getTweenStyle();tween=new TweenStrategyEx([start],[end],this.cfg.duration,this.cfg.motion);this.onTweening=true;tween.onTween=function(v){style[tweenStyle]=parseInt(v[0],10)+"px"};var _this=this;tween.onEnd=function(){var isEnd=!_this.hasNextPage(),isBegin=!_this.hasPreviousePage(),status="";if(isEnd){_this.isLast=true;_this.isFirst=false;status="end"}else if(isBegin){_this.isFirst=true;_this.isLast=false;status="begin"}else{_this.isFirst=false;_this.isLast=false}_this.onTweening=false;_this.cfg.onTweenEnd(status,_this.currentPage)};tween.start()}};$registJob("blog365Slide",function(){if(!$E("calendarCon")){return}$E("calendarCon").style.width=9999+"px";new slideBox($E("swrap"),$E("calendarCon"),$E("btn_preview"),$E("btn_next"),{slideChildCount:7,duration:1})});Lib.classUtils=function(){};Lib.classUtils.prototype.addClass=function(dom,clz){if(!dom){return false}if(!this.hasClass(dom,clz)){dom.className=Core.String.trim(dom.className.concat(" "+clz))}};Lib.classUtils.prototype.delClass=function(dom,clz){if(!dom){return false}var reg=new RegExp("( +|^)"+clz+"(?=( |$))","ig");dom.className=Core.String.trim(dom.className.replace(reg,""))};Lib.classUtils.prototype.hasClass=function(dom,clz){if(!dom){return false}var reg=new RegExp("( +|^)"+clz+"(?=( |$))","ig");return reg.test(dom.className)};!function(){if(scope.tpl!=="8_52"){return}Lib.checkAuthor(function(){var tmp='<ul id="blog365_calCon">'+'<li class="d1"><div class="pic"></div></li>'+'<li class="d2"><div class="pic"></div></li>'+'<li class="d3"><div class="pic"></div></li>'+'<li class="d4"><div class="pic"></div></li>'+'<li class="d5"><div class="pic"></div></li>'+'<li class="d6"><div class="pic"></div></li>'+'<li class="d7"><div class="pic"></div></li>'+'<li class="d8"><div class="pic"></div></li>'+'<li class="d9"><div class="pic"></div></li>'+'<li class="d10"><div class="pic"></div></li>'+'<li class="d11"><div class="pic"></div></li>'+'<li class="d12"><div class="pic"></div></li>'+'<li class="d13"><div class="pic"></div></li>'+'<li class="d14"><div class="pic"></div></li>'+'<li class="d15"><div class="pic"></div></li>'+'<li class="d16"><div class="pic"></div></li>'+'<li class="d17"><div class="pic"></div></li>'+'<li class="d18"><div class="pic"></div></li>'+'<li class="d19"><div class="pic"></div></li>'+'<li class="d20"><div class="pic"></div></li>'+'<li class="d21"><div class="pic"></div></li>'+'<li class="d22"><div class="pic"></div></li>'+'<li class="d23"><div class="pic"></div></li>'+'<li class="d24"><div class="pic"></div></li>'+'<li class="d25"><div class="pic"></div></li>'+'<li class="d26"><div class="pic"></div></li>'+'<li class="d27"><div class="pic"></div></li>'+'<li class="d28"><div class="pic"></div></li>'+'<li class="d29"><div class="pic"></div></li>'+'<li class="d30"><div class="pic"></div></li>'+'<li class="d31"><div class="pic"></div></li>'+'<li class="actpage"><div class="pic"><a title="活动页" target="_blank" href="http://qing.blog.sina.com.cn/tag/365"></a></div></li>'+"</ul>"+'<div class="wdate" id="blog365_dateNum"></div>';var url="http://control.blog.sina.com.cn/riaapi/activity/get_blog365.php?data=1";preRender();Utils.Io.JsLoad.request(url,{GET:{uid:scope.$uid||""},onComplete:function(result){if(result.code&&result.code==="A00006"){renderHTML(result.data)}}});function preRender(){var div=$C("div");div.className="module365";div.style.position="absolute";div.style.top="0px";div.style.right="0px";div.style.zIndex="200";div.innerHTML=tmp;$E("headarea")&&$E("headarea").appendChild(div);var children=$E("blog365_calCon")&&$E("blog365_calCon").children;var now=new Date,day=now.getDate(),year=now.getFullYear(),month=now.getMonth()+1;var t1=now.getTime();var t2=new Date(year,0,1).getTime();var time=t1-t2;if(time==0){time=1}else{time=Math.floor(time/(24*60*60*1e3))+1}$E("blog365_dateNum").innerHTML=time;if($isAdmin){var today=children[day-1];todayDiv=today.getElementsByTagName("div")[0];today.className+=" today";var html='<a onclick="v7sendLog(\'48_01_22\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365" target="_blank"><span class="rectoday" title="记录今天"></span></a>';
todayDiv.innerHTML=html;var monthDays=daysNum(year,month);for(var j=day;j<monthDays;j++){var child=children[j],childDiv=child.getElementsByTagName("div")[0];child.className+=" coming";var preTime=year+"-"+month+"-"+(j+1);var html='<a onclick="v7sendLog(\'48_01_23\')" href="http://control.blog.sina.com.cn/admin/article/article_add.php?tag365='+preTime+'" target="_blank"><span class="tq">提前<br>记录</span></a>';childDiv.innerHTML=html}}}function renderHTML(data){var children=$E("blog365_calCon")&&$E("blog365_calCon").children;var now=new Date,day=now.getDate(),year=now.getFullYear(),month=now.getMonth()+1;for(var item in data){var i=item.split("-")[2]-1;var child=children[i],childDiv=child.getElementsByTagName("div")[0];if(data[item].pre&&data[item].href){child.className="d"+(i+1)+" writed";var html="";if($isAdmin){html='<a href="'+data[item].href+'" target="_blank" ><span class="date">'+(i+1)+"日</span></a>";childDiv.innerHTML=html}childDiv.innerHTML=html}else{if(i===day-1){child.className="d"+day}var href,html;href=data[item].href?data[item].href:"javascript:void(0);";target=data[item].href?"_blank":"";if(data[item].src&&data[item].src.indexOf("sinaimg.cn")>=0){html='<a href="'+href+'" target="'+target+'"><img src="'+data[item].src+'"/><span class="date">'+(i+1)+"日</span></a>"}else{html='<a href="'+href+'" target="'+target+'"><span class="date">'+(i+1)+"日</span></a>"}childDiv.innerHTML=html}}}function daysNum(y,m){var isLeap=function(y){return y%400?y%100?y%4?0:1:0:1};if(!y*m){return 0}var d=31;switch(m){case 4:case 6:case 9:case 11:d=30;break;case 2:d=isLeap(y)?29:28;break}return d}},"templateCanlendar"+(new Date).getTime())}();$registJob("loginStatus",function(){var _getCookie=Utils.Cookie.getCookie;var _setCookie=Utils.Cookie.setCookie;var statusUid=_getCookie("_s_loginStatus");var loginUid=_getCookie("_s_loginuid");Lib.checkAuthor(function(){if($isLogin){if(loginUid===$UID){return}}else{if(!statusUid||statusUid===loginUid){return}}_setCookie("_s_loginuid",$UID||statusUid,24-(new Date).getHours(),"","blog.sina.com.cn");var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/padblog/padInfo.php?rnd="+Math.random();Utils.Io.JsLoad.request(url,{onComplete:function(){},onException:function(){}})},"loginStatus"+(new Date).getTime())});$registJob("showTB680",function(){Lib.execZhitou(function(res){var col1=document.getElementById("column_1");var comps=Core.Dom.byClass("SG_conn","div",col1);var insertEl=comps[2]||comps[comps.length-1];var adEl=blogAd.insertIns("PDPS000000033239",insertEl,"beforebegin");(window.sinaads||[]).push({element:adEl,params:{sinaads_success_handler:function(){adEl.style.marginBottom="10px"}}})})});$registJob("padSwitch",function(){var ua=navigator.userAgent,isiPad=/(iPad).*OS\s([\d_]+)/.test(ua);var _el_html='<div class="webSelect"><a id="sw_web" class="current" href="javascript:void(0);">电脑版</a><a id="sw_pad" href="javascript:void(0)">PAD版</a></div>';var _addevent=Core.Events.addEvent;var url=window.location.href;function deleteCookie(name){var Then=new Date;Then.setTime(Then.getTime()-1);document.cookie=name+"=_pass;path=/;domain=.blog.sina.com.cn;expires="+Then.toGMTString()}if(isiPad){Core.Dom.insertHTML($E("sinablogfooter"),_el_html,"AfterBegin");_addevent($E("sw_pad"),function(e){e.target.className="current";Core.Dom.removeClass($E("sw_web"),"current");deleteCookie("ipad4web");url=url.replace("blog","m.blog");window.location.href=url})}});$registJob("loginFollow",function(){Lib.checkAuthor(function(){var loginFollow=$E("loginFollow");var onceloggedonblog=unescape(Utils.Cookie.getCookie("onceloggedonblog"));var userInfo=Lib.Login.info();var uid=userInfo.uid;var nick=userInfo.nick;if(!loginFollow||!onceloggedonblog||$isLogin||!uid||!nick){return}if(uid===scope.$uid){return}var tpl='<div class="loginFollow">'+'<div class="con">'+'<p id="#{loginFollowCon}"></p>'+'<div class="btm"><a id="#{loginBtn}" href="javascript:void(0);" class="btn" title="登录并关注"></a><span>还没有博客账号？点此<a href="https://login.sina.com.cn/signup/signupmail.php?entry=blog&r=&srcuid=&src=blogicp" target="_blank" onclick="v7sendLog(\'44_01_03_'+uid+"')\">注册</a>一个</span></div>"+"</div>"+"</div>";var nodes=Utils.insertTemplate(loginFollow,tpl,"BeforeEnd");nodes.loginFollowCon.innerHTML="Hi，"+nick+"！我是"+(scope.owenerNickName||$E("ownernick").innerHTML.replace(/(\r|\n)/g,""))+"。  现在就登录关注我的博客，不要错过我的任何更新！";v7sendLog("44_01_01_"+uid);var trayLogin=new Lib.Login.Ui;Core.Events.addEvent(nodes.loginBtn,function(){v7sendLog("44_01_02_"+uid);trayLogin.login(function(){v7sendLog("44_01_04_"+uid);Lib.Component.Attention($UID,scope.$uid,function(){location.reload()})})},"click");function tween(){var twn=new Ui.TweenStrategy;twn.onTween=function(value){};twn.onEnd=function(){};twn.start()}},"loginFollow"+(new Date).getTime())});$registJob("blogTip",function(){var listener=Lib.Listener;listener.on({name:"article-msg-loaded",callBack:function(data){onDataComplete(data)},scope:this});var closeBtn=null;var uid="";var cid="";var NickName="";var UserPicUrl="";var reSetUID=function(_uid){uid=_uid;var size=size||50;var n=parseInt(_uid)%8+1;UserPicUrl="http://portrait"+n+".sinaimg.cn/"+_uid+"/blog/"+size};var onDataComplete=function(json){if(json){if(json.cms_id==cid){return}reSetUID(json.uid);cid=json.cms_id+"";NickName=json.nick_name;creatTip();showTip()}};var creatTip=function(){if(!$E("blogTip")){var _shtml='<div id="blogTip" class="mDynaState" style="position:fixed;z-index:300; left:580px; top:92px; opacity:0.0;"><div class="con"><a onclick="v7sendLog(\'40_01_47\')" href="###"><img id="UIMG" width="30" height="30" alt=""></a><a href="###" onclick="v7sendLog(\'40_01_47\')" id="NName" class="nickname"></a>刚刚对此博文进行了评论<span id="blogTipShowBtn">,<a href="###" onclick="v7sendLog(\'40_01_46\')">查看</a></span></div><a href="###" onclick="v7sendLog(\'40_01_48\');" class="close" title="关闭" id="blogTip_closeBtn">×</a></div>';Core.Dom.addHTML(document.body,_shtml);var xy=Core.Dom.getXY($E("sinabloga"));$E("blogTip").style.top=xy[1]+"px";Core.Events.addEvent(blogTip,function(){hideTip();if($E("article_comment_list").childNodes[0].childNodes.length<1){var myComment=new Comment.List;myComment.load(1);scope.$comment_is_load_page_1=1;setTimeout(checkCMS,1e3)}else{checkCMS()}Core.Events.stopEvent()},"click");Core.Events.addEvent(blogTip_closeBtn,function(){hideTip();Core.Events.stopEvent()},"click");Core.Events.addEvent(UIMG,function(){window.open("http://blog.sina.com.cn/u/"+uid);hideTip();Core.Events.stopEvent()},"click");Core.Events.addEvent(NName,function(){window.open("http://blog.sina.com.cn/u/"+uid);hideTip();Core.Events.stopEvent()},"click")}$E(UIMG).src=UserPicUrl;var nickNameLength=0;var a=NickName.split("");var flag=0;for(var i=0;i<a.length;i++){if(a[i].charCodeAt(0)<299){nickNameLength+=.75}else{nickNameLength+=1}if(nickNameLength>=8&&flag==0){flag=i}}if(flag>0){$E(NName).innerHTML=NickName.substr(0,flag)+"..."}else{$E(NName).innerHTML=NickName}if(cid){$E("blogTipShowBtn").style.display=""}else{$E("blogTipShowBtn").style.display="none"}};var checkCMS=function(){if($E("cmt_"+cid)){changeHASH()}else{var url="http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/getCms.php?uid="+scope.$uid+"&cms_id="+cid;Utils.Io.JsLoad.request(url,{onComplete:function(result){if(result&&"A00006"===result.code){result.data["cid"]=cid;addCMS(result.data)}},onException:function(){location.hash="commonComment"},timeout:3e3})}};var addCMS=function(data){var $container=$E("article_comment_list");var comment=new CommentV2.Add;var item=data;item.action_data=Utils.Json.flatten({articleid:scope.$articleid,commentid:item.id,fromProduct:item.fromProduct,comm_uid:item.uid,uname:item.nick_name,ulink:item.ulink,src_uid:item.src_uid,cms_reply_num:item.cms_reply_num});item.uname=item.nick_name;item.action_data=encodeURIComponent(item.action_data);var $li=comment.render(item);$container.insertBefore($li,$container.firstChild);changeHASH()};var changeHASH=function(){location.hash="cmt_"+cid};var showTip=function(){v7sendLog("40_01_45");$E("blogTip").style.display="";var tween=new Ui.TweenStrategy(0,1,.5);tween.onTween=function(value){Core.Dom.setStyle($E("blogTip"),"opacity",value)};tween.onEnd=function(){tween=null;setTimeout(hideTip,5e3)};tween.start()};var hideTip=function(){var tween=new Ui.TweenStrategy(1,0,.5);tween.onTween=function(value){Core.Dom.setStyle($E("blogTip"),"opacity",value)};tween.onEnd=function(){tween=null;$E("blogTip").style.display="none"};tween.start()}});CommentV2.CommentForCheck=Core.Class.create();CommentV2.CommentForCheck.prototype={initialize:function(opt){this._opt=opt;if(scope.$commentlistIsReady){this.load()}else{Lib.Listener.on({name:"commentlist-isready",callBack:this.load,scope:this})}},getParam:function(){return this._opt},load:function(){if($E("cmt_"+this._opt.cms_id)){this.setHashPos();return}var param=this.getParam();this.getInterface=new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/profile/note/getCms.php","jsload");this.getInterface.request({GET:param,onSuccess:function(_data){this.rander(_data)}.bind2(this),onError:function(_data){},onFail:function(){}})},rander:function(item){var $container=$E("article_comment_list");var comment=new CommentV2.Add;item.action_data=Utils.Json.flatten({commentid:item.id,articleid:scope.$articleid,fromProduct:item.fromProduct,comm_uid:item.comm_uid,uname:item.nick_name,ulink:item.ulink});item.uname=item.nick_name;item.action_data=encodeURIComponent(item.action_data);if(item.fromProduct=="weibo"){item.from='<img height="15" align="absmiddle" width="15" class="SG_icon SG_icon51" src="http://simg.sinajs.cn/images/common/sg_trans.gif">'}var $li=comment.render(item);$container.insertBefore($li,$container.firstChild);this.setHashPos()},setHashPos:function(){var oldhash=window.location.hash;window.location.hash="cmt_"+this._opt.cms_id;window.location.hash=oldhash}};$registJob("commentForCheck",function(){if(/cmtforcheck_/.test(location.hash)){var hashs=location.hash.split("_");var param={cms_id:hashs[1],uid:hashs[2]};new CommentV2.CommentForCheck(param)}});$registJob("uatrack",function(){Lib.sendSuda(function(){var pageid=scope.$pageid;var _byClass=Core.Dom.byClass;switch(pageid){case"editor":var el=_byClass("msnTips_lx","div");if(el){v7sendLog("41_01_05");SUDA.uaTrack("blog_post","v_post1")}break;case"article":case"articleM":var btjblog=$E("module_909");var blogxg=$E("module_903");var tjblog=$E("module_904");if(btjblog){SUDA.uaTrack("blog_btjblog","v_btjblog")}if(blogxg){SUDA.uaTrack("blog_xg","v_blogxg")}if(tjblog){SUDA.uaTrack("blog_tjblog","v_tjblog")}break}})});$registJob("hotAdvertise",function(){var col1=document.getElementById("column_1");var comps=Core.Dom.byClass("SG_conn","div",col1);var module_903=document.getElementById("module_903")||comps[comps.length-1];var html='<div class="SG_conn" suda-uatrack="key=blog_article&value=h_article53" id="hotShangPin"></div>';Utils.insertTemplate(module_903,html,"BeforeBegin");Lib.execZhitou(function(res){blogAd.insertIns("PDPS000000057414",$E("hotShangPin"),"Afterbegin");(window.sinaads||[]).push({})});var module_903=document.getElementById("module_903")||comps[comps.length-1];var tpl='<div class="SG_conn"><!--博客左侧推荐商讯210*220按钮(扶翼) Start--><ins class="sinaads" data-ad-pdps="PDPS000000057669"></ins><script>(sinaads = window.sinaads || []).push({})</script><!--博客左侧推荐商讯210*220按钮(扶翼) End—></div>';Utils.insertTemplate(module_903,tpl,"AfterEnd");(sinaads=window.sinaads||[]).push({});Lib.execZhitou(function(res){var recommendShangXun=document.getElementById("recommendShangXun");if(recommendShangXun){blogAd.insertIns("PDPS000000052390",recommendShangXun.children[1].children[0].children[0],"Afterbegin");(window.sinaads||[]).push({params:{sinaads_ad_tpl:'<li class="SG_j_linedot1"><p class="atcTitCell_tit SG_dot"><a target="_blank" suda-uatrack="key=blog_article&value=h_article50" href="#{link}" onclick="try{#{monitor}}catch(e){}">#{src}</a></p><p class="atcTitCell_nm"><a target="_blank" suda-uatrack="key=blog_article&value=h_article50" href="#{link}" onclick="try{#{monitor}}catch(e){}" class="SG_linkb" style="display:inline-block;height:14px; line-height:14px; white-space:normal; overflow:hidden;">#{src1}</a></p></li>'}})}})});$registJob("notAeAd",function(){var col1=document.getElementById("column_1");var comps=Core.Dom.byClass("SG_conn","div",col1);var module_904=document.getElementById("module_904")||comps[comps.length-1];var html='<div id="notAe" class="SG_conn"></div>';Utils.insertTemplate(module_904,html,"BeforeBegin");Lib.execZhitou(function(){blogAd.insertIns("593E0A43A6FE",$E("notAe"),"Afterbegin");(window.sinaads||[]).push({})})});$registJob("xgBlogAD",function(){var newVersion=scope.$pageid=="articleM_new"||scope.$pageid=="article_new";var $getByClass=Core.Dom.getElementsByClass;var $insertHTML=Core.Dom.insertHTML;var xgWrap=$E("module_903");var bodyWrapper,secondLi,thirdLi,liCount,moreWrapper;var sloturl="http://comet.blog.sina.com.cn/api?maintype=pagexg";var sourceID="SLOT_89";var adTpl_xg1='<li class="SG_j_linedot1">'+'<p class="atcTitCell_tit SG_dot">'+'<a {{a_c_suda}} href="{{a_href}}" target="_blank" title="{{a_title}}">{{words}}</a>'+"</p>"+'<p class="atcTitCell_nm">'+'<a {{a_c_suda}} href="{{a_href}}" class="SG_linkb" target="_blank">{{author}}</a>'+"</p>"+"</li>";var adTpl_xg2='<li class="reco_bloglist_con">'+'<span class="blogname">'+'<a {{a_c_suda}} onclick="v7sendLog(\'41_01_07\');" href="{{a_href}}" target="_blank" title="{{a_title}}">{{words}}</a>'+"</span>"+'<span class="bloguser">'+'<a {{a_c_suda}} onclick="v7sendLog(\'41_01_07\');" class="SG_linkb" href="{{a_href}}" target="_blank">{{author}}</a>'+"</span>"+"</li>";var adTpl_xg3="<li>"+"<p class=Ltit>"+'<a {{a_c_suda}} class="BNE_lkA" href="{{a_href}}" target="_blank" title="{{a_title}}"><i class="icon i7_dot"></i>{{words}}</a>'+"</p>"+'<p class="Lname">'+'<a {{a_c_suda}} class="BNE_lkB" href="{{a_href}}" class="SG_linkb" target="_blank">{{author}}</a>'+"</p>"+"</li>";var adTpl_common1='<li class="SG_j_linedot1">'+'<p class="atcTitCell_tit SG_dot">'+'<a {{a_c_suda}} href="{{a_href}}" target="_blank" title="{{a_title}}">{{a_title}}</a>'+"</p>"+'<p class="atcTitCell_nm">'+'<a {{a_c_suda}} href="http://blog.sina.com.cn/u/{{uid}}" class="SG_linkb" target="_blank">{{author}}</a>'+"</p>"+"</li>";var adTpl_common2='<li class="reco_bloglist_con">'+'<span class="blogname">'+'<a {{a_c_suda}} onclick="v7sendLog(\'41_01_07\');" href="{{a_href}}" target="_blank" title="{{a_title}}">{{a_title}}</a>'+"</span>"+'<span class="bloguser">'+'<a {{a_c_suda}} onclick="v7sendLog(\'41_01_07\');" class="SG_linkb" href="http://blog.sina.com.cn/u/{{uid}}" target="_blank">{{author}}</a>'+"</span>"+"</li>";var adTpl_common3="<li>"+"<p class=Ltit>"+'<a {{a_c_suda}} class="BNE_lkA" href="{{a_href}}" target="_blank" title="{{a_title}}"><i class="icon i7_dot"></i>{{a_title}}</a>'+"</p>"+'<p class="Lname">'+'<a {{a_c_suda}} class="BNE_lkB" href="http://blog.sina.com.cn/u/{{uid}}" class="SG_linkb" target="_blank">{{author}}</a>'+"</p>"+"</li>";function tplToData(template,data){var t,key,reg;for(key in data){reg=new RegExp("{{"+key+"}}","ig");t=(t||template).replace(reg,data[key])}return t}function reqData(){Lib.checkAuthor(function(){Utils.Io.JsLoad.request(sloturl,{GET:{id:sourceID,uid:$UID||0,blogerid:scope.$uid||0},onComplete:function(res){var data=null;if(res[sourceID]){data=res[sourceID].res[0]}if(data){if(scope.$pageid=="articletj"){var htmlxg2=tplToData(adTpl_xg2,data);$insertHTML(secondLi,htmlxg2,"AfterEnd")}else if(newVersion){var htmlxg3=tplToData(adTpl_xg3,data);$insertHTML(secondLi,htmlxg3,"AfterEnd")}else{var htmlxg1=tplToData(adTpl_xg1,data);$insertHTML(secondLi,htmlxg1,"AfterEnd")}if(SUDA){SUDA.uaTrack(data.a_v_suda_key,data.a_v_suda_value)}}reqRelatedBlog()},onException:function(res){}})},"xgBlogAD"+(new Date).getTime())}function reqRelatedBlog(){var articleId=scope.$articleid;var cateId=scope.$cate_id;var sortId=scope.$sort_id;if(articleId){var url="http://blog.sina.com.cn/s/related_"+articleId+".js";var reqdata={cate_id:cateId,sort_id:sortId};bodyWrapper=newVersion?$getByClass(xgWrap,"ul","crlaList"):$getByClass(xgWrap,"div","SG_connBody");moreWrapper=newVersion?$getByClass(xgWrap,"div","more"):$getByClass(xgWrap,"div","atcTit_more");if(scope.$pageid=="articletj"){liCount=$getByClass(bodyWrapper[0],"li","reco_bloglist_con").length}else if(newVersion){liCount=$getByClass(bodyWrapper[0],"li","").length}else{liCount=$getByClass(bodyWrapper[0],"li","SG_j_linedot1").length}if(liCount>3){return}Utils.Io.Ajax.request(url,{returnType:"json",GET:reqdata,onComplete:function(res){var res2=res.slideReads;var res=res.relatedReads;if(scope.$pageid=="articletj"){var ulNode=$getByClass(bodyWrapper[0],"ul","reco_bloglist have_user")[0];if(ulNode){for(var i=0;i<res.length;i++){var htmlcommon2=tplToData(adTpl_common2,res[i]);$insertHTML(ulNode,htmlcommon2,"BeforeEnd")}}}else if(newVersion){var ulNode=bodyWrapper[0];if(ulNode){for(var i=0;i<res.length;i++){var htmlcommon3=tplToData(adTpl_common3,res[i]);$insertHTML(ulNode,htmlcommon3,"BeforeEnd")}}}else{var ulNode=$getByClass(bodyWrapper[0],"ul","")[0];if(ulNode){for(var i=0;i<res.length;i++){var htmlcommon1=tplToData(adTpl_common1,res[i]);$insertHTML(ulNode,htmlcommon1,"BeforeEnd")}}}var moreNode=$getByClass(moreWrapper[0],"a","")[0];if(moreNode){if(sortId=="111"){moreNode.setAttribute("href","http://finance.sina.com.cn/blog/8.html")}else if(sortId=="153"){moreNode.setAttribute("href","http://finance.sina.com.cn/blog/2.html")}}if(typeof window.scope.___fnForListenerSlot==="function"){window.scope.___fnForListenerSlot(res2)}else{window.scope.___fnForListenerSlot=res2}},onException:function(res){}})}}if(scope.$pageid=="articletj"){bodyWrapper=$getByClass(xgWrap,"div","SG_connBody");secondLi=$getByClass(bodyWrapper[0],"li","reco_bloglist_con")[1]}else if(newVersion){bodyWrapper=$getByClass(xgWrap,"ul","crlaList");secondLi=$getByClass(bodyWrapper[0],"li","")[1]}else{bodyWrapper=$getByClass(xgWrap,"div","SG_connBody");secondLi=$getByClass(bodyWrapper[0],"li","SG_j_linedot1")[1]}if(secondLi){reqData()}});Lib.register("blogAppAd",function(lib){function scrollAdLeft(){Core.Dom.insertHTML(document.body,'<div id="sinaads_pdps54771"></div>',"beforeend");var cookieKeyName="sinaads_blogAppAd_"+scope.$PRODUCT_NAME+scope.$pageid;if(document.cookie.indexOf(cookieKeyName)===-1){var insdiv=document.getElementById("sinaads_pdps54771");insdiv.innerHTML=' <ins class="sinaads" data-ad-pdps="PDPS000000054771"></ins>  ';(sinaads=window.sinaads||[]).push({params:{sinaads_ls_root:"sinablogbody",sinaads_ls_cookieKey:cookieKeyName}});var expires=new Date;expires.setTime(expires.getTime()+24*60*60*1e3);document.cookie="blogAppAd_"+scope.$PRODUCT_NAME+scope.$pageid+"=1; expires="+expires.toGMTString()}}lib.execZhitou(function(){scrollAdLeft()});var Panel=lib.Panel;var ad=new Panel;ad.init=function(root){var cookieName="blogAppAd_"+scope.$PRODUCT_NAME+scope.$pageid;var blogappCookie=Utils.Cookie.getCookie(cookieName);if(blogappCookie=="1"){return}var self=this;var baseUrl="http://comet.blog.sina.com.cn/qr?";var urlmap={blog7indexM:"http://blog.sina.com.cn/main_v5/ria/app_515_7.html",blog7index:"http://blog.sina.com.cn/main_v5/ria/app_515_7.html",blog7articleM:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7article:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7articletj:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7articletjTech:"http://blog.sina.com.cn/main_v5/ria/app_515_8.html",blog7icpprofile_index:"http://blog.sina.com.cn/main_v5/ria/app_515_9.html",blog7articlelistM:"http://blog.sina.com.cn/main_v5/ria/app_515_10.html",blog7articlelist:"http://blog.sina.com.cn/main_v5/ria/app_515_10.html",blog7photoindex:"http://blog.sina.com.cn/main_v5/ria/app_515_11.html",blog7photophoto:"http://blog.sina.com.cn/main_v5/ria/app_515_12.html"};root=Core.Dom.getElementsByClass(null,"div",root)[0];var realurl=urlmap[scope.$PRODUCT_NAME+scope.$pageid];if(!root||!realurl)return;var url=baseUrl+realurl;var template='<div style="position:absolute;width:140px;height:330px; text-align:center;z-index:999;" id="#{panel}">                                <a href="http://blog.sina.com.cn/s/blog_86f95d450102uzt1.html" target="_blank" ><img src="http://simg.sinajs.cn/blog7style/images/activity/app_tuiguang/activity.png" style="display:block;border:0 none;"></a>                                <a href="http://blog.sina.com.cn/s/blog_86f95d450102uzt1.html" target="_blank" style="background:#fff;border:1px solid #dbdbdb; border-top:0 none; height:117px; padding-top:5px; display:block; text-decoration:none;">                                    <img src="http://comet.blog.sina.com.cn/qr?http://blog.sina.com.cn/lm/z/xytx22/index.html" width="70" height="70" style="display:block; border:0 none; margin:0 auto 3px;">                                    <span style=" display:block;line-height:1;font-size:12px;margin-bottom:5px;color:#6e6e6e;text-align:center; font-family:Helvetica,\'Microsoft YaHei\'">新阅天下客户端</span>                                    <span style=" display:block;line-height:1;font-size:18px;color:#5f5f5f;text-align:center;font-family:Helvetica,\'Microsoft YaHei\';"> 扫一扫下载</span>                                    <span node-action="close" style="position:absolute;z-index:99;right:0px;bottom:0px;width:15px;height:15px;text-align:center;line-height:17px; overflow:hidden;border:1px solid #cbcbcb;cursor:pointer;font-size:15px;color:#5f5f5f; font-family:SimSun;font-weight:700;" title="关闭">×</span>                                </a>                            </div>';self.setTemplate(template);var templateWidth=parseInt(Core.Dom.getStyle(self.entity,"width"),10);var paddingTop=parseInt(Core.Dom.getStyle(root,"paddingTop"),10);var panelHeight=parseInt(Core.Dom.getStyle(self.entity,"height"),10);var marginLeft=10;self.setFixed(true);resize();var closeBtn=Core.Dom.getElementsByAttr(self.entity,"node-action","close")[0];function close(){Core.Events.stopDefaultEvent();ad.close();Core.Events.removeEvent(closeBtn,close);Core.Events.removeEvent(window,resize,"resize");Utils.Cookie.setCookie(cookieName,"1",24)}function winSize(){var e=window,a="inner";if(!("innerWidth"in window)){a="client";e=document.documentElement||document.body}return{width:e[a+"Width"],height:e[a+"Height"]}}var resizeT;function resize(){if(resizeT)clearTimeout(resizeT);resizeT=setTimeout(function(){var maxHeight=winSize().height;var rootOffset=Core.Dom.getXY(root);var left=rootOffset[0]-templateWidth-marginLeft;var top=rootOffset[1]+paddingTop;left=left>0?left:0;top=top+panelHeight>maxHeight?maxHeight-panelHeight-20:top;self.setPosition(left,top)},300)}Core.Events.addEvent(closeBtn,close);Core.Events.addEvent(window,resize,"resize");Core.Events.addEvent(window,resize,"scroll");self.show()};return ad});$registJob("blogAppAd",function(){Lib.blogAppAd.init("sinablogbody")});Utils.tpl=function(tpl,data){return tpl.replace(/{(\w+)}/g,function(all,match){return data[match]})};$registJob("goldPan",function(){var addEvent=Core.Events.addEvent;var getElementsByAttr=Core.Dom.getElementsByAttr;var stopDefaultEvent=Core.Events.stopDefaultEvent;var getEvent=Core.Events.getEvent;var getEventTarget=Core.Events.getEventTarget;var trim=Core.String.trim;var Radio=Utils.Form.Radio;var pageInfo={articleid:scope.$articleid,uid:scope.$uid,_uid:typeof $UID!=="undefined"?$UID:null,goldPanNum:0,_goldPanNum:0};var itf={getGoldPanNum:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/goldpen/user_goldpen_num.php","ijax"),giveGoldpan:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/goldpen/donate.php","ijax"),redeem:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/points/points_redeem.php","ijax"),zindexGold:new Interface("http://control.blog.sina.com.cn/blog_rebuild/riaapi/goldpen/goldpen_rank.php","ijax")};var MSG={M00:"赠送成功~！",M10:"请输入1~100整数",M11:"请选择或者输入您要赠送的金笔数",M12:"请求失败",M13:"赠送失败",M14:"不能给自己的文章赠送金笔"};var lock=0;var popup={tpl:'<table class="CP_w" id="#{panel}" style="z-index: 5000">'+"<thead>"+"<tr>"+'<th class="tLeft"><span></span></th>'+'<th class="tMid"><div class="bLyTop"><strong>赠金笔</strong><cite><a node-data="btn-close" href="#" class="CP_w_shut" title="关闭">关闭</a></cite></div></th>'+'<th class="tRight"><span></span></th>'+"</tr>"+"</thead>"+"<tfoot>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid"><span></span></td>'+'<td class="tRight"><span></span></td>'+"</tr>"+"</tfoot>"+"<tbody>"+"<tr>"+'<td class="tLeft"><span></span></td>'+'<td class="tMid"><div class="CP_layercon3 jiben">'+'<div class="SG_tag tag_h">'+"<ul>"+'<li class="current"><span><strong><a node-data="gold-exchange" href="javascript:void(0)">金笔兑换</a></strong></span><span class="tagR"></span></li>'+'<li><span><strong><a node-data="tyrant-standings" href="javascript:void(0)">今日土豪榜</a></strong></span><span class="tagR"></span></li>'+'<li><span><strong><a node-data="nomination-list" href="javascript:void(0)">今日提名榜</a></strong></span><span class="tagR"></span></li>'+"</ul>"+"</div>"+'<div name="jiben_tab" class="jiben_tab">'+'<ul class="denPicRow denPicRow01 clearfix" name="radioAll">'+'<li><span class="a">兑换服务：</span><span class="b">金笔道具</span></li>'+'<li><span class="a"><span class="CP_w_star"></span>赠送数量：</span><span class="b rlist">'+'<input name="num" value="1" type="radio" id="jb1">'+'<label for="jb1">1支</label>'+'<input name="num" value="10" type="radio" id="jb2">'+'<label for="jb2">10支</label>'+'<input name="num" value="20" type="radio" id="jb3">'+'<label for="jb3">20支</label>'+'<input name="num" value="50" type="radio" id="jb4">'+'<label for="jb4">50支</label>'+'<input name="num" value="100" type="radio" id="jb5">'+'<label for="jb5">100支</label>'+"<br>"+'<input name="num" value="0" type="radio" id="jb5">'+'<label for="jb6">其他</label>'+'<input type="text" maxLength="4" class="SG_input" id="jb6" node-data="other-num" value="请输入整数">'+"</span>"+"</li>"+'<li><span class="a cold">现有金笔：</span><span class="b cold" node-data="own-num">12支</span></li>'+'<li><span class="a cold">还需兑换：</span><span class="b cold" node-data="need-num">2支 x 50=100(积分)</span></li>'+"</ul>"+'<div id="hidden"></div>'+'<div class="butt01" id="button01"><a node-data="btn-ok" href="#" class="SG_aBtn SG_aBtnB "><cite>确认</cite></a><a target="_blank" href="http://blog.sina.com.cn/s/blog_4b0f52990102v0dd.html" class="jf_rule">点击了解更多规则</a></div>'+"</div>"+'<div class="clearit"></div>'+"</div></td>"+'<td class="tRight"><span></span></td>'+"</tr>"+"</tbody>"+"</table>",thTpl:"<tr>"+'<th width="50px" align="center"><a href="{1}"><img src="{0}"></a></th>'+'<th width="240px" align="left"><a href="{1}">{2}</a></th>'+'<th width="105px" align="left">{3}<!--今日提名榜此处是“收到金笔”--></th>'+'<th width="110px" align="left"><strong><span>{4}</span>支</strong></th>'+'<th align="left"><img src="http://simg.sinajs.cn/blog7style/images/common/badge/badge14.png" class="badge" style="background-image:url(../../images/common/badge/badge14.png);_background-image: url(../../images/common/badge/badge14.gif);"></th>'+"</tr>",testTpl:"<tr>"+'<td align="center"><a href="{1}"><img src="{0}"></a></td>'+'<td><a href="{1}">{2}</a></td>'+"<td>{3}</td>"+"<td><strong><span>{4}</span>支</strong></td>"+'<td><img src="http://simg.sinajs.cn/blog7style/images/common/badge/badge14.png" class="badge" style="background-image:url(../../images/common/badge/badge14.png);_background-image: url(../../images/common/badge/badge14.gif);"></td>'+"</tr>",w:669,h:412,bs:null,panel:null,box:null,radios:null,input:null,ownNumEl:null,needNumEl:null,cNum:1,price:1,updateTag:null,goldExchange:null,tyrantStandings:null,nominationList:null,init:function(){var self=this;var bs=popup.bs=new BackShadow(.4);var panel=popup.panel=new Lib.Panel;panel.setTemplate(self.tpl);var box=self.box=panel.getNode("panel");self.radios=getElementsByAttr(box,"name","num");self.input=getElementsByAttr(box,"node-data","other-num")[0];self.ownNumEl=getElementsByAttr(self.box,"node-data","own-num")[0];self.needNumEl=getElementsByAttr(self.box,"node-data","need-num")[0];self.goldExchange=getElementsByAttr(self.box,"node-data","gold-exchange")[0];self.tyrantStandings=getElementsByAttr(self.box,"node-data","tyrant-standings")[0];self.nominationList=getElementsByAttr(self.box,"node-data","nomination-list")[0];self.initBox();self.initEvent();self.setPosition()},initBox:function(){var self=this;var radios=self.radios;var len=radios.length;var num=self.cNum;Radio.set(radios,num);if(!parseInt(Radio.get(radios))){radios[len-1].checked=true;self.input.value=num}self.input.value=MSG["M10"];self.ownNumEl.innerHTML=pageInfo._goldPanNum+"支";self.changeNeed(num)},initEvent:function(){var self=this;addEvent(self.input,function(){var val=self.getNum(self.input);self.radios[self.radios.length-1].checked=true;self.input.value=val||""},"focus");addEvent(self.input,function(){var val=self.getNum(self.input);self.input.value=val||MSG["M10"];self.changeNeed(val)},"blur");addEvent(self.box,function(){var ev=getEvent();var tarEl=getEventTarget(ev);var ntype=tarEl.getAttribute("node-data")||tarEl.parentNode.getAttribute("node-data");if(ntype=="btn-close"){stopDefaultEvent();self.hide()}else if(ntype=="btn-ok"){stopDefaultEvent();if(!lock){lock=1;self.submit()}}else{var val=self.getNum();val!=self.cNum?self.changeNeed(val):""}});addEvent(self.goldExchange,function(){var jibenTab=getElementsByAttr(self.box,"name","jiben_tab")[0];var hidden=$E("hidden");var button01=$E("button01");var radioAll=getElementsByAttr(document.getElementsByTagName("body")[0],"name","radioAll")[0];radioAll.style.display="block";hidden.style.display="none";button01.style.display="block";self.goldExchange.parentNode.parentNode.parentNode.className="current";self.tyrantStandings.parentNode.parentNode.parentNode.className="";self.nominationList.parentNode.parentNode.parentNode.className=""});addEvent(self.tyrantStandings,function(){var jibenTab=getElementsByAttr(self.box,"name","jiben_tab")[0];var radioAll=getElementsByAttr(document.getElementsByTagName("body")[0],"name","radioAll")[0];var hidden=$E("hidden");var button01=$E("button01");button01.style.display="none";radioAll.style.display="none";hidden.style.display="block";self.goldExchange.parentNode.parentNode.parentNode.className="";self.tyrantStandings.parentNode.parentNode.parentNode.className="current";self.nominationList.parentNode.parentNode.parentNode.className="";itf.zindexGold.request({GET:{type:"donate"},onSuccess:function(data){if(data.length){var html='<table width="100%" border="0" cellspacing="0" cellpadding="0" class="top_tab">';for(var i=0;i<data.length;i++){if(i==0){html=html+Utils.tpl(self.thTpl,[data[i]["photo"],"http://blog.sina.com.cn/u/"+data[i]["uid"],data[i]["nickname"],"送出金笔",data[i]["number"]])}else{html=html+Utils.tpl(self.testTpl,[data[i]["photo"],"http://blog.sina.com.cn/u/"+data[i]["uid"],data[i]["nickname"],"送出金笔",data[i]["number"]])}}html=html+'</table><div class="butt01"> <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/goldpen_rank.php?action=1" class="SG_aBtn SG_aBtnB "><cite>查看更多</cite></a></div>';hidden.innerHTML=html}else{hidden.innerHTML=""}},onError:function(result){if(result.code=="A00005"){alert("非法操作")}else if(result.code=="A11007"){alert("非博客用户，只是新浪用户")}else if(result.code=="00015"){alert("参数错误")}},onFail:function(){console.log(arguments[0])}})});addEvent(self.nominationList,function(){var jibenTab=getElementsByAttr(self.box,"name","jiben_tab")[0];var radioAll=getElementsByAttr(document.getElementsByTagName("body")[0],"name","radioAll")[0];var hidden=$E("hidden");var button01=$E("button01");button01.style.display="none";radioAll.style.display="none";hidden.style.display="block";self.goldExchange.parentNode.parentNode.parentNode.className="";self.tyrantStandings.parentNode.parentNode.parentNode.className="";self.nominationList.parentNode.parentNode.parentNode.className="current";itf.zindexGold.request({GET:{type:"receive"},onSuccess:function(data){if(data.length){var html='<table width="100%" border="0" cellspacing="0" cellpadding="0" class="top_tab">';
for(var i=0;i<data.length;i++){if(i==0){html=html+Utils.tpl(self.thTpl,[data[i]["photo"],"http://blog.sina.com.cn/u/"+data[i]["uid"],data[i]["nickname"],"收到金笔",data[i]["number"]])}else{html=html+Utils.tpl(self.testTpl,[data[i]["photo"],"http://blog.sina.com.cn/u/"+data[i]["uid"],data[i]["nickname"],"收到金笔",data[i]["number"]])}}html=html+'</table><div class="butt01"> <a href="http://control.blog.sina.com.cn/blog_rebuild/profile/controllers/goldpen_rank.php?action=2" class="SG_aBtn SG_aBtnB "><cite>查看更多</cite></a></div>';hidden.innerHTML=html}else{hidden.innerHTML=""}},onError:function(result){if(result.code=="A00005"){alert("非法操作")}else if(result.code=="A11007"){alert("非博客用户，只是新浪用户")}else if(result.code=="00015"){alert("参数错误")}},onFail:function(){}})})},changeNeed:function(n){var self=this;var need=0;if(n>pageInfo._goldPanNum){need=n-pageInfo._goldPanNum}self.cNum=n;self.needNumEl.innerHTML=need+"支 x "+self.price+"="+need*self.price+"(积分)"},updateOwnNum:function(type){var self=this;var time=(new Date).valueOf();if(type!=1&&(!pageInfo._uid||time-self.updateTag<60*1e3))return;self.updateTag=time;itf.getGoldPanNum.request({GET:{uid:pageInfo._uid},onSuccess:function(data){pageInfo._goldPanNum=parseInt(data&&data.total)||0;self.initBox();self.updateTag=(new Date).valueOf()},onError:function(result){},onFail:function(){}})},getNum:function(input){var num=input?Math.abs(parseInt(trim(input.value))||0):Math.abs(parseInt(Radio.get(this.radios)/1||this.input.value/1||0));return num>100?100:num},submit:function(){var self=this;var num=self.getNum();if(pageInfo.uid==pageInfo._uid){winDialog.alert(MSG["M14"]);lock=0;return}if(!num){winDialog.alert(MSG["M11"]);lock=0;return}else if(num>pageInfo._goldPanNum){var newnum=num-pageInfo._goldPanNum;redeemGoldpan(newnum,function(s,t){if(s){giveGoldpan({blogid:pageInfo.articleid,num:num,newnum:newnum},function(s,t){if(s){winDialog.alert(MSG["M00"]);updateActGPN();self.updateOwnNum(1);self.hide();lock=0}else{winDialog.alert(t);lock=0}});pageInfo._goldPanNum=num;self.ownNumEl.innerHTML=num+"支";self.changeNeed(num)}else{winDialog.alert(t);lock=0}})}else{giveGoldpan({blogid:pageInfo.articleid,num:num},function(s,t){if(s){winDialog.alert(MSG["M00"]);updateActGPN();self.updateOwnNum(1);self.hide();lock=0}else{winDialog.alert(t);lock=0}})}},show:function(){this.updateOwnNum();this.bs.show();this.panel.show()},hide:function(){this.panel.hide();this.bs.hidden()},setPosition:function(){var self=this;var win=Core.System.winSize();var x=win.width/2-self.w/2;var y=win.height/2-self.h/2-20;self.panel.setPosition(x,y);self.panel.setFixed(true)}};var popupLiked={tpl:['<table class="CP_w" id="#{panel}" style="z-index: 5000">',"<thead>","<tr>",'<th class="tLeft"><span></span></th>','<th class="tMid"><div class="bLyTop"><strong>提示</strong><cite><a href="#" class="CP_w_shut" data-node="btn-close" title="关闭">关闭</a></cite></div></th>','<th class="tRight"><span></span></th>',"</tr>","</thead>","<tfoot>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid"><span></span></td>','<td class="tRight"><span></span></td>',"</tr>","</tfoot>","<tbody>","<tr>",'<td class="tLeft"><span></span></td>','<td class="tMid">','<div class="CP_layercon9 jinbi_f">',"<p><strong>写的不错，送支金笔奖励一下吧！只需要1积分哦！！！！！</strong></p>",'<p class="CP_w_btns_Mid"><a class="SG_aBtn SG_aBtnB" href="#" data-node="btn-ok"><cite>确认</cite></a></p>',"</div>","</td>",'<td class="tRight"><span></span></td>',"</tr>","</tbody>","</table>"].join(""),w:396,h:198,bs:null,panel:null,box:null,init:function(){var self=this;var bs=self.bs=new BackShadow(.4);var panel=self.panel=new Lib.Panel;panel.setTemplate(self.tpl);var box=self.box=panel.getNode("panel");var closeBtn=getElementsByAttr(box,"data-node","btn-close")[0];var okBtn=getElementsByAttr(box,"data-node","btn-ok")[0];addEvent(closeBtn,function(){stopDefaultEvent();self.hide()});addEvent(okBtn,function(){stopDefaultEvent();if(!lock){lock=1;self.submit()}});self.setPosition();self.isInit=1},submit:function(){var self=this;var num=1;if(pageInfo.uid==pageInfo._uid){winDialog.alert(MSG["M14"]);lock=0;return}if(pageInfo._goldPanNum<num){var newnum=num-pageInfo._goldPanNum;redeemGoldpan(newnum,function(s,t){if(s){giveGoldpan({blogid:pageInfo.articleid,num:num,newnum:newnum},function(s,t){if(s){winDialog.alert(MSG["M00"]);updateActGPN();self.hide();lock=0}else{winDialog.alert(t);lock=0}})}else{winDialog.alert(t);lock=0}})}else{giveGoldpan({blogid:pageInfo.articleid,num:num},function(s,t){if(s){winDialog.alert(MSG["M00"]);updateActGPN();self.hide();lock=0}else{winDialog.alert(t);lock=0}})}},show:function(){!this.isInit?this.init():"";this.bs.show();this.panel.show()},hide:function(){this.panel.hide();this.bs.hidden()},setPosition:function(){var self=this;var win=Core.System.winSize();var x=win.width/2-self.w/2;var y=win.height/2-self.h/2-20;self.panel.setPosition(x,y);self.panel.setFixed(true)}};function getUserData(cb){var attention=new Interface("http://blogtj.sinajs.cn/api/get_attention_num.php","jsload");var getVal={uid:$UID,suid:$UID,attention:"suid",userpointuid:$UID,s:"1"};attention.request({GET:getVal,onSuccess:function(oData){cb(oData)},onError:function(){cb({})},onFail:function(){cb({})}})}function redeemGoldpan(num,cb){itf.redeem.request({POST:{type:10,num:num,user:"",auto:0},onSuccess:function(data){cb(true)},onError:function(result){cb(false,result&&result.data)},onFail:function(){cb(false,MSG["M12"])}})}function giveGoldpan(data,cb){itf.giveGoldpan.request({POST:data,onSuccess:function(data){cb(1)},onError:function(result){cb(0,result&&result.data)},onFail:function(){cb(0,MSG["M13"])}})}function updateActGPN(){Utils.Io.JsLoad.request("http://comet.blog.sina.com.cn/api?maintype=goldpen&blogid="+pageInfo.articleid,{onComplete:function(data){var el=$E("goldPan-num");if(data&&el){el.innerHTML=pageInfo.goldPanNum=parseInt(data.blog_receive)||0}},onException:function(){}})}function initGoldPan(){updateActGPN();Lib.checkAuthor(function(){popup.init();$isLogin?getUserData(function(data){pageInfo._userpoint=data.userpoint;pageInfo._goldPanNum=data.goldpen;if(data.userpoint>0||data.goldpen>0){Lib.Listener.on({name:"article_like_success",callBack:function(){popupLiked.show()}})}}):"";addEvent($E("goldPan-give"),function(){if(!$isLogin){var Login=new Lib.Login.Ui;Login.login(function(){scope.blogOpener.showDialog(function(){pageInfo._uid=$UID;popup.show()})},false,"referer:"+location.hostname+location.pathname+",func:giveGoldpan")}else{popup.show();var jibenTab=getElementsByAttr(document.getElementsByTagName("body")[0],"name","jiben_tab")[0];var otherNum=getElementsByAttr(document.getElementsByTagName("body")[0],"node-data","other-num")[0];getElementsByAttr(document.getElementsByTagName("body")[0],"node-data","gold-exchange")[0].parentNode.parentNode.parentNode.className="current";getElementsByAttr(document.getElementsByTagName("body")[0],"node-data","tyrant-standings")[0].parentNode.parentNode.parentNode.className="";getElementsByAttr(document.getElementsByTagName("body")[0],"node-data","nomination-list")[0].parentNode.parentNode.parentNode.className="";var radioAll=getElementsByAttr(document.getElementsByTagName("body")[0],"name","radioAll")[0];var hidden=$E("hidden");var button01=$E("button01");button01.style.display="block";radioAll.style.display="block";hidden.style.display="none"}})},"goldPan"+(new Date).getTime())}initGoldPan()});$registJob("wenjuan1",function(){time=new Date("Thu Aug 26 2015 14:00:00 GMT+0800 (CST)").getTime();var now=+new Date;if(now<=time){drawBtn()}function drawBtn(){var panel=new Lib.Panel;root=$E("sinablogbody");var html='<a id="#{panel}" onclick="window.v7sendLog(\'15_05_03\')" href="http://www.wenjuan.com/s/mEZNNb/" target="_blank" style="display: block; padding: 5px 0; background:#ff3030; color: #ffe400; width: 58px; text-align: center; font-weight: bold; font-size: 22px; text-decoration: none; line-height:24px;">有奖调查</a>';panel.noIframe=true;panel.setTemplate(html);var tWidth=parseInt(Core.Dom.getStyle(panel.entity,"width"));panel.setFixed(true);panel.show();var lt=getLT();panel.setPosition(lt.left,lt.top);var addEvent=Core.Events.addEvent;addEvent(window,resize,"resize");addEvent(window,resize,"scroll");var resizeT;function resize(){if(resizeT)clearTimeout(resizeT);resizeT=setTimeout(function(){var lt=getLT();panel.setPosition(lt.left,lt.top)},300)}function getLT(){var btnWidth=58,btnHeight=58;var ws=Core.System.winSize();var rootOffset=Core.Dom.getXY(root);var rootWidth=parseInt(Core.Dom.getStyle(root,"width"));var left=Math.min(ws.width-btnWidth-20,rootOffset[0]+rootWidth+5);var top=Math.max(ws.height-260-btnHeight,80);if(top>80){top-=68}else{top+=68}return{left:left,top:top}}}});$registJob("articleMaxImg",function(){var pageid=scope.$pageid,getElementsByClass=Core.Dom.getElementsByClass,getStyle=Core.Dom.getStyle,maxWidth="100%",content;function setMax(img,max,width){setTimeout(function(){if(img.width>width){if("max-width"in img.style){img.style["max-width"]=max}else{img.style.width=max}}if(img.width==1)setMax(img,max,width)},100)}function setImgMax(contents,max){if(!contents||!contents[0]){return}var width=parseInt(getStyle(contents[0],"width"),10);for(var i=0;i<contents.length;i++){var content=contents[i];var imgs=content.getElementsByTagName("img");for(var k=0;k<imgs.length;k++){var img=imgs[k];setMax(img,max,width)}}}if(pageid=="indexM"||pageid=="index"){content=$E("module_10001_SG_connBody");var contents=getElementsByClass(content,"div","content");setImgMax(contents,maxWidth)}else if(pageid=="articleM"||pageid=="article"){content=$E("sina_keyword_ad_area2");setImgMax([content],maxWidth)}});$registJob("article_10years_suda",function(){var md=$E("module_920")||$E("module_10001");Core.Events.addEvent(md,function(evt){if(evt.target&&evt.target.tagName==="A"&&evt.target.href=="http://blog.sina.com.cn/lm/ten"){v7sendLog("15_04_17_"+scope.$uid)}})});function main(){var isTj=window.location.href.indexOf("tj=1")>-1;if(isTj){v7sendLog("42_01_07")}var listener=Lib.Listener;listener.add("tray-ad-tips");var job=new Jobs;job.add("suda");job.add("tray");job.add("trayTipsAd");job.add("renderAd");job.add("showTB680");job.add("digger");job.add("articleDigger");job.add("recordVisitor");job.add("renderReblogDiv");job.add("articleCommentV2");job.add("goldPan");job.add("blogNotice");job.add("trashPv");job.add("adNoticeChannel");job.add("articleMaxImg");job.add("imageLazyLoad");job.add("articleComp1");job.add("articleNumberV2");job.add("articleCommentPostV2",2);job.add("quote");job.add("quote_list");job.add("dynamicVoteView");job.add("updownurl");job.add("articleComp2");job.add("sharePhoto");job.add("templateClone",3);job.add("favGames");job.add("teams_wc");job.add("calendar_wc");job.add("randomScroll",3);job.add("audioCheck",3);job.add("subscribe",3);job.add("articleShare",3);job.add("report_bodyArticle");job.add("flashtemplate",3);job.add("stylefix",3);job.add("miniBlogAttention");job.add("baby_headPhoto");job.add("baby_babyBarFlashDetect");job.add("scrollAd");job.add("static");job.add("userResidenceTime");job.add("blog365Slide");job.add("SinglesDay");job.add("selectionShare",2);job.add("tranVideo");job.add("errorTips");job.add("toZoneStatic",3);job.add("tjAd",3);job.add("showSlideBox",3);job.add("showSlideBtn",3);job.add("xingqu",3);job.add("osl_article",3);job.add("padSwitch");job.add("loginFollow");job.add("uatrack");job.add("blogTip");job.add("commentForCheck");job.add("xgBlogAD",2);job.add("blogAppAd");job.add("hotAdvertise",2);job.add("notAeAd",2);job.add("article_10years_suda");job.add("wenjuan1");job.start()}